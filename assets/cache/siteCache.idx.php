<?php
$c=&$this->config;
$c['manager_theme'] = "MODxCarbon";
$c['settings_version'] = "1.0.6";
$c['show_meta'] = "0";
$c['server_offset_time'] = "0";
$c['server_protocol'] = "http";
$c['manager_language'] = "russian-UTF8";
$c['modx_charset'] = "UTF-8";
$c['site_name'] = "Skveez";
$c['site_start'] = "1";
$c['error_page'] = "1";
$c['unauthorized_page'] = "1";
$c['site_status'] = "1";
$c['track_visitors'] = "0";
$c['top_howmany'] = "10";
$c['auto_template_logic'] = "sibling";
$c['default_template'] = "3";
$c['old_template'] = "3";
$c['publish_default'] = "1";
$c['cache_default'] = "1";
$c['search_default'] = "1";
$c['friendly_urls'] = "1";
$c['friendly_url_prefix'] = "";
$c['friendly_url_suffix'] = ".html";
$c['friendly_alias_urls'] = "1";
$c['use_alias_path'] = "1";
$c['use_udperms'] = "1";
$c['udperms_allowroot'] = "0";
$c['failed_login_attempts'] = "5";
$c['blocked_minutes'] = "30";
$c['use_captcha'] = "0";
$c['captcha_words'] = "0,1,2,3,4,5,6,7,8,9";
$c['emailsender'] = "mail@ieremeev.ru";
$c['number_of_logs'] = "100";
$c['number_of_messages'] = "30";
$c['number_of_results'] = "20";
$c['use_editor'] = "1";
$c['use_browser'] = "1";
$c['rb_base_dir'] = "/var/www/lancer/data/www/skveez.aqua-host.ru/assets/";
$c['rb_base_url'] = "assets/";
$c['which_editor'] = "TinyMCE";
$c['fe_editor_lang'] = "russian-UTF8";
$c['fck_editor_toolbar'] = "standard";
$c['fck_editor_autolang'] = "0";
$c['editor_css_path'] = "";
$c['editor_css_selectors'] = "";
$c['strip_image_paths'] = "1";
$c['upload_images'] = "bmp,ico,gif,jpeg,jpg,png,psd,tif,tiff";
$c['upload_media'] = "au,avi,mp3,mp4,mpeg,mpg,wav,wmv";
$c['upload_flash'] = "fla,flv,swf";
$c['upload_files'] = "aac,au,avi,css,cache,doc,docx,gz,gzip,htaccess,htm,html,js,mp3,mp4,mpeg,mpg,ods,odp,odt,pdf,ppt,pptx,rar,tar,tgz,txt,wav,wmv,xls,xlsx,xml,z,zip,JPG,JPEG,PNG,GIF";
$c['upload_maxsize'] = "1048576";
$c['new_file_permissions'] = "0644";
$c['new_folder_permissions'] = "0755";
$c['filemanager_path'] = "/var/www/lancer/data/www/skveez.aqua-host.ru/";
$c['theme_refresher'] = "";
$c['manager_layout'] = "4";
$c['custom_contenttype'] = "application/rss+xml,application/pdf,application/vnd.ms-word,application/vnd.ms-excel,text/html,text/css,text/xml,text/javascript,text/plain";
$c['auto_menuindex'] = "1";
$c['session.cookie.lifetime'] = "604800";
$c['mail_check_timeperiod'] = "60";
$c['manager_direction'] = "ltr";
$c['tinymce_editor_theme'] = "editor";
$c['tinymce_custom_plugins'] = "style,advimage,advlink,searchreplace,print,contextmenu,paste,fullscreen,nonbreaking,xhtmlxtras,visualchars,media";
$c['tinymce_custom_buttons1'] = "undo,redo,selectall,separator,pastetext,pasteword,separator,search,replace,separator,nonbreaking,hr,charmap,separator,image,link,unlink,anchor,media,separator,cleanup,removeformat,separator,fullscreen,print,code,help";
$c['tinymce_custom_buttons2'] = "bold,italic,underline,strikethrough,sub,sup,separator,bullist,numlist,outdent,indent,separator,justifyleft,justifycenter,justifyright,justifyfull,separator,styleselect,formatselect,separator,styleprops";
$c['tree_show_protected'] = "0";
$c['rss_url_news'] = "http://feeds.feedburner.com/modx-announce";
$c['rss_url_security'] = "http://feeds.feedburner.com/modxsecurity";
$c['validate_referer'] = "1";
$c['datepicker_offset'] = "-10";
$c['xhtml_urls'] = "0";
$c['allow_duplicate_alias'] = "0";
$c['automatic_alias'] = "1";
$c['datetime_format'] = "dd-mm-YYYY";
$c['warning_visibility'] = "0";
$c['tree_page_click'] = "27";
$c['clean_uploaded_filename'] = "1";
$c['remember_last_tab'] = "1";
$c['site_id'] = "50fe110e78262";
$c['site_unavailable_page'] = "";
$c['reload_site_unavailable'] = "";
$c['site_unavailable_message'] = "В настоящее время сайт недоступен.";
$c['siteunavailable_message_default'] = "В настоящее время сайт недоступен.";
$c['reload_captcha_words'] = "";
$c['captcha_words_default'] = "MODx,Access,Better,BitCode,Chunk,Cache,Desc,Design,Excell,Enjoy,URLs,TechView,Gerald,Griff,Humphrey,Holiday,Intel,Integration,Joystick,Join(),Oscope,Genetic,Light,Likeness,Marit,Maaike,Niche,Netherlands,Ordinance,Oscillo,Parser,Phusion,Query,Question,Regalia,Righteous,Snippet,Sentinel,Template,Thespian,Unity,Enterprise,Verily,Tattoo,Veri,Website,WideWeb,Yap,Yellow,Zebra,Zygote";
$c['reload_emailsubject'] = "";
$c['emailsubject'] = "Данные для авторизации";
$c['emailsubject_default'] = "Данные для авторизации";
$c['reload_signupemail_message'] = "";
$c['signupemail_message'] = "Здравствуйте, [+uid+]!\r\n\r\nВаши данные для авторизации в системе управления сайтом [+sname+]:\r\n\r\nИмя пользователя: [+uid+]\r\nПароль: [+pwd+]\r\n\r\nПосле успешной авторизации в системе управления сайтом ([+surl+]), вы сможете изменить свой пароль.\r\n\r\nС уважением, Администрация";
$c['system_email_signup_default'] = "Здравствуйте, [+uid+]!\r\n\r\nВаши данные для авторизации в системе управления сайтом [+sname+]:\r\n\r\nИмя пользователя: [+uid+]\r\nПароль: [+pwd+]\r\n\r\nПосле успешной авторизации в системе управления сайтом ([+surl+]), вы сможете изменить свой пароль.\r\n\r\nС уважением, Администрация";
$c['reload_websignupemail_message'] = "";
$c['websignupemail_message'] = "Здравствуйте, [+uid+]!\r\n\r\nВаши данные для авторизации на [+sname+]:\r\n\r\nИмя пользователя: [+uid+]\r\nПароль: [+pwd+]\r\n\r\nПосле успешной авторизации на [+sname+] ([+surl+]), вы сможете изменить свой пароль.\r\n\r\nС уважением, Администрация";
$c['system_email_websignup_default'] = "Здравствуйте, [+uid+]!\r\n\r\nВаши данные для авторизации на [+sname+]:\r\n\r\nИмя пользователя: [+uid+]\r\nПароль: [+pwd+]\r\n\r\nПосле успешной авторизации на [+sname+] ([+surl+]), вы сможете изменить свой пароль.\r\n\r\nС уважением, Администрация";
$c['reload_system_email_webreminder_message'] = "";
$c['webpwdreminder_message'] = "Здравствуйте, [+uid+]!\r\n\r\nЧтобы активировать ваш новый пароль, перейдите по следующей ссылке:\r\n\r\n[+surl+]\r\n\r\nПозже вы сможете использовать следующий пароль для авторизации: [+pwd+]\r\n\r\nЕсли это письмо пришло к вам по ошибке, пожалуйста, проигнорируйте его.\r\n\r\nС уважением, Администрация";
$c['system_email_webreminder_default'] = "Здравствуйте, [+uid+]!\r\n\r\nЧтобы активировать ваш новый пароль, перейдите по следующей ссылке:\r\n\r\n[+surl+]\r\n\r\nПозже вы сможете использовать следующий пароль для авторизации: [+pwd+]\r\n\r\nЕсли это письмо пришло к вам по ошибке, пожалуйста, проигнорируйте его.\r\n\r\nС уважением, Администрация";
$c['rb_webuser'] = "0";
$c['tinymce_custom_buttons3'] = "";
$c['tinymce_custom_buttons4'] = "";
$c['tinymce_css_selectors'] = "";
$this->aliasListing = array();
$a = &$this->aliasListing;
$d = &$this->documentListing;
$m = &$this->documentMap;
$d['index'] = 1;
$a[1] = array('id' => 1, 'alias' => 'index', 'path' => '', 'parent' => 0);
$m[] = array('0' => '1');
$d['system.php'] = 3;
$a[3] = array('id' => 3, 'alias' => 'system.php', 'path' => '', 'parent' => 0);
$m[] = array('0' => '3');
$d['test'] = 4;
$a[4] = array('id' => 4, 'alias' => 'test', 'path' => '', 'parent' => 0);
$m[] = array('0' => '4');
$c = &$this->contentTypes;
$c = &$this->chunkCache;
$c['ie6nomore'] = '<!--[if lt IE 9]>
	<script type="text/javascript" src="assets/js/ie6nomore/ie6_script_other.js"></script>
	<script type="text/javascript" src="js/html5.js"></script>
<![endif]-->

';
$c['feedback'] = '[!eForm? &formid=`feedbackForm` &subject=`Сообщение с сайта` &tpl=`eFeedbackForm` &report=`eFeedbackReport` &gotoid=`[*id*]` &vericode=`1` !] 

';
$c['eFeedbackReport'] = '<p>Прислано человеком, с именем: [+name+] . Подробности ниже:</p>
<table>
<tr valign="top"><td>Имя:</td><td>[+name+]</td></tr>
<tr valign="top"><td>E-mail:</td><td>[+email+]</td></tr>
<tr valign="top"><td>Номер телефона:</td><td>[+phone+]</td></tr>
<tr valign="top"><td>Текст сообщения:</td><td>[+comments+]</td></tr>
</table>
<p>Можно использовать ссылку для ответа: <a href="mailto:[+email+]?subject=RE:[+subject+]">[+email+]</a></p>

';
$c['fancybox'] = '<script type="text/javascript" src="/assets/js/fancybox/jquery.mousewheel-3.0.6.pack.js"></script>
<script type="text/javascript" src="/assets/js/fancybox/jquery.fancybox.js"></script>
<script type="text/javascript" src="/assets/js/fancybox/jquery.fancybox-conf.js"></script>
<link rel="stylesheet" type="text/css" href="/assets/js/fancybox/jquery.fancybox.css" media="screen" />';
$c['mm_rules'] = '// more example rules are in assets/plugins/managermanager/example_mm_rules.inc.php

mm_widget_showimagetvs(); // Показываем превью ТВ

mm_renameField(\'log\', \'Дочерние ресурсы отображаются в дереве\');
mm_changeFieldHelp(\'log\', \'Это поле используется для папок с большим числом вложенных страниц\');

mm_createTab(\'Для SEO\', \'seo\', \'\', \'\', \'\', \'\');
mm_moveFieldsToTab(\'titl,keyw,desc,seoOverride,noIndex\', \'seo\', \'\', \'\');
mm_widget_tags(\'keyw\',\',\'); // Give blog tag editing capabilities to the \'documentTags (3)\' TV


//mm_createTab(\'Изображения\', \'photos\', \'\', \'\', \'\', \'850\');
//mm_moveFieldsToTab(\'images,photos\', \'photos\', \'\', \'\');

//mm_hideFields(\'longtitle,description,link_attributes,menutitle,content\', \'\', \'6,7\');

//mm_hideTemplates(\'0,5,8,9,11,12\', \'2,3\');

//mm_hideTabs(\'settings, access\', \'2\');

//mm_widget_evogallery(1, Галерея, \'1,2,3\', 3);   // подключаем галерею 
//mm_galleryLink($fields, $roles, $templates, $moduleid);
//mm_widget_evogallery($moduleid, $title, $roles, $templates);';
$c['eFeedbackForm'] = '<p><span style="color:#900;">[+validationmessage+]</span></p>

<form  class="eform" method="post" action="[~[*id*]~]">

<input type="hidden" name="formid" value="feedbackForm" />

<p>
    <input type="text" name="name" id="name" class="grid_3" value=""  eform="Имя:string:1"/>
    <label for="name">Ваше имя</label>
</p>
            
<p>
    <input type="text" name="email" id="email" class="grid_3" value="" eform="E-mail:email:1" />
    <label for="email">Ваш E-mail</label>
</p>
            
<p>
    <input type="text" name="phone" id="subject" class="grid_3" value="" eform="Номер телефона:string:1"/>
    <label for="subject">Номер телефона</label>
</p>
            
<p>
    <textarea name="comments" id="message" class="grid_6" cols="50" rows="10" eform="Текст сообщения:string:1"></textarea>
</p>
<p>Введите код с картинки: <br />
    <input type="text" class="ver" name="vericode" /><img class="feed" src="[+verimageurl+]" alt="Введите код" />
</p>            
<p>
    <input type="submit" name="submit" class="grid_2" value="Отправить сообщение"  class="subeform"/>
 </p>

</form>


 

';
$c['Untitled chunk'] = '<table border="0" cellspacing="0" cellpadding="0" width="100%" style="padding-top:24px;padding-left:15px;"><tbody><tr>
			<td><span class="textpopup">Фамилия</span></td>
			<td><input type="text" id="sename" class="initinput" value=""/></td>
			<td width="40px;"><div class="chf"></div></td>
		</tr><tr>
			<td><span class="textpopup">Имя</span></td>
			<td><input type="text" id="namename" class="initinput" value=""/></td>
			<td><div class="chn"></div></td>
		</tr><tr>
			<td><span class="textpopup">Отчество</span></td>
			<td><input type="text" id="secname" class="initinput" value=""/></td>
			<td><div class="cho"></div></td>
		</tr><tr>
			<td><span class="textpopup">Email</span></td>
			<td><input type="text" id="email" class="initinput" value=""/></td>
			<td><div class="che"></div></td>
		</tr><tr>
			<td><span class="textpopup">Телефон</span></td>
			<td><input type="text" id="phone1" class="initinput2" maxlength="3" value=""/><input type="text" id="phone2" class="initinput3" value=""/></td>
			<td><div class="chp"></div></td>
		</tr><tr>
			<td></td>
			<td colspan="2" height="20px" valign="middle"><span class="oper">для оперативной связи для вручения призов</span></td>
		</tr></tbody></table>
';
$c['number'] = '';
$s = &$this->snippetCache;
$s['splitPagination'] = '/* 

PURPOSE
When a Ditto result set is large, the pagination can grow too large to fit comfortably and usably on the page. 
This snippet provides alternative "Google" style pagination, where a maximum number of pages are shown - the 
first and last pages of the results, and the pages immediately surrounding the current page.
 e.g. instead Ditto\'s default pagination output of

[1] [2] [3] [4] [5] [6] [7] [8] [9] [10] [*11*] [12] [13] [14] [15] [16] [17] [18] [19] [20]

(current page is 11) this snippet produces

[1] [2] ... [8] [9] [10] [*11*] [12] [13] [14] ... [19] [20]


REQUIREMENTS
This snippet is tested with Ditto 2.1 in ModX Evo 1.0.x


INSTALLATION
Create a new snippet named splitPagination, and paste the contents of this file into it. 


USAGE
Place the snippet immediately following a Ditto call. 

e.g. 1 

[[splitPagination]]
will just create a placeholder named "splitPages" - to insert the pagination bar into the correct place of your document use the [+splitPages+] placeholder

e.g.2
[[splitPagination? &id=`myDitto` &pagesToShow=`10` &constantEndCount=`3` &ellipses=`myChunk` &return=`1`]]
will output the pagination directly, using data obtained from the Ditto call with the ID of "myDitto". 
It will display a maximum of 10 links to pages, with three before/after the ellipses at the beginning and end. 
The HTML to use for the ellipses will be obtained from the "myChunk" chunk.


PARAMETERS

 Param: id

    Purpose:
    If there is more than one Ditto call on a page, or your Ditto call has the ID paramater set, this is required to 
	know which Ditto ID to use.

    Options:
    Ditto ID parameter
	
	Default:
    <none>
	
	
	
 Param: pagesToShow

    Purpose:
    Maximum number of page links to show. Any pages above this number will be replaced by ellipses. 
	Sets of ellipses are included in this count, to ensure the total size of the pagination remains largely 
	the same regardless of current position.

    Options:
    Number
	
	Default:
    15	
	


 Param: constantEndCount

    Purpose:
    Number of pages links to display at the beginning and end of the results set, before and after the ellipses
	e.g. set to 2, the results would display:	
	[1] [2] ... [99] [100]
	
	or set to 4, the results would display:
	[1] [2] [3] [4] ... [97] [98] [99] [100]	

    Options:
    Number
	
	Default:
    2	
	
	
 Param: return

    Purpose:
    Output the pagination directly from the location of the snippet, rather than to a placeholder

    Options:
    Boolean
	
	Default:
    0	


	
 Param: tplEllipses

    Purpose:
    Chunk name, or HTML that should be used to indicate a break in the page numbering. ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.

    Options:
    Chunk name or HTML
	
	Default:
    <span class="splitPagination">...</span>	
	

 Param: tplCurrent

    Purpose:
    Chunk name, or HTML that should be used for the current results page. ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.
	
	The [+page+] placeholder will be replaced by the page number
	The [+class+] placeholder will be replace by a class representing first or last items if this applies (see firstClass and lastClass params)

    Options:
    Chunk name or HTML
	
	Default:
    <span class="ditto_currentpage ditto_page_[+page+][+class+]">[+page+]</span>		
	
	

 Param: tplPageLink

    Purpose:
    Chunk name, or HTML that should be used for links to all results page (other than current). ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.
	
	The [+page+] placeholder will be replaced by the page number
	The [+url+] placeholder will be replaced by the link URL
	The [+class+] placeholder will be replace by a class representing first or last items if this applies (see firstClass and lastClass params)

    Options:
    Chunk name or HTML
	
	Default:
    <a class="ditto_page ditto_page_[+page+][+class+]" href="[+url+]">[+page+]</a>



 Param: firstClass

    Purpose:
    Class applied to the first page link
	
    Options:
    HTML class
	
	Default:
    first



 Param: lastClass

    Purpose:
    Class applied to the last page link
	
    Options:
    HTML class
	
	Default:
    last
	

---------------------------------------------------------------------------------------
The following parameters are available as manual overrides, however they are normally 
populated with correct values automatically.
	
	
 Param: total

    Purpose:
   	Total number of results from the Ditto query - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results	
	
	
	
 Param: start

    Purpose:
   	Start position of results from the Ditto query - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results		
	
	
	
 Param: display

    Purpose:
   	Number of results per page to display - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results	
	
	
	
 Param: currentPage

    Purpose:
   	Override current page. Usually automatically calculated. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From URL	


	
 Param: landing

    Purpose:
   	Landing page for pagination links. 

    Options:
    Document ID
	
	Default:
    Current page
	
	


 


*/



if (!function_exists("generatePagination")) {
	
function generatePagination($currentPage, $totalResults, $resultsPerPage, $pagesToShow, $constantEndCount) {
	
	// How many pages are there altogether?
	$totalPages = ceil($totalResults / $resultsPerPage);
	
	// How far through are we?
	$pagesBefore = $currentPage - 1;
	$pagesAfter = $totalPages - $currentPage;
	
	// An array of tabs to display (made up of page numbers)
	$tabArr = array();
	
	// If we need to split the pagination
	if($totalPages > $pagesToShow) {
		
		// If we\'re currently more than half way through
		if($pagesBefore > $pagesToShow/2) {
			
			// Always show pages 1 and 2 (or whatever the constant end count is), then a separator
			for($i=1; $i<=$constantEndCount; $i++) { $tabArr[] = $i; }
			$tabArr[] = 0;
				
			// If the number of pages after the current page is more than the number of available slots
			if($pagesAfter >= $pagesToShow/2) {
				$empty_slots_before = floor( ($pagesToShow - ($constantEndCount*2 /*there are two ends*/) - 1 /*the current page*/) / 2 /*only half*/) -1  /*the set of dots counts as one slot*/;
			} else {
				$empty_slots_before = $pagesToShow - count($tabArr) - 1 /*current page*/ - $pagesAfter /*How many after*/;
			}
			
			// Insert the tabs	
			for($i=($currentPage-$empty_slots_before); $i<$currentPage; $i++) { $tabArr[] = $i; }	
			
		} else {
			for($i=1; $i<$currentPage; $i++) { $tabArr[] = $i; }
		}
		
		// Insert current page
		$tabArr[] = $currentPage;		
		
		// If we\'re less than half way through
		if($pagesAfter > $pagesToShow/2) {
			
			// How many more slots do we want to show after the current page?
			$empty_slots_after = $pagesToShow - count($tabArr) - $constantEndCount - 1/*the set of dots*/;
			
			// Insert the tabs	
			for($i=($currentPage+1); $i<=$currentPage+$empty_slots_after; $i++) { $tabArr[] = $i; }
			
			// Add a separator
			$tabArr[] = 0;
			
			// Always show pages last 2 pages (or whatever the constant end count is)
			for($i=$totalPages-$constantEndCount+1; $i<=$totalPages; $i++) { $tabArr[] = $i; }

		} else {
			for($i=($currentPage+1); $i<=$totalPages; $i++) { $tabArr[] = $i; }
		}
		
	} else { // No need to split the pagination
		for($i=1;$i<=$totalPages;$i++) { $tabArr[] = $i; }
	}
			
	return $tabArr;
	
	} // end function
} // end if




// ----------------------------------------------------------------------------------------------------------------







// Define some paramaters
$id = isset($id) ? $id.\'_\' : \'\';
$total = isset($total) ? $total : $modx->getPlaceholder($id."total");
$start = isset($start) ? $start : $modx->getPlaceholder($id."start");
$display = isset($display) ? $display : $modx->getPlaceholder($id."perPage");
$currentPage = isset($currentPage) ? $currentPage : $modx->getPlaceholder($id."current");
$landing = isset($tagDocumentID) ? $tagDocumentID : $modx->documentObject[\'id\'];

$pagesToShow = isset($pagesToShow) && is_numeric($pagesToShow) ? $pagesToShow : 15;
$constantEndCount = isset($constantEndCount) && is_numeric($constantEndCount) ? $constantEndCount : 2;


$tplEllipses = isset($tplEllipses) ? $modx->getChunk($tplEllipses) : \'\';
$tplEllipses = !empty($tplEllipses) ? $tplEllipses : \'<span class="splitPagination">...</span>\';

$tplCurrent = isset($tplCurrent) ? $modx->getChunk($tplCurrent) : \'\';
$tplCurrent = !empty($tplCurrent) ? $tplCurrent : \'<span class="ditto_currentpage ditto_page_[+page+][+class+]">[+page+]</span>\';

$tplPageLink = isset($tplPageLink) ? $modx->getChunk($tplPageLink) : \'\';
$tplPageLink = !empty($tplPageLink) ? $tplPageLink : \'<a class="ditto_page ditto_page_[+page+][+class+]" href="[+url+]">[+page+]</a>\';

$firstClass = isset($firstClass) ? $firstClass: \'first\';
$lastClass = isset($lastClass) ? $lastClass: \'last\';


$return = isset($return) ? $return : 0;

// Do nothing if there\'s nothing to do
if ($total == 0 || $display==0 || $total <= $display) {
	return false;
}

// What page are we on?
$page = ceil($start/$display);

// Generate the pagination
$paginationArray = generatePagination($page, $total, $display, $pagesToShow, $constantEndCount);

// Create empty placeholder for output
$ph = "";

// Build the output
foreach($paginationArray as $page) {
	$inc = ($page-1)*$display;
	
	// First or last classes
	if ($page == 1) { 
			$newClass = \' \' . $firstClass;
	} else if ($page == ceil($total/$display)) {
		$newClass = \' \' . $lastClass;
	} else {
		$newClass = \'\';
	}
	
	// Insert into output
	if($page == 0) {
		$ph .= $tplEllipses; // print an elipse, representing pages that aren\'t displayed
	} else if ($inc==$_GET[$id.\'start\']) {
		$newLink = str_replace(\'[+class+]\', $newClass , $tplCurrent);
		$ph .= str_replace(\'[+page+]\', $page, $newLink);	
	} else {
		$newLink = str_replace(\'[+url+]\', ditto::buildURL("start=".$inc,$landing,$id) , $tplPageLink);		
		$newLink = str_replace(\'[+class+]\', $newClass , $newLink);
		$ph .= str_replace(\'[+page+]\', $page, $newLink);	
	}
}

// Set the placeholder
$modx->setPlaceholder($id."splitPages",$ph);

// Or return the output
if ($return) return $ph;';
$s['splitPagination'] = '/* 

PURPOSE
When a Ditto result set is large, the pagination can grow too large to fit comfortably and usably on the page. 
This snippet provides alternative "Google" style pagination, where a maximum number of pages are shown - the 
first and last pages of the results, and the pages immediately surrounding the current page.
 e.g. instead Ditto\'s default pagination output of

[1] [2] [3] [4] [5] [6] [7] [8] [9] [10] [*11*] [12] [13] [14] [15] [16] [17] [18] [19] [20]

(current page is 11) this snippet produces

[1] [2] ... [8] [9] [10] [*11*] [12] [13] [14] ... [19] [20]


REQUIREMENTS
This snippet is tested with Ditto 2.1 in ModX Evo 1.0.x


INSTALLATION
Create a new snippet named splitPagination, and paste the contents of this file into it. 


USAGE
Place the snippet immediately following a Ditto call. 

e.g. 1 

[[splitPagination]]
will just create a placeholder named "splitPages" - to insert the pagination bar into the correct place of your document use the [+splitPages+] placeholder

e.g.2
[[splitPagination? &id=`myDitto` &pagesToShow=`10` &constantEndCount=`3` &ellipses=`myChunk` &return=`1`]]
will output the pagination directly, using data obtained from the Ditto call with the ID of "myDitto". 
It will display a maximum of 10 links to pages, with three before/after the ellipses at the beginning and end. 
The HTML to use for the ellipses will be obtained from the "myChunk" chunk.


PARAMETERS

 Param: id

    Purpose:
    If there is more than one Ditto call on a page, or your Ditto call has the ID paramater set, this is required to 
	know which Ditto ID to use.

    Options:
    Ditto ID parameter
	
	Default:
    <none>
	
	
	
 Param: pagesToShow

    Purpose:
    Maximum number of page links to show. Any pages above this number will be replaced by ellipses. 
	Sets of ellipses are included in this count, to ensure the total size of the pagination remains largely 
	the same regardless of current position.

    Options:
    Number
	
	Default:
    15	
	


 Param: constantEndCount

    Purpose:
    Number of pages links to display at the beginning and end of the results set, before and after the ellipses
	e.g. set to 2, the results would display:	
	[1] [2] ... [99] [100]
	
	or set to 4, the results would display:
	[1] [2] [3] [4] ... [97] [98] [99] [100]	

    Options:
    Number
	
	Default:
    2	
	
	
 Param: return

    Purpose:
    Output the pagination directly from the location of the snippet, rather than to a placeholder

    Options:
    Boolean
	
	Default:
    0	


	
 Param: tplEllipses

    Purpose:
    Chunk name, or HTML that should be used to indicate a break in the page numbering. ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.

    Options:
    Chunk name or HTML
	
	Default:
    <span class="splitPagination">...</span>	
	

 Param: tplCurrent

    Purpose:
    Chunk name, or HTML that should be used for the current results page. ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.
	
	The [+page+] placeholder will be replaced by the page number
	The [+class+] placeholder will be replace by a class representing first or last items if this applies (see firstClass and lastClass params)

    Options:
    Chunk name or HTML
	
	Default:
    <span class="ditto_currentpage ditto_page_[+page+][+class+]">[+page+]</span>		
	
	

 Param: tplPageLink

    Purpose:
    Chunk name, or HTML that should be used for links to all results page (other than current). ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.
	
	The [+page+] placeholder will be replaced by the page number
	The [+url+] placeholder will be replaced by the link URL
	The [+class+] placeholder will be replace by a class representing first or last items if this applies (see firstClass and lastClass params)

    Options:
    Chunk name or HTML
	
	Default:
    <a class="ditto_page ditto_page_[+page+][+class+]" href="[+url+]">[+page+]</a>



 Param: firstClass

    Purpose:
    Class applied to the first page link
	
    Options:
    HTML class
	
	Default:
    first



 Param: lastClass

    Purpose:
    Class applied to the last page link
	
    Options:
    HTML class
	
	Default:
    last
	

---------------------------------------------------------------------------------------
The following parameters are available as manual overrides, however they are normally 
populated with correct values automatically.
	
	
 Param: total

    Purpose:
   	Total number of results from the Ditto query - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results	
	
	
	
 Param: start

    Purpose:
   	Start position of results from the Ditto query - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results		
	
	
	
 Param: display

    Purpose:
   	Number of results per page to display - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results	
	
	
	
 Param: currentPage

    Purpose:
   	Override current page. Usually automatically calculated. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From URL	


	
 Param: landing

    Purpose:
   	Landing page for pagination links. 

    Options:
    Document ID
	
	Default:
    Current page
	
	


 


*/



if (!function_exists("generatePagination")) {
	
function generatePagination($currentPage, $totalResults, $resultsPerPage, $pagesToShow, $constantEndCount) {
	
	// How many pages are there altogether?
	$totalPages = ceil($totalResults / $resultsPerPage);
	
	// How far through are we?
	$pagesBefore = $currentPage - 1;
	$pagesAfter = $totalPages - $currentPage;
	
	// An array of tabs to display (made up of page numbers)
	$tabArr = array();
	
	// If we need to split the pagination
	if($totalPages > $pagesToShow) {
		
		// If we\'re currently more than half way through
		if($pagesBefore > $pagesToShow/2) {
			
			// Always show pages 1 and 2 (or whatever the constant end count is), then a separator
			for($i=1; $i<=$constantEndCount; $i++) { $tabArr[] = $i; }
			$tabArr[] = 0;
				
			// If the number of pages after the current page is more than the number of available slots
			if($pagesAfter >= $pagesToShow/2) {
				$empty_slots_before = floor( ($pagesToShow - ($constantEndCount*2 /*there are two ends*/) - 1 /*the current page*/) / 2 /*only half*/) -1  /*the set of dots counts as one slot*/;
			} else {
				$empty_slots_before = $pagesToShow - count($tabArr) - 1 /*current page*/ - $pagesAfter /*How many after*/;
			}
			
			// Insert the tabs	
			for($i=($currentPage-$empty_slots_before); $i<$currentPage; $i++) { $tabArr[] = $i; }	
			
		} else {
			for($i=1; $i<$currentPage; $i++) { $tabArr[] = $i; }
		}
		
		// Insert current page
		$tabArr[] = $currentPage;		
		
		// If we\'re less than half way through
		if($pagesAfter > $pagesToShow/2) {
			
			// How many more slots do we want to show after the current page?
			$empty_slots_after = $pagesToShow - count($tabArr) - $constantEndCount - 1/*the set of dots*/;
			
			// Insert the tabs	
			for($i=($currentPage+1); $i<=$currentPage+$empty_slots_after; $i++) { $tabArr[] = $i; }
			
			// Add a separator
			$tabArr[] = 0;
			
			// Always show pages last 2 pages (or whatever the constant end count is)
			for($i=$totalPages-$constantEndCount+1; $i<=$totalPages; $i++) { $tabArr[] = $i; }

		} else {
			for($i=($currentPage+1); $i<=$totalPages; $i++) { $tabArr[] = $i; }
		}
		
	} else { // No need to split the pagination
		for($i=1;$i<=$totalPages;$i++) { $tabArr[] = $i; }
	}
			
	return $tabArr;
	
	} // end function
} // end if




// ----------------------------------------------------------------------------------------------------------------







// Define some paramaters
$id = isset($id) ? $id.\'_\' : \'\';
$total = isset($total) ? $total : $modx->getPlaceholder($id."total");
$start = isset($start) ? $start : $modx->getPlaceholder($id."start");
$display = isset($display) ? $display : $modx->getPlaceholder($id."perPage");
$currentPage = isset($currentPage) ? $currentPage : $modx->getPlaceholder($id."current");
$landing = isset($tagDocumentID) ? $tagDocumentID : $modx->documentObject[\'id\'];

$pagesToShow = isset($pagesToShow) && is_numeric($pagesToShow) ? $pagesToShow : 15;
$constantEndCount = isset($constantEndCount) && is_numeric($constantEndCount) ? $constantEndCount : 2;


$tplEllipses = isset($tplEllipses) ? $modx->getChunk($tplEllipses) : \'\';
$tplEllipses = !empty($tplEllipses) ? $tplEllipses : \'<span class="splitPagination">...</span>\';

$tplCurrent = isset($tplCurrent) ? $modx->getChunk($tplCurrent) : \'\';
$tplCurrent = !empty($tplCurrent) ? $tplCurrent : \'<span class="ditto_currentpage ditto_page_[+page+][+class+]">[+page+]</span>\';

$tplPageLink = isset($tplPageLink) ? $modx->getChunk($tplPageLink) : \'\';
$tplPageLink = !empty($tplPageLink) ? $tplPageLink : \'<a class="ditto_page ditto_page_[+page+][+class+]" href="[+url+]">[+page+]</a>\';

$firstClass = isset($firstClass) ? $firstClass: \'first\';
$lastClass = isset($lastClass) ? $lastClass: \'last\';


$return = isset($return) ? $return : 0;

// Do nothing if there\'s nothing to do
if ($total == 0 || $display==0 || $total <= $display) {
	return false;
}

// What page are we on?
$page = ceil($start/$display);

// Generate the pagination
$paginationArray = generatePagination($page, $total, $display, $pagesToShow, $constantEndCount);

// Create empty placeholder for output
$ph = "";

// Build the output
foreach($paginationArray as $page) {
	$inc = ($page-1)*$display;
	
	// First or last classes
	if ($page == 1) { 
			$newClass = \' \' . $firstClass;
	} else if ($page == ceil($total/$display)) {
		$newClass = \' \' . $lastClass;
	} else {
		$newClass = \'\';
	}
	
	// Insert into output
	if($page == 0) {
		$ph .= $tplEllipses; // print an elipse, representing pages that aren\'t displayed
	} else if ($inc==$_GET[$id.\'start\']) {
		$newLink = str_replace(\'[+class+]\', $newClass , $tplCurrent);
		$ph .= str_replace(\'[+page+]\', $page, $newLink);	
	} else {
		$newLink = str_replace(\'[+url+]\', ditto::buildURL("start=".$inc,$landing,$id) , $tplPageLink);		
		$newLink = str_replace(\'[+class+]\', $newClass , $newLink);
		$ph .= str_replace(\'[+page+]\', $page, $newLink);	
	}
}

// Set the placeholder
$modx->setPlaceholder($id."splitPages",$ph);

// Or return the output
if ($return) return $ph;';
$s['splitPagination'] = '/* 

PURPOSE
When a Ditto result set is large, the pagination can grow too large to fit comfortably and usably on the page. 
This snippet provides alternative "Google" style pagination, where a maximum number of pages are shown - the 
first and last pages of the results, and the pages immediately surrounding the current page.
 e.g. instead Ditto\'s default pagination output of

[1] [2] [3] [4] [5] [6] [7] [8] [9] [10] [*11*] [12] [13] [14] [15] [16] [17] [18] [19] [20]

(current page is 11) this snippet produces

[1] [2] ... [8] [9] [10] [*11*] [12] [13] [14] ... [19] [20]


REQUIREMENTS
This snippet is tested with Ditto 2.1 in ModX Evo 1.0.x


INSTALLATION
Create a new snippet named splitPagination, and paste the contents of this file into it. 


USAGE
Place the snippet immediately following a Ditto call. 

e.g. 1 

[[splitPagination]]
will just create a placeholder named "splitPages" - to insert the pagination bar into the correct place of your document use the [+splitPages+] placeholder

e.g.2
[[splitPagination? &id=`myDitto` &pagesToShow=`10` &constantEndCount=`3` &ellipses=`myChunk` &return=`1`]]
will output the pagination directly, using data obtained from the Ditto call with the ID of "myDitto". 
It will display a maximum of 10 links to pages, with three before/after the ellipses at the beginning and end. 
The HTML to use for the ellipses will be obtained from the "myChunk" chunk.


PARAMETERS

 Param: id

    Purpose:
    If there is more than one Ditto call on a page, or your Ditto call has the ID paramater set, this is required to 
	know which Ditto ID to use.

    Options:
    Ditto ID parameter
	
	Default:
    <none>
	
	
	
 Param: pagesToShow

    Purpose:
    Maximum number of page links to show. Any pages above this number will be replaced by ellipses. 
	Sets of ellipses are included in this count, to ensure the total size of the pagination remains largely 
	the same regardless of current position.

    Options:
    Number
	
	Default:
    15	
	


 Param: constantEndCount

    Purpose:
    Number of pages links to display at the beginning and end of the results set, before and after the ellipses
	e.g. set to 2, the results would display:	
	[1] [2] ... [99] [100]
	
	or set to 4, the results would display:
	[1] [2] [3] [4] ... [97] [98] [99] [100]	

    Options:
    Number
	
	Default:
    2	
	
	
 Param: return

    Purpose:
    Output the pagination directly from the location of the snippet, rather than to a placeholder

    Options:
    Boolean
	
	Default:
    0	


	
 Param: tplEllipses

    Purpose:
    Chunk name, or HTML that should be used to indicate a break in the page numbering. ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.

    Options:
    Chunk name or HTML
	
	Default:
    <span class="splitPagination">...</span>	
	

 Param: tplCurrent

    Purpose:
    Chunk name, or HTML that should be used for the current results page. ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.
	
	The [+page+] placeholder will be replaced by the page number
	The [+class+] placeholder will be replace by a class representing first or last items if this applies (see firstClass and lastClass params)

    Options:
    Chunk name or HTML
	
	Default:
    <span class="ditto_currentpage ditto_page_[+page+][+class+]">[+page+]</span>		
	
	

 Param: tplPageLink

    Purpose:
    Chunk name, or HTML that should be used for links to all results page (other than current). ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.
	
	The [+page+] placeholder will be replaced by the page number
	The [+url+] placeholder will be replaced by the link URL
	The [+class+] placeholder will be replace by a class representing first or last items if this applies (see firstClass and lastClass params)

    Options:
    Chunk name or HTML
	
	Default:
    <a class="ditto_page ditto_page_[+page+][+class+]" href="[+url+]">[+page+]</a>



 Param: firstClass

    Purpose:
    Class applied to the first page link
	
    Options:
    HTML class
	
	Default:
    first



 Param: lastClass

    Purpose:
    Class applied to the last page link
	
    Options:
    HTML class
	
	Default:
    last
	

---------------------------------------------------------------------------------------
The following parameters are available as manual overrides, however they are normally 
populated with correct values automatically.
	
	
 Param: total

    Purpose:
   	Total number of results from the Ditto query - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results	
	
	
	
 Param: start

    Purpose:
   	Start position of results from the Ditto query - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results		
	
	
	
 Param: display

    Purpose:
   	Number of results per page to display - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results	
	
	
	
 Param: currentPage

    Purpose:
   	Override current page. Usually automatically calculated. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From URL	


	
 Param: landing

    Purpose:
   	Landing page for pagination links. 

    Options:
    Document ID
	
	Default:
    Current page
	
	


 


*/



if (!function_exists("generatePagination")) {
	
function generatePagination($currentPage, $totalResults, $resultsPerPage, $pagesToShow, $constantEndCount) {
	
	// How many pages are there altogether?
	$totalPages = ceil($totalResults / $resultsPerPage);
	
	// How far through are we?
	$pagesBefore = $currentPage - 1;
	$pagesAfter = $totalPages - $currentPage;
	
	// An array of tabs to display (made up of page numbers)
	$tabArr = array();
	
	// If we need to split the pagination
	if($totalPages > $pagesToShow) {
		
		// If we\'re currently more than half way through
		if($pagesBefore > $pagesToShow/2) {
			
			// Always show pages 1 and 2 (or whatever the constant end count is), then a separator
			for($i=1; $i<=$constantEndCount; $i++) { $tabArr[] = $i; }
			$tabArr[] = 0;
				
			// If the number of pages after the current page is more than the number of available slots
			if($pagesAfter >= $pagesToShow/2) {
				$empty_slots_before = floor( ($pagesToShow - ($constantEndCount*2 /*there are two ends*/) - 1 /*the current page*/) / 2 /*only half*/) -1  /*the set of dots counts as one slot*/;
			} else {
				$empty_slots_before = $pagesToShow - count($tabArr) - 1 /*current page*/ - $pagesAfter /*How many after*/;
			}
			
			// Insert the tabs	
			for($i=($currentPage-$empty_slots_before); $i<$currentPage; $i++) { $tabArr[] = $i; }	
			
		} else {
			for($i=1; $i<$currentPage; $i++) { $tabArr[] = $i; }
		}
		
		// Insert current page
		$tabArr[] = $currentPage;		
		
		// If we\'re less than half way through
		if($pagesAfter > $pagesToShow/2) {
			
			// How many more slots do we want to show after the current page?
			$empty_slots_after = $pagesToShow - count($tabArr) - $constantEndCount - 1/*the set of dots*/;
			
			// Insert the tabs	
			for($i=($currentPage+1); $i<=$currentPage+$empty_slots_after; $i++) { $tabArr[] = $i; }
			
			// Add a separator
			$tabArr[] = 0;
			
			// Always show pages last 2 pages (or whatever the constant end count is)
			for($i=$totalPages-$constantEndCount+1; $i<=$totalPages; $i++) { $tabArr[] = $i; }

		} else {
			for($i=($currentPage+1); $i<=$totalPages; $i++) { $tabArr[] = $i; }
		}
		
	} else { // No need to split the pagination
		for($i=1;$i<=$totalPages;$i++) { $tabArr[] = $i; }
	}
			
	return $tabArr;
	
	} // end function
} // end if




// ----------------------------------------------------------------------------------------------------------------







// Define some paramaters
$id = isset($id) ? $id.\'_\' : \'\';
$total = isset($total) ? $total : $modx->getPlaceholder($id."total");
$start = isset($start) ? $start : $modx->getPlaceholder($id."start");
$display = isset($display) ? $display : $modx->getPlaceholder($id."perPage");
$currentPage = isset($currentPage) ? $currentPage : $modx->getPlaceholder($id."current");
$landing = isset($tagDocumentID) ? $tagDocumentID : $modx->documentObject[\'id\'];

$pagesToShow = isset($pagesToShow) && is_numeric($pagesToShow) ? $pagesToShow : 15;
$constantEndCount = isset($constantEndCount) && is_numeric($constantEndCount) ? $constantEndCount : 2;


$tplEllipses = isset($tplEllipses) ? $modx->getChunk($tplEllipses) : \'\';
$tplEllipses = !empty($tplEllipses) ? $tplEllipses : \'<span class="splitPagination">...</span>\';

$tplCurrent = isset($tplCurrent) ? $modx->getChunk($tplCurrent) : \'\';
$tplCurrent = !empty($tplCurrent) ? $tplCurrent : \'<span class="ditto_currentpage ditto_page_[+page+][+class+]">[+page+]</span>\';

$tplPageLink = isset($tplPageLink) ? $modx->getChunk($tplPageLink) : \'\';
$tplPageLink = !empty($tplPageLink) ? $tplPageLink : \'<a class="ditto_page ditto_page_[+page+][+class+]" href="[+url+]">[+page+]</a>\';

$firstClass = isset($firstClass) ? $firstClass: \'first\';
$lastClass = isset($lastClass) ? $lastClass: \'last\';


$return = isset($return) ? $return : 0;

// Do nothing if there\'s nothing to do
if ($total == 0 || $display==0 || $total <= $display) {
	return false;
}

// What page are we on?
$page = ceil($start/$display);

// Generate the pagination
$paginationArray = generatePagination($page, $total, $display, $pagesToShow, $constantEndCount);

// Create empty placeholder for output
$ph = "";

// Build the output
foreach($paginationArray as $page) {
	$inc = ($page-1)*$display;
	
	// First or last classes
	if ($page == 1) { 
			$newClass = \' \' . $firstClass;
	} else if ($page == ceil($total/$display)) {
		$newClass = \' \' . $lastClass;
	} else {
		$newClass = \'\';
	}
	
	// Insert into output
	if($page == 0) {
		$ph .= $tplEllipses; // print an elipse, representing pages that aren\'t displayed
	} else if ($inc==$_GET[$id.\'start\']) {
		$newLink = str_replace(\'[+class+]\', $newClass , $tplCurrent);
		$ph .= str_replace(\'[+page+]\', $page, $newLink);	
	} else {
		$newLink = str_replace(\'[+url+]\', ditto::buildURL("start=".$inc,$landing,$id) , $tplPageLink);		
		$newLink = str_replace(\'[+class+]\', $newClass , $newLink);
		$ph .= str_replace(\'[+page+]\', $page, $newLink);	
	}
}

// Set the placeholder
$modx->setPlaceholder($id."splitPages",$ph);

// Or return the output
if ($return) return $ph;';
$s['splitPaginationProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['splitPagination'] = '/* 

PURPOSE
When a Ditto result set is large, the pagination can grow too large to fit comfortably and usably on the page. 
This snippet provides alternative "Google" style pagination, where a maximum number of pages are shown - the 
first and last pages of the results, and the pages immediately surrounding the current page.
 e.g. instead Ditto\'s default pagination output of

[1] [2] [3] [4] [5] [6] [7] [8] [9] [10] [*11*] [12] [13] [14] [15] [16] [17] [18] [19] [20]

(current page is 11) this snippet produces

[1] [2] ... [8] [9] [10] [*11*] [12] [13] [14] ... [19] [20]


REQUIREMENTS
This snippet is tested with Ditto 2.1 in ModX Evo 1.0.x


INSTALLATION
Create a new snippet named splitPagination, and paste the contents of this file into it. 


USAGE
Place the snippet immediately following a Ditto call. 

e.g. 1 

[[splitPagination]]
will just create a placeholder named "splitPages" - to insert the pagination bar into the correct place of your document use the [+splitPages+] placeholder

e.g.2
[[splitPagination? &id=`myDitto` &pagesToShow=`10` &constantEndCount=`3` &ellipses=`myChunk` &return=`1`]]
will output the pagination directly, using data obtained from the Ditto call with the ID of "myDitto". 
It will display a maximum of 10 links to pages, with three before/after the ellipses at the beginning and end. 
The HTML to use for the ellipses will be obtained from the "myChunk" chunk.


PARAMETERS

 Param: id

    Purpose:
    If there is more than one Ditto call on a page, or your Ditto call has the ID paramater set, this is required to 
	know which Ditto ID to use.

    Options:
    Ditto ID parameter
	
	Default:
    <none>
	
	
	
 Param: pagesToShow

    Purpose:
    Maximum number of page links to show. Any pages above this number will be replaced by ellipses. 
	Sets of ellipses are included in this count, to ensure the total size of the pagination remains largely 
	the same regardless of current position.

    Options:
    Number
	
	Default:
    15	
	


 Param: constantEndCount

    Purpose:
    Number of pages links to display at the beginning and end of the results set, before and after the ellipses
	e.g. set to 2, the results would display:	
	[1] [2] ... [99] [100]
	
	or set to 4, the results would display:
	[1] [2] [3] [4] ... [97] [98] [99] [100]	

    Options:
    Number
	
	Default:
    2	
	
	
 Param: return

    Purpose:
    Output the pagination directly from the location of the snippet, rather than to a placeholder

    Options:
    Boolean
	
	Default:
    0	


	
 Param: tplEllipses

    Purpose:
    Chunk name, or HTML that should be used to indicate a break in the page numbering. ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.

    Options:
    Chunk name or HTML
	
	Default:
    <span class="splitPagination">...</span>	
	

 Param: tplCurrent

    Purpose:
    Chunk name, or HTML that should be used for the current results page. ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.
	
	The [+page+] placeholder will be replaced by the page number
	The [+class+] placeholder will be replace by a class representing first or last items if this applies (see firstClass and lastClass params)

    Options:
    Chunk name or HTML
	
	Default:
    <span class="ditto_currentpage ditto_page_[+page+][+class+]">[+page+]</span>		
	
	

 Param: tplPageLink

    Purpose:
    Chunk name, or HTML that should be used for links to all results page (other than current). ModX doesn\'t work very
	well (as of 1.0.x) with = sign within parameters, so if you wish to use HTML containing = sign, it is 
	suggested to put it in a chunk rather than supply HTML directly.
	
	The [+page+] placeholder will be replaced by the page number
	The [+url+] placeholder will be replaced by the link URL
	The [+class+] placeholder will be replace by a class representing first or last items if this applies (see firstClass and lastClass params)

    Options:
    Chunk name or HTML
	
	Default:
    <a class="ditto_page ditto_page_[+page+][+class+]" href="[+url+]">[+page+]</a>



 Param: firstClass

    Purpose:
    Class applied to the first page link
	
    Options:
    HTML class
	
	Default:
    first



 Param: lastClass

    Purpose:
    Class applied to the last page link
	
    Options:
    HTML class
	
	Default:
    last
	

---------------------------------------------------------------------------------------
The following parameters are available as manual overrides, however they are normally 
populated with correct values automatically.
	
	
 Param: total

    Purpose:
   	Total number of results from the Ditto query - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results	
	
	
	
 Param: start

    Purpose:
   	Start position of results from the Ditto query - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results		
	
	
	
 Param: display

    Purpose:
   	Number of results per page to display - usually obtained automatically from Ditto. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From Ditto results	
	
	
	
 Param: currentPage

    Purpose:
   	Override current page. Usually automatically calculated. Setting manually may have
	unpredictable results!

    Options:
    Number
	
	Default:
    From URL	


	
 Param: landing

    Purpose:
   	Landing page for pagination links. 

    Options:
    Document ID
	
	Default:
    Current page
	
	


 


*/



if (!function_exists("generatePagination")) {
	
function generatePagination($currentPage, $totalResults, $resultsPerPage, $pagesToShow, $constantEndCount) {
	
	// How many pages are there altogether?
	$totalPages = ceil($totalResults / $resultsPerPage);
	
	// How far through are we?
	$pagesBefore = $currentPage - 1;
	$pagesAfter = $totalPages - $currentPage;
	
	// An array of tabs to display (made up of page numbers)
	$tabArr = array();
	
	// If we need to split the pagination
	if($totalPages > $pagesToShow) {
		
		// If we\'re currently more than half way through
		if($pagesBefore > $pagesToShow/2) {
			
			// Always show pages 1 and 2 (or whatever the constant end count is), then a separator
			for($i=1; $i<=$constantEndCount; $i++) { $tabArr[] = $i; }
			$tabArr[] = 0;
				
			// If the number of pages after the current page is more than the number of available slots
			if($pagesAfter >= $pagesToShow/2) {
				$empty_slots_before = floor( ($pagesToShow - ($constantEndCount*2 /*there are two ends*/) - 1 /*the current page*/) / 2 /*only half*/) -1  /*the set of dots counts as one slot*/;
			} else {
				$empty_slots_before = $pagesToShow - count($tabArr) - 1 /*current page*/ - $pagesAfter /*How many after*/;
			}
			
			// Insert the tabs	
			for($i=($currentPage-$empty_slots_before); $i<$currentPage; $i++) { $tabArr[] = $i; }	
			
		} else {
			for($i=1; $i<$currentPage; $i++) { $tabArr[] = $i; }
		}
		
		// Insert current page
		$tabArr[] = $currentPage;		
		
		// If we\'re less than half way through
		if($pagesAfter > $pagesToShow/2) {
			
			// How many more slots do we want to show after the current page?
			$empty_slots_after = $pagesToShow - count($tabArr) - $constantEndCount - 1/*the set of dots*/;
			
			// Insert the tabs	
			for($i=($currentPage+1); $i<=$currentPage+$empty_slots_after; $i++) { $tabArr[] = $i; }
			
			// Add a separator
			$tabArr[] = 0;
			
			// Always show pages last 2 pages (or whatever the constant end count is)
			for($i=$totalPages-$constantEndCount+1; $i<=$totalPages; $i++) { $tabArr[] = $i; }

		} else {
			for($i=($currentPage+1); $i<=$totalPages; $i++) { $tabArr[] = $i; }
		}
		
	} else { // No need to split the pagination
		for($i=1;$i<=$totalPages;$i++) { $tabArr[] = $i; }
	}
			
	return $tabArr;
	
	} // end function
} // end if




// ----------------------------------------------------------------------------------------------------------------







// Define some paramaters
$id = isset($id) ? $id.\'_\' : \'\';
$total = isset($total) ? $total : $modx->getPlaceholder($id."total");
$start = isset($start) ? $start : $modx->getPlaceholder($id."start");
$display = isset($display) ? $display : $modx->getPlaceholder($id."perPage");
$currentPage = isset($currentPage) ? $currentPage : $modx->getPlaceholder($id."current");
$landing = isset($tagDocumentID) ? $tagDocumentID : $modx->documentObject[\'id\'];

$pagesToShow = isset($pagesToShow) && is_numeric($pagesToShow) ? $pagesToShow : 15;
$constantEndCount = isset($constantEndCount) && is_numeric($constantEndCount) ? $constantEndCount : 2;


$tplEllipses = isset($tplEllipses) ? $modx->getChunk($tplEllipses) : \'\';
$tplEllipses = !empty($tplEllipses) ? $tplEllipses : \'<span class="splitPagination">...</span>\';

$tplCurrent = isset($tplCurrent) ? $modx->getChunk($tplCurrent) : \'\';
$tplCurrent = !empty($tplCurrent) ? $tplCurrent : \'<span class="ditto_currentpage ditto_page_[+page+][+class+]">[+page+]</span>\';

$tplPageLink = isset($tplPageLink) ? $modx->getChunk($tplPageLink) : \'\';
$tplPageLink = !empty($tplPageLink) ? $tplPageLink : \'<a class="ditto_page ditto_page_[+page+][+class+]" href="[+url+]">[+page+]</a>\';

$firstClass = isset($firstClass) ? $firstClass: \'first\';
$lastClass = isset($lastClass) ? $lastClass: \'last\';


$return = isset($return) ? $return : 0;

// Do nothing if there\'s nothing to do
if ($total == 0 || $display==0 || $total <= $display) {
	return false;
}

// What page are we on?
$page = ceil($start/$display);

// Generate the pagination
$paginationArray = generatePagination($page, $total, $display, $pagesToShow, $constantEndCount);

// Create empty placeholder for output
$ph = "";

// Build the output
foreach($paginationArray as $page) {
	$inc = ($page-1)*$display;
	
	// First or last classes
	if ($page == 1) { 
			$newClass = \' \' . $firstClass;
	} else if ($page == ceil($total/$display)) {
		$newClass = \' \' . $lastClass;
	} else {
		$newClass = \'\';
	}
	
	// Insert into output
	if($page == 0) {
		$ph .= $tplEllipses; // print an elipse, representing pages that aren\'t displayed
	} else if ($inc==$_GET[$id.\'start\']) {
		$newLink = str_replace(\'[+class+]\', $newClass , $tplCurrent);
		$ph .= str_replace(\'[+page+]\', $page, $newLink);	
	} else {
		$newLink = str_replace(\'[+url+]\', ditto::buildURL("start=".$inc,$landing,$id) , $tplPageLink);		
		$newLink = str_replace(\'[+class+]\', $newClass , $newLink);
		$ph .= str_replace(\'[+page+]\', $page, $newLink);	
	}
}

// Set the placeholder
$modx->setPlaceholder($id."splitPages",$ph);

// Or return the output
if ($return) return $ph;';
$s['phpthumb'] = '//[[phpthumb? &input=`[+tvimagename+]` &options=`h_170,w_255`]]
if($input == \'\')
    {echo \'assets/snippets/phpthumbof/noimage.png\';}
else{   
     $replace  = Array("," => "&", "_" => "=");
    $options  = strtr($options, $replace);
    $options .= "&f=jpg&q=85";
    $opt = $options;
    $pt = $modx->getPageInfo($modx->documentIdentifier);
    require_once $_SERVER[\'DOCUMENT_ROOT\']."/assets/snippets/phpthumbof/phpthumb.class.php";
    $phpThumb = new phpthumb();
    $phpThumb->setSourceFilename($input); 
    $options = explode("&", $options);
    foreach ($options as $value) {
       $thumb = explode("=", $value);
       $phpThumb->setParameter($thumb[0], $thumb[1]);
    }
    $outputFilename = $_SERVER[\'DOCUMENT_ROOT\']."/assets/cache/phpthumbof/".md5($input.$pt[\'id\'].$opt).".jpg";
    if (!file_exists($outputFilename))
       if ($phpThumb->GenerateThumbnail())
           $phpThumb->RenderToFile($outputFilename) ;
    $res = explode("/assets", $outputFilename); 
    $res = "/assets".$res[1];
    return $res;
}
';
$s['phpthumb'] = '//[[phpthumb? &input=`[+tvimagename+]` &options=`h_170,w_255`]]
if($input == \'\')
    {echo \'assets/snippets/phpthumbof/noimage.png\';}
else{   
     $replace  = Array("," => "&", "_" => "=");
    $options  = strtr($options, $replace);
    $options .= "&f=jpg&q=85";
    $opt = $options;
    $pt = $modx->getPageInfo($modx->documentIdentifier);
    require_once $_SERVER[\'DOCUMENT_ROOT\']."/assets/snippets/phpthumbof/phpthumb.class.php";
    $phpThumb = new phpthumb();
    $phpThumb->setSourceFilename($input); 
    $options = explode("&", $options);
    foreach ($options as $value) {
       $thumb = explode("=", $value);
       $phpThumb->setParameter($thumb[0], $thumb[1]);
    }
    $outputFilename = $_SERVER[\'DOCUMENT_ROOT\']."/assets/cache/phpthumbof/".md5($input.$pt[\'id\'].$opt).".jpg";
    if (!file_exists($outputFilename))
       if ($phpThumb->GenerateThumbnail())
           $phpThumb->RenderToFile($outputFilename) ;
    $res = explode("/assets", $outputFilename); 
    $res = "/assets".$res[1];
    return $res;
}
';
$s['phpthumb'] = '//[[phpthumb? &input=`[+tvimagename+]` &options=`h_170,w_255`]]
if($input == \'\')
    {echo \'assets/snippets/phpthumbof/noimage.png\';}
else{   
     $replace  = Array("," => "&", "_" => "=");
    $options  = strtr($options, $replace);
    $options .= "&f=jpg&q=85";
    $opt = $options;
    $pt = $modx->getPageInfo($modx->documentIdentifier);
    require_once $_SERVER[\'DOCUMENT_ROOT\']."/assets/snippets/phpthumbof/phpthumb.class.php";
    $phpThumb = new phpthumb();
    $phpThumb->setSourceFilename($input); 
    $options = explode("&", $options);
    foreach ($options as $value) {
       $thumb = explode("=", $value);
       $phpThumb->setParameter($thumb[0], $thumb[1]);
    }
    $outputFilename = $_SERVER[\'DOCUMENT_ROOT\']."/assets/cache/phpthumbof/".md5($input.$pt[\'id\'].$opt).".jpg";
    if (!file_exists($outputFilename))
       if ($phpThumb->GenerateThumbnail())
           $phpThumb->RenderToFile($outputFilename) ;
    $res = explode("/assets", $outputFilename); 
    $res = "/assets".$res[1];
    return $res;
}
';
$s['phpthumbProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['phpthumb'] = '//[[phpthumb? &input=`[+tvimagename+]` &options=`h_170,w_255`]]
if($input == \'\')
    {echo \'assets/snippets/phpthumbof/noimage.png\';}
else{   
     $replace  = Array("," => "&", "_" => "=");
    $options  = strtr($options, $replace);
    $options .= "&f=jpg&q=85";
    $opt = $options;
    $pt = $modx->getPageInfo($modx->documentIdentifier);
    require_once $_SERVER[\'DOCUMENT_ROOT\']."/assets/snippets/phpthumbof/phpthumb.class.php";
    $phpThumb = new phpthumb();
    $phpThumb->setSourceFilename($input); 
    $options = explode("&", $options);
    foreach ($options as $value) {
       $thumb = explode("=", $value);
       $phpThumb->setParameter($thumb[0], $thumb[1]);
    }
    $outputFilename = $_SERVER[\'DOCUMENT_ROOT\']."/assets/cache/phpthumbof/".md5($input.$pt[\'id\'].$opt).".jpg";
    if (!file_exists($outputFilename))
       if ($phpThumb->GenerateThumbnail())
           $phpThumb->RenderToFile($outputFilename) ;
    $res = explode("/assets", $outputFilename); 
    $res = "/assets".$res[1];
    return $res;
}
';
$s['UltimateParent'] = '/*
 * @name UltimateParent
 * @version 2.0 beta (requires MODx 0.9.5+)
 * @author Jason Coward <modx@opengeek.com>
 * 
 * @param &id The id of the document whose parent you want to find.
 * @param &top The top node for the search.
 * @param &topLevel The top level node for the search (root = level 1)
 * 
 * @license Public Domain, use as you like.
 * 
 * @example [[UltimateParent? &id=`45` &top=`6`]] 
 * Will find the ultimate parent of document 45 if it is a child of document 6;
 * otherwise it will return 45.
 * 
 * @example [[UltimateParent? &topLevel=`2`]]
 * Will find the ultimate parent of the current document at a depth of 2 levels
 * in the document hierarchy, with the root level being level 1.
 * 
 * This snippet travels up the document tree from a specified document and
 * returns the "ultimate" parent.  Version 2.0 was rewritten to use the new
 * getParentIds function features available only in MODx 0.9.5 or later.
 * 
 * Based on the original UltimateParent 1.x snippet by Susan Ottwell
 * <sottwell@sottwell.com>.  The topLevel parameter was introduced by staed and
 * adopted here.
 */
$top= isset ($top) && intval($top) ? $top : 0;
$id= isset ($id) && intval($id) ? intval($id) : $modx->documentIdentifier;
$topLevel= isset ($topLevel) && intval($topLevel) ? intval($topLevel) : 0;
if ($id && $id != $top) {
    $pid= $id;
    if (!$topLevel || count($modx->getParentIds($id)) >= $topLevel) {
        while ($parentIds= $modx->getParentIds($id, 1)) {
            $pid= array_pop($parentIds);
            if ($pid == $top) {
                break;
            }
            $id= $pid;
            if ($topLevel && count($modx->getParentIds($id)) < $topLevel) {
                break;
            }
        }
    }
}
return $id;';
$s['UltimateParent'] = '/*
 * @name UltimateParent
 * @version 2.0 beta (requires MODx 0.9.5+)
 * @author Jason Coward <modx@opengeek.com>
 * 
 * @param &id The id of the document whose parent you want to find.
 * @param &top The top node for the search.
 * @param &topLevel The top level node for the search (root = level 1)
 * 
 * @license Public Domain, use as you like.
 * 
 * @example [[UltimateParent? &id=`45` &top=`6`]] 
 * Will find the ultimate parent of document 45 if it is a child of document 6;
 * otherwise it will return 45.
 * 
 * @example [[UltimateParent? &topLevel=`2`]]
 * Will find the ultimate parent of the current document at a depth of 2 levels
 * in the document hierarchy, with the root level being level 1.
 * 
 * This snippet travels up the document tree from a specified document and
 * returns the "ultimate" parent.  Version 2.0 was rewritten to use the new
 * getParentIds function features available only in MODx 0.9.5 or later.
 * 
 * Based on the original UltimateParent 1.x snippet by Susan Ottwell
 * <sottwell@sottwell.com>.  The topLevel parameter was introduced by staed and
 * adopted here.
 */
$top= isset ($top) && intval($top) ? $top : 0;
$id= isset ($id) && intval($id) ? intval($id) : $modx->documentIdentifier;
$topLevel= isset ($topLevel) && intval($topLevel) ? intval($topLevel) : 0;
if ($id && $id != $top) {
    $pid= $id;
    if (!$topLevel || count($modx->getParentIds($id)) >= $topLevel) {
        while ($parentIds= $modx->getParentIds($id, 1)) {
            $pid= array_pop($parentIds);
            if ($pid == $top) {
                break;
            }
            $id= $pid;
            if ($topLevel && count($modx->getParentIds($id)) < $topLevel) {
                break;
            }
        }
    }
}
return $id;';
$s['UltimateParent'] = '/*
 * @name UltimateParent
 * @version 2.0 beta (requires MODx 0.9.5+)
 * @author Jason Coward <modx@opengeek.com>
 * 
 * @param &id The id of the document whose parent you want to find.
 * @param &top The top node for the search.
 * @param &topLevel The top level node for the search (root = level 1)
 * 
 * @license Public Domain, use as you like.
 * 
 * @example [[UltimateParent? &id=`45` &top=`6`]] 
 * Will find the ultimate parent of document 45 if it is a child of document 6;
 * otherwise it will return 45.
 * 
 * @example [[UltimateParent? &topLevel=`2`]]
 * Will find the ultimate parent of the current document at a depth of 2 levels
 * in the document hierarchy, with the root level being level 1.
 * 
 * This snippet travels up the document tree from a specified document and
 * returns the "ultimate" parent.  Version 2.0 was rewritten to use the new
 * getParentIds function features available only in MODx 0.9.5 or later.
 * 
 * Based on the original UltimateParent 1.x snippet by Susan Ottwell
 * <sottwell@sottwell.com>.  The topLevel parameter was introduced by staed and
 * adopted here.
 */
$top= isset ($top) && intval($top) ? $top : 0;
$id= isset ($id) && intval($id) ? intval($id) : $modx->documentIdentifier;
$topLevel= isset ($topLevel) && intval($topLevel) ? intval($topLevel) : 0;
if ($id && $id != $top) {
    $pid= $id;
    if (!$topLevel || count($modx->getParentIds($id)) >= $topLevel) {
        while ($parentIds= $modx->getParentIds($id, 1)) {
            $pid= array_pop($parentIds);
            if ($pid == $top) {
                break;
            }
            $id= $pid;
            if ($topLevel && count($modx->getParentIds($id)) < $topLevel) {
                break;
            }
        }
    }
}
return $id;';
$s['UltimateParentProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['UltimateParent'] = '/*
 * @name UltimateParent
 * @version 2.0 beta (requires MODx 0.9.5+)
 * @author Jason Coward <modx@opengeek.com>
 * 
 * @param &id The id of the document whose parent you want to find.
 * @param &top The top node for the search.
 * @param &topLevel The top level node for the search (root = level 1)
 * 
 * @license Public Domain, use as you like.
 * 
 * @example [[UltimateParent? &id=`45` &top=`6`]] 
 * Will find the ultimate parent of document 45 if it is a child of document 6;
 * otherwise it will return 45.
 * 
 * @example [[UltimateParent? &topLevel=`2`]]
 * Will find the ultimate parent of the current document at a depth of 2 levels
 * in the document hierarchy, with the root level being level 1.
 * 
 * This snippet travels up the document tree from a specified document and
 * returns the "ultimate" parent.  Version 2.0 was rewritten to use the new
 * getParentIds function features available only in MODx 0.9.5 or later.
 * 
 * Based on the original UltimateParent 1.x snippet by Susan Ottwell
 * <sottwell@sottwell.com>.  The topLevel parameter was introduced by staed and
 * adopted here.
 */
$top= isset ($top) && intval($top) ? $top : 0;
$id= isset ($id) && intval($id) ? intval($id) : $modx->documentIdentifier;
$topLevel= isset ($topLevel) && intval($topLevel) ? intval($topLevel) : 0;
if ($id && $id != $top) {
    $pid= $id;
    if (!$topLevel || count($modx->getParentIds($id)) >= $topLevel) {
        while ($parentIds= $modx->getParentIds($id, 1)) {
            $pid= array_pop($parentIds);
            if ($pid == $top) {
                break;
            }
            $id= $pid;
            if ($topLevel && count($modx->getParentIds($id)) < $topLevel) {
                break;
            }
        }
    }
}
return $id;';
$s['EvoGallery'] = '/*---------------------------------------------------------------------------
* EvoGallery Snippet - Generates sortable listing of
* galleries, with full templating control
*--------------------------------------------------------------------------*/
//
// System settings
//

$params[\'display\'] = isset($display) ? $display : \'images\';
	// Have the snippet output either a list of galleries within the specified doc Id, a list of images within a gallery, or a single image based on a pic Id
	// Possible values: galleries, images, single

$params[\'type\'] = isset($type) ? $type : \'simple-list\';
	// Output type, if specified, the snippet will automatically load the required javascript
	// Current types: simple-list, single, jquery-cycle

$params[\'includeAssets\'] = isset($includeAssets) ? intval($includeAssets) : 1;
	// Register external scripts and CSS files required by the specified gallery type
	// If set to 0, these will need to be included manually in the document <head>

$params[\'picId\'] = isset($picId) ? $picId : $_REQUEST[\'picId\'];
	// ID of specific pic to show when displaying by a single image

$params[\'docId\'] = isset($docId) ? $docId : $modx->documentIdentifier;
	// Document ID for which to display gallery (default: document from which snippet was called)
        // Multiple document id\'s can be specified by commas (no spaces), or * for all documents

$params[\'gallerySortBy\'] = isset($gallerySortBy) ? $gallerySortBy : \'menuindex\';
	// Galleries sort order (possible fields: id, pagetitle, longtitle, description, alias, pub_date, introtext,
	// editedby, editedon, publishedon, publishedby, menutitle) or RAND()

$params[\'gallerySortDir\'] = isset($gallerySortDir) ? $gallerySortDir : \'ASC\';
	// Direction to sort the galleries ASC or DESC

$params[\'ignoreHidden\'] = isset($ignoreHidden) ? $ignoreHidden : 0;
	// Display documents marked as hidden in the gallery listing

$params[\'excludeDocs\'] = isset($excludeDocs) ? $excludeDocs : 0;
	// Prevent the specified documents from showing in the gallery listing
        // Multiple document id\'s can be specified by commas (no spaces)

$params[\'sortBy\'] = isset($sortBy) ? $sortBy : \'sortorder\';
	// Sort items by field (possible fields: id, content_id, filename, title, description, sortorder) or RAND()

$params[\'sortDir\'] = isset($sortDir) ? $sortDir : \'ASC\';
	// Direction to sort the items ASC or DESC

$params[\'limit\'] = isset($limit) ? $limit : \'\';
	// Limit the number of items to display

$params[\'tags\'] = isset($tags) ? $tags : \'\';
	// Comma delimited set of tags to filter results by

$params[\'tagMode\'] = isset($tagMode) ? $tagMode : \'AND\';
	// Search mode for tag: AND or OR

$params[\'tpl\'] = isset($tpl) ? $tpl : \'\';
	// Chunk template for the outer gallery template (defaults to tpl.default.txt for selected type)
	// Placeholders: items

$params[\'itemTpl\'] = isset($itemTpl) ? $itemTpl : \'\';
	// Chunk template for each thumbnail/image in the gallery (defaults to tpl.item.default.txt for selected type)

$params[\'itemTplFirst\'] = isset($itemTplFirst) ? $itemTplFirst : \'\';
	// Chunk template for last thumbnail/image in the gallery (defaults to tpl.item.first.txt for selected type)

$params[\'itemTplLast\'] = isset($itemTplLast) ? $itemTplLast : \'\';
	// Chunk template for last thumbnail/image in the gallery (defaults to tpl.item.last.txt for selected type)

$params[\'itemTplAlt\'] = isset($itemTplAlt) ? $itemTplAlt : \'\';
	// Chunk template for alternate thumbnail/image in the gallery (defaults to tpl.item.alt.txt for selected type)

$params[\'itemAltNum\'] = isset($itemAltNum) ? $itemAltNum : \'2\';
	// Modifier for the alternate thumbnail/image (defaults to every second item)

$params[\'galleriesUrl\'] = isset($galleriesUrl) ? $galleriesUrl : $modx->config[\'base_url\'] . \'assets/galleries/\';
	// URL to the galleries directory (should contain folders with the Id of the document, with a thumbs/ folder within each document\'s gallery)

$params[\'galleriesPath\'] = isset($galleriesPath) ? $galleriesPath : $modx->config[\'base_path\'] . \'assets/galleries/\';
	// Path to the galleries directory

$params[\'snippetUrl\'] = isset($snippetUrl) ? $snippetUrl : $modx->config[\'base_url\'] . \'assets/snippets/evogallery/\';
	// URL to the snippet directory

$params[\'snippetPath\'] = isset($snippetPath) ? $snippetPath : $modx->config[\'base_path\'] . \'assets/snippets/evogallery/\';
	// Path to the snippet directory

$params[\'id\'] = isset($id)?$id:\'\';
	// Unique ID for this EvoGallery instance and unique URL parameters

$params[\'paginate\'] = isset($paginate)?$paginate:0;
	// Paginate the results set into pages of &show length. 

$params[\'paginateAlwaysShowLinks\'] = isset($paginateAlwaysShowLinks)?$paginateAlwaysShowLinks:0;
	// Determine whether or not to always show previous next links

$params[\'show\'] = isset($show)?$show:\'20\';
	// Number of images to display in the results when pagination on

$params[\'paginateNextText\'] = isset($paginateNextText)?$paginateNextText:\'Next\';
	// Text for next label

$params[\'paginatePreviousText\'] = isset($paginatePreviousText)?$paginatePreviousText:\'Previous\';
	// Text for previous label

$params[\'paginateSplitterCharacter\'] = isset($paginateSplitterCharacter)?$modx->getChunk($paginateSplitterCharacter):"|";
	// Splitter to use if always show is disabled

$params[\'tplPaginatePrevious\'] = isset($tplPaginatePrevious)?$modx->getChunk($tplPaginatePrevious):"<a href=\'[+url+]\' class=\'eg_previous_link\'>[+PaginatePreviousText+]</a>";
	// Template for the previous link

$params[\'tplPaginateNext\'] = isset($tplPaginateNext)?$modx->getChunk($tplPaginateNext):"<a href=\'[+url+]\' class=\'eg_next_link\'>[+PaginateNextText+]</a>";
	// Template for the next link

$params[\'tplPaginateNextOff\'] = isset($tplPaginateNextOff)?$modx->getChunk($tplPaginateNextOff):"<span class=\'eg_next_off eg_off\'>[+PaginateNextText+]</span>";
	// Template for the inside of the next link

$params[\'tplPaginatePreviousOff\'] = isset($tplPaginatePreviousOff)?$modx->getChunk($tplPaginatePreviousOff):"<span class=\'eg_previous_off eg_off\'>[+PaginatePreviousText+]</span>";
	// Template for the inside of the previous link

$params[\'tplPaginatePage\'] = isset($tplPaginatePage)?$modx->getChunk($tplPaginatePage):"<a class=\'eg_page\' href=\'[+url+]\'>[+page+]</a>";
	// Template for the page link

$params[\'tplPaginateCurrentPage\'] = isset($tplPaginateCurrentPage)?$modx->getChunk($tplPaginateCurrentPage):"<span class=\'eg_currentpage\'>[+page+]</span>";
	// Template for the current page link

/*--------------------------------------------------------------------------*/

include_once($params[\'snippetPath\'] . \'classes/gallery.class.inc.php\');

if (!class_exists(\'PHxParser\'))
	include_once($params[\'snippetPath\'] . \'classes/phx.parser.class.inc.php\');

if (class_exists(\'Gallery\'))
	$gal = new Gallery($params);
else
	$modx->logEvent(1, 3, \'Error loading gallery snippet\');

return $gal->execute();
';
$s['EvoGallery'] = '/*---------------------------------------------------------------------------
* EvoGallery Snippet - Generates sortable listing of
* galleries, with full templating control
*--------------------------------------------------------------------------*/
//
// System settings
//

$params[\'display\'] = isset($display) ? $display : \'images\';
	// Have the snippet output either a list of galleries within the specified doc Id, a list of images within a gallery, or a single image based on a pic Id
	// Possible values: galleries, images, single

$params[\'type\'] = isset($type) ? $type : \'simple-list\';
	// Output type, if specified, the snippet will automatically load the required javascript
	// Current types: simple-list, single, jquery-cycle

$params[\'includeAssets\'] = isset($includeAssets) ? intval($includeAssets) : 1;
	// Register external scripts and CSS files required by the specified gallery type
	// If set to 0, these will need to be included manually in the document <head>

$params[\'picId\'] = isset($picId) ? $picId : $_REQUEST[\'picId\'];
	// ID of specific pic to show when displaying by a single image

$params[\'docId\'] = isset($docId) ? $docId : $modx->documentIdentifier;
	// Document ID for which to display gallery (default: document from which snippet was called)
        // Multiple document id\'s can be specified by commas (no spaces), or * for all documents

$params[\'gallerySortBy\'] = isset($gallerySortBy) ? $gallerySortBy : \'menuindex\';
	// Galleries sort order (possible fields: id, pagetitle, longtitle, description, alias, pub_date, introtext,
	// editedby, editedon, publishedon, publishedby, menutitle) or RAND()

$params[\'gallerySortDir\'] = isset($gallerySortDir) ? $gallerySortDir : \'ASC\';
	// Direction to sort the galleries ASC or DESC

$params[\'ignoreHidden\'] = isset($ignoreHidden) ? $ignoreHidden : 0;
	// Display documents marked as hidden in the gallery listing

$params[\'excludeDocs\'] = isset($excludeDocs) ? $excludeDocs : 0;
	// Prevent the specified documents from showing in the gallery listing
        // Multiple document id\'s can be specified by commas (no spaces)

$params[\'sortBy\'] = isset($sortBy) ? $sortBy : \'sortorder\';
	// Sort items by field (possible fields: id, content_id, filename, title, description, sortorder) or RAND()

$params[\'sortDir\'] = isset($sortDir) ? $sortDir : \'ASC\';
	// Direction to sort the items ASC or DESC

$params[\'limit\'] = isset($limit) ? $limit : \'\';
	// Limit the number of items to display

$params[\'tags\'] = isset($tags) ? $tags : \'\';
	// Comma delimited set of tags to filter results by

$params[\'tagMode\'] = isset($tagMode) ? $tagMode : \'AND\';
	// Search mode for tag: AND or OR

$params[\'tpl\'] = isset($tpl) ? $tpl : \'\';
	// Chunk template for the outer gallery template (defaults to tpl.default.txt for selected type)
	// Placeholders: items

$params[\'itemTpl\'] = isset($itemTpl) ? $itemTpl : \'\';
	// Chunk template for each thumbnail/image in the gallery (defaults to tpl.item.default.txt for selected type)

$params[\'itemTplFirst\'] = isset($itemTplFirst) ? $itemTplFirst : \'\';
	// Chunk template for last thumbnail/image in the gallery (defaults to tpl.item.first.txt for selected type)

$params[\'itemTplLast\'] = isset($itemTplLast) ? $itemTplLast : \'\';
	// Chunk template for last thumbnail/image in the gallery (defaults to tpl.item.last.txt for selected type)

$params[\'itemTplAlt\'] = isset($itemTplAlt) ? $itemTplAlt : \'\';
	// Chunk template for alternate thumbnail/image in the gallery (defaults to tpl.item.alt.txt for selected type)

$params[\'itemAltNum\'] = isset($itemAltNum) ? $itemAltNum : \'2\';
	// Modifier for the alternate thumbnail/image (defaults to every second item)

$params[\'galleriesUrl\'] = isset($galleriesUrl) ? $galleriesUrl : $modx->config[\'base_url\'] . \'assets/galleries/\';
	// URL to the galleries directory (should contain folders with the Id of the document, with a thumbs/ folder within each document\'s gallery)

$params[\'galleriesPath\'] = isset($galleriesPath) ? $galleriesPath : $modx->config[\'base_path\'] . \'assets/galleries/\';
	// Path to the galleries directory

$params[\'snippetUrl\'] = isset($snippetUrl) ? $snippetUrl : $modx->config[\'base_url\'] . \'assets/snippets/evogallery/\';
	// URL to the snippet directory

$params[\'snippetPath\'] = isset($snippetPath) ? $snippetPath : $modx->config[\'base_path\'] . \'assets/snippets/evogallery/\';
	// Path to the snippet directory

$params[\'id\'] = isset($id)?$id:\'\';
	// Unique ID for this EvoGallery instance and unique URL parameters

$params[\'paginate\'] = isset($paginate)?$paginate:0;
	// Paginate the results set into pages of &show length. 

$params[\'paginateAlwaysShowLinks\'] = isset($paginateAlwaysShowLinks)?$paginateAlwaysShowLinks:0;
	// Determine whether or not to always show previous next links

$params[\'show\'] = isset($show)?$show:\'20\';
	// Number of images to display in the results when pagination on

$params[\'paginateNextText\'] = isset($paginateNextText)?$paginateNextText:\'Next\';
	// Text for next label

$params[\'paginatePreviousText\'] = isset($paginatePreviousText)?$paginatePreviousText:\'Previous\';
	// Text for previous label

$params[\'paginateSplitterCharacter\'] = isset($paginateSplitterCharacter)?$modx->getChunk($paginateSplitterCharacter):"|";
	// Splitter to use if always show is disabled

$params[\'tplPaginatePrevious\'] = isset($tplPaginatePrevious)?$modx->getChunk($tplPaginatePrevious):"<a href=\'[+url+]\' class=\'eg_previous_link\'>[+PaginatePreviousText+]</a>";
	// Template for the previous link

$params[\'tplPaginateNext\'] = isset($tplPaginateNext)?$modx->getChunk($tplPaginateNext):"<a href=\'[+url+]\' class=\'eg_next_link\'>[+PaginateNextText+]</a>";
	// Template for the next link

$params[\'tplPaginateNextOff\'] = isset($tplPaginateNextOff)?$modx->getChunk($tplPaginateNextOff):"<span class=\'eg_next_off eg_off\'>[+PaginateNextText+]</span>";
	// Template for the inside of the next link

$params[\'tplPaginatePreviousOff\'] = isset($tplPaginatePreviousOff)?$modx->getChunk($tplPaginatePreviousOff):"<span class=\'eg_previous_off eg_off\'>[+PaginatePreviousText+]</span>";
	// Template for the inside of the previous link

$params[\'tplPaginatePage\'] = isset($tplPaginatePage)?$modx->getChunk($tplPaginatePage):"<a class=\'eg_page\' href=\'[+url+]\'>[+page+]</a>";
	// Template for the page link

$params[\'tplPaginateCurrentPage\'] = isset($tplPaginateCurrentPage)?$modx->getChunk($tplPaginateCurrentPage):"<span class=\'eg_currentpage\'>[+page+]</span>";
	// Template for the current page link

/*--------------------------------------------------------------------------*/

include_once($params[\'snippetPath\'] . \'classes/gallery.class.inc.php\');

if (!class_exists(\'PHxParser\'))
	include_once($params[\'snippetPath\'] . \'classes/phx.parser.class.inc.php\');

if (class_exists(\'Gallery\'))
	$gal = new Gallery($params);
else
	$modx->logEvent(1, 3, \'Error loading gallery snippet\');

return $gal->execute();
';
$s['EvoGallery'] = '/*---------------------------------------------------------------------------
* EvoGallery Snippet - Generates sortable listing of
* galleries, with full templating control
*--------------------------------------------------------------------------*/
//
// System settings
//

$params[\'display\'] = isset($display) ? $display : \'images\';
	// Have the snippet output either a list of galleries within the specified doc Id, a list of images within a gallery, or a single image based on a pic Id
	// Possible values: galleries, images, single

$params[\'type\'] = isset($type) ? $type : \'simple-list\';
	// Output type, if specified, the snippet will automatically load the required javascript
	// Current types: simple-list, single, jquery-cycle

$params[\'includeAssets\'] = isset($includeAssets) ? intval($includeAssets) : 1;
	// Register external scripts and CSS files required by the specified gallery type
	// If set to 0, these will need to be included manually in the document <head>

$params[\'picId\'] = isset($picId) ? $picId : $_REQUEST[\'picId\'];
	// ID of specific pic to show when displaying by a single image

$params[\'docId\'] = isset($docId) ? $docId : $modx->documentIdentifier;
	// Document ID for which to display gallery (default: document from which snippet was called)
        // Multiple document id\'s can be specified by commas (no spaces), or * for all documents

$params[\'gallerySortBy\'] = isset($gallerySortBy) ? $gallerySortBy : \'menuindex\';
	// Galleries sort order (possible fields: id, pagetitle, longtitle, description, alias, pub_date, introtext,
	// editedby, editedon, publishedon, publishedby, menutitle) or RAND()

$params[\'gallerySortDir\'] = isset($gallerySortDir) ? $gallerySortDir : \'ASC\';
	// Direction to sort the galleries ASC or DESC

$params[\'ignoreHidden\'] = isset($ignoreHidden) ? $ignoreHidden : 0;
	// Display documents marked as hidden in the gallery listing

$params[\'excludeDocs\'] = isset($excludeDocs) ? $excludeDocs : 0;
	// Prevent the specified documents from showing in the gallery listing
        // Multiple document id\'s can be specified by commas (no spaces)

$params[\'sortBy\'] = isset($sortBy) ? $sortBy : \'sortorder\';
	// Sort items by field (possible fields: id, content_id, filename, title, description, sortorder) or RAND()

$params[\'sortDir\'] = isset($sortDir) ? $sortDir : \'ASC\';
	// Direction to sort the items ASC or DESC

$params[\'limit\'] = isset($limit) ? $limit : \'\';
	// Limit the number of items to display

$params[\'tags\'] = isset($tags) ? $tags : \'\';
	// Comma delimited set of tags to filter results by

$params[\'tagMode\'] = isset($tagMode) ? $tagMode : \'AND\';
	// Search mode for tag: AND or OR

$params[\'tpl\'] = isset($tpl) ? $tpl : \'\';
	// Chunk template for the outer gallery template (defaults to tpl.default.txt for selected type)
	// Placeholders: items

$params[\'itemTpl\'] = isset($itemTpl) ? $itemTpl : \'\';
	// Chunk template for each thumbnail/image in the gallery (defaults to tpl.item.default.txt for selected type)

$params[\'itemTplFirst\'] = isset($itemTplFirst) ? $itemTplFirst : \'\';
	// Chunk template for last thumbnail/image in the gallery (defaults to tpl.item.first.txt for selected type)

$params[\'itemTplLast\'] = isset($itemTplLast) ? $itemTplLast : \'\';
	// Chunk template for last thumbnail/image in the gallery (defaults to tpl.item.last.txt for selected type)

$params[\'itemTplAlt\'] = isset($itemTplAlt) ? $itemTplAlt : \'\';
	// Chunk template for alternate thumbnail/image in the gallery (defaults to tpl.item.alt.txt for selected type)

$params[\'itemAltNum\'] = isset($itemAltNum) ? $itemAltNum : \'2\';
	// Modifier for the alternate thumbnail/image (defaults to every second item)

$params[\'galleriesUrl\'] = isset($galleriesUrl) ? $galleriesUrl : $modx->config[\'base_url\'] . \'assets/galleries/\';
	// URL to the galleries directory (should contain folders with the Id of the document, with a thumbs/ folder within each document\'s gallery)

$params[\'galleriesPath\'] = isset($galleriesPath) ? $galleriesPath : $modx->config[\'base_path\'] . \'assets/galleries/\';
	// Path to the galleries directory

$params[\'snippetUrl\'] = isset($snippetUrl) ? $snippetUrl : $modx->config[\'base_url\'] . \'assets/snippets/evogallery/\';
	// URL to the snippet directory

$params[\'snippetPath\'] = isset($snippetPath) ? $snippetPath : $modx->config[\'base_path\'] . \'assets/snippets/evogallery/\';
	// Path to the snippet directory

$params[\'id\'] = isset($id)?$id:\'\';
	// Unique ID for this EvoGallery instance and unique URL parameters

$params[\'paginate\'] = isset($paginate)?$paginate:0;
	// Paginate the results set into pages of &show length. 

$params[\'paginateAlwaysShowLinks\'] = isset($paginateAlwaysShowLinks)?$paginateAlwaysShowLinks:0;
	// Determine whether or not to always show previous next links

$params[\'show\'] = isset($show)?$show:\'20\';
	// Number of images to display in the results when pagination on

$params[\'paginateNextText\'] = isset($paginateNextText)?$paginateNextText:\'Next\';
	// Text for next label

$params[\'paginatePreviousText\'] = isset($paginatePreviousText)?$paginatePreviousText:\'Previous\';
	// Text for previous label

$params[\'paginateSplitterCharacter\'] = isset($paginateSplitterCharacter)?$modx->getChunk($paginateSplitterCharacter):"|";
	// Splitter to use if always show is disabled

$params[\'tplPaginatePrevious\'] = isset($tplPaginatePrevious)?$modx->getChunk($tplPaginatePrevious):"<a href=\'[+url+]\' class=\'eg_previous_link\'>[+PaginatePreviousText+]</a>";
	// Template for the previous link

$params[\'tplPaginateNext\'] = isset($tplPaginateNext)?$modx->getChunk($tplPaginateNext):"<a href=\'[+url+]\' class=\'eg_next_link\'>[+PaginateNextText+]</a>";
	// Template for the next link

$params[\'tplPaginateNextOff\'] = isset($tplPaginateNextOff)?$modx->getChunk($tplPaginateNextOff):"<span class=\'eg_next_off eg_off\'>[+PaginateNextText+]</span>";
	// Template for the inside of the next link

$params[\'tplPaginatePreviousOff\'] = isset($tplPaginatePreviousOff)?$modx->getChunk($tplPaginatePreviousOff):"<span class=\'eg_previous_off eg_off\'>[+PaginatePreviousText+]</span>";
	// Template for the inside of the previous link

$params[\'tplPaginatePage\'] = isset($tplPaginatePage)?$modx->getChunk($tplPaginatePage):"<a class=\'eg_page\' href=\'[+url+]\'>[+page+]</a>";
	// Template for the page link

$params[\'tplPaginateCurrentPage\'] = isset($tplPaginateCurrentPage)?$modx->getChunk($tplPaginateCurrentPage):"<span class=\'eg_currentpage\'>[+page+]</span>";
	// Template for the current page link

/*--------------------------------------------------------------------------*/

include_once($params[\'snippetPath\'] . \'classes/gallery.class.inc.php\');

if (!class_exists(\'PHxParser\'))
	include_once($params[\'snippetPath\'] . \'classes/phx.parser.class.inc.php\');

if (class_exists(\'Gallery\'))
	$gal = new Gallery($params);
else
	$modx->logEvent(1, 3, \'Error loading gallery snippet\');

return $gal->execute();
';
$s['EvoGalleryProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['EvoGallery'] = '/*---------------------------------------------------------------------------
* EvoGallery Snippet - Generates sortable listing of
* galleries, with full templating control
*--------------------------------------------------------------------------*/
//
// System settings
//

$params[\'display\'] = isset($display) ? $display : \'images\';
	// Have the snippet output either a list of galleries within the specified doc Id, a list of images within a gallery, or a single image based on a pic Id
	// Possible values: galleries, images, single

$params[\'type\'] = isset($type) ? $type : \'simple-list\';
	// Output type, if specified, the snippet will automatically load the required javascript
	// Current types: simple-list, single, jquery-cycle

$params[\'includeAssets\'] = isset($includeAssets) ? intval($includeAssets) : 1;
	// Register external scripts and CSS files required by the specified gallery type
	// If set to 0, these will need to be included manually in the document <head>

$params[\'picId\'] = isset($picId) ? $picId : $_REQUEST[\'picId\'];
	// ID of specific pic to show when displaying by a single image

$params[\'docId\'] = isset($docId) ? $docId : $modx->documentIdentifier;
	// Document ID for which to display gallery (default: document from which snippet was called)
        // Multiple document id\'s can be specified by commas (no spaces), or * for all documents

$params[\'gallerySortBy\'] = isset($gallerySortBy) ? $gallerySortBy : \'menuindex\';
	// Galleries sort order (possible fields: id, pagetitle, longtitle, description, alias, pub_date, introtext,
	// editedby, editedon, publishedon, publishedby, menutitle) or RAND()

$params[\'gallerySortDir\'] = isset($gallerySortDir) ? $gallerySortDir : \'ASC\';
	// Direction to sort the galleries ASC or DESC

$params[\'ignoreHidden\'] = isset($ignoreHidden) ? $ignoreHidden : 0;
	// Display documents marked as hidden in the gallery listing

$params[\'excludeDocs\'] = isset($excludeDocs) ? $excludeDocs : 0;
	// Prevent the specified documents from showing in the gallery listing
        // Multiple document id\'s can be specified by commas (no spaces)

$params[\'sortBy\'] = isset($sortBy) ? $sortBy : \'sortorder\';
	// Sort items by field (possible fields: id, content_id, filename, title, description, sortorder) or RAND()

$params[\'sortDir\'] = isset($sortDir) ? $sortDir : \'ASC\';
	// Direction to sort the items ASC or DESC

$params[\'limit\'] = isset($limit) ? $limit : \'\';
	// Limit the number of items to display

$params[\'tags\'] = isset($tags) ? $tags : \'\';
	// Comma delimited set of tags to filter results by

$params[\'tagMode\'] = isset($tagMode) ? $tagMode : \'AND\';
	// Search mode for tag: AND or OR

$params[\'tpl\'] = isset($tpl) ? $tpl : \'\';
	// Chunk template for the outer gallery template (defaults to tpl.default.txt for selected type)
	// Placeholders: items

$params[\'itemTpl\'] = isset($itemTpl) ? $itemTpl : \'\';
	// Chunk template for each thumbnail/image in the gallery (defaults to tpl.item.default.txt for selected type)

$params[\'itemTplFirst\'] = isset($itemTplFirst) ? $itemTplFirst : \'\';
	// Chunk template for last thumbnail/image in the gallery (defaults to tpl.item.first.txt for selected type)

$params[\'itemTplLast\'] = isset($itemTplLast) ? $itemTplLast : \'\';
	// Chunk template for last thumbnail/image in the gallery (defaults to tpl.item.last.txt for selected type)

$params[\'itemTplAlt\'] = isset($itemTplAlt) ? $itemTplAlt : \'\';
	// Chunk template for alternate thumbnail/image in the gallery (defaults to tpl.item.alt.txt for selected type)

$params[\'itemAltNum\'] = isset($itemAltNum) ? $itemAltNum : \'2\';
	// Modifier for the alternate thumbnail/image (defaults to every second item)

$params[\'galleriesUrl\'] = isset($galleriesUrl) ? $galleriesUrl : $modx->config[\'base_url\'] . \'assets/galleries/\';
	// URL to the galleries directory (should contain folders with the Id of the document, with a thumbs/ folder within each document\'s gallery)

$params[\'galleriesPath\'] = isset($galleriesPath) ? $galleriesPath : $modx->config[\'base_path\'] . \'assets/galleries/\';
	// Path to the galleries directory

$params[\'snippetUrl\'] = isset($snippetUrl) ? $snippetUrl : $modx->config[\'base_url\'] . \'assets/snippets/evogallery/\';
	// URL to the snippet directory

$params[\'snippetPath\'] = isset($snippetPath) ? $snippetPath : $modx->config[\'base_path\'] . \'assets/snippets/evogallery/\';
	// Path to the snippet directory

$params[\'id\'] = isset($id)?$id:\'\';
	// Unique ID for this EvoGallery instance and unique URL parameters

$params[\'paginate\'] = isset($paginate)?$paginate:0;
	// Paginate the results set into pages of &show length. 

$params[\'paginateAlwaysShowLinks\'] = isset($paginateAlwaysShowLinks)?$paginateAlwaysShowLinks:0;
	// Determine whether or not to always show previous next links

$params[\'show\'] = isset($show)?$show:\'20\';
	// Number of images to display in the results when pagination on

$params[\'paginateNextText\'] = isset($paginateNextText)?$paginateNextText:\'Next\';
	// Text for next label

$params[\'paginatePreviousText\'] = isset($paginatePreviousText)?$paginatePreviousText:\'Previous\';
	// Text for previous label

$params[\'paginateSplitterCharacter\'] = isset($paginateSplitterCharacter)?$modx->getChunk($paginateSplitterCharacter):"|";
	// Splitter to use if always show is disabled

$params[\'tplPaginatePrevious\'] = isset($tplPaginatePrevious)?$modx->getChunk($tplPaginatePrevious):"<a href=\'[+url+]\' class=\'eg_previous_link\'>[+PaginatePreviousText+]</a>";
	// Template for the previous link

$params[\'tplPaginateNext\'] = isset($tplPaginateNext)?$modx->getChunk($tplPaginateNext):"<a href=\'[+url+]\' class=\'eg_next_link\'>[+PaginateNextText+]</a>";
	// Template for the next link

$params[\'tplPaginateNextOff\'] = isset($tplPaginateNextOff)?$modx->getChunk($tplPaginateNextOff):"<span class=\'eg_next_off eg_off\'>[+PaginateNextText+]</span>";
	// Template for the inside of the next link

$params[\'tplPaginatePreviousOff\'] = isset($tplPaginatePreviousOff)?$modx->getChunk($tplPaginatePreviousOff):"<span class=\'eg_previous_off eg_off\'>[+PaginatePreviousText+]</span>";
	// Template for the inside of the previous link

$params[\'tplPaginatePage\'] = isset($tplPaginatePage)?$modx->getChunk($tplPaginatePage):"<a class=\'eg_page\' href=\'[+url+]\'>[+page+]</a>";
	// Template for the page link

$params[\'tplPaginateCurrentPage\'] = isset($tplPaginateCurrentPage)?$modx->getChunk($tplPaginateCurrentPage):"<span class=\'eg_currentpage\'>[+page+]</span>";
	// Template for the current page link

/*--------------------------------------------------------------------------*/

include_once($params[\'snippetPath\'] . \'classes/gallery.class.inc.php\');

if (!class_exists(\'PHxParser\'))
	include_once($params[\'snippetPath\'] . \'classes/phx.parser.class.inc.php\');

if (class_exists(\'Gallery\'))
	$gal = new Gallery($params);
else
	$modx->logEvent(1, 3, \'Error loading gallery snippet\');

return $gal->execute();
';
$s['MultiFiles'] = '$tvname = isset($tvname) ? $tvname : \'files\';
$outerTpl = isset($outerTpl) ? $modx->getChunk($outerTpl) : \'<div class="files">[+files+]</div>\';
$rowTpl = isset($rowTpl) ? $modx->getChunk($rowTpl) : \'<p><img src="[+icon+]" alt="[+alt+]" title="[+alt+]" />&nbsp;<a href="[+url+]" id="file_[+num+]">[+title+]</a></p>\';
$fid = isset($fid) ? $fid : false;

if (isset($id)) {
	$tvf = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvf[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvf = $modx->documentObject[$tvname];
	$tvv = $tvf[1];
}
if (!$tvv) return;
$fileArr=json_decode($tvv);
$fileRes=array();
$num=1;
foreach ($fileArr as $v) {
	$pathinfo = pathinfo($v[0]);
	$ext = strtolower($pathinfo[\'extension\']);
	switch($ext) {
		case \'gif\': case \'jpg\': case \'jpeg\': case \'png\': case \'tif\': case \'tiff\':  case \'bmp\':
			$icon = \'icon_image\';
			$alt = \'Изображение\';
			break;
		case \'xls\':
			$icon = \'icon_excel\';
			$alt = \'Microsoft Excel\';
			break;
		case \'html\': case \'htm\':
			$icon = \'icon_html\';
			$alt = \'HTML\';
			break;
		case \'pdf\':
			$icon = \'icon_pdf\';
			$alt = \'Adobe PDF\';
			break;
		case \'ppt\':
			$icon = \'icon_pp\';
			$alt = \'Microsoft Powerpoint\';
			break;
		case \'rtf\': case \'txt\': case \'css\': case \'js\': case \'xml\':
			$icon = \'icon_text\';
			$alt = \'Текст\';
			break;
		case \'doc\':
			$icon = \'icon_word\';
			$alt = \'Microsoft Word\';
			break;
		case \'zip\': case \'rar\': case \'tar\': case \'7z\':
			$icon = \'icon_zip\';
			$alt = \'Файл архива\';
			break;
		default:
			$icon = \'icon_generic\';
			$alt = \'Файл\';
			break;
	}
	$icon=MODX_BASE_URL.\'assets/fileicons/\'.$icon.\'.gif\';
	$fields = array (\'[+url+]\',\'[+title+]\',\'[+num+]\',\'[+icon+]\',\'[+alt+]\');
	$values = array ($v[0],$v[1],$num,$icon,$alt);
	$fileRes[$num] = str_replace($fields, $values, $rowTpl);
	$num++;
}
$output = $fid ? $fileRes[$fid] : implode(\'\',$fileRes);
if (isset($random)) $output = $fileRes[array_rand($fileRes)];
if ($output) return str_replace(\'[+files+]\',$output,$outerTpl);
?>';
$s['MultiFiles'] = '$tvname = isset($tvname) ? $tvname : \'files\';
$outerTpl = isset($outerTpl) ? $modx->getChunk($outerTpl) : \'<div class="files">[+files+]</div>\';
$rowTpl = isset($rowTpl) ? $modx->getChunk($rowTpl) : \'<p><img src="[+icon+]" alt="[+alt+]" title="[+alt+]" />&nbsp;<a href="[+url+]" id="file_[+num+]">[+title+]</a></p>\';
$fid = isset($fid) ? $fid : false;

if (isset($id)) {
	$tvf = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvf[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvf = $modx->documentObject[$tvname];
	$tvv = $tvf[1];
}
if (!$tvv) return;
$fileArr=json_decode($tvv);
$fileRes=array();
$num=1;
foreach ($fileArr as $v) {
	$pathinfo = pathinfo($v[0]);
	$ext = strtolower($pathinfo[\'extension\']);
	switch($ext) {
		case \'gif\': case \'jpg\': case \'jpeg\': case \'png\': case \'tif\': case \'tiff\':  case \'bmp\':
			$icon = \'icon_image\';
			$alt = \'Изображение\';
			break;
		case \'xls\':
			$icon = \'icon_excel\';
			$alt = \'Microsoft Excel\';
			break;
		case \'html\': case \'htm\':
			$icon = \'icon_html\';
			$alt = \'HTML\';
			break;
		case \'pdf\':
			$icon = \'icon_pdf\';
			$alt = \'Adobe PDF\';
			break;
		case \'ppt\':
			$icon = \'icon_pp\';
			$alt = \'Microsoft Powerpoint\';
			break;
		case \'rtf\': case \'txt\': case \'css\': case \'js\': case \'xml\':
			$icon = \'icon_text\';
			$alt = \'Текст\';
			break;
		case \'doc\':
			$icon = \'icon_word\';
			$alt = \'Microsoft Word\';
			break;
		case \'zip\': case \'rar\': case \'tar\': case \'7z\':
			$icon = \'icon_zip\';
			$alt = \'Файл архива\';
			break;
		default:
			$icon = \'icon_generic\';
			$alt = \'Файл\';
			break;
	}
	$icon=MODX_BASE_URL.\'assets/fileicons/\'.$icon.\'.gif\';
	$fields = array (\'[+url+]\',\'[+title+]\',\'[+num+]\',\'[+icon+]\',\'[+alt+]\');
	$values = array ($v[0],$v[1],$num,$icon,$alt);
	$fileRes[$num] = str_replace($fields, $values, $rowTpl);
	$num++;
}
$output = $fid ? $fileRes[$fid] : implode(\'\',$fileRes);
if (isset($random)) $output = $fileRes[array_rand($fileRes)];
if ($output) return str_replace(\'[+files+]\',$output,$outerTpl);
?>';
$s['MultiFiles'] = '$tvname = isset($tvname) ? $tvname : \'files\';
$outerTpl = isset($outerTpl) ? $modx->getChunk($outerTpl) : \'<div class="files">[+files+]</div>\';
$rowTpl = isset($rowTpl) ? $modx->getChunk($rowTpl) : \'<p><img src="[+icon+]" alt="[+alt+]" title="[+alt+]" />&nbsp;<a href="[+url+]" id="file_[+num+]">[+title+]</a></p>\';
$fid = isset($fid) ? $fid : false;

if (isset($id)) {
	$tvf = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvf[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvf = $modx->documentObject[$tvname];
	$tvv = $tvf[1];
}
if (!$tvv) return;
$fileArr=json_decode($tvv);
$fileRes=array();
$num=1;
foreach ($fileArr as $v) {
	$pathinfo = pathinfo($v[0]);
	$ext = strtolower($pathinfo[\'extension\']);
	switch($ext) {
		case \'gif\': case \'jpg\': case \'jpeg\': case \'png\': case \'tif\': case \'tiff\':  case \'bmp\':
			$icon = \'icon_image\';
			$alt = \'Изображение\';
			break;
		case \'xls\':
			$icon = \'icon_excel\';
			$alt = \'Microsoft Excel\';
			break;
		case \'html\': case \'htm\':
			$icon = \'icon_html\';
			$alt = \'HTML\';
			break;
		case \'pdf\':
			$icon = \'icon_pdf\';
			$alt = \'Adobe PDF\';
			break;
		case \'ppt\':
			$icon = \'icon_pp\';
			$alt = \'Microsoft Powerpoint\';
			break;
		case \'rtf\': case \'txt\': case \'css\': case \'js\': case \'xml\':
			$icon = \'icon_text\';
			$alt = \'Текст\';
			break;
		case \'doc\':
			$icon = \'icon_word\';
			$alt = \'Microsoft Word\';
			break;
		case \'zip\': case \'rar\': case \'tar\': case \'7z\':
			$icon = \'icon_zip\';
			$alt = \'Файл архива\';
			break;
		default:
			$icon = \'icon_generic\';
			$alt = \'Файл\';
			break;
	}
	$icon=MODX_BASE_URL.\'assets/fileicons/\'.$icon.\'.gif\';
	$fields = array (\'[+url+]\',\'[+title+]\',\'[+num+]\',\'[+icon+]\',\'[+alt+]\');
	$values = array ($v[0],$v[1],$num,$icon,$alt);
	$fileRes[$num] = str_replace($fields, $values, $rowTpl);
	$num++;
}
$output = $fid ? $fileRes[$fid] : implode(\'\',$fileRes);
if (isset($random)) $output = $fileRes[array_rand($fileRes)];
if ($output) return str_replace(\'[+files+]\',$output,$outerTpl);
?>';
$s['MultiFilesProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['MultiFiles'] = '$tvname = isset($tvname) ? $tvname : \'files\';
$outerTpl = isset($outerTpl) ? $modx->getChunk($outerTpl) : \'<div class="files">[+files+]</div>\';
$rowTpl = isset($rowTpl) ? $modx->getChunk($rowTpl) : \'<p><img src="[+icon+]" alt="[+alt+]" title="[+alt+]" />&nbsp;<a href="[+url+]" id="file_[+num+]">[+title+]</a></p>\';
$fid = isset($fid) ? $fid : false;

if (isset($id)) {
	$tvf = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvf[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvf = $modx->documentObject[$tvname];
	$tvv = $tvf[1];
}
if (!$tvv) return;
$fileArr=json_decode($tvv);
$fileRes=array();
$num=1;
foreach ($fileArr as $v) {
	$pathinfo = pathinfo($v[0]);
	$ext = strtolower($pathinfo[\'extension\']);
	switch($ext) {
		case \'gif\': case \'jpg\': case \'jpeg\': case \'png\': case \'tif\': case \'tiff\':  case \'bmp\':
			$icon = \'icon_image\';
			$alt = \'Изображение\';
			break;
		case \'xls\':
			$icon = \'icon_excel\';
			$alt = \'Microsoft Excel\';
			break;
		case \'html\': case \'htm\':
			$icon = \'icon_html\';
			$alt = \'HTML\';
			break;
		case \'pdf\':
			$icon = \'icon_pdf\';
			$alt = \'Adobe PDF\';
			break;
		case \'ppt\':
			$icon = \'icon_pp\';
			$alt = \'Microsoft Powerpoint\';
			break;
		case \'rtf\': case \'txt\': case \'css\': case \'js\': case \'xml\':
			$icon = \'icon_text\';
			$alt = \'Текст\';
			break;
		case \'doc\':
			$icon = \'icon_word\';
			$alt = \'Microsoft Word\';
			break;
		case \'zip\': case \'rar\': case \'tar\': case \'7z\':
			$icon = \'icon_zip\';
			$alt = \'Файл архива\';
			break;
		default:
			$icon = \'icon_generic\';
			$alt = \'Файл\';
			break;
	}
	$icon=MODX_BASE_URL.\'assets/fileicons/\'.$icon.\'.gif\';
	$fields = array (\'[+url+]\',\'[+title+]\',\'[+num+]\',\'[+icon+]\',\'[+alt+]\');
	$values = array ($v[0],$v[1],$num,$icon,$alt);
	$fileRes[$num] = str_replace($fields, $values, $rowTpl);
	$num++;
}
$output = $fid ? $fileRes[$fid] : implode(\'\',$fileRes);
if (isset($random)) $output = $fileRes[array_rand($fileRes)];
if ($output) return str_replace(\'[+files+]\',$output,$outerTpl);
?>';
$s['EasyAdvertising'] = '/*
*  EasyAdvertising - снипет вывода рекламы на сайте
*  Версия 1.02 (17.05.2012)
*  Авторы:  Леха.com
*           thebat053
*  ver.1.02 lo-pata (s.vlksm@gmail.com)
*
*  Параметры:
*  limit	- сколько блоков выводить
*  area		- рекламная зона
*  sort		- "rnd", по-умолчанию сортируется по позиции
*  regCss	- подключение стилей из чанка, можно использовать @FILE: для подключения из файла
*  regJs	- аналогично regCss, только подключение javascript
*  noJs		- по-умолчанию для показа flash-баннеров подключается swfobject.js, 
*				этот параметр позволяет его отключить
*				(путь к файлу assets/modules/easyadvertising/flash)
*  noCss	- по-умолчанию для показа flash-баннеров подключается eadvt.css, 
*				этот параметр позволяет его отключить
*				(путь к файлу assets/modules/easyadvertising/css)
*/
if (!class_exists("EasyAdvertising")) {
    class EasyAdvertising {
		
		public $js; 
        public $css; 
        public $mx;
		
		function __construct($modx) {
			$this->js = \'\';
			$this->css = \'\';
			$this->mx = $modx;
		}
		
		function is_show_advrt ($url, $template, $ex_template) {
			if (!empty($template)) {
				if ($this->find_template($url, $template)) 
					return !$this->find_template($url, $ex_template);
			} else
				return !$this->find_template($url, $ex_template);
		}
		   
		function find_template($url, $template) {
            $cur_id = $this->mx->documentIdentifier;
            $temp = explode("\\r\\n", $template);
			foreach ($temp as $value) {
				$value = trim($value);
				if ($value != \'\') {
                    if (substr($value,-1) == \'*\' && (int)$value > 0) { // если указан id раздела с документами
                        $par_arr = $this->mx->getParentIds($cur_id); 
                        if (substr($value,-2) == \'**\') // включая страницу раздела
                            $par_arr[] = $cur_id;
                        if (in_array((int)$value, $par_arr)) 
                            return true;
                    } else {
                        if (is_int($value)) {// если в строке шаблона указан ид, а не урл
                            if ($cur_id == (int)$value)
                                return true;
                            else if ($this->mx->getConfig(\'friendly_urls\') == 1)
                                $value = $this->mx->makeUrl((int)$value, \'\', \'\', \'full\');
                        } 
                        if (stripos( $url, $value) !== false) 
                            return true;
                    }    
				}    
			}
			return false;
		}
		
		function get_banner($row, $modUrl, $protocol="http://") {
			$lnk = \'<a target="_blank" href="\'.
				($row[\'jump_counted\'] == 1 ? $protocol.$_SERVER[\'HTTP_HOST\'].\'/click.php?id=\'.$row[\'id\'] : $row[\'link\']).\'">\';
			$row[\'content\'] = htmlspecialchars_decode($row[\'content\']);
			if (!is_file($row[\'content\'])) {	// html-код
			
                if (strpos($row[\'content\'], \'[+link_start+]\'))
					$banner = str_replace(array(\'[+link_start+]\',\'[+link_finish+]\') , array($lnk,\'</a>\'), $row[\'content\']);	
				else 
					$banner = $lnk.$row[\'content\'].\'</a>\';	
			
            } else {							// путь к файлу
				
                $ext = pathinfo($row[\'content\'], PATHINFO_EXTENSION);
				if ($ext == \'swf\') {
					
					$alt = \'<a href="http://www.adobe.com/go/getflashplayer">
							<img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" 
							alt="Get Adobe Flash player" /></a>\';
					
					//рисуем ссылку, если нужно считать переходы или если заполнено поле "линк" (т.е. не зашита в баннер)
					if ($row[\'jump_counted\'] == 1 || !empty($row[\'link\'])) { 
						$banner = \'<div id="eadvt_wrapper\'.$row[\'id\'].\'">\'.$lnk.\'</a><div id="eadvt\'.$row[\'id\'].\'">\'.$alt.\'</div></div>\';
					} else 
						$banner = \'<div id="eadvt\'.$row[\'id\'].\'">\'.$alt.\'</div>\';
					
					$fl = getimagesize($row[\'content\']);
					$this->js .= "swfobject.embedSWF(\'".$row[\'content\']."\', \'eadvt".$row[\'id\']."\', \'".$fl[0]."\', \'".$fl[1]."\', \'6.0.65\', \'".$modUrl."flash/expressInstall.swf\', {}, {wmode:\'opaque\',quality:\'high\'});\\n";
					$this->css .= "#eadvt_wrapper".$row[\'id\']." {width:".$fl[0]."px; height:".$fl[1]."px} \\n";
				} else 
					$banner = $lnk.\'<img src="\'.$row[\'content\'].\'" alt="banner \'.$row[\'id\'].\'" /></a>\';	
			
            }
            
			return $banner;	
		}	
	}
}

$regCss		= (isset($regCss) && !empty($regCss)) ? $regCss : \'\';
$regJs		= (isset($regJs) && !empty($regJs)) ? $regJs : \'\';
$noCss		= isset($noCss) ? (int)$noCss : 0;
$noJs		= isset($noJs) ? (int)$noJs : 0;

$ea = new EasyAdvertising($modx);
$mod_table = $modx->getFullTableName("site_easyadvt");
$modUrl = \'assets/modules/easyadvertising/\';
$url=$modx->getConfig(\'server_protocol\')."://".$_SERVER[\'HTTP_HOST\'].$_SERVER[\'REQUEST_URI\'];
$out = \'\';
$i = 0; //инициализация счетчика рекламных блоков

$limit = isset($limit) ? (int)$limit : 0;
$where = "published = 1 AND pub_date < ".time()." AND (unpub_date > ".time()." OR unpub_date = 0 ) ";
$where .= "AND area = \'".(isset($area) ? trim($area) : \'\')."\' ";
$where .= "AND (count_view < total_view OR total_view = 0)";
$where .= "AND (jump_count < total_jump OR total_jump = 0)";
$sort = isset($sort) ? ((strtoupper($sort) == "RND") ? "RAND()" : $sort) : "pos ASC";

$sql = "SELECT 
			id, pos, template, ex_template, content, counted, count_view, 
			total_view, jump_counted, total_jump, link 
		FROM ".$mod_table."
		WHERE ".$where."
		ORDER BY ".$sort;
$res = $modx->db->query($sql);

while (($row = $modx->db->getRow($res)) && ($i < $limit || $limit == 0)) {
	if ($ea->is_show_advrt($url, $row[\'template\'], $row[\'ex_template\'])) {
		if (($row[\'count_view\'] < $row[\'total_view\'] || $row[\'total_view\'] == 0) 
			&& ($row[\'jump_count\'] < $row[\'total_jump\'] || $row[\'total_jump\'] == 0)) { // если удовлетворяет условиям кол-ва показов и кликов
			$out .= $ea->get_banner($row, $modUrl, $modx->getConfig(\'server_protocol\').\'://\');
			$i = ($limit != 0) ? ++$i : $i;
			if ($row[\'counted\'] == 1) 
				$modx->ui[] = $row[\'id\'];
		}
	}
}

if (isset($regCss) && !empty($regCss)) {
	if (substr($regCss,0,6) == \'@FILE:\') 
		$modx->regClientCSS($regCss);
	else 
		$modx->regClientCSS(\'<style type="text/css">\'.$modx->getChunk($regCss).\'</style>\');
} else if (!empty($ea->css) && $noCss != 1) {
	$modx->regClientCSS($modUrl.\'css/eadvt.css\');
	$modx->regClientCSS(\'<style type="text/css">\'.$ea->css.\'</style>\');
}

if (isset($regJs) && !empty($regJs)) {
	if (substr($regJs,0,6) == \'@FILE:\') 
		$modx->regClientScript($regJs);
	else 
		$modx->regClientScript(\'<script type="text/javascript">\'.$modx->getChunk($regJs).\'</script>\');
} else if (!empty($ea->js) && $noJs != 1) {
	$modx->regClientScript($modUrl.\'flash/swfobject.js\');
	$script = \'<script type="text/javascript">\'.$ea->js.\'</script>\';
	$modx->regClientScript($script);
}	

return $out;';
$s['EasyAdvertising'] = '/*
*  EasyAdvertising - снипет вывода рекламы на сайте
*  Версия 1.02 (17.05.2012)
*  Авторы:  Леха.com
*           thebat053
*  ver.1.02 lo-pata (s.vlksm@gmail.com)
*
*  Параметры:
*  limit	- сколько блоков выводить
*  area		- рекламная зона
*  sort		- "rnd", по-умолчанию сортируется по позиции
*  regCss	- подключение стилей из чанка, можно использовать @FILE: для подключения из файла
*  regJs	- аналогично regCss, только подключение javascript
*  noJs		- по-умолчанию для показа flash-баннеров подключается swfobject.js, 
*				этот параметр позволяет его отключить
*				(путь к файлу assets/modules/easyadvertising/flash)
*  noCss	- по-умолчанию для показа flash-баннеров подключается eadvt.css, 
*				этот параметр позволяет его отключить
*				(путь к файлу assets/modules/easyadvertising/css)
*/
if (!class_exists("EasyAdvertising")) {
    class EasyAdvertising {
		
		public $js; 
        public $css; 
        public $mx;
		
		function __construct($modx) {
			$this->js = \'\';
			$this->css = \'\';
			$this->mx = $modx;
		}
		
		function is_show_advrt ($url, $template, $ex_template) {
			if (!empty($template)) {
				if ($this->find_template($url, $template)) 
					return !$this->find_template($url, $ex_template);
			} else
				return !$this->find_template($url, $ex_template);
		}
		   
		function find_template($url, $template) {
            $cur_id = $this->mx->documentIdentifier;
            $temp = explode("\\r\\n", $template);
			foreach ($temp as $value) {
				$value = trim($value);
				if ($value != \'\') {
                    if (substr($value,-1) == \'*\' && (int)$value > 0) { // если указан id раздела с документами
                        $par_arr = $this->mx->getParentIds($cur_id); 
                        if (substr($value,-2) == \'**\') // включая страницу раздела
                            $par_arr[] = $cur_id;
                        if (in_array((int)$value, $par_arr)) 
                            return true;
                    } else {
                        if (is_int($value)) {// если в строке шаблона указан ид, а не урл
                            if ($cur_id == (int)$value)
                                return true;
                            else if ($this->mx->getConfig(\'friendly_urls\') == 1)
                                $value = $this->mx->makeUrl((int)$value, \'\', \'\', \'full\');
                        } 
                        if (stripos( $url, $value) !== false) 
                            return true;
                    }    
				}    
			}
			return false;
		}
		
		function get_banner($row, $modUrl, $protocol="http://") {
			$lnk = \'<a target="_blank" href="\'.
				($row[\'jump_counted\'] == 1 ? $protocol.$_SERVER[\'HTTP_HOST\'].\'/click.php?id=\'.$row[\'id\'] : $row[\'link\']).\'">\';
			$row[\'content\'] = htmlspecialchars_decode($row[\'content\']);
			if (!is_file($row[\'content\'])) {	// html-код
			
                if (strpos($row[\'content\'], \'[+link_start+]\'))
					$banner = str_replace(array(\'[+link_start+]\',\'[+link_finish+]\') , array($lnk,\'</a>\'), $row[\'content\']);	
				else 
					$banner = $lnk.$row[\'content\'].\'</a>\';	
			
            } else {							// путь к файлу
				
                $ext = pathinfo($row[\'content\'], PATHINFO_EXTENSION);
				if ($ext == \'swf\') {
					
					$alt = \'<a href="http://www.adobe.com/go/getflashplayer">
							<img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" 
							alt="Get Adobe Flash player" /></a>\';
					
					//рисуем ссылку, если нужно считать переходы или если заполнено поле "линк" (т.е. не зашита в баннер)
					if ($row[\'jump_counted\'] == 1 || !empty($row[\'link\'])) { 
						$banner = \'<div id="eadvt_wrapper\'.$row[\'id\'].\'">\'.$lnk.\'</a><div id="eadvt\'.$row[\'id\'].\'">\'.$alt.\'</div></div>\';
					} else 
						$banner = \'<div id="eadvt\'.$row[\'id\'].\'">\'.$alt.\'</div>\';
					
					$fl = getimagesize($row[\'content\']);
					$this->js .= "swfobject.embedSWF(\'".$row[\'content\']."\', \'eadvt".$row[\'id\']."\', \'".$fl[0]."\', \'".$fl[1]."\', \'6.0.65\', \'".$modUrl."flash/expressInstall.swf\', {}, {wmode:\'opaque\',quality:\'high\'});\\n";
					$this->css .= "#eadvt_wrapper".$row[\'id\']." {width:".$fl[0]."px; height:".$fl[1]."px} \\n";
				} else 
					$banner = $lnk.\'<img src="\'.$row[\'content\'].\'" alt="banner \'.$row[\'id\'].\'" /></a>\';	
			
            }
            
			return $banner;	
		}	
	}
}

$regCss		= (isset($regCss) && !empty($regCss)) ? $regCss : \'\';
$regJs		= (isset($regJs) && !empty($regJs)) ? $regJs : \'\';
$noCss		= isset($noCss) ? (int)$noCss : 0;
$noJs		= isset($noJs) ? (int)$noJs : 0;

$ea = new EasyAdvertising($modx);
$mod_table = $modx->getFullTableName("site_easyadvt");
$modUrl = \'assets/modules/easyadvertising/\';
$url=$modx->getConfig(\'server_protocol\')."://".$_SERVER[\'HTTP_HOST\'].$_SERVER[\'REQUEST_URI\'];
$out = \'\';
$i = 0; //инициализация счетчика рекламных блоков

$limit = isset($limit) ? (int)$limit : 0;
$where = "published = 1 AND pub_date < ".time()." AND (unpub_date > ".time()." OR unpub_date = 0 ) ";
$where .= "AND area = \'".(isset($area) ? trim($area) : \'\')."\' ";
$where .= "AND (count_view < total_view OR total_view = 0)";
$where .= "AND (jump_count < total_jump OR total_jump = 0)";
$sort = isset($sort) ? ((strtoupper($sort) == "RND") ? "RAND()" : $sort) : "pos ASC";

$sql = "SELECT 
			id, pos, template, ex_template, content, counted, count_view, 
			total_view, jump_counted, total_jump, link 
		FROM ".$mod_table."
		WHERE ".$where."
		ORDER BY ".$sort;
$res = $modx->db->query($sql);

while (($row = $modx->db->getRow($res)) && ($i < $limit || $limit == 0)) {
	if ($ea->is_show_advrt($url, $row[\'template\'], $row[\'ex_template\'])) {
		if (($row[\'count_view\'] < $row[\'total_view\'] || $row[\'total_view\'] == 0) 
			&& ($row[\'jump_count\'] < $row[\'total_jump\'] || $row[\'total_jump\'] == 0)) { // если удовлетворяет условиям кол-ва показов и кликов
			$out .= $ea->get_banner($row, $modUrl, $modx->getConfig(\'server_protocol\').\'://\');
			$i = ($limit != 0) ? ++$i : $i;
			if ($row[\'counted\'] == 1) 
				$modx->ui[] = $row[\'id\'];
		}
	}
}

if (isset($regCss) && !empty($regCss)) {
	if (substr($regCss,0,6) == \'@FILE:\') 
		$modx->regClientCSS($regCss);
	else 
		$modx->regClientCSS(\'<style type="text/css">\'.$modx->getChunk($regCss).\'</style>\');
} else if (!empty($ea->css) && $noCss != 1) {
	$modx->regClientCSS($modUrl.\'css/eadvt.css\');
	$modx->regClientCSS(\'<style type="text/css">\'.$ea->css.\'</style>\');
}

if (isset($regJs) && !empty($regJs)) {
	if (substr($regJs,0,6) == \'@FILE:\') 
		$modx->regClientScript($regJs);
	else 
		$modx->regClientScript(\'<script type="text/javascript">\'.$modx->getChunk($regJs).\'</script>\');
} else if (!empty($ea->js) && $noJs != 1) {
	$modx->regClientScript($modUrl.\'flash/swfobject.js\');
	$script = \'<script type="text/javascript">\'.$ea->js.\'</script>\';
	$modx->regClientScript($script);
}	

return $out;';
$s['EasyAdvertising'] = '/*
*  EasyAdvertising - снипет вывода рекламы на сайте
*  Версия 1.02 (17.05.2012)
*  Авторы:  Леха.com
*           thebat053
*  ver.1.02 lo-pata (s.vlksm@gmail.com)
*
*  Параметры:
*  limit	- сколько блоков выводить
*  area		- рекламная зона
*  sort		- "rnd", по-умолчанию сортируется по позиции
*  regCss	- подключение стилей из чанка, можно использовать @FILE: для подключения из файла
*  regJs	- аналогично regCss, только подключение javascript
*  noJs		- по-умолчанию для показа flash-баннеров подключается swfobject.js, 
*				этот параметр позволяет его отключить
*				(путь к файлу assets/modules/easyadvertising/flash)
*  noCss	- по-умолчанию для показа flash-баннеров подключается eadvt.css, 
*				этот параметр позволяет его отключить
*				(путь к файлу assets/modules/easyadvertising/css)
*/
if (!class_exists("EasyAdvertising")) {
    class EasyAdvertising {
		
		public $js; 
        public $css; 
        public $mx;
		
		function __construct($modx) {
			$this->js = \'\';
			$this->css = \'\';
			$this->mx = $modx;
		}
		
		function is_show_advrt ($url, $template, $ex_template) {
			if (!empty($template)) {
				if ($this->find_template($url, $template)) 
					return !$this->find_template($url, $ex_template);
			} else
				return !$this->find_template($url, $ex_template);
		}
		   
		function find_template($url, $template) {
            $cur_id = $this->mx->documentIdentifier;
            $temp = explode("\\r\\n", $template);
			foreach ($temp as $value) {
				$value = trim($value);
				if ($value != \'\') {
                    if (substr($value,-1) == \'*\' && (int)$value > 0) { // если указан id раздела с документами
                        $par_arr = $this->mx->getParentIds($cur_id); 
                        if (substr($value,-2) == \'**\') // включая страницу раздела
                            $par_arr[] = $cur_id;
                        if (in_array((int)$value, $par_arr)) 
                            return true;
                    } else {
                        if (is_int($value)) {// если в строке шаблона указан ид, а не урл
                            if ($cur_id == (int)$value)
                                return true;
                            else if ($this->mx->getConfig(\'friendly_urls\') == 1)
                                $value = $this->mx->makeUrl((int)$value, \'\', \'\', \'full\');
                        } 
                        if (stripos( $url, $value) !== false) 
                            return true;
                    }    
				}    
			}
			return false;
		}
		
		function get_banner($row, $modUrl, $protocol="http://") {
			$lnk = \'<a target="_blank" href="\'.
				($row[\'jump_counted\'] == 1 ? $protocol.$_SERVER[\'HTTP_HOST\'].\'/click.php?id=\'.$row[\'id\'] : $row[\'link\']).\'">\';
			$row[\'content\'] = htmlspecialchars_decode($row[\'content\']);
			if (!is_file($row[\'content\'])) {	// html-код
			
                if (strpos($row[\'content\'], \'[+link_start+]\'))
					$banner = str_replace(array(\'[+link_start+]\',\'[+link_finish+]\') , array($lnk,\'</a>\'), $row[\'content\']);	
				else 
					$banner = $lnk.$row[\'content\'].\'</a>\';	
			
            } else {							// путь к файлу
				
                $ext = pathinfo($row[\'content\'], PATHINFO_EXTENSION);
				if ($ext == \'swf\') {
					
					$alt = \'<a href="http://www.adobe.com/go/getflashplayer">
							<img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" 
							alt="Get Adobe Flash player" /></a>\';
					
					//рисуем ссылку, если нужно считать переходы или если заполнено поле "линк" (т.е. не зашита в баннер)
					if ($row[\'jump_counted\'] == 1 || !empty($row[\'link\'])) { 
						$banner = \'<div id="eadvt_wrapper\'.$row[\'id\'].\'">\'.$lnk.\'</a><div id="eadvt\'.$row[\'id\'].\'">\'.$alt.\'</div></div>\';
					} else 
						$banner = \'<div id="eadvt\'.$row[\'id\'].\'">\'.$alt.\'</div>\';
					
					$fl = getimagesize($row[\'content\']);
					$this->js .= "swfobject.embedSWF(\'".$row[\'content\']."\', \'eadvt".$row[\'id\']."\', \'".$fl[0]."\', \'".$fl[1]."\', \'6.0.65\', \'".$modUrl."flash/expressInstall.swf\', {}, {wmode:\'opaque\',quality:\'high\'});\\n";
					$this->css .= "#eadvt_wrapper".$row[\'id\']." {width:".$fl[0]."px; height:".$fl[1]."px} \\n";
				} else 
					$banner = $lnk.\'<img src="\'.$row[\'content\'].\'" alt="banner \'.$row[\'id\'].\'" /></a>\';	
			
            }
            
			return $banner;	
		}	
	}
}

$regCss		= (isset($regCss) && !empty($regCss)) ? $regCss : \'\';
$regJs		= (isset($regJs) && !empty($regJs)) ? $regJs : \'\';
$noCss		= isset($noCss) ? (int)$noCss : 0;
$noJs		= isset($noJs) ? (int)$noJs : 0;

$ea = new EasyAdvertising($modx);
$mod_table = $modx->getFullTableName("site_easyadvt");
$modUrl = \'assets/modules/easyadvertising/\';
$url=$modx->getConfig(\'server_protocol\')."://".$_SERVER[\'HTTP_HOST\'].$_SERVER[\'REQUEST_URI\'];
$out = \'\';
$i = 0; //инициализация счетчика рекламных блоков

$limit = isset($limit) ? (int)$limit : 0;
$where = "published = 1 AND pub_date < ".time()." AND (unpub_date > ".time()." OR unpub_date = 0 ) ";
$where .= "AND area = \'".(isset($area) ? trim($area) : \'\')."\' ";
$where .= "AND (count_view < total_view OR total_view = 0)";
$where .= "AND (jump_count < total_jump OR total_jump = 0)";
$sort = isset($sort) ? ((strtoupper($sort) == "RND") ? "RAND()" : $sort) : "pos ASC";

$sql = "SELECT 
			id, pos, template, ex_template, content, counted, count_view, 
			total_view, jump_counted, total_jump, link 
		FROM ".$mod_table."
		WHERE ".$where."
		ORDER BY ".$sort;
$res = $modx->db->query($sql);

while (($row = $modx->db->getRow($res)) && ($i < $limit || $limit == 0)) {
	if ($ea->is_show_advrt($url, $row[\'template\'], $row[\'ex_template\'])) {
		if (($row[\'count_view\'] < $row[\'total_view\'] || $row[\'total_view\'] == 0) 
			&& ($row[\'jump_count\'] < $row[\'total_jump\'] || $row[\'total_jump\'] == 0)) { // если удовлетворяет условиям кол-ва показов и кликов
			$out .= $ea->get_banner($row, $modUrl, $modx->getConfig(\'server_protocol\').\'://\');
			$i = ($limit != 0) ? ++$i : $i;
			if ($row[\'counted\'] == 1) 
				$modx->ui[] = $row[\'id\'];
		}
	}
}

if (isset($regCss) && !empty($regCss)) {
	if (substr($regCss,0,6) == \'@FILE:\') 
		$modx->regClientCSS($regCss);
	else 
		$modx->regClientCSS(\'<style type="text/css">\'.$modx->getChunk($regCss).\'</style>\');
} else if (!empty($ea->css) && $noCss != 1) {
	$modx->regClientCSS($modUrl.\'css/eadvt.css\');
	$modx->regClientCSS(\'<style type="text/css">\'.$ea->css.\'</style>\');
}

if (isset($regJs) && !empty($regJs)) {
	if (substr($regJs,0,6) == \'@FILE:\') 
		$modx->regClientScript($regJs);
	else 
		$modx->regClientScript(\'<script type="text/javascript">\'.$modx->getChunk($regJs).\'</script>\');
} else if (!empty($ea->js) && $noJs != 1) {
	$modx->regClientScript($modUrl.\'flash/swfobject.js\');
	$script = \'<script type="text/javascript">\'.$ea->js.\'</script>\';
	$modx->regClientScript($script);
}	

return $out;';
$s['EasyAdvertisingProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['EasyAdvertising'] = '/*
*  EasyAdvertising - снипет вывода рекламы на сайте
*  Версия 1.02 (17.05.2012)
*  Авторы:  Леха.com
*           thebat053
*  ver.1.02 lo-pata (s.vlksm@gmail.com)
*
*  Параметры:
*  limit	- сколько блоков выводить
*  area		- рекламная зона
*  sort		- "rnd", по-умолчанию сортируется по позиции
*  regCss	- подключение стилей из чанка, можно использовать @FILE: для подключения из файла
*  regJs	- аналогично regCss, только подключение javascript
*  noJs		- по-умолчанию для показа flash-баннеров подключается swfobject.js, 
*				этот параметр позволяет его отключить
*				(путь к файлу assets/modules/easyadvertising/flash)
*  noCss	- по-умолчанию для показа flash-баннеров подключается eadvt.css, 
*				этот параметр позволяет его отключить
*				(путь к файлу assets/modules/easyadvertising/css)
*/
if (!class_exists("EasyAdvertising")) {
    class EasyAdvertising {
		
		public $js; 
        public $css; 
        public $mx;
		
		function __construct($modx) {
			$this->js = \'\';
			$this->css = \'\';
			$this->mx = $modx;
		}
		
		function is_show_advrt ($url, $template, $ex_template) {
			if (!empty($template)) {
				if ($this->find_template($url, $template)) 
					return !$this->find_template($url, $ex_template);
			} else
				return !$this->find_template($url, $ex_template);
		}
		   
		function find_template($url, $template) {
            $cur_id = $this->mx->documentIdentifier;
            $temp = explode("\\r\\n", $template);
			foreach ($temp as $value) {
				$value = trim($value);
				if ($value != \'\') {
                    if (substr($value,-1) == \'*\' && (int)$value > 0) { // если указан id раздела с документами
                        $par_arr = $this->mx->getParentIds($cur_id); 
                        if (substr($value,-2) == \'**\') // включая страницу раздела
                            $par_arr[] = $cur_id;
                        if (in_array((int)$value, $par_arr)) 
                            return true;
                    } else {
                        if (is_int($value)) {// если в строке шаблона указан ид, а не урл
                            if ($cur_id == (int)$value)
                                return true;
                            else if ($this->mx->getConfig(\'friendly_urls\') == 1)
                                $value = $this->mx->makeUrl((int)$value, \'\', \'\', \'full\');
                        } 
                        if (stripos( $url, $value) !== false) 
                            return true;
                    }    
				}    
			}
			return false;
		}
		
		function get_banner($row, $modUrl, $protocol="http://") {
			$lnk = \'<a target="_blank" href="\'.
				($row[\'jump_counted\'] == 1 ? $protocol.$_SERVER[\'HTTP_HOST\'].\'/click.php?id=\'.$row[\'id\'] : $row[\'link\']).\'">\';
			$row[\'content\'] = htmlspecialchars_decode($row[\'content\']);
			if (!is_file($row[\'content\'])) {	// html-код
			
                if (strpos($row[\'content\'], \'[+link_start+]\'))
					$banner = str_replace(array(\'[+link_start+]\',\'[+link_finish+]\') , array($lnk,\'</a>\'), $row[\'content\']);	
				else 
					$banner = $lnk.$row[\'content\'].\'</a>\';	
			
            } else {							// путь к файлу
				
                $ext = pathinfo($row[\'content\'], PATHINFO_EXTENSION);
				if ($ext == \'swf\') {
					
					$alt = \'<a href="http://www.adobe.com/go/getflashplayer">
							<img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" 
							alt="Get Adobe Flash player" /></a>\';
					
					//рисуем ссылку, если нужно считать переходы или если заполнено поле "линк" (т.е. не зашита в баннер)
					if ($row[\'jump_counted\'] == 1 || !empty($row[\'link\'])) { 
						$banner = \'<div id="eadvt_wrapper\'.$row[\'id\'].\'">\'.$lnk.\'</a><div id="eadvt\'.$row[\'id\'].\'">\'.$alt.\'</div></div>\';
					} else 
						$banner = \'<div id="eadvt\'.$row[\'id\'].\'">\'.$alt.\'</div>\';
					
					$fl = getimagesize($row[\'content\']);
					$this->js .= "swfobject.embedSWF(\'".$row[\'content\']."\', \'eadvt".$row[\'id\']."\', \'".$fl[0]."\', \'".$fl[1]."\', \'6.0.65\', \'".$modUrl."flash/expressInstall.swf\', {}, {wmode:\'opaque\',quality:\'high\'});\\n";
					$this->css .= "#eadvt_wrapper".$row[\'id\']." {width:".$fl[0]."px; height:".$fl[1]."px} \\n";
				} else 
					$banner = $lnk.\'<img src="\'.$row[\'content\'].\'" alt="banner \'.$row[\'id\'].\'" /></a>\';	
			
            }
            
			return $banner;	
		}	
	}
}

$regCss		= (isset($regCss) && !empty($regCss)) ? $regCss : \'\';
$regJs		= (isset($regJs) && !empty($regJs)) ? $regJs : \'\';
$noCss		= isset($noCss) ? (int)$noCss : 0;
$noJs		= isset($noJs) ? (int)$noJs : 0;

$ea = new EasyAdvertising($modx);
$mod_table = $modx->getFullTableName("site_easyadvt");
$modUrl = \'assets/modules/easyadvertising/\';
$url=$modx->getConfig(\'server_protocol\')."://".$_SERVER[\'HTTP_HOST\'].$_SERVER[\'REQUEST_URI\'];
$out = \'\';
$i = 0; //инициализация счетчика рекламных блоков

$limit = isset($limit) ? (int)$limit : 0;
$where = "published = 1 AND pub_date < ".time()." AND (unpub_date > ".time()." OR unpub_date = 0 ) ";
$where .= "AND area = \'".(isset($area) ? trim($area) : \'\')."\' ";
$where .= "AND (count_view < total_view OR total_view = 0)";
$where .= "AND (jump_count < total_jump OR total_jump = 0)";
$sort = isset($sort) ? ((strtoupper($sort) == "RND") ? "RAND()" : $sort) : "pos ASC";

$sql = "SELECT 
			id, pos, template, ex_template, content, counted, count_view, 
			total_view, jump_counted, total_jump, link 
		FROM ".$mod_table."
		WHERE ".$where."
		ORDER BY ".$sort;
$res = $modx->db->query($sql);

while (($row = $modx->db->getRow($res)) && ($i < $limit || $limit == 0)) {
	if ($ea->is_show_advrt($url, $row[\'template\'], $row[\'ex_template\'])) {
		if (($row[\'count_view\'] < $row[\'total_view\'] || $row[\'total_view\'] == 0) 
			&& ($row[\'jump_count\'] < $row[\'total_jump\'] || $row[\'total_jump\'] == 0)) { // если удовлетворяет условиям кол-ва показов и кликов
			$out .= $ea->get_banner($row, $modUrl, $modx->getConfig(\'server_protocol\').\'://\');
			$i = ($limit != 0) ? ++$i : $i;
			if ($row[\'counted\'] == 1) 
				$modx->ui[] = $row[\'id\'];
		}
	}
}

if (isset($regCss) && !empty($regCss)) {
	if (substr($regCss,0,6) == \'@FILE:\') 
		$modx->regClientCSS($regCss);
	else 
		$modx->regClientCSS(\'<style type="text/css">\'.$modx->getChunk($regCss).\'</style>\');
} else if (!empty($ea->css) && $noCss != 1) {
	$modx->regClientCSS($modUrl.\'css/eadvt.css\');
	$modx->regClientCSS(\'<style type="text/css">\'.$ea->css.\'</style>\');
}

if (isset($regJs) && !empty($regJs)) {
	if (substr($regJs,0,6) == \'@FILE:\') 
		$modx->regClientScript($regJs);
	else 
		$modx->regClientScript(\'<script type="text/javascript">\'.$modx->getChunk($regJs).\'</script>\');
} else if (!empty($ea->js) && $noJs != 1) {
	$modx->regClientScript($modUrl.\'flash/swfobject.js\');
	$script = \'<script type="text/javascript">\'.$ea->js.\'</script>\';
	$modx->regClientScript($script);
}	

return $out;';
$s['MemberCheck'] = '#::::::::::::::::::::::::::::::::::::::::
# Version: 1.0
# Created By Ryan Thrash (vertexworks.com)
# Sanitized By Jason Coward (opengeek.com)
#
# Date: November 29, 2005
#
# Changelog: 
# Nov 29, 05 -- initial release
# Jul 13, 06 -- adjusted Singleton to work under PHP4, added placeholder code (by: garryn)
#
#::::::::::::::::::::::::::::::::::::::::
# Description: 	
#	Checks to see if users belong to a certain group and 
#	displays the specified chunk if they do. Performs several
#	sanity checks and allows to be used multiple times on a page.
#
# Params:
#	&groups [array] (REQUIRED)
#		array of webuser group-names to check against
#
#	&chunk [string] (REQUIRED)
#		name of the chunk to use if passes the check
#
#	&ph [string] (optional)
#		name of the placeholder to set instead of directly retuning chunk
#
#	&debug [boolean] (optional | false) 
#		turn on debug mode for extra troubleshooting
#
# Example Usage:
#
#	[[MemberCheck? &groups=`siteadmin, registered users` &chunk=`privateSiteNav` &ph=`MemberMenu` &debug=`true`]]
#
#	This would place the \'members-only\' navigation store in the chunk \'privateSiteNav\'
#	into a placeholder (called \'MemberMenu\'). It will only do this as long as the user 
#	is logged in as a webuser and is a member of the \'siteadmin\' or the \'registered users\'
#	groups. The optional debug parameter can be used to display informative error messages 
#	when configuring this snippet for your site. For example, if the developer had 
#	mistakenly typed \'siteowners\' for the first group, and none existed with debug mode on, 
#	it would have returned the error message: The group siteowners could not be found....
#
#::::::::::::::::::::::::::::::::::::::::

# debug parameter
$debug = isset ($debug) ? $debug : false;

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}

if (!isset ($groups)) {
	return $debug ? \'<p>Error: No Group Specified</p>\' : \'\';
}

if (!isset ($chunk)) {
	return $debug ? \'<p>Error: No Chunk Specified</p>\' : \'\';
}

# turn comma-delimited list of groups into an array
$groups = explode(\',\', $groups);

if (!class_exists(\'MemberCheck\')) {
	class MemberCheck {
		var $allGroups = NULL;
		var $debug;

		function getInstance($debug) {
			static $instance;
			if (!isset ($instance)) {
				$instance = new MemberCheck($debug);
			}
			return $instance;
		}

		function MemberCheck($debug = false) {
			global $modx;

			$this->debug = $debug;
			if ($debug) {
				$this->allGroups = array ();
				$tableName = $modx->getFullTableName(\'webgroup_names\');
				$sql = "SELECT name FROM $tableName";
				if ($rs = $modx->db->query($sql)) {
					while ($row = $modx->db->getRow($rs)) {
						array_push($this->allGroups, stripslashes($row[\'name\']));
					}
				}
			}
		}

		function isValidGroup($groupName) {
			$isValid = !(array_search($groupName, $this->allGroups) === false);
			return $isValid;
		}

		function getMemberChunk(& $groups, $chunk) {
			global $modx;
			$o = \'\';
			if (is_array($groups)) {
				for ($i = 0; $i < count($groups); $i++) {
					$groups[$i] = trim($groups[$i]);
					if ($this->debug) {
						if (!$this->isValidGroup($groups[$i])) {
							return "<p>The group <strong>" . $groups[$i] . "</strong> could not be found...</p>";
						}
					}
				}

				$check = $modx->isMemberOfWebGroup($groups);

				$chunkcheck = $modx->getChunk($chunk);

				$o .= ($check && $chunkcheck) ? $chunkcheck : \'\';
				if (!$chunkcheck)
					$o .= $this->debug ? "<p>The chunk <strong>$chunk</strong> not found...</p>" : \'\';
			} else {
				$o .= "<p>No valid group names were specified!</p>";
			}

			return $o;
		}
	}
}

$memberCheck = MemberCheck :: getInstance($debug);

if (!isset ($ph)) {
	return $memberCheck->getMemberChunk($groups, $chunk);
} else {
	$modx->setPlaceholder($ph, $memberCheck->getMemberChunk($groups, $chunk));
	return \'\';
}';
$s['MemberCheck'] = '#::::::::::::::::::::::::::::::::::::::::
# Version: 1.0
# Created By Ryan Thrash (vertexworks.com)
# Sanitized By Jason Coward (opengeek.com)
#
# Date: November 29, 2005
#
# Changelog: 
# Nov 29, 05 -- initial release
# Jul 13, 06 -- adjusted Singleton to work under PHP4, added placeholder code (by: garryn)
#
#::::::::::::::::::::::::::::::::::::::::
# Description: 	
#	Checks to see if users belong to a certain group and 
#	displays the specified chunk if they do. Performs several
#	sanity checks and allows to be used multiple times on a page.
#
# Params:
#	&groups [array] (REQUIRED)
#		array of webuser group-names to check against
#
#	&chunk [string] (REQUIRED)
#		name of the chunk to use if passes the check
#
#	&ph [string] (optional)
#		name of the placeholder to set instead of directly retuning chunk
#
#	&debug [boolean] (optional | false) 
#		turn on debug mode for extra troubleshooting
#
# Example Usage:
#
#	[[MemberCheck? &groups=`siteadmin, registered users` &chunk=`privateSiteNav` &ph=`MemberMenu` &debug=`true`]]
#
#	This would place the \'members-only\' navigation store in the chunk \'privateSiteNav\'
#	into a placeholder (called \'MemberMenu\'). It will only do this as long as the user 
#	is logged in as a webuser and is a member of the \'siteadmin\' or the \'registered users\'
#	groups. The optional debug parameter can be used to display informative error messages 
#	when configuring this snippet for your site. For example, if the developer had 
#	mistakenly typed \'siteowners\' for the first group, and none existed with debug mode on, 
#	it would have returned the error message: The group siteowners could not be found....
#
#::::::::::::::::::::::::::::::::::::::::

# debug parameter
$debug = isset ($debug) ? $debug : false;

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}

if (!isset ($groups)) {
	return $debug ? \'<p>Error: No Group Specified</p>\' : \'\';
}

if (!isset ($chunk)) {
	return $debug ? \'<p>Error: No Chunk Specified</p>\' : \'\';
}

# turn comma-delimited list of groups into an array
$groups = explode(\',\', $groups);

if (!class_exists(\'MemberCheck\')) {
	class MemberCheck {
		var $allGroups = NULL;
		var $debug;

		function getInstance($debug) {
			static $instance;
			if (!isset ($instance)) {
				$instance = new MemberCheck($debug);
			}
			return $instance;
		}

		function MemberCheck($debug = false) {
			global $modx;

			$this->debug = $debug;
			if ($debug) {
				$this->allGroups = array ();
				$tableName = $modx->getFullTableName(\'webgroup_names\');
				$sql = "SELECT name FROM $tableName";
				if ($rs = $modx->db->query($sql)) {
					while ($row = $modx->db->getRow($rs)) {
						array_push($this->allGroups, stripslashes($row[\'name\']));
					}
				}
			}
		}

		function isValidGroup($groupName) {
			$isValid = !(array_search($groupName, $this->allGroups) === false);
			return $isValid;
		}

		function getMemberChunk(& $groups, $chunk) {
			global $modx;
			$o = \'\';
			if (is_array($groups)) {
				for ($i = 0; $i < count($groups); $i++) {
					$groups[$i] = trim($groups[$i]);
					if ($this->debug) {
						if (!$this->isValidGroup($groups[$i])) {
							return "<p>The group <strong>" . $groups[$i] . "</strong> could not be found...</p>";
						}
					}
				}

				$check = $modx->isMemberOfWebGroup($groups);

				$chunkcheck = $modx->getChunk($chunk);

				$o .= ($check && $chunkcheck) ? $chunkcheck : \'\';
				if (!$chunkcheck)
					$o .= $this->debug ? "<p>The chunk <strong>$chunk</strong> not found...</p>" : \'\';
			} else {
				$o .= "<p>No valid group names were specified!</p>";
			}

			return $o;
		}
	}
}

$memberCheck = MemberCheck :: getInstance($debug);

if (!isset ($ph)) {
	return $memberCheck->getMemberChunk($groups, $chunk);
} else {
	$modx->setPlaceholder($ph, $memberCheck->getMemberChunk($groups, $chunk));
	return \'\';
}';
$s['MemberCheck'] = '#::::::::::::::::::::::::::::::::::::::::
# Version: 1.0
# Created By Ryan Thrash (vertexworks.com)
# Sanitized By Jason Coward (opengeek.com)
#
# Date: November 29, 2005
#
# Changelog: 
# Nov 29, 05 -- initial release
# Jul 13, 06 -- adjusted Singleton to work under PHP4, added placeholder code (by: garryn)
#
#::::::::::::::::::::::::::::::::::::::::
# Description: 	
#	Checks to see if users belong to a certain group and 
#	displays the specified chunk if they do. Performs several
#	sanity checks and allows to be used multiple times on a page.
#
# Params:
#	&groups [array] (REQUIRED)
#		array of webuser group-names to check against
#
#	&chunk [string] (REQUIRED)
#		name of the chunk to use if passes the check
#
#	&ph [string] (optional)
#		name of the placeholder to set instead of directly retuning chunk
#
#	&debug [boolean] (optional | false) 
#		turn on debug mode for extra troubleshooting
#
# Example Usage:
#
#	[[MemberCheck? &groups=`siteadmin, registered users` &chunk=`privateSiteNav` &ph=`MemberMenu` &debug=`true`]]
#
#	This would place the \'members-only\' navigation store in the chunk \'privateSiteNav\'
#	into a placeholder (called \'MemberMenu\'). It will only do this as long as the user 
#	is logged in as a webuser and is a member of the \'siteadmin\' or the \'registered users\'
#	groups. The optional debug parameter can be used to display informative error messages 
#	when configuring this snippet for your site. For example, if the developer had 
#	mistakenly typed \'siteowners\' for the first group, and none existed with debug mode on, 
#	it would have returned the error message: The group siteowners could not be found....
#
#::::::::::::::::::::::::::::::::::::::::

# debug parameter
$debug = isset ($debug) ? $debug : false;

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}

if (!isset ($groups)) {
	return $debug ? \'<p>Error: No Group Specified</p>\' : \'\';
}

if (!isset ($chunk)) {
	return $debug ? \'<p>Error: No Chunk Specified</p>\' : \'\';
}

# turn comma-delimited list of groups into an array
$groups = explode(\',\', $groups);

if (!class_exists(\'MemberCheck\')) {
	class MemberCheck {
		var $allGroups = NULL;
		var $debug;

		function getInstance($debug) {
			static $instance;
			if (!isset ($instance)) {
				$instance = new MemberCheck($debug);
			}
			return $instance;
		}

		function MemberCheck($debug = false) {
			global $modx;

			$this->debug = $debug;
			if ($debug) {
				$this->allGroups = array ();
				$tableName = $modx->getFullTableName(\'webgroup_names\');
				$sql = "SELECT name FROM $tableName";
				if ($rs = $modx->db->query($sql)) {
					while ($row = $modx->db->getRow($rs)) {
						array_push($this->allGroups, stripslashes($row[\'name\']));
					}
				}
			}
		}

		function isValidGroup($groupName) {
			$isValid = !(array_search($groupName, $this->allGroups) === false);
			return $isValid;
		}

		function getMemberChunk(& $groups, $chunk) {
			global $modx;
			$o = \'\';
			if (is_array($groups)) {
				for ($i = 0; $i < count($groups); $i++) {
					$groups[$i] = trim($groups[$i]);
					if ($this->debug) {
						if (!$this->isValidGroup($groups[$i])) {
							return "<p>The group <strong>" . $groups[$i] . "</strong> could not be found...</p>";
						}
					}
				}

				$check = $modx->isMemberOfWebGroup($groups);

				$chunkcheck = $modx->getChunk($chunk);

				$o .= ($check && $chunkcheck) ? $chunkcheck : \'\';
				if (!$chunkcheck)
					$o .= $this->debug ? "<p>The chunk <strong>$chunk</strong> not found...</p>" : \'\';
			} else {
				$o .= "<p>No valid group names were specified!</p>";
			}

			return $o;
		}
	}
}

$memberCheck = MemberCheck :: getInstance($debug);

if (!isset ($ph)) {
	return $memberCheck->getMemberChunk($groups, $chunk);
} else {
	$modx->setPlaceholder($ph, $memberCheck->getMemberChunk($groups, $chunk));
	return \'\';
}';
$s['MemberCheckProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['MemberCheck'] = '#::::::::::::::::::::::::::::::::::::::::
# Version: 1.0
# Created By Ryan Thrash (vertexworks.com)
# Sanitized By Jason Coward (opengeek.com)
#
# Date: November 29, 2005
#
# Changelog: 
# Nov 29, 05 -- initial release
# Jul 13, 06 -- adjusted Singleton to work under PHP4, added placeholder code (by: garryn)
#
#::::::::::::::::::::::::::::::::::::::::
# Description: 	
#	Checks to see if users belong to a certain group and 
#	displays the specified chunk if they do. Performs several
#	sanity checks and allows to be used multiple times on a page.
#
# Params:
#	&groups [array] (REQUIRED)
#		array of webuser group-names to check against
#
#	&chunk [string] (REQUIRED)
#		name of the chunk to use if passes the check
#
#	&ph [string] (optional)
#		name of the placeholder to set instead of directly retuning chunk
#
#	&debug [boolean] (optional | false) 
#		turn on debug mode for extra troubleshooting
#
# Example Usage:
#
#	[[MemberCheck? &groups=`siteadmin, registered users` &chunk=`privateSiteNav` &ph=`MemberMenu` &debug=`true`]]
#
#	This would place the \'members-only\' navigation store in the chunk \'privateSiteNav\'
#	into a placeholder (called \'MemberMenu\'). It will only do this as long as the user 
#	is logged in as a webuser and is a member of the \'siteadmin\' or the \'registered users\'
#	groups. The optional debug parameter can be used to display informative error messages 
#	when configuring this snippet for your site. For example, if the developer had 
#	mistakenly typed \'siteowners\' for the first group, and none existed with debug mode on, 
#	it would have returned the error message: The group siteowners could not be found....
#
#::::::::::::::::::::::::::::::::::::::::

# debug parameter
$debug = isset ($debug) ? $debug : false;

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}

if (!isset ($groups)) {
	return $debug ? \'<p>Error: No Group Specified</p>\' : \'\';
}

if (!isset ($chunk)) {
	return $debug ? \'<p>Error: No Chunk Specified</p>\' : \'\';
}

# turn comma-delimited list of groups into an array
$groups = explode(\',\', $groups);

if (!class_exists(\'MemberCheck\')) {
	class MemberCheck {
		var $allGroups = NULL;
		var $debug;

		function getInstance($debug) {
			static $instance;
			if (!isset ($instance)) {
				$instance = new MemberCheck($debug);
			}
			return $instance;
		}

		function MemberCheck($debug = false) {
			global $modx;

			$this->debug = $debug;
			if ($debug) {
				$this->allGroups = array ();
				$tableName = $modx->getFullTableName(\'webgroup_names\');
				$sql = "SELECT name FROM $tableName";
				if ($rs = $modx->db->query($sql)) {
					while ($row = $modx->db->getRow($rs)) {
						array_push($this->allGroups, stripslashes($row[\'name\']));
					}
				}
			}
		}

		function isValidGroup($groupName) {
			$isValid = !(array_search($groupName, $this->allGroups) === false);
			return $isValid;
		}

		function getMemberChunk(& $groups, $chunk) {
			global $modx;
			$o = \'\';
			if (is_array($groups)) {
				for ($i = 0; $i < count($groups); $i++) {
					$groups[$i] = trim($groups[$i]);
					if ($this->debug) {
						if (!$this->isValidGroup($groups[$i])) {
							return "<p>The group <strong>" . $groups[$i] . "</strong> could not be found...</p>";
						}
					}
				}

				$check = $modx->isMemberOfWebGroup($groups);

				$chunkcheck = $modx->getChunk($chunk);

				$o .= ($check && $chunkcheck) ? $chunkcheck : \'\';
				if (!$chunkcheck)
					$o .= $this->debug ? "<p>The chunk <strong>$chunk</strong> not found...</p>" : \'\';
			} else {
				$o .= "<p>No valid group names were specified!</p>";
			}

			return $o;
		}
	}
}

$memberCheck = MemberCheck :: getInstance($debug);

if (!isset ($ph)) {
	return $memberCheck->getMemberChunk($groups, $chunk);
} else {
	$modx->setPlaceholder($ph, $memberCheck->getMemberChunk($groups, $chunk));
	return \'\';
}';
$s['sitemap'] = '/*
==================================================
	sitemap
==================================================

Outputs a machine readable site map for search
engines and robots. Supports the following
formats:

- Sitemap Protocol used by Google Sitemaps
  (http://www.google.com/webmasters/sitemaps/)

- URL list in text format
  (e.g. Yahoo! submission)

Author: Grzegorz Adamiak [grad]
Version: 1.0.8 @ 22-AUG-2008
License: LGPL
MODx: 0.9.2.1, 0.9.6.1

History:
# 1.0.8
- excludeTemplates can now also be specified as a template ID instead of template name. 
  Useful if you change the names of your templates frequently. (ncrossland)
  e.g. &excludeTemplates=`myTemplateName,3,4`
# 1.0.7
- Unpublished and deleted documents were showing up in the sitemap. Even though they could not be viewed, 
  they were showing up as broken links to search engines. (ncrossland)
# 1.0.6
- Add optional parameter (excludeWeblinks) to exclude weblinks from the sitemap, since they often point to external
  sites (which don\'t belong on your sitemap), or redirecting to other internal pages (which are already
  in the sitemap). Google Webmaster Tools generates warnings for excessive redirects.	
  Default is false - e.g. default behaviour remains unchanged. (ncrossland)
# 1.0.5
- Modification about non searchable documents, as suggested by forum user JayBee
  (http://modxcms.com/forums/index.php/topic,5754.msg99895.html#msg99895)
# 1.0.4 (By Bert Catsburg, bert@catsburg.com)
- Added display option \'ulli\'. 
  An <ul><li> list of all published documents.
# 1.0.3
- Added ability to specify the XSL URL - you don\'t always need one and it 
  seems to create a lot of support confusion!
  It is now a parameter (&xsl=``) which can take either an alias or a doc ID (ncrossland)
- Modifications suggested by forum users Grad and Picachu incorporated
  (http://modxcms.com/forums/index.php/topic,5754.60.html)
# 1.0.2
- Reworked fetching of template variable value to
  get INHERITED value.
# 1.0.1
- Reworked fetching of template variable value,
  now it gets computed value instead of nominal;
  however, still not the inherited value.
# 1.0
- First public release.

TODO:
- provide output for ROR
--------------------------------------------------
*/

/* Parameters
----------------------------------------------- */

# $startid [ int ]
# Id of the \'root\' document from which the sitemap
# starts.
# Default: 0

$startid = (isset($startid)) ? $startid : 0;

# $format [ sp | txt | ror ]
# Which format of sitemap to use:
# - sp <- Sitemap Protocol used by Google
# - txt <- text file with list of URLs
# TODO - ror <- Resource Of Resources
# Default: sp

$format = (isset($format) && ($format != \'ror\')) ? $format : \'sp\';

# $priority [ str ]
# Name of TV which sets the relative priority of
# the document. If there is no such TV, this
# parameter will not be used.
# Default: sitemap_priority

$priority = (isset($priority)) ? $priority : \'sitemap_priority\';

# $changefreq [ str ]
# Name of TV which sets the change frequency. If
# there is no such TV this parameter will not be
# used.
# Default: sitemap_changefreq

$changefreq = (isset($changefreq)) ? $changefreq : \'sitemap_changefreq\';

# $excludeTemplates [ str ]
# Documents based on which templates should not be
# included in the sitemap. Comma separated list
# with names of templates.
# Default: empty

$excludeTemplates = (isset($excludeTemplates)) ? $excludeTemplates : array();

# $excludeTV [ str ]
# Name of TV (boolean type) which sets document
# exclusion form sitemap. If there is no such TV
# this parameter will not be used.
# Default: \'sitemap_exclude\'

$excludeTV = (isset($excludeTV)) ? $excludeTV : \'sitemap_exclude\';

# $xsl [ str ] 
# URL to the XSL style sheet
# or
# $xsl [ int ]
# doc ID of the XSL style sheet

$xsl = (isset($xsl)) ? $xsl : \'\';
if (is_numeric($xsl)) { $xsl = $modx->makeUrl($xsl); }


# $excludeWeblinks [ bool ]
# Should weblinks be excluded?
# You may not want to include links to external sites in your sitemap,
# and Google gives warnings about multiple redirects to pages 
# within your site.
# Default: false
$excludeWeblinks = (isset($excludeWeblinks)) ? $excludeWeblinks : false;


/* End parameters
----------------------------------------------- */

# get list of documents
# ---------------------------------------------
$docs = getDocs($modx,$startid,$priority,$changefreq,$excludeTV);


# filter out documents by template or TV
# ---------------------------------------------
// get all templates
$select = $modx->db->select("id, templatename", $modx->getFullTableName(\'site_templates\'));
while ($query = $modx->db->getRow($select)) {
	$allTemplates[$query[\'id\']] = $query[\'templatename\'];
}

$remainingTemplates = $allTemplates;

// get templates to exclude, and remove them from the all templates list
if (!empty ($excludeTemplates)) {
	
	$excludeTemplates = explode(",", $excludeTemplates);	
	
	// Loop through each template we want to exclude
	foreach ($excludeTemplates as $template) {
		$template = trim($template);
		
		// If it\'s numeric, assume it\'s an ID, and remove directly from the $allTemplates array
		if (is_numeric($template) && isset($remainingTemplates[$template])) {
			unset($remainingTemplates[$template]);
		} else if (trim($template) && in_array($template, $remainingTemplates)) { // If it\'s text, and not empty, assume it\'s a template name
			unset($remainingTemplates[array_search($template, $remainingTemplates)]);			
		}
	} // end foreach
}

$output= array();
// filter out documents which shouldn\'t be included
foreach ($docs as $doc)
{
	if (isset($remainingTemplates[$doc[\'template\']]) && !$doc[$excludeTV] && $doc[\'published\'] && $doc[\'template\']!=0 && $doc[\'searchable\']) {
		if (!$excludeWeblinks || ($excludeWeblinks && $doc[\'type\'] != \'reference\')) {
			$output[] = $doc;		
		}
	}
}
$docs = $output;
unset ($output, $allTemplates, $excludeTemplates);


# build sitemap in specified format
# ---------------------------------------------

switch ($format)
{
	// Next case added in version 1.0.4
	case \'ulli\': // UL List
		$output .= "<ul class=\\"sitemap\\">\\n";
		// TODO: Sort the array on Menu Index
		// TODO: Make a nested ul-li based on the levels in the document tree.
		foreach ($docs as $doc)
		{
			$s  = "  <li class=\\"sitemap\\">";
			$s .= "<a href=\\"[(site_url)][~" . $doc[\'id\'] . "~]\\" class=\\"sitemap\\">" . $doc[\'pagetitle\'] . "</a>";
			$s .= "</li>\\n";
			$output .= $s;
		} // end foreach
		$output .= "</ul>\\n";
		break;
		
	case \'txt\': // plain text list of URLs

		foreach ($docs as $doc)
		{
			$url = \'[(site_url)][~\'.$doc[\'id\'].\'~]\';

			$output .= $url."\\n";
		} // end foreach
		break;

	case \'ror\': // TODO
	default: // Sitemap Protocol

	
	$output = \'<?xml version="1.0" encoding="UTF-8"?>\'."\\n";
	if ($xsl != \'\') {
		$output .=\'<?xml-stylesheet type="text/xsl" href="\'.$xsl.\'"?>\'."\\n";
	}
	$output .=\'<urlset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd" xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\'."\\n";
	
	
	foreach ($docs as $doc)	{
		$url = \'[(site_url)][~\'.$doc[\'id\'].\'~]\';
		$date = $doc[\'editedon\'];
		$date = date("Y-m-d", $date);
		$docPriority = ($doc[$priority]) ? $doc[$priority] : 0; // false if TV doesn\'t exist
		$docChangefreq = ($doc[$changefreq]) ? $doc[$changefreq] : 0; // false if TV doesn\'t exist

		$output .= "\\t".\'<url>\'."\\n";
		$output .= "\\t\\t".\'<loc>\'.$url.\'</loc>\'."\\n";
		$output .= "\\t\\t".\'<lastmod>\'.$date.\'</lastmod>\'."\\n";
		$output .= ($docPriority) ? ("\\t\\t".\'<priority>\'.$docPriority.\'</priority>\'."\\n") : \'\'; // don\'t output anything if TV doesn\'t exist
		$output .= ($docChangefreq) ? ("\\t\\t".\'<changefreq>\'.$docChangefreq.\'</changefreq>\'."\\n") : \'\'; // don\'t output anything if TV doesn\'t exist
		$output .= "\\t".\'</url>\'."\\n";
	} // end foreach
	$output .= \'</urlset>\';

} // end switch

return $output;

# functions
# ---------------------------------------------

# gets (inherited) value of template variable
function getTV($modx,$docid,$doctv)
{
/* apparently in 0.9.2.1 the getTemplateVarOutput function doesn\'t work as expected and doesn\'t return INHERITED value; this is probably to be fixed for next release; see http://modxcms.com/bugs/task/464
	$output = $modx->getTemplateVarOutput($tv,$docid);
	return $output[$tv];
*/
	
	while ($pid = $modx->getDocument($docid,\'parent\'))
	{
		$tv = $modx->getTemplateVar($doctv,\'*\',$docid);
		if (($tv[\'value\'] && substr($tv[\'value\'],0,8) != \'@INHERIT\') or !$tv[\'value\']) // tv default value is overriden (including empty)
		{
			$output = $tv[\'value\'];
			break;
		}
		else // there is no parent with default value overriden 
		{
			$output = trim(substr($tv[\'value\'],8));
		}
		$docid = $pid[\'parent\']; // move up one document in document tree
	} // end while
	
	return $output;
}

# gets list of published documents with properties
function getDocs($modx,$startid,$priority,$changefreq,$excludeTV)
{
	// get children documents
	$docs = $modx->getActiveChildren($startid,\'menuindex\',\'asc\',\'id,editedon,template,published,searchable,pagetitle,type\'); 
	// add sub-children to the list
	foreach ($docs as $key => $doc)
	{
		$id = $doc[\'id\'];
		$docs[$key][$priority] = getTV($modx,$id,$priority); // add priority property
		$docs[$key][$changefreq] = getTV($modx,$id,$changefreq); // add changefreq property
		$docs[$key][$excludeTV] = getTV($modx,$id,$excludeTV); // add excludeTV property
		
		if ($modx->getActiveChildren($id))
			$docs = array_merge($docs, getDocs($modx,$id,$priority,$changefreq,$excludeTV));
	} // end foreach
	return $docs;
}';
$s['sitemap'] = '/*
==================================================
	sitemap
==================================================

Outputs a machine readable site map for search
engines and robots. Supports the following
formats:

- Sitemap Protocol used by Google Sitemaps
  (http://www.google.com/webmasters/sitemaps/)

- URL list in text format
  (e.g. Yahoo! submission)

Author: Grzegorz Adamiak [grad]
Version: 1.0.8 @ 22-AUG-2008
License: LGPL
MODx: 0.9.2.1, 0.9.6.1

History:
# 1.0.8
- excludeTemplates can now also be specified as a template ID instead of template name. 
  Useful if you change the names of your templates frequently. (ncrossland)
  e.g. &excludeTemplates=`myTemplateName,3,4`
# 1.0.7
- Unpublished and deleted documents were showing up in the sitemap. Even though they could not be viewed, 
  they were showing up as broken links to search engines. (ncrossland)
# 1.0.6
- Add optional parameter (excludeWeblinks) to exclude weblinks from the sitemap, since they often point to external
  sites (which don\'t belong on your sitemap), or redirecting to other internal pages (which are already
  in the sitemap). Google Webmaster Tools generates warnings for excessive redirects.	
  Default is false - e.g. default behaviour remains unchanged. (ncrossland)
# 1.0.5
- Modification about non searchable documents, as suggested by forum user JayBee
  (http://modxcms.com/forums/index.php/topic,5754.msg99895.html#msg99895)
# 1.0.4 (By Bert Catsburg, bert@catsburg.com)
- Added display option \'ulli\'. 
  An <ul><li> list of all published documents.
# 1.0.3
- Added ability to specify the XSL URL - you don\'t always need one and it 
  seems to create a lot of support confusion!
  It is now a parameter (&xsl=``) which can take either an alias or a doc ID (ncrossland)
- Modifications suggested by forum users Grad and Picachu incorporated
  (http://modxcms.com/forums/index.php/topic,5754.60.html)
# 1.0.2
- Reworked fetching of template variable value to
  get INHERITED value.
# 1.0.1
- Reworked fetching of template variable value,
  now it gets computed value instead of nominal;
  however, still not the inherited value.
# 1.0
- First public release.

TODO:
- provide output for ROR
--------------------------------------------------
*/

/* Parameters
----------------------------------------------- */

# $startid [ int ]
# Id of the \'root\' document from which the sitemap
# starts.
# Default: 0

$startid = (isset($startid)) ? $startid : 0;

# $format [ sp | txt | ror ]
# Which format of sitemap to use:
# - sp <- Sitemap Protocol used by Google
# - txt <- text file with list of URLs
# TODO - ror <- Resource Of Resources
# Default: sp

$format = (isset($format) && ($format != \'ror\')) ? $format : \'sp\';

# $priority [ str ]
# Name of TV which sets the relative priority of
# the document. If there is no such TV, this
# parameter will not be used.
# Default: sitemap_priority

$priority = (isset($priority)) ? $priority : \'sitemap_priority\';

# $changefreq [ str ]
# Name of TV which sets the change frequency. If
# there is no such TV this parameter will not be
# used.
# Default: sitemap_changefreq

$changefreq = (isset($changefreq)) ? $changefreq : \'sitemap_changefreq\';

# $excludeTemplates [ str ]
# Documents based on which templates should not be
# included in the sitemap. Comma separated list
# with names of templates.
# Default: empty

$excludeTemplates = (isset($excludeTemplates)) ? $excludeTemplates : array();

# $excludeTV [ str ]
# Name of TV (boolean type) which sets document
# exclusion form sitemap. If there is no such TV
# this parameter will not be used.
# Default: \'sitemap_exclude\'

$excludeTV = (isset($excludeTV)) ? $excludeTV : \'sitemap_exclude\';

# $xsl [ str ] 
# URL to the XSL style sheet
# or
# $xsl [ int ]
# doc ID of the XSL style sheet

$xsl = (isset($xsl)) ? $xsl : \'\';
if (is_numeric($xsl)) { $xsl = $modx->makeUrl($xsl); }


# $excludeWeblinks [ bool ]
# Should weblinks be excluded?
# You may not want to include links to external sites in your sitemap,
# and Google gives warnings about multiple redirects to pages 
# within your site.
# Default: false
$excludeWeblinks = (isset($excludeWeblinks)) ? $excludeWeblinks : false;


/* End parameters
----------------------------------------------- */

# get list of documents
# ---------------------------------------------
$docs = getDocs($modx,$startid,$priority,$changefreq,$excludeTV);


# filter out documents by template or TV
# ---------------------------------------------
// get all templates
$select = $modx->db->select("id, templatename", $modx->getFullTableName(\'site_templates\'));
while ($query = $modx->db->getRow($select)) {
	$allTemplates[$query[\'id\']] = $query[\'templatename\'];
}

$remainingTemplates = $allTemplates;

// get templates to exclude, and remove them from the all templates list
if (!empty ($excludeTemplates)) {
	
	$excludeTemplates = explode(",", $excludeTemplates);	
	
	// Loop through each template we want to exclude
	foreach ($excludeTemplates as $template) {
		$template = trim($template);
		
		// If it\'s numeric, assume it\'s an ID, and remove directly from the $allTemplates array
		if (is_numeric($template) && isset($remainingTemplates[$template])) {
			unset($remainingTemplates[$template]);
		} else if (trim($template) && in_array($template, $remainingTemplates)) { // If it\'s text, and not empty, assume it\'s a template name
			unset($remainingTemplates[array_search($template, $remainingTemplates)]);			
		}
	} // end foreach
}

$output= array();
// filter out documents which shouldn\'t be included
foreach ($docs as $doc)
{
	if (isset($remainingTemplates[$doc[\'template\']]) && !$doc[$excludeTV] && $doc[\'published\'] && $doc[\'template\']!=0 && $doc[\'searchable\']) {
		if (!$excludeWeblinks || ($excludeWeblinks && $doc[\'type\'] != \'reference\')) {
			$output[] = $doc;		
		}
	}
}
$docs = $output;
unset ($output, $allTemplates, $excludeTemplates);


# build sitemap in specified format
# ---------------------------------------------

switch ($format)
{
	// Next case added in version 1.0.4
	case \'ulli\': // UL List
		$output .= "<ul class=\\"sitemap\\">\\n";
		// TODO: Sort the array on Menu Index
		// TODO: Make a nested ul-li based on the levels in the document tree.
		foreach ($docs as $doc)
		{
			$s  = "  <li class=\\"sitemap\\">";
			$s .= "<a href=\\"[(site_url)][~" . $doc[\'id\'] . "~]\\" class=\\"sitemap\\">" . $doc[\'pagetitle\'] . "</a>";
			$s .= "</li>\\n";
			$output .= $s;
		} // end foreach
		$output .= "</ul>\\n";
		break;
		
	case \'txt\': // plain text list of URLs

		foreach ($docs as $doc)
		{
			$url = \'[(site_url)][~\'.$doc[\'id\'].\'~]\';

			$output .= $url."\\n";
		} // end foreach
		break;

	case \'ror\': // TODO
	default: // Sitemap Protocol

	
	$output = \'<?xml version="1.0" encoding="UTF-8"?>\'."\\n";
	if ($xsl != \'\') {
		$output .=\'<?xml-stylesheet type="text/xsl" href="\'.$xsl.\'"?>\'."\\n";
	}
	$output .=\'<urlset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd" xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\'."\\n";
	
	
	foreach ($docs as $doc)	{
		$url = \'[(site_url)][~\'.$doc[\'id\'].\'~]\';
		$date = $doc[\'editedon\'];
		$date = date("Y-m-d", $date);
		$docPriority = ($doc[$priority]) ? $doc[$priority] : 0; // false if TV doesn\'t exist
		$docChangefreq = ($doc[$changefreq]) ? $doc[$changefreq] : 0; // false if TV doesn\'t exist

		$output .= "\\t".\'<url>\'."\\n";
		$output .= "\\t\\t".\'<loc>\'.$url.\'</loc>\'."\\n";
		$output .= "\\t\\t".\'<lastmod>\'.$date.\'</lastmod>\'."\\n";
		$output .= ($docPriority) ? ("\\t\\t".\'<priority>\'.$docPriority.\'</priority>\'."\\n") : \'\'; // don\'t output anything if TV doesn\'t exist
		$output .= ($docChangefreq) ? ("\\t\\t".\'<changefreq>\'.$docChangefreq.\'</changefreq>\'."\\n") : \'\'; // don\'t output anything if TV doesn\'t exist
		$output .= "\\t".\'</url>\'."\\n";
	} // end foreach
	$output .= \'</urlset>\';

} // end switch

return $output;

# functions
# ---------------------------------------------

# gets (inherited) value of template variable
function getTV($modx,$docid,$doctv)
{
/* apparently in 0.9.2.1 the getTemplateVarOutput function doesn\'t work as expected and doesn\'t return INHERITED value; this is probably to be fixed for next release; see http://modxcms.com/bugs/task/464
	$output = $modx->getTemplateVarOutput($tv,$docid);
	return $output[$tv];
*/
	
	while ($pid = $modx->getDocument($docid,\'parent\'))
	{
		$tv = $modx->getTemplateVar($doctv,\'*\',$docid);
		if (($tv[\'value\'] && substr($tv[\'value\'],0,8) != \'@INHERIT\') or !$tv[\'value\']) // tv default value is overriden (including empty)
		{
			$output = $tv[\'value\'];
			break;
		}
		else // there is no parent with default value overriden 
		{
			$output = trim(substr($tv[\'value\'],8));
		}
		$docid = $pid[\'parent\']; // move up one document in document tree
	} // end while
	
	return $output;
}

# gets list of published documents with properties
function getDocs($modx,$startid,$priority,$changefreq,$excludeTV)
{
	// get children documents
	$docs = $modx->getActiveChildren($startid,\'menuindex\',\'asc\',\'id,editedon,template,published,searchable,pagetitle,type\'); 
	// add sub-children to the list
	foreach ($docs as $key => $doc)
	{
		$id = $doc[\'id\'];
		$docs[$key][$priority] = getTV($modx,$id,$priority); // add priority property
		$docs[$key][$changefreq] = getTV($modx,$id,$changefreq); // add changefreq property
		$docs[$key][$excludeTV] = getTV($modx,$id,$excludeTV); // add excludeTV property
		
		if ($modx->getActiveChildren($id))
			$docs = array_merge($docs, getDocs($modx,$id,$priority,$changefreq,$excludeTV));
	} // end foreach
	return $docs;
}';
$s['sitemap'] = '/*
==================================================
	sitemap
==================================================

Outputs a machine readable site map for search
engines and robots. Supports the following
formats:

- Sitemap Protocol used by Google Sitemaps
  (http://www.google.com/webmasters/sitemaps/)

- URL list in text format
  (e.g. Yahoo! submission)

Author: Grzegorz Adamiak [grad]
Version: 1.0.8 @ 22-AUG-2008
License: LGPL
MODx: 0.9.2.1, 0.9.6.1

History:
# 1.0.8
- excludeTemplates can now also be specified as a template ID instead of template name. 
  Useful if you change the names of your templates frequently. (ncrossland)
  e.g. &excludeTemplates=`myTemplateName,3,4`
# 1.0.7
- Unpublished and deleted documents were showing up in the sitemap. Even though they could not be viewed, 
  they were showing up as broken links to search engines. (ncrossland)
# 1.0.6
- Add optional parameter (excludeWeblinks) to exclude weblinks from the sitemap, since they often point to external
  sites (which don\'t belong on your sitemap), or redirecting to other internal pages (which are already
  in the sitemap). Google Webmaster Tools generates warnings for excessive redirects.	
  Default is false - e.g. default behaviour remains unchanged. (ncrossland)
# 1.0.5
- Modification about non searchable documents, as suggested by forum user JayBee
  (http://modxcms.com/forums/index.php/topic,5754.msg99895.html#msg99895)
# 1.0.4 (By Bert Catsburg, bert@catsburg.com)
- Added display option \'ulli\'. 
  An <ul><li> list of all published documents.
# 1.0.3
- Added ability to specify the XSL URL - you don\'t always need one and it 
  seems to create a lot of support confusion!
  It is now a parameter (&xsl=``) which can take either an alias or a doc ID (ncrossland)
- Modifications suggested by forum users Grad and Picachu incorporated
  (http://modxcms.com/forums/index.php/topic,5754.60.html)
# 1.0.2
- Reworked fetching of template variable value to
  get INHERITED value.
# 1.0.1
- Reworked fetching of template variable value,
  now it gets computed value instead of nominal;
  however, still not the inherited value.
# 1.0
- First public release.

TODO:
- provide output for ROR
--------------------------------------------------
*/

/* Parameters
----------------------------------------------- */

# $startid [ int ]
# Id of the \'root\' document from which the sitemap
# starts.
# Default: 0

$startid = (isset($startid)) ? $startid : 0;

# $format [ sp | txt | ror ]
# Which format of sitemap to use:
# - sp <- Sitemap Protocol used by Google
# - txt <- text file with list of URLs
# TODO - ror <- Resource Of Resources
# Default: sp

$format = (isset($format) && ($format != \'ror\')) ? $format : \'sp\';

# $priority [ str ]
# Name of TV which sets the relative priority of
# the document. If there is no such TV, this
# parameter will not be used.
# Default: sitemap_priority

$priority = (isset($priority)) ? $priority : \'sitemap_priority\';

# $changefreq [ str ]
# Name of TV which sets the change frequency. If
# there is no such TV this parameter will not be
# used.
# Default: sitemap_changefreq

$changefreq = (isset($changefreq)) ? $changefreq : \'sitemap_changefreq\';

# $excludeTemplates [ str ]
# Documents based on which templates should not be
# included in the sitemap. Comma separated list
# with names of templates.
# Default: empty

$excludeTemplates = (isset($excludeTemplates)) ? $excludeTemplates : array();

# $excludeTV [ str ]
# Name of TV (boolean type) which sets document
# exclusion form sitemap. If there is no such TV
# this parameter will not be used.
# Default: \'sitemap_exclude\'

$excludeTV = (isset($excludeTV)) ? $excludeTV : \'sitemap_exclude\';

# $xsl [ str ] 
# URL to the XSL style sheet
# or
# $xsl [ int ]
# doc ID of the XSL style sheet

$xsl = (isset($xsl)) ? $xsl : \'\';
if (is_numeric($xsl)) { $xsl = $modx->makeUrl($xsl); }


# $excludeWeblinks [ bool ]
# Should weblinks be excluded?
# You may not want to include links to external sites in your sitemap,
# and Google gives warnings about multiple redirects to pages 
# within your site.
# Default: false
$excludeWeblinks = (isset($excludeWeblinks)) ? $excludeWeblinks : false;


/* End parameters
----------------------------------------------- */

# get list of documents
# ---------------------------------------------
$docs = getDocs($modx,$startid,$priority,$changefreq,$excludeTV);


# filter out documents by template or TV
# ---------------------------------------------
// get all templates
$select = $modx->db->select("id, templatename", $modx->getFullTableName(\'site_templates\'));
while ($query = $modx->db->getRow($select)) {
	$allTemplates[$query[\'id\']] = $query[\'templatename\'];
}

$remainingTemplates = $allTemplates;

// get templates to exclude, and remove them from the all templates list
if (!empty ($excludeTemplates)) {
	
	$excludeTemplates = explode(",", $excludeTemplates);	
	
	// Loop through each template we want to exclude
	foreach ($excludeTemplates as $template) {
		$template = trim($template);
		
		// If it\'s numeric, assume it\'s an ID, and remove directly from the $allTemplates array
		if (is_numeric($template) && isset($remainingTemplates[$template])) {
			unset($remainingTemplates[$template]);
		} else if (trim($template) && in_array($template, $remainingTemplates)) { // If it\'s text, and not empty, assume it\'s a template name
			unset($remainingTemplates[array_search($template, $remainingTemplates)]);			
		}
	} // end foreach
}

$output= array();
// filter out documents which shouldn\'t be included
foreach ($docs as $doc)
{
	if (isset($remainingTemplates[$doc[\'template\']]) && !$doc[$excludeTV] && $doc[\'published\'] && $doc[\'template\']!=0 && $doc[\'searchable\']) {
		if (!$excludeWeblinks || ($excludeWeblinks && $doc[\'type\'] != \'reference\')) {
			$output[] = $doc;		
		}
	}
}
$docs = $output;
unset ($output, $allTemplates, $excludeTemplates);


# build sitemap in specified format
# ---------------------------------------------

switch ($format)
{
	// Next case added in version 1.0.4
	case \'ulli\': // UL List
		$output .= "<ul class=\\"sitemap\\">\\n";
		// TODO: Sort the array on Menu Index
		// TODO: Make a nested ul-li based on the levels in the document tree.
		foreach ($docs as $doc)
		{
			$s  = "  <li class=\\"sitemap\\">";
			$s .= "<a href=\\"[(site_url)][~" . $doc[\'id\'] . "~]\\" class=\\"sitemap\\">" . $doc[\'pagetitle\'] . "</a>";
			$s .= "</li>\\n";
			$output .= $s;
		} // end foreach
		$output .= "</ul>\\n";
		break;
		
	case \'txt\': // plain text list of URLs

		foreach ($docs as $doc)
		{
			$url = \'[(site_url)][~\'.$doc[\'id\'].\'~]\';

			$output .= $url."\\n";
		} // end foreach
		break;

	case \'ror\': // TODO
	default: // Sitemap Protocol

	
	$output = \'<?xml version="1.0" encoding="UTF-8"?>\'."\\n";
	if ($xsl != \'\') {
		$output .=\'<?xml-stylesheet type="text/xsl" href="\'.$xsl.\'"?>\'."\\n";
	}
	$output .=\'<urlset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd" xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\'."\\n";
	
	
	foreach ($docs as $doc)	{
		$url = \'[(site_url)][~\'.$doc[\'id\'].\'~]\';
		$date = $doc[\'editedon\'];
		$date = date("Y-m-d", $date);
		$docPriority = ($doc[$priority]) ? $doc[$priority] : 0; // false if TV doesn\'t exist
		$docChangefreq = ($doc[$changefreq]) ? $doc[$changefreq] : 0; // false if TV doesn\'t exist

		$output .= "\\t".\'<url>\'."\\n";
		$output .= "\\t\\t".\'<loc>\'.$url.\'</loc>\'."\\n";
		$output .= "\\t\\t".\'<lastmod>\'.$date.\'</lastmod>\'."\\n";
		$output .= ($docPriority) ? ("\\t\\t".\'<priority>\'.$docPriority.\'</priority>\'."\\n") : \'\'; // don\'t output anything if TV doesn\'t exist
		$output .= ($docChangefreq) ? ("\\t\\t".\'<changefreq>\'.$docChangefreq.\'</changefreq>\'."\\n") : \'\'; // don\'t output anything if TV doesn\'t exist
		$output .= "\\t".\'</url>\'."\\n";
	} // end foreach
	$output .= \'</urlset>\';

} // end switch

return $output;

# functions
# ---------------------------------------------

# gets (inherited) value of template variable
function getTV($modx,$docid,$doctv)
{
/* apparently in 0.9.2.1 the getTemplateVarOutput function doesn\'t work as expected and doesn\'t return INHERITED value; this is probably to be fixed for next release; see http://modxcms.com/bugs/task/464
	$output = $modx->getTemplateVarOutput($tv,$docid);
	return $output[$tv];
*/
	
	while ($pid = $modx->getDocument($docid,\'parent\'))
	{
		$tv = $modx->getTemplateVar($doctv,\'*\',$docid);
		if (($tv[\'value\'] && substr($tv[\'value\'],0,8) != \'@INHERIT\') or !$tv[\'value\']) // tv default value is overriden (including empty)
		{
			$output = $tv[\'value\'];
			break;
		}
		else // there is no parent with default value overriden 
		{
			$output = trim(substr($tv[\'value\'],8));
		}
		$docid = $pid[\'parent\']; // move up one document in document tree
	} // end while
	
	return $output;
}

# gets list of published documents with properties
function getDocs($modx,$startid,$priority,$changefreq,$excludeTV)
{
	// get children documents
	$docs = $modx->getActiveChildren($startid,\'menuindex\',\'asc\',\'id,editedon,template,published,searchable,pagetitle,type\'); 
	// add sub-children to the list
	foreach ($docs as $key => $doc)
	{
		$id = $doc[\'id\'];
		$docs[$key][$priority] = getTV($modx,$id,$priority); // add priority property
		$docs[$key][$changefreq] = getTV($modx,$id,$changefreq); // add changefreq property
		$docs[$key][$excludeTV] = getTV($modx,$id,$excludeTV); // add excludeTV property
		
		if ($modx->getActiveChildren($id))
			$docs = array_merge($docs, getDocs($modx,$id,$priority,$changefreq,$excludeTV));
	} // end foreach
	return $docs;
}';
$s['sitemapProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['sitemap'] = '/*
==================================================
	sitemap
==================================================

Outputs a machine readable site map for search
engines and robots. Supports the following
formats:

- Sitemap Protocol used by Google Sitemaps
  (http://www.google.com/webmasters/sitemaps/)

- URL list in text format
  (e.g. Yahoo! submission)

Author: Grzegorz Adamiak [grad]
Version: 1.0.8 @ 22-AUG-2008
License: LGPL
MODx: 0.9.2.1, 0.9.6.1

History:
# 1.0.8
- excludeTemplates can now also be specified as a template ID instead of template name. 
  Useful if you change the names of your templates frequently. (ncrossland)
  e.g. &excludeTemplates=`myTemplateName,3,4`
# 1.0.7
- Unpublished and deleted documents were showing up in the sitemap. Even though they could not be viewed, 
  they were showing up as broken links to search engines. (ncrossland)
# 1.0.6
- Add optional parameter (excludeWeblinks) to exclude weblinks from the sitemap, since they often point to external
  sites (which don\'t belong on your sitemap), or redirecting to other internal pages (which are already
  in the sitemap). Google Webmaster Tools generates warnings for excessive redirects.	
  Default is false - e.g. default behaviour remains unchanged. (ncrossland)
# 1.0.5
- Modification about non searchable documents, as suggested by forum user JayBee
  (http://modxcms.com/forums/index.php/topic,5754.msg99895.html#msg99895)
# 1.0.4 (By Bert Catsburg, bert@catsburg.com)
- Added display option \'ulli\'. 
  An <ul><li> list of all published documents.
# 1.0.3
- Added ability to specify the XSL URL - you don\'t always need one and it 
  seems to create a lot of support confusion!
  It is now a parameter (&xsl=``) which can take either an alias or a doc ID (ncrossland)
- Modifications suggested by forum users Grad and Picachu incorporated
  (http://modxcms.com/forums/index.php/topic,5754.60.html)
# 1.0.2
- Reworked fetching of template variable value to
  get INHERITED value.
# 1.0.1
- Reworked fetching of template variable value,
  now it gets computed value instead of nominal;
  however, still not the inherited value.
# 1.0
- First public release.

TODO:
- provide output for ROR
--------------------------------------------------
*/

/* Parameters
----------------------------------------------- */

# $startid [ int ]
# Id of the \'root\' document from which the sitemap
# starts.
# Default: 0

$startid = (isset($startid)) ? $startid : 0;

# $format [ sp | txt | ror ]
# Which format of sitemap to use:
# - sp <- Sitemap Protocol used by Google
# - txt <- text file with list of URLs
# TODO - ror <- Resource Of Resources
# Default: sp

$format = (isset($format) && ($format != \'ror\')) ? $format : \'sp\';

# $priority [ str ]
# Name of TV which sets the relative priority of
# the document. If there is no such TV, this
# parameter will not be used.
# Default: sitemap_priority

$priority = (isset($priority)) ? $priority : \'sitemap_priority\';

# $changefreq [ str ]
# Name of TV which sets the change frequency. If
# there is no such TV this parameter will not be
# used.
# Default: sitemap_changefreq

$changefreq = (isset($changefreq)) ? $changefreq : \'sitemap_changefreq\';

# $excludeTemplates [ str ]
# Documents based on which templates should not be
# included in the sitemap. Comma separated list
# with names of templates.
# Default: empty

$excludeTemplates = (isset($excludeTemplates)) ? $excludeTemplates : array();

# $excludeTV [ str ]
# Name of TV (boolean type) which sets document
# exclusion form sitemap. If there is no such TV
# this parameter will not be used.
# Default: \'sitemap_exclude\'

$excludeTV = (isset($excludeTV)) ? $excludeTV : \'sitemap_exclude\';

# $xsl [ str ] 
# URL to the XSL style sheet
# or
# $xsl [ int ]
# doc ID of the XSL style sheet

$xsl = (isset($xsl)) ? $xsl : \'\';
if (is_numeric($xsl)) { $xsl = $modx->makeUrl($xsl); }


# $excludeWeblinks [ bool ]
# Should weblinks be excluded?
# You may not want to include links to external sites in your sitemap,
# and Google gives warnings about multiple redirects to pages 
# within your site.
# Default: false
$excludeWeblinks = (isset($excludeWeblinks)) ? $excludeWeblinks : false;


/* End parameters
----------------------------------------------- */

# get list of documents
# ---------------------------------------------
$docs = getDocs($modx,$startid,$priority,$changefreq,$excludeTV);


# filter out documents by template or TV
# ---------------------------------------------
// get all templates
$select = $modx->db->select("id, templatename", $modx->getFullTableName(\'site_templates\'));
while ($query = $modx->db->getRow($select)) {
	$allTemplates[$query[\'id\']] = $query[\'templatename\'];
}

$remainingTemplates = $allTemplates;

// get templates to exclude, and remove them from the all templates list
if (!empty ($excludeTemplates)) {
	
	$excludeTemplates = explode(",", $excludeTemplates);	
	
	// Loop through each template we want to exclude
	foreach ($excludeTemplates as $template) {
		$template = trim($template);
		
		// If it\'s numeric, assume it\'s an ID, and remove directly from the $allTemplates array
		if (is_numeric($template) && isset($remainingTemplates[$template])) {
			unset($remainingTemplates[$template]);
		} else if (trim($template) && in_array($template, $remainingTemplates)) { // If it\'s text, and not empty, assume it\'s a template name
			unset($remainingTemplates[array_search($template, $remainingTemplates)]);			
		}
	} // end foreach
}

$output= array();
// filter out documents which shouldn\'t be included
foreach ($docs as $doc)
{
	if (isset($remainingTemplates[$doc[\'template\']]) && !$doc[$excludeTV] && $doc[\'published\'] && $doc[\'template\']!=0 && $doc[\'searchable\']) {
		if (!$excludeWeblinks || ($excludeWeblinks && $doc[\'type\'] != \'reference\')) {
			$output[] = $doc;		
		}
	}
}
$docs = $output;
unset ($output, $allTemplates, $excludeTemplates);


# build sitemap in specified format
# ---------------------------------------------

switch ($format)
{
	// Next case added in version 1.0.4
	case \'ulli\': // UL List
		$output .= "<ul class=\\"sitemap\\">\\n";
		// TODO: Sort the array on Menu Index
		// TODO: Make a nested ul-li based on the levels in the document tree.
		foreach ($docs as $doc)
		{
			$s  = "  <li class=\\"sitemap\\">";
			$s .= "<a href=\\"[(site_url)][~" . $doc[\'id\'] . "~]\\" class=\\"sitemap\\">" . $doc[\'pagetitle\'] . "</a>";
			$s .= "</li>\\n";
			$output .= $s;
		} // end foreach
		$output .= "</ul>\\n";
		break;
		
	case \'txt\': // plain text list of URLs

		foreach ($docs as $doc)
		{
			$url = \'[(site_url)][~\'.$doc[\'id\'].\'~]\';

			$output .= $url."\\n";
		} // end foreach
		break;

	case \'ror\': // TODO
	default: // Sitemap Protocol

	
	$output = \'<?xml version="1.0" encoding="UTF-8"?>\'."\\n";
	if ($xsl != \'\') {
		$output .=\'<?xml-stylesheet type="text/xsl" href="\'.$xsl.\'"?>\'."\\n";
	}
	$output .=\'<urlset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd" xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\'."\\n";
	
	
	foreach ($docs as $doc)	{
		$url = \'[(site_url)][~\'.$doc[\'id\'].\'~]\';
		$date = $doc[\'editedon\'];
		$date = date("Y-m-d", $date);
		$docPriority = ($doc[$priority]) ? $doc[$priority] : 0; // false if TV doesn\'t exist
		$docChangefreq = ($doc[$changefreq]) ? $doc[$changefreq] : 0; // false if TV doesn\'t exist

		$output .= "\\t".\'<url>\'."\\n";
		$output .= "\\t\\t".\'<loc>\'.$url.\'</loc>\'."\\n";
		$output .= "\\t\\t".\'<lastmod>\'.$date.\'</lastmod>\'."\\n";
		$output .= ($docPriority) ? ("\\t\\t".\'<priority>\'.$docPriority.\'</priority>\'."\\n") : \'\'; // don\'t output anything if TV doesn\'t exist
		$output .= ($docChangefreq) ? ("\\t\\t".\'<changefreq>\'.$docChangefreq.\'</changefreq>\'."\\n") : \'\'; // don\'t output anything if TV doesn\'t exist
		$output .= "\\t".\'</url>\'."\\n";
	} // end foreach
	$output .= \'</urlset>\';

} // end switch

return $output;

# functions
# ---------------------------------------------

# gets (inherited) value of template variable
function getTV($modx,$docid,$doctv)
{
/* apparently in 0.9.2.1 the getTemplateVarOutput function doesn\'t work as expected and doesn\'t return INHERITED value; this is probably to be fixed for next release; see http://modxcms.com/bugs/task/464
	$output = $modx->getTemplateVarOutput($tv,$docid);
	return $output[$tv];
*/
	
	while ($pid = $modx->getDocument($docid,\'parent\'))
	{
		$tv = $modx->getTemplateVar($doctv,\'*\',$docid);
		if (($tv[\'value\'] && substr($tv[\'value\'],0,8) != \'@INHERIT\') or !$tv[\'value\']) // tv default value is overriden (including empty)
		{
			$output = $tv[\'value\'];
			break;
		}
		else // there is no parent with default value overriden 
		{
			$output = trim(substr($tv[\'value\'],8));
		}
		$docid = $pid[\'parent\']; // move up one document in document tree
	} // end while
	
	return $output;
}

# gets list of published documents with properties
function getDocs($modx,$startid,$priority,$changefreq,$excludeTV)
{
	// get children documents
	$docs = $modx->getActiveChildren($startid,\'menuindex\',\'asc\',\'id,editedon,template,published,searchable,pagetitle,type\'); 
	// add sub-children to the list
	foreach ($docs as $key => $doc)
	{
		$id = $doc[\'id\'];
		$docs[$key][$priority] = getTV($modx,$id,$priority); // add priority property
		$docs[$key][$changefreq] = getTV($modx,$id,$changefreq); // add changefreq property
		$docs[$key][$excludeTV] = getTV($modx,$id,$excludeTV); // add excludeTV property
		
		if ($modx->getActiveChildren($id))
			$docs = array_merge($docs, getDocs($modx,$id,$priority,$changefreq,$excludeTV));
	} // end foreach
	return $docs;
}';
$s['Wayfinder'] = '/*
::::::::::::::::::::::::::::::::::::::::
 Snippet name: Wayfinder
 Short Desc: builds site navigation
 Version: 2.0
 Authors: 
	Kyle Jaebker (muddydogpaws.com)
	Ryan Thrash (vertexworks.com)
 Date: February 27, 2006
::::::::::::::::::::::::::::::::::::::::
Description:
    Totally refactored from original DropMenu nav builder to make it easier to
    create custom navigation by using chunks as output templates. By using templates,
    many of the paramaters are no longer needed for flexible output including tables,
    unordered- or ordered-lists (ULs or OLs), definition lists (DLs) or in any other
    format you desire.
::::::::::::::::::::::::::::::::::::::::
Example Usage:
    [[Wayfinder? &startId=`0`]]
::::::::::::::::::::::::::::::::::::::::
*/

$wayfinder_base = $modx->config[\'base_path\']."assets/snippets/wayfinder/";

//Include a custom config file if specified
$config = (isset($config)) ? "{$wayfinder_base}configs/{$config}.config.php" : "{$wayfinder_base}configs/default.config.php";
if (file_exists($config)) {
	include_once("$config");
}

include_once("{$wayfinder_base}wayfinder.inc.php");

if (class_exists(\'Wayfinder\')) {
   $wf = new Wayfinder();
} else {
    return \'error: Wayfinder class not found\';
}

$wf->_config = array(
	\'id\' => isset($startId) ? $startId : $modx->documentIdentifier,
	\'level\' => isset($level) ? $level : 0,
	\'includeDocs\' => isset($includeDocs) ? $includeDocs : 0,
	\'excludeDocs\' => isset($excludeDocs) ? $excludeDocs : 0,
	\'ph\' => isset($ph) ? $ph : FALSE,
	\'debug\' => isset($debug) ? TRUE : FALSE,
	\'ignoreHidden\' => isset($ignoreHidden) ? $ignoreHidden : FALSE,
	\'hideSubMenus\' => isset($hideSubMenus) ? $hideSubMenus : FALSE,
	\'useWeblinkUrl\' => isset($useWeblinkUrl) ? $useWeblinkUrl : TRUE,
	\'fullLink\' => isset($fullLink) ? $fullLink : FALSE,
	\'nl\' => isset($removeNewLines) ? \'\' : "\\n",
	\'sortOrder\' => isset($sortOrder) ? strtoupper($sortOrder) : \'ASC\',
	\'sortBy\' => isset($sortBy) ? $sortBy : \'menuindex\',
	\'limit\' => isset($limit) ? $limit : 0,
	\'cssTpl\' => isset($cssTpl) ? $cssTpl : FALSE,
	\'jsTpl\' => isset($jsTpl) ? $jsTpl : FALSE,
	\'rowIdPrefix\' => isset($rowIdPrefix) ? $rowIdPrefix : FALSE,
	\'textOfLinks\' => isset($textOfLinks) ? $textOfLinks : \'menutitle\',
	\'titleOfLinks\' => isset($titleOfLinks) ? $titleOfLinks : \'pagetitle\',
	\'displayStart\' => isset($displayStart) ? $displayStart : FALSE,
);

//get user class definitions
$wf->_css = array(
	\'first\' => isset($firstClass) ? $firstClass : \'\',
	\'last\' => isset($lastClass) ? $lastClass : \'last\',
	\'here\' => isset($hereClass) ? $hereClass : \'active\',
	\'parent\' => isset($parentClass) ? $parentClass : \'\',
	\'row\' => isset($rowClass) ? $rowClass : \'\',
	\'outer\' => isset($outerClass) ? $outerClass : \'\',
	\'inner\' => isset($innerClass) ? $innerClass : \'\',
	\'level\' => isset($levelClass) ? $levelClass: \'\',
	\'self\' => isset($selfClass) ? $selfClass : \'\',
	\'weblink\' => isset($webLinkClass) ? $webLinkClass : \'\',
);

//get user templates
$wf->_templates = array(
	\'outerTpl\' => isset($outerTpl) ? $outerTpl : \'\',
	\'rowTpl\' => isset($rowTpl) ? $rowTpl : \'\',
	\'parentRowTpl\' => isset($parentRowTpl) ? $parentRowTpl : \'\',
	\'parentRowHereTpl\' => isset($parentRowHereTpl) ? $parentRowHereTpl : \'\',
	\'hereTpl\' => isset($hereTpl) ? $hereTpl : \'\',
	\'innerTpl\' => isset($innerTpl) ? $innerTpl : \'\',
	\'innerRowTpl\' => isset($innerRowTpl) ? $innerRowTpl : \'\',
	\'innerHereTpl\' => isset($innerHereTpl) ? $innerHereTpl : \'\',
	\'activeParentRowTpl\' => isset($activeParentRowTpl) ? $activeParentRowTpl : \'\',
	\'categoryFoldersTpl\' => isset($categoryFoldersTpl) ? $categoryFoldersTpl : \'\',
	\'startItemTpl\' => isset($startItemTpl) ? $startItemTpl : \'\',
);

//Process Wayfinder
$output = $wf->run();

if ($wf->_config[\'debug\']) {
	$output .= $wf->renderDebugOutput();
}

//Ouput Results
if ($wf->_config[\'ph\']) {
    $modx->setPlaceholder($wf->_config[\'ph\'],$output);
} else {
    return $output;
}';
$s['Wayfinder'] = '/*
::::::::::::::::::::::::::::::::::::::::
 Snippet name: Wayfinder
 Short Desc: builds site navigation
 Version: 2.0
 Authors: 
	Kyle Jaebker (muddydogpaws.com)
	Ryan Thrash (vertexworks.com)
 Date: February 27, 2006
::::::::::::::::::::::::::::::::::::::::
Description:
    Totally refactored from original DropMenu nav builder to make it easier to
    create custom navigation by using chunks as output templates. By using templates,
    many of the paramaters are no longer needed for flexible output including tables,
    unordered- or ordered-lists (ULs or OLs), definition lists (DLs) or in any other
    format you desire.
::::::::::::::::::::::::::::::::::::::::
Example Usage:
    [[Wayfinder? &startId=`0`]]
::::::::::::::::::::::::::::::::::::::::
*/

$wayfinder_base = $modx->config[\'base_path\']."assets/snippets/wayfinder/";

//Include a custom config file if specified
$config = (isset($config)) ? "{$wayfinder_base}configs/{$config}.config.php" : "{$wayfinder_base}configs/default.config.php";
if (file_exists($config)) {
	include_once("$config");
}

include_once("{$wayfinder_base}wayfinder.inc.php");

if (class_exists(\'Wayfinder\')) {
   $wf = new Wayfinder();
} else {
    return \'error: Wayfinder class not found\';
}

$wf->_config = array(
	\'id\' => isset($startId) ? $startId : $modx->documentIdentifier,
	\'level\' => isset($level) ? $level : 0,
	\'includeDocs\' => isset($includeDocs) ? $includeDocs : 0,
	\'excludeDocs\' => isset($excludeDocs) ? $excludeDocs : 0,
	\'ph\' => isset($ph) ? $ph : FALSE,
	\'debug\' => isset($debug) ? TRUE : FALSE,
	\'ignoreHidden\' => isset($ignoreHidden) ? $ignoreHidden : FALSE,
	\'hideSubMenus\' => isset($hideSubMenus) ? $hideSubMenus : FALSE,
	\'useWeblinkUrl\' => isset($useWeblinkUrl) ? $useWeblinkUrl : TRUE,
	\'fullLink\' => isset($fullLink) ? $fullLink : FALSE,
	\'nl\' => isset($removeNewLines) ? \'\' : "\\n",
	\'sortOrder\' => isset($sortOrder) ? strtoupper($sortOrder) : \'ASC\',
	\'sortBy\' => isset($sortBy) ? $sortBy : \'menuindex\',
	\'limit\' => isset($limit) ? $limit : 0,
	\'cssTpl\' => isset($cssTpl) ? $cssTpl : FALSE,
	\'jsTpl\' => isset($jsTpl) ? $jsTpl : FALSE,
	\'rowIdPrefix\' => isset($rowIdPrefix) ? $rowIdPrefix : FALSE,
	\'textOfLinks\' => isset($textOfLinks) ? $textOfLinks : \'menutitle\',
	\'titleOfLinks\' => isset($titleOfLinks) ? $titleOfLinks : \'pagetitle\',
	\'displayStart\' => isset($displayStart) ? $displayStart : FALSE,
);

//get user class definitions
$wf->_css = array(
	\'first\' => isset($firstClass) ? $firstClass : \'\',
	\'last\' => isset($lastClass) ? $lastClass : \'last\',
	\'here\' => isset($hereClass) ? $hereClass : \'active\',
	\'parent\' => isset($parentClass) ? $parentClass : \'\',
	\'row\' => isset($rowClass) ? $rowClass : \'\',
	\'outer\' => isset($outerClass) ? $outerClass : \'\',
	\'inner\' => isset($innerClass) ? $innerClass : \'\',
	\'level\' => isset($levelClass) ? $levelClass: \'\',
	\'self\' => isset($selfClass) ? $selfClass : \'\',
	\'weblink\' => isset($webLinkClass) ? $webLinkClass : \'\',
);

//get user templates
$wf->_templates = array(
	\'outerTpl\' => isset($outerTpl) ? $outerTpl : \'\',
	\'rowTpl\' => isset($rowTpl) ? $rowTpl : \'\',
	\'parentRowTpl\' => isset($parentRowTpl) ? $parentRowTpl : \'\',
	\'parentRowHereTpl\' => isset($parentRowHereTpl) ? $parentRowHereTpl : \'\',
	\'hereTpl\' => isset($hereTpl) ? $hereTpl : \'\',
	\'innerTpl\' => isset($innerTpl) ? $innerTpl : \'\',
	\'innerRowTpl\' => isset($innerRowTpl) ? $innerRowTpl : \'\',
	\'innerHereTpl\' => isset($innerHereTpl) ? $innerHereTpl : \'\',
	\'activeParentRowTpl\' => isset($activeParentRowTpl) ? $activeParentRowTpl : \'\',
	\'categoryFoldersTpl\' => isset($categoryFoldersTpl) ? $categoryFoldersTpl : \'\',
	\'startItemTpl\' => isset($startItemTpl) ? $startItemTpl : \'\',
);

//Process Wayfinder
$output = $wf->run();

if ($wf->_config[\'debug\']) {
	$output .= $wf->renderDebugOutput();
}

//Ouput Results
if ($wf->_config[\'ph\']) {
    $modx->setPlaceholder($wf->_config[\'ph\'],$output);
} else {
    return $output;
}';
$s['Wayfinder'] = '/*
::::::::::::::::::::::::::::::::::::::::
 Snippet name: Wayfinder
 Short Desc: builds site navigation
 Version: 2.0
 Authors: 
	Kyle Jaebker (muddydogpaws.com)
	Ryan Thrash (vertexworks.com)
 Date: February 27, 2006
::::::::::::::::::::::::::::::::::::::::
Description:
    Totally refactored from original DropMenu nav builder to make it easier to
    create custom navigation by using chunks as output templates. By using templates,
    many of the paramaters are no longer needed for flexible output including tables,
    unordered- or ordered-lists (ULs or OLs), definition lists (DLs) or in any other
    format you desire.
::::::::::::::::::::::::::::::::::::::::
Example Usage:
    [[Wayfinder? &startId=`0`]]
::::::::::::::::::::::::::::::::::::::::
*/

$wayfinder_base = $modx->config[\'base_path\']."assets/snippets/wayfinder/";

//Include a custom config file if specified
$config = (isset($config)) ? "{$wayfinder_base}configs/{$config}.config.php" : "{$wayfinder_base}configs/default.config.php";
if (file_exists($config)) {
	include_once("$config");
}

include_once("{$wayfinder_base}wayfinder.inc.php");

if (class_exists(\'Wayfinder\')) {
   $wf = new Wayfinder();
} else {
    return \'error: Wayfinder class not found\';
}

$wf->_config = array(
	\'id\' => isset($startId) ? $startId : $modx->documentIdentifier,
	\'level\' => isset($level) ? $level : 0,
	\'includeDocs\' => isset($includeDocs) ? $includeDocs : 0,
	\'excludeDocs\' => isset($excludeDocs) ? $excludeDocs : 0,
	\'ph\' => isset($ph) ? $ph : FALSE,
	\'debug\' => isset($debug) ? TRUE : FALSE,
	\'ignoreHidden\' => isset($ignoreHidden) ? $ignoreHidden : FALSE,
	\'hideSubMenus\' => isset($hideSubMenus) ? $hideSubMenus : FALSE,
	\'useWeblinkUrl\' => isset($useWeblinkUrl) ? $useWeblinkUrl : TRUE,
	\'fullLink\' => isset($fullLink) ? $fullLink : FALSE,
	\'nl\' => isset($removeNewLines) ? \'\' : "\\n",
	\'sortOrder\' => isset($sortOrder) ? strtoupper($sortOrder) : \'ASC\',
	\'sortBy\' => isset($sortBy) ? $sortBy : \'menuindex\',
	\'limit\' => isset($limit) ? $limit : 0,
	\'cssTpl\' => isset($cssTpl) ? $cssTpl : FALSE,
	\'jsTpl\' => isset($jsTpl) ? $jsTpl : FALSE,
	\'rowIdPrefix\' => isset($rowIdPrefix) ? $rowIdPrefix : FALSE,
	\'textOfLinks\' => isset($textOfLinks) ? $textOfLinks : \'menutitle\',
	\'titleOfLinks\' => isset($titleOfLinks) ? $titleOfLinks : \'pagetitle\',
	\'displayStart\' => isset($displayStart) ? $displayStart : FALSE,
);

//get user class definitions
$wf->_css = array(
	\'first\' => isset($firstClass) ? $firstClass : \'\',
	\'last\' => isset($lastClass) ? $lastClass : \'last\',
	\'here\' => isset($hereClass) ? $hereClass : \'active\',
	\'parent\' => isset($parentClass) ? $parentClass : \'\',
	\'row\' => isset($rowClass) ? $rowClass : \'\',
	\'outer\' => isset($outerClass) ? $outerClass : \'\',
	\'inner\' => isset($innerClass) ? $innerClass : \'\',
	\'level\' => isset($levelClass) ? $levelClass: \'\',
	\'self\' => isset($selfClass) ? $selfClass : \'\',
	\'weblink\' => isset($webLinkClass) ? $webLinkClass : \'\',
);

//get user templates
$wf->_templates = array(
	\'outerTpl\' => isset($outerTpl) ? $outerTpl : \'\',
	\'rowTpl\' => isset($rowTpl) ? $rowTpl : \'\',
	\'parentRowTpl\' => isset($parentRowTpl) ? $parentRowTpl : \'\',
	\'parentRowHereTpl\' => isset($parentRowHereTpl) ? $parentRowHereTpl : \'\',
	\'hereTpl\' => isset($hereTpl) ? $hereTpl : \'\',
	\'innerTpl\' => isset($innerTpl) ? $innerTpl : \'\',
	\'innerRowTpl\' => isset($innerRowTpl) ? $innerRowTpl : \'\',
	\'innerHereTpl\' => isset($innerHereTpl) ? $innerHereTpl : \'\',
	\'activeParentRowTpl\' => isset($activeParentRowTpl) ? $activeParentRowTpl : \'\',
	\'categoryFoldersTpl\' => isset($categoryFoldersTpl) ? $categoryFoldersTpl : \'\',
	\'startItemTpl\' => isset($startItemTpl) ? $startItemTpl : \'\',
);

//Process Wayfinder
$output = $wf->run();

if ($wf->_config[\'debug\']) {
	$output .= $wf->renderDebugOutput();
}

//Ouput Results
if ($wf->_config[\'ph\']) {
    $modx->setPlaceholder($wf->_config[\'ph\'],$output);
} else {
    return $output;
}';
$s['WayfinderProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['Wayfinder'] = '/*
::::::::::::::::::::::::::::::::::::::::
 Snippet name: Wayfinder
 Short Desc: builds site navigation
 Version: 2.0
 Authors: 
	Kyle Jaebker (muddydogpaws.com)
	Ryan Thrash (vertexworks.com)
 Date: February 27, 2006
::::::::::::::::::::::::::::::::::::::::
Description:
    Totally refactored from original DropMenu nav builder to make it easier to
    create custom navigation by using chunks as output templates. By using templates,
    many of the paramaters are no longer needed for flexible output including tables,
    unordered- or ordered-lists (ULs or OLs), definition lists (DLs) or in any other
    format you desire.
::::::::::::::::::::::::::::::::::::::::
Example Usage:
    [[Wayfinder? &startId=`0`]]
::::::::::::::::::::::::::::::::::::::::
*/

$wayfinder_base = $modx->config[\'base_path\']."assets/snippets/wayfinder/";

//Include a custom config file if specified
$config = (isset($config)) ? "{$wayfinder_base}configs/{$config}.config.php" : "{$wayfinder_base}configs/default.config.php";
if (file_exists($config)) {
	include_once("$config");
}

include_once("{$wayfinder_base}wayfinder.inc.php");

if (class_exists(\'Wayfinder\')) {
   $wf = new Wayfinder();
} else {
    return \'error: Wayfinder class not found\';
}

$wf->_config = array(
	\'id\' => isset($startId) ? $startId : $modx->documentIdentifier,
	\'level\' => isset($level) ? $level : 0,
	\'includeDocs\' => isset($includeDocs) ? $includeDocs : 0,
	\'excludeDocs\' => isset($excludeDocs) ? $excludeDocs : 0,
	\'ph\' => isset($ph) ? $ph : FALSE,
	\'debug\' => isset($debug) ? TRUE : FALSE,
	\'ignoreHidden\' => isset($ignoreHidden) ? $ignoreHidden : FALSE,
	\'hideSubMenus\' => isset($hideSubMenus) ? $hideSubMenus : FALSE,
	\'useWeblinkUrl\' => isset($useWeblinkUrl) ? $useWeblinkUrl : TRUE,
	\'fullLink\' => isset($fullLink) ? $fullLink : FALSE,
	\'nl\' => isset($removeNewLines) ? \'\' : "\\n",
	\'sortOrder\' => isset($sortOrder) ? strtoupper($sortOrder) : \'ASC\',
	\'sortBy\' => isset($sortBy) ? $sortBy : \'menuindex\',
	\'limit\' => isset($limit) ? $limit : 0,
	\'cssTpl\' => isset($cssTpl) ? $cssTpl : FALSE,
	\'jsTpl\' => isset($jsTpl) ? $jsTpl : FALSE,
	\'rowIdPrefix\' => isset($rowIdPrefix) ? $rowIdPrefix : FALSE,
	\'textOfLinks\' => isset($textOfLinks) ? $textOfLinks : \'menutitle\',
	\'titleOfLinks\' => isset($titleOfLinks) ? $titleOfLinks : \'pagetitle\',
	\'displayStart\' => isset($displayStart) ? $displayStart : FALSE,
);

//get user class definitions
$wf->_css = array(
	\'first\' => isset($firstClass) ? $firstClass : \'\',
	\'last\' => isset($lastClass) ? $lastClass : \'last\',
	\'here\' => isset($hereClass) ? $hereClass : \'active\',
	\'parent\' => isset($parentClass) ? $parentClass : \'\',
	\'row\' => isset($rowClass) ? $rowClass : \'\',
	\'outer\' => isset($outerClass) ? $outerClass : \'\',
	\'inner\' => isset($innerClass) ? $innerClass : \'\',
	\'level\' => isset($levelClass) ? $levelClass: \'\',
	\'self\' => isset($selfClass) ? $selfClass : \'\',
	\'weblink\' => isset($webLinkClass) ? $webLinkClass : \'\',
);

//get user templates
$wf->_templates = array(
	\'outerTpl\' => isset($outerTpl) ? $outerTpl : \'\',
	\'rowTpl\' => isset($rowTpl) ? $rowTpl : \'\',
	\'parentRowTpl\' => isset($parentRowTpl) ? $parentRowTpl : \'\',
	\'parentRowHereTpl\' => isset($parentRowHereTpl) ? $parentRowHereTpl : \'\',
	\'hereTpl\' => isset($hereTpl) ? $hereTpl : \'\',
	\'innerTpl\' => isset($innerTpl) ? $innerTpl : \'\',
	\'innerRowTpl\' => isset($innerRowTpl) ? $innerRowTpl : \'\',
	\'innerHereTpl\' => isset($innerHereTpl) ? $innerHereTpl : \'\',
	\'activeParentRowTpl\' => isset($activeParentRowTpl) ? $activeParentRowTpl : \'\',
	\'categoryFoldersTpl\' => isset($categoryFoldersTpl) ? $categoryFoldersTpl : \'\',
	\'startItemTpl\' => isset($startItemTpl) ? $startItemTpl : \'\',
);

//Process Wayfinder
$output = $wf->run();

if ($wf->_config[\'debug\']) {
	$output .= $wf->renderDebugOutput();
}

//Ouput Results
if ($wf->_config[\'ph\']) {
    $modx->setPlaceholder($wf->_config[\'ph\'],$output);
} else {
    return $output;
}';
$s['Ditto'] = '/* Description:
 *      Aggregates documents to create blogs, article/news
 *      collections, and more,with full support for templating.
 * 
 * Author: 
 *      Mark Kaplan for MODx CMF
*/

//---Core Settings---------------------------------------------------- //

$ditto_version = "2.1.0";
    // Ditto version being executed

$ditto_base = isset($ditto_base) ? $modx->config[\'base_path\'].$ditto_base : $modx->config[\'base_path\']."assets/snippets/ditto/";
/*
    Param: ditto_base
    
    Purpose:
    Location of Ditto files

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    [(base_path)]assets/snippets/ditto/
*/
$dittoID = (!isset($id)) ? "" : $id."_";
$GLOBALS["dittoID"] = $dittoID;
/*
    Param: id

    Purpose:
    Unique ID for this Ditto instance for connection with other scripts (like Reflect) and unique URL parameters

    Options:
    Any combination of characters a-z, underscores, and numbers 0-9
    
    Note:
    This is case sensitive

    Default:
    "" - blank
*/      
$language = (isset($language))? $language : $modx->config[\'manager_language\'];
if (!file_exists($ditto_base."lang/".$language.".inc.php")) {
    $language ="english";
}
/*
    Param: language

    Purpose:
    language for defaults, debug, and error messages

    Options:
    Any language name with a corresponding file in the &ditto_base/lang folder

    Default:
    "english"
*/
$format = (isset($format)) ? strtolower($format) : "html" ;
/*
    Param: format

    Purpose:
    Output format to use

    Options:
    - "html"
    - "json"
    - "xml"
    - "atom"
    - "rss"

    Default:
    "html"
*/
$config = (isset($config)) ? $config : "default";
/*
    Param: config

    Purpose:
    Load a custom configuration

    Options:
    "default" - default blank config file
    CONFIG_NAME - Other configs installed in the configs folder or in any folder within the MODx base path via @FILE

    Default:
    "default"
    
    Related:
    - <extenders>
*/
$debug = isset($debug)? $debug : 0;
/*
    Param: debug

    Purpose:
    Output debugging information

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <debug>
*/
$phx = (isset($phx))? $phx : 1;
/*
    Param: phx

    Purpose:
    Use PHx formatting

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/      
$extenders = isset($extenders) ? explode(",",$extenders) : array();
/*
    Param: extenders

    Purpose:
    Load an extender which adds functionality to Ditto

    Options:
    Any extender in the extenders folder or in any folder within the MODx base path via @FILE

    Default:
    [NULL]

    Related:
    - <config>
*/
    // Variable: extenders
    // Array that can be added to by configs or formats to load that extender
    
$placeholders = array();
    // Variable: placeholders
    // Initialize custom placeholders array for configs or extenders to add to

$filters = array("custom"=>array(),"parsed"=>array());
    // Variable: filters
    // Holds both the custom filters array for configs or extenders to add to 
    // and the parsed filters array. To add to this array, use the following format
    // (code)
    // $filters["parsed"][] = array("name" => array("source"=>$source,"value"=>$value,"mode"=>$mode));
    // $filters["custom"][] = array("source","callback_function");

$orderBy = array(\'parsed\'=>array(),\'custom\'=>array(),\'unparsed\'=>$orderBy);
    // Variable: orderBy
    // An array that holds all criteria to sort the result set by. 
    // Note that using a custom sort will disable all other sorting.
    // (code)
    // $orderBy["parsed"][] = array("sortBy","sortDir");
    // $orderBy["custom"][] = array("sortBy","callback_function");
        
//---Includes-------------------------------------------------------- //

$files = array (
    "base_language" => $ditto_base."lang/english.inc.php",
    "language" => $ditto_base."lang/$language.inc.php",
    "main_class" => $ditto_base."classes/ditto.class.inc.php",
    "template_class" => $ditto_base."classes/template.class.inc.php",
    "filter_class" => $ditto_base."classes/filter.class.inc.php",
    "format" => $ditto_base."formats/$format.format.inc.php",
    "config" => $ditto_base."configs/default.config.php",
    "user_config" => (substr($config, 0, 5) != "@FILE") ? $ditto_base."configs/$config.config.php" : $modx->config[\'base_path\'].trim(substr($config, 5))
);

if ($phx == 1) {
    $files["prePHx_class"] = $ditto_base."classes/phx.pre.class.inc.php";
}
if (isset($randomize)) {
    $files["randomize_class"] = $ditto_base."classes/random.class.inc.php";
}
if ($debug == 1) {
    $files["modx_debug_class"] = $ditto_base."debug/modxDebugConsole.class.php";
    $files["debug_class"] = $ditto_base."classes/debug.class.inc.php";
    $files["debug_templates"] = $ditto_base."debug/debug.templates.php";
}

$files = array_unique($files);
foreach ($files as $filename => $filevalue) {
    if (file_exists($filevalue) && strpos($filename,"class")) {
        include_once($filevalue);
    } else if (file_exists($filevalue)) {
        include($filevalue);
    } else if ($filename == "language") {
        $modx->logEvent(1, 3, "Language file does not exist Please check: " . $filevalue, "Ditto " . $ditto_version);
        return "Language file does not exist Please check: " . $filevalue;
    } else {
        $modx->logEvent(1, 3, $filevalue . " " . $_lang[\'file_does_not_exist\'], "Ditto " . $ditto_version);
        return $filevalue . " " . $_lang[\'file_does_not_exist\'];
    }
}

//---Initiate Class-------------------------------------------------- //
if (class_exists(\'ditto\')) {
    $ditto = new ditto($dittoID,$format,$_lang,$dbg_templates);
        // create a new Ditto instance in the specified format and language with the requested debug level
} else {
    $modx->logEvent(1,3,$_lang[\'invalid_class\'],"Ditto ".$ditto_version);
    return $_lang[\'invalid_class\'];
}

//---Initiate Extenders---------------------------------------------- //
if (isset($tagData)) {
    $extenders[] = "tagging";
}
if(count($extenders) > 0) {
    $extenders = array_unique($extenders);
    foreach ($extenders as $extender) {
            if(substr($extender, 0, 5) != "@FILE") {
                $extender_path = $ditto_base."extenders/".$extender.".extender.inc.php";                
            } else {
                $extender_path = $modx->config[\'base_path\'].trim(substr($extender, 5));
            }
            
            if (file_exists($extender_path)){
                include($extender_path);
            } else {
                $modx->logEvent(1, 3, $extender . " " . $_lang[\'extender_does_not_exist\'], "Ditto ".$ditto_version);
                return $extender . " " . $_lang[\'extender_does_not_exist\'];
            }       
    }   
}

//---Parameters------------------------------------------------------- /*
if (isset($startID)) {$parents = $startID;}
if (isset($summarize)) {$display = $summarize;}
if (isset($limit)) {$queryLimit = $limit;}
if (isset($sortBy) || isset($sortDir) || is_null($orderBy[\'unparsed\'])) {
    $sortDir = isset($sortDir) ? strtoupper($sortDir) : \'DESC\';
    $sortBy = isset($sortBy) ? $sortBy : "createdon";
    $orderBy[\'parsed\'][]=array($sortBy,$sortDir);
}
    // Allow backwards compatibility

$idType = isset($documents) ? "documents" : "parents";
    // Variable: idType
    // type of IDs provided; can be either parents or documents

$parents = isset($parents) ? $ditto->cleanIDs($parents) : $modx->documentIdentifier;

/*
    Param: parents

    Purpose:
    IDs of containers for Ditto to retrieve their children to &depth depth

    Options:
    Any valid MODx document marked as a container

    Default:
    Current MODx Document

    Related:
    - <documents>
    - <depth>
*/
$documents = isset($documents) ? $ditto->cleanIDs($documents) : false;
/*
    Param: documents

    Purpose:
    IDs of documents for Ditto to retrieve

    Options:
    Any valid MODx document marked as a container

    Default:
    None

    Related:
    - <parents>
*/

$IDs = ($idType == "parents") ? $parents : $documents;
    // Variable: IDs
    // Internal variable which holds the set of IDs for Ditto to fetch

$depth = isset($depth) ? $depth : 1;
/*
    Param: depth

    Purpose:
    Number of levels deep to retrieve documents

    Options:
    Any number greater than or equal to 1
    0 - infinite depth

    Default:
    1

    Related:
    - <seeThruUnpub>
*/
$paginate = isset($paginate)? $paginate : 0;
/*
    Param: paginate

    Purpose:
    Paginate the results set into pages of &display length.
    Use &total to limit the number of documents retreived.

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <paginateAlwaysShowLinks>
    - <paginateSplitterCharacter>
    - <display>
*/
$dateSource = isset($dateSource) ? $dateSource : "createdon";
/*
    Param: dateSource

    Purpose:
    Source of the [+date+] placeholder

    Options:
    # - Any UNIX timestamp from MODx fields or TVs such as createdon, pub_date, or editedon
    
    Default:
    "createdon"
    
    Related:
    - <dateFormat>
*/
$dateFormat = isset($dateFormat)? $dateFormat : $_lang["dateFormat"];
/*
    Param: dateFormat

    Purpose:
    Format the [+date+] placeholder in human readable form

    Options:
    Any PHP valid strftime option

    Default:
    [LANG]
    
    Related:
    - <dateSource>
*/
$display = isset($display) ? $display : "all";
/*
    Param: display

    Purpose:
    Number of documents to display in the results

    Options:
    # - Any number
    "all" - All documents found

    Default:
    "all"
    
    Related:
    - <queryLimit>
    - <total>
*/
$total = isset($total) ? $total : "all";
/*
    Param: total

    Purpose:
    Number of documents to retrieve
    
    Options:
    # - Any number
    "all" - All documents found

    Default:
    "all" - All documents found
    
    Related:
    - <display>
    - <queryLimit>
*/
$showPublishedOnly = isset($showPublishedOnly) ? $showPublishedOnly : 1;
/*
    Param: showPublishedOnly

    Purpose:
    Show only published documents

    Options:
    0 - show only unpublished documents
    1 - show both published and unpublished documents
    
    Default:
    1 - show both published and unpublished documents
    
    Related:
    - <seeThruUnpub>
    - <hideFolders>
    - <showPublishedOnly>
    - <where>
*/
$showInMenuOnly = isset($showInMenuOnly) ? $showInMenuOnly : 0;
/*
    Param: showInMenuOnly

    Purpose:
    Show only documents visible in the menu

    Options:
    0 - show all documents
    1 - show only documents with the show in menu flag checked
    
    Default:
    0 - show all documents
    
    Related:
    - <seeThruUnpub>
    - <hideFolders>
    - <where>
*/
$hideFolders = isset($hideFolders)? $hideFolders : 0;
/*
    Param: hideFolders

    Purpose:
    Don\'t show folders in the returned results

    Options:
    0 - keep folders
    1 - remove folders
    
    Default:
    0 - keep folders
    
    Related:
    - <seeThruUnpub>
    - <showInMenuOnly>
    - <where>
*/
$hidePrivate = isset($hidePrivate)? $hidePrivate : 1;
/*
    Param: hidePrivate

    Purpose:
    Don\'t show documents the guest or user does not have permission to see

    Options:
    0 - show private documents
    1 - hide private documents
    
    Default:
    1 - hide private documents
    
    Related:
    - <seeThruUnpub>
    - <showInMenuOnly>
    - <where>
*/
$seeThruUnpub = (isset($seeThruUnpub))? $seeThruUnpub : 1 ;
/*
    Param: seeThruUnpub

    Purpose:
    See through unpublished folders to retrive their children
    Used when depth is greater than 1

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <hideFolders>
    - <showInMenuOnly>
    - <where>
*/
$queryLimit = (isset($queryLimit))? $queryLimit : 0;
/*
    Param: queryLimit

    Purpose:
    Number of documents to retrieve from the database, same as MySQL LIMIT

    Options:
    # - Any number
    0 - automatic

    Default:
    0 - automatic
    
    Related:
    - <where>
*/
$where = (isset($where))? $where : "";
/*
    Param: where

    Purpose:
    Custom MySQL WHERE statement

    Options:
    A valid MySQL WHERE statement using only document object items (no TVs)

    Default:
    [NULL]
    
    Related:
    - <queryLimit>
*/
$noResults = isset($noResults)? $ditto->getParam($noResults,"no_documents") : $_lang[\'no_documents\'];
/*
    Param: noResults

    Purpose:
    Text or chunk to display when there are no results

    Options:
    Any valid chunk name or text

    Default:
    [LANG]
*/
$removeChunk = isset($removeChunk) ? explode(",",$removeChunk) : false;
/*
    Param: removeChunk

    Purpose:
    Name of chunks to be stripped from content separated by commas
    - Commonly used to remove comments

    Options:
    Any valid chunkname that appears in the output

    Default:
    [NULL]
*/
$hiddenFields = isset($hiddenFields) ? explode(",",$hiddenFields) : false;
/*
    Param: hiddenFields

    Purpose:
    Allow Ditto to retrieve fields its template parser cannot handle such as nested placeholders and [*fields*]

    Options:
    Any valid MODx fieldnames or TVs comma separated

    Default:
    [NULL]
*/
$offset = isset($start) ? $start : 0;
$start = (isset($_GET[$dittoID.\'start\'])) ? intval($_GET[$dittoID.\'start\']) : 0;
/*
    Param: start

    Purpose:
    Number of documents to skip in the results
    
    Options:
    Any number

    Default:
    0
*/
$globalFilterDelimiter = isset($globalFilterDelimiter) ? $globalFilterDelimiter : "|";
/*
    Param: globalFilterDelimiter

    Purpose:
    Filter delimiter used to separate filters in the filter string
    
    Options:
    Any character not used in the filters

    Default:
    "|"
    
    Related:
    - <localFilterDelimiter>
    - <filter>
    - <parseFilters>
*/
    
$localFilterDelimiter = isset($localFilterDelimiter) ? $localFilterDelimiter : ",";
/*
    Param: localFilterDelimiter

    Purpose:
    Delimiter used to separate individual parameters within each filter string
    
    Options:
    Any character not used in the filter itself

    Default:
    ","
    
    Related:
    - <globalFilterDelimiter>
    - <filter>
    - <parseFilters>
*/
$filters["custom"] = isset($cFilters) ? array_merge($filters["custom"],$cFilters) : $filters["custom"];
$filters["parsed"] = isset($parsedFilters) ? array_merge($filters["parsed"],$parsedFilters) : $filters["parsed"];
    // handle 2.0.0 compatibility
$filter = (isset($filter) || ($filters["custom"] != false) || ($filters["parsed"] != false)) ? $ditto->parseFilters($filter,$filters["custom"],$filters["parsed"],$globalFilterDelimiter,$localFilterDelimiter) : false;
/*
    Param: filter

    Purpose:
    Removes items not meeting a critera. Thus, if pagetitle == joe then it will be removed.
    Use in the format field,criteria,mode with the comma being the local delimiter

    *Mode* *Meaning*
    
    1 - !=
    2 - ==
    3 - <
    4 - >
    5 - <=
    6 - >=
    7 - Text not in field value
    8 - Text in field value
    9 - case insenstive version of #7
    10 - case insenstive version of #8
    11 - checks leading character of the field
    
    @EVAL:
        @EVAL in filters works the same as it does in MODx exect it can only be used 
        with basic filtering, not custom filtering (tagging, etc). Make sure that
        you return the value you wish Ditto to filter by and that the code is valid PHP.

    Default:
    [NULL]
    
    Related:
    - <localFilterDelimiter>
    - <globalFilterDelimiter>
    - <parseFilters>
*/
$keywords = (isset($keywords))? $keywords : 0;
/*  
    Param: keywords
    
    Purpose: 
    Enable fetching of associated keywords for each document
    Can be used as [+keywords+] or as a tagData source
    
    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
*/

$randomize = (isset($randomize))? $randomize : 0;
/*  
    Param: randomize
    
    Purpose: 
    Randomize the order of the output
    
    Options:
    0 - off
    1 - on
    Any MODx field or TV for weighted random
    
    Default:
    0 - off
*/
$save = (isset($save))? $save : 0;
/*
    Param: save

    Purpose:
    Saves the ditto object and results set to placeholders
    for use by other snippets

    Options:
    0 - off; returns output
    1 - remaining; returns output
    2 - all;
    3 - all; returns ph only

    Default:
        0 - off; returns output
*/
$templates = array(
    "default" => "@CODE".$_lang[\'default_template\'],
    "base" => $tpl,
    "alt" => $tplAlt,
    "first" => $tplFirst,
    "last" => $tplLast,
    "current" => $tplCurrentDocument
);
/*
    Param: tpl

    Purpose:
    User defined chunk to format the documents 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    [LANG]
*/
/*
    Param: tplAlt

    Purpose:
    User defined chunk to format every other document

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplFirst

    Purpose:
    User defined chunk to format the first document 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplLast

    Purpose:
    User defined chunk to format the last document 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplCurrentDocument

    Purpose:
    User defined chunk to format the current document

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
$orderBy = $ditto->parseOrderBy($orderBy,$randomize);
/*
    Param: orderBy

    Purpose:
    Sort the result set

    Options:
    Any valid MySQL style orderBy statement

    Default:
    createdon DESC
*/
//-------------------------------------------------------------------- */
$templates = $ditto->template->process($templates);
    // parse the templates for TV\'s and store them for later use

$ditto->setDisplayFields($ditto->template->fields,$hiddenFields);
    // parse hidden fields
    
$ditto->parseFields($placeholders,$seeThruUnpub,$dateSource,$randomize);
    // parse the fields into the field array
    
$documentIDs = $ditto->determineIDs($IDs, $idType, $ditto->fields["backend"]["tv"], $orderBy, $depth, $showPublishedOnly, $seeThruUnpub, $hideFolders, $hidePrivate, $showInMenuOnly, $where, $keywords, $dateSource, $queryLimit, $display, $filter,$paginate, $randomize);
    // retrieves a list of document IDs that meet the criteria and populates the $resources array with them
$count = count($documentIDs);
    // count the number of documents to be retrieved
$count = $count-$offset;
    // handle the offset

if ($count > 0) {
    // if documents are returned continue with execution
    
    $total = ($total == "all") ? $count : min($total,$count);
        // set total equal to count if all documents are to be included
    
    $display = ($display == "all") ? min($count,$total) : min($display,$total);
        // allow show to use all option

    $stop = ($save != "1") ? min($total-$start,$display) : min($count,$total);
        // set initial stop count

    if($paginate == 1) {
        $paginateAlwaysShowLinks = isset($paginateAlwaysShowLinks)? $paginateAlwaysShowLinks : 0;
        /*
            Param: paginateAlwaysShowLinks

            Purpose:
            Determine whether or not to always show previous next links

            Options:
            0 - off
            1 - on

            Default:
            0 - off
        
            Related:
            - <paginate>
            - <paginateSplitterCharacter>
        */
        $paginateSplitterCharacter = isset($paginateSplitterCharacter)? $paginateSplitterCharacter : $_lang[\'button_splitter\'];
        /*
            Param: paginateSplitterCharacter

            Purpose:
            Splitter to use if always show is disabled

            Options:
            Any valid character

            Default:
            [LANG]
        
            Related:
            - <paginate>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePrevious = isset($tplPaginatePrevious)? $ditto->template->fetch($tplPaginatePrevious) : "<a href=\'[+url+]\' class=\'ditto_previous_link\'>[+lang:previous+]</a>";
        /*
            Param: tplPaginatePrevious

            Purpose:
            Template for the previous link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - URL for the previous link
            lang:previous - value of \'prev\' from the language file
        
            Related:
            - <tplPaginateNext>
            - <paginateSplitterCharacter>
        */
        $tplPaginateNext = isset($tplPaginateNext)? $ditto->template->fetch($tplPaginateNext) : "<a href=\'[+url+]\' class=\'ditto_next_link\'>[+lang:next+]</a>";
        /*
            Param: tplPaginateNext

            Purpose:
            Template for the next link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - URL for the next link
            lang:next - value of \'next\' from the language file
        
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginateNextOff = isset($tplPaginateNextOff)? $ditto->template->fetch($tplPaginateNextOff) : "<span class=\'ditto_next_off ditto_off\'>[+lang:next+]</span>";
        /*
            Param: tplPaginateNextOff

            Purpose:
            Template for the inside of the next link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            lang:next - value of \'next\' from the language file
        
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePreviousOff = isset($tplPaginatePreviousOff)? $ditto->template->fetch($tplPaginatePreviousOff) : "<span class=\'ditto_previous_off ditto_off\'>[+lang:previous+]</span>";
        /*
            Param: tplPaginatePreviousOff

            Purpose:
            Template for the previous link when it is off

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            lang:previous - value of \'prev\' from the language file
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePage = isset($tplPaginatePage)? $ditto->template->fetch($tplPaginatePage) : "<a class=\'ditto_page\' href=\'[+url+]\'>[+page+]</a>";
        /*
            Param: tplPaginatePage

            Purpose:
            Template for the page link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - url for the page
            page - number of the page
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginateCurrentPage = isset($tplPaginateCurrentPage)? $ditto->template->fetch($tplPaginateCurrentPage) : "<span class=\'ditto_currentpage\'>[+page+]</span>";
        /*
            Param: tplPaginateCurrentPage

            Purpose:
            Template for the current page link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            page - number of the page
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        
        $ditto->paginate($start, $stop, $total, $display, $tplPaginateNext, $tplPaginatePrevious, $tplPaginateNextOff, $tplPaginatePreviousOff, $tplPaginatePage, $tplPaginateCurrentPage, $paginateAlwaysShowLinks, $paginateSplitterCharacter);
            // generate the pagination placeholders
    }

    $dbFields = $ditto->fields["display"]["db"];
        // get the database fields
    $TVs = $ditto->fields["display"]["tv"];
        // get the TVs
    
    switch($orderBy[\'parsed\'][0][1]) {
        case "DESC":
            $stop = ($ditto->prefetch === false) ? $stop + $start + $offset : $stop + $offset; 
            $start += $offset;
        break;
        case "ASC":
            $start += $offset;
            $stop += $start;
        break;
    }

    if ($ditto->prefetch !== false) {
        $documentIDs = array_slice($documentIDs,$start,$stop);
            // set the document IDs equal to the trimmed array
        $dbFields = array_diff($dbFields,$ditto->prefetch["fields"]["db"]);
            // calculate the difference between the database fields and those already prefetched
        $dbFields[] = "id";
            // append id to the db fields array
        $TVs = array_diff($TVs,$ditto->prefetch["fields"]["tv"]);
            // calculate the difference between the tv fields and those already prefetched
        $start = 0;
        $stop = min($display,($queryLimit != 0) ? $queryLimit : $display,count($documentIDs));
    } else {
        $queryLimit = ($queryLimit == 0) ? "" : $queryLimit;
    }
    
    $resource = $ditto->getDocuments($documentIDs, $dbFields, $TVs, $orderBy, $showPublishedOnly, 0, $hidePrivate, $where, $queryLimit, $keywords, $randomize, $dateSource);
        // retrieves documents
    $output = $header;
        // initialize the output variable and send the header

    if ($resource) {
        if ($randomize != "0" && $randomize != "1") {
            $resource = $ditto->weightedRandom($resource,$randomize,$stop);
                // randomize the documents
        }
        
        $resource = array_values($resource);

        for ($x=$start;$x<$stop;$x++) {
            $template = $ditto->template->determine($templates,$x,0,$stop,$resource[$x]["id"]);
                // choose the template to use and set the code of that template to the template variable
            $renderedOutput = $ditto->render($resource[$x], $template, $removeChunk, $dateSource, $dateFormat, $placeholders,$phx,abs($start-$x));
                // render the output using the correct template, in the correct format and language
            $modx->setPlaceholder($dittoID."item[".abs($start-$x)."]",$renderedOutput);
            /*
                Placeholder: item[x]

                Content:
                Individual items rendered output
            */
            $output .= $renderedOutput;
                // send the rendered output to the buffer
        }
    } else {
        $output .= $ditto->noResults($noResults,$paginate);
            // if no documents are found return a no documents found string
    }
    $output .= $footer;
        // send the footer

    // ---------------------------------------------------
    // Save Object
    // ---------------------------------------------------

    if($save) {
        $modx->setPlaceholder($dittoID."ditto_object", $ditto);
        $modx->setPlaceholder($dittoID."ditto_resource", ($save == "1") ? array_slice($resource,$display) : $resource);
    }
} else {
    $output = $header.$ditto->noResults($noResults,$paginate).$footer;
}
// ---------------------------------------------------
// Handle Debugging
// ---------------------------------------------------

if ($debug == 1) {
    $ditto_params =& $modx->event_params;
    if (!isset($_GET["ditto_".$dittoID."debug"])) {
    $_SESSION["ditto_debug_$dittoID"] = $ditto->debug->render_popup($ditto, $ditto_base, $ditto_version, $ditto_params, $documentIDs, array("db"=>$dbFields,"tv"=>$TVs), $display, $templates, $orderBy, $start, $stop, $total,$filter,$resource);
    }
    if (isset($_GET["ditto_".$dittoID."debug"])) {
        switch ($_GET["ditto_".$dittoID."debug"]) {
            case "open" :
                exit($_SESSION["ditto_debug_$dittoID"]);
            break;
            case "save" :
                $ditto->debug->save($_SESSION["ditto_debug_$dittoID"],"ditto".strtolower($ditto_version)."_debug_doc".$modx->documentIdentifier.".html");
            break;
        }
    } else {
        $output = $ditto->debug->render_link($dittoID,$ditto_base).$output;
    }
}

return ($save != 3) ? $output : "";';
$s['Ditto'] = '/* Description:
 *      Aggregates documents to create blogs, article/news
 *      collections, and more,with full support for templating.
 * 
 * Author: 
 *      Mark Kaplan for MODx CMF
*/

//---Core Settings---------------------------------------------------- //

$ditto_version = "2.1.0";
    // Ditto version being executed

$ditto_base = isset($ditto_base) ? $modx->config[\'base_path\'].$ditto_base : $modx->config[\'base_path\']."assets/snippets/ditto/";
/*
    Param: ditto_base
    
    Purpose:
    Location of Ditto files

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    [(base_path)]assets/snippets/ditto/
*/
$dittoID = (!isset($id)) ? "" : $id."_";
$GLOBALS["dittoID"] = $dittoID;
/*
    Param: id

    Purpose:
    Unique ID for this Ditto instance for connection with other scripts (like Reflect) and unique URL parameters

    Options:
    Any combination of characters a-z, underscores, and numbers 0-9
    
    Note:
    This is case sensitive

    Default:
    "" - blank
*/      
$language = (isset($language))? $language : $modx->config[\'manager_language\'];
if (!file_exists($ditto_base."lang/".$language.".inc.php")) {
    $language ="english";
}
/*
    Param: language

    Purpose:
    language for defaults, debug, and error messages

    Options:
    Any language name with a corresponding file in the &ditto_base/lang folder

    Default:
    "english"
*/
$format = (isset($format)) ? strtolower($format) : "html" ;
/*
    Param: format

    Purpose:
    Output format to use

    Options:
    - "html"
    - "json"
    - "xml"
    - "atom"
    - "rss"

    Default:
    "html"
*/
$config = (isset($config)) ? $config : "default";
/*
    Param: config

    Purpose:
    Load a custom configuration

    Options:
    "default" - default blank config file
    CONFIG_NAME - Other configs installed in the configs folder or in any folder within the MODx base path via @FILE

    Default:
    "default"
    
    Related:
    - <extenders>
*/
$debug = isset($debug)? $debug : 0;
/*
    Param: debug

    Purpose:
    Output debugging information

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <debug>
*/
$phx = (isset($phx))? $phx : 1;
/*
    Param: phx

    Purpose:
    Use PHx formatting

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/      
$extenders = isset($extenders) ? explode(",",$extenders) : array();
/*
    Param: extenders

    Purpose:
    Load an extender which adds functionality to Ditto

    Options:
    Any extender in the extenders folder or in any folder within the MODx base path via @FILE

    Default:
    [NULL]

    Related:
    - <config>
*/
    // Variable: extenders
    // Array that can be added to by configs or formats to load that extender
    
$placeholders = array();
    // Variable: placeholders
    // Initialize custom placeholders array for configs or extenders to add to

$filters = array("custom"=>array(),"parsed"=>array());
    // Variable: filters
    // Holds both the custom filters array for configs or extenders to add to 
    // and the parsed filters array. To add to this array, use the following format
    // (code)
    // $filters["parsed"][] = array("name" => array("source"=>$source,"value"=>$value,"mode"=>$mode));
    // $filters["custom"][] = array("source","callback_function");

$orderBy = array(\'parsed\'=>array(),\'custom\'=>array(),\'unparsed\'=>$orderBy);
    // Variable: orderBy
    // An array that holds all criteria to sort the result set by. 
    // Note that using a custom sort will disable all other sorting.
    // (code)
    // $orderBy["parsed"][] = array("sortBy","sortDir");
    // $orderBy["custom"][] = array("sortBy","callback_function");
        
//---Includes-------------------------------------------------------- //

$files = array (
    "base_language" => $ditto_base."lang/english.inc.php",
    "language" => $ditto_base."lang/$language.inc.php",
    "main_class" => $ditto_base."classes/ditto.class.inc.php",
    "template_class" => $ditto_base."classes/template.class.inc.php",
    "filter_class" => $ditto_base."classes/filter.class.inc.php",
    "format" => $ditto_base."formats/$format.format.inc.php",
    "config" => $ditto_base."configs/default.config.php",
    "user_config" => (substr($config, 0, 5) != "@FILE") ? $ditto_base."configs/$config.config.php" : $modx->config[\'base_path\'].trim(substr($config, 5))
);

if ($phx == 1) {
    $files["prePHx_class"] = $ditto_base."classes/phx.pre.class.inc.php";
}
if (isset($randomize)) {
    $files["randomize_class"] = $ditto_base."classes/random.class.inc.php";
}
if ($debug == 1) {
    $files["modx_debug_class"] = $ditto_base."debug/modxDebugConsole.class.php";
    $files["debug_class"] = $ditto_base."classes/debug.class.inc.php";
    $files["debug_templates"] = $ditto_base."debug/debug.templates.php";
}

$files = array_unique($files);
foreach ($files as $filename => $filevalue) {
    if (file_exists($filevalue) && strpos($filename,"class")) {
        include_once($filevalue);
    } else if (file_exists($filevalue)) {
        include($filevalue);
    } else if ($filename == "language") {
        $modx->logEvent(1, 3, "Language file does not exist Please check: " . $filevalue, "Ditto " . $ditto_version);
        return "Language file does not exist Please check: " . $filevalue;
    } else {
        $modx->logEvent(1, 3, $filevalue . " " . $_lang[\'file_does_not_exist\'], "Ditto " . $ditto_version);
        return $filevalue . " " . $_lang[\'file_does_not_exist\'];
    }
}

//---Initiate Class-------------------------------------------------- //
if (class_exists(\'ditto\')) {
    $ditto = new ditto($dittoID,$format,$_lang,$dbg_templates);
        // create a new Ditto instance in the specified format and language with the requested debug level
} else {
    $modx->logEvent(1,3,$_lang[\'invalid_class\'],"Ditto ".$ditto_version);
    return $_lang[\'invalid_class\'];
}

//---Initiate Extenders---------------------------------------------- //
if (isset($tagData)) {
    $extenders[] = "tagging";
}
if(count($extenders) > 0) {
    $extenders = array_unique($extenders);
    foreach ($extenders as $extender) {
            if(substr($extender, 0, 5) != "@FILE") {
                $extender_path = $ditto_base."extenders/".$extender.".extender.inc.php";                
            } else {
                $extender_path = $modx->config[\'base_path\'].trim(substr($extender, 5));
            }
            
            if (file_exists($extender_path)){
                include($extender_path);
            } else {
                $modx->logEvent(1, 3, $extender . " " . $_lang[\'extender_does_not_exist\'], "Ditto ".$ditto_version);
                return $extender . " " . $_lang[\'extender_does_not_exist\'];
            }       
    }   
}

//---Parameters------------------------------------------------------- /*
if (isset($startID)) {$parents = $startID;}
if (isset($summarize)) {$display = $summarize;}
if (isset($limit)) {$queryLimit = $limit;}
if (isset($sortBy) || isset($sortDir) || is_null($orderBy[\'unparsed\'])) {
    $sortDir = isset($sortDir) ? strtoupper($sortDir) : \'DESC\';
    $sortBy = isset($sortBy) ? $sortBy : "createdon";
    $orderBy[\'parsed\'][]=array($sortBy,$sortDir);
}
    // Allow backwards compatibility

$idType = isset($documents) ? "documents" : "parents";
    // Variable: idType
    // type of IDs provided; can be either parents or documents

$parents = isset($parents) ? $ditto->cleanIDs($parents) : $modx->documentIdentifier;

/*
    Param: parents

    Purpose:
    IDs of containers for Ditto to retrieve their children to &depth depth

    Options:
    Any valid MODx document marked as a container

    Default:
    Current MODx Document

    Related:
    - <documents>
    - <depth>
*/
$documents = isset($documents) ? $ditto->cleanIDs($documents) : false;
/*
    Param: documents

    Purpose:
    IDs of documents for Ditto to retrieve

    Options:
    Any valid MODx document marked as a container

    Default:
    None

    Related:
    - <parents>
*/

$IDs = ($idType == "parents") ? $parents : $documents;
    // Variable: IDs
    // Internal variable which holds the set of IDs for Ditto to fetch

$depth = isset($depth) ? $depth : 1;
/*
    Param: depth

    Purpose:
    Number of levels deep to retrieve documents

    Options:
    Any number greater than or equal to 1
    0 - infinite depth

    Default:
    1

    Related:
    - <seeThruUnpub>
*/
$paginate = isset($paginate)? $paginate : 0;
/*
    Param: paginate

    Purpose:
    Paginate the results set into pages of &display length.
    Use &total to limit the number of documents retreived.

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <paginateAlwaysShowLinks>
    - <paginateSplitterCharacter>
    - <display>
*/
$dateSource = isset($dateSource) ? $dateSource : "createdon";
/*
    Param: dateSource

    Purpose:
    Source of the [+date+] placeholder

    Options:
    # - Any UNIX timestamp from MODx fields or TVs such as createdon, pub_date, or editedon
    
    Default:
    "createdon"
    
    Related:
    - <dateFormat>
*/
$dateFormat = isset($dateFormat)? $dateFormat : $_lang["dateFormat"];
/*
    Param: dateFormat

    Purpose:
    Format the [+date+] placeholder in human readable form

    Options:
    Any PHP valid strftime option

    Default:
    [LANG]
    
    Related:
    - <dateSource>
*/
$display = isset($display) ? $display : "all";
/*
    Param: display

    Purpose:
    Number of documents to display in the results

    Options:
    # - Any number
    "all" - All documents found

    Default:
    "all"
    
    Related:
    - <queryLimit>
    - <total>
*/
$total = isset($total) ? $total : "all";
/*
    Param: total

    Purpose:
    Number of documents to retrieve
    
    Options:
    # - Any number
    "all" - All documents found

    Default:
    "all" - All documents found
    
    Related:
    - <display>
    - <queryLimit>
*/
$showPublishedOnly = isset($showPublishedOnly) ? $showPublishedOnly : 1;
/*
    Param: showPublishedOnly

    Purpose:
    Show only published documents

    Options:
    0 - show only unpublished documents
    1 - show both published and unpublished documents
    
    Default:
    1 - show both published and unpublished documents
    
    Related:
    - <seeThruUnpub>
    - <hideFolders>
    - <showPublishedOnly>
    - <where>
*/
$showInMenuOnly = isset($showInMenuOnly) ? $showInMenuOnly : 0;
/*
    Param: showInMenuOnly

    Purpose:
    Show only documents visible in the menu

    Options:
    0 - show all documents
    1 - show only documents with the show in menu flag checked
    
    Default:
    0 - show all documents
    
    Related:
    - <seeThruUnpub>
    - <hideFolders>
    - <where>
*/
$hideFolders = isset($hideFolders)? $hideFolders : 0;
/*
    Param: hideFolders

    Purpose:
    Don\'t show folders in the returned results

    Options:
    0 - keep folders
    1 - remove folders
    
    Default:
    0 - keep folders
    
    Related:
    - <seeThruUnpub>
    - <showInMenuOnly>
    - <where>
*/
$hidePrivate = isset($hidePrivate)? $hidePrivate : 1;
/*
    Param: hidePrivate

    Purpose:
    Don\'t show documents the guest or user does not have permission to see

    Options:
    0 - show private documents
    1 - hide private documents
    
    Default:
    1 - hide private documents
    
    Related:
    - <seeThruUnpub>
    - <showInMenuOnly>
    - <where>
*/
$seeThruUnpub = (isset($seeThruUnpub))? $seeThruUnpub : 1 ;
/*
    Param: seeThruUnpub

    Purpose:
    See through unpublished folders to retrive their children
    Used when depth is greater than 1

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <hideFolders>
    - <showInMenuOnly>
    - <where>
*/
$queryLimit = (isset($queryLimit))? $queryLimit : 0;
/*
    Param: queryLimit

    Purpose:
    Number of documents to retrieve from the database, same as MySQL LIMIT

    Options:
    # - Any number
    0 - automatic

    Default:
    0 - automatic
    
    Related:
    - <where>
*/
$where = (isset($where))? $where : "";
/*
    Param: where

    Purpose:
    Custom MySQL WHERE statement

    Options:
    A valid MySQL WHERE statement using only document object items (no TVs)

    Default:
    [NULL]
    
    Related:
    - <queryLimit>
*/
$noResults = isset($noResults)? $ditto->getParam($noResults,"no_documents") : $_lang[\'no_documents\'];
/*
    Param: noResults

    Purpose:
    Text or chunk to display when there are no results

    Options:
    Any valid chunk name or text

    Default:
    [LANG]
*/
$removeChunk = isset($removeChunk) ? explode(",",$removeChunk) : false;
/*
    Param: removeChunk

    Purpose:
    Name of chunks to be stripped from content separated by commas
    - Commonly used to remove comments

    Options:
    Any valid chunkname that appears in the output

    Default:
    [NULL]
*/
$hiddenFields = isset($hiddenFields) ? explode(",",$hiddenFields) : false;
/*
    Param: hiddenFields

    Purpose:
    Allow Ditto to retrieve fields its template parser cannot handle such as nested placeholders and [*fields*]

    Options:
    Any valid MODx fieldnames or TVs comma separated

    Default:
    [NULL]
*/
$offset = isset($start) ? $start : 0;
$start = (isset($_GET[$dittoID.\'start\'])) ? intval($_GET[$dittoID.\'start\']) : 0;
/*
    Param: start

    Purpose:
    Number of documents to skip in the results
    
    Options:
    Any number

    Default:
    0
*/
$globalFilterDelimiter = isset($globalFilterDelimiter) ? $globalFilterDelimiter : "|";
/*
    Param: globalFilterDelimiter

    Purpose:
    Filter delimiter used to separate filters in the filter string
    
    Options:
    Any character not used in the filters

    Default:
    "|"
    
    Related:
    - <localFilterDelimiter>
    - <filter>
    - <parseFilters>
*/
    
$localFilterDelimiter = isset($localFilterDelimiter) ? $localFilterDelimiter : ",";
/*
    Param: localFilterDelimiter

    Purpose:
    Delimiter used to separate individual parameters within each filter string
    
    Options:
    Any character not used in the filter itself

    Default:
    ","
    
    Related:
    - <globalFilterDelimiter>
    - <filter>
    - <parseFilters>
*/
$filters["custom"] = isset($cFilters) ? array_merge($filters["custom"],$cFilters) : $filters["custom"];
$filters["parsed"] = isset($parsedFilters) ? array_merge($filters["parsed"],$parsedFilters) : $filters["parsed"];
    // handle 2.0.0 compatibility
$filter = (isset($filter) || ($filters["custom"] != false) || ($filters["parsed"] != false)) ? $ditto->parseFilters($filter,$filters["custom"],$filters["parsed"],$globalFilterDelimiter,$localFilterDelimiter) : false;
/*
    Param: filter

    Purpose:
    Removes items not meeting a critera. Thus, if pagetitle == joe then it will be removed.
    Use in the format field,criteria,mode with the comma being the local delimiter

    *Mode* *Meaning*
    
    1 - !=
    2 - ==
    3 - <
    4 - >
    5 - <=
    6 - >=
    7 - Text not in field value
    8 - Text in field value
    9 - case insenstive version of #7
    10 - case insenstive version of #8
    11 - checks leading character of the field
    
    @EVAL:
        @EVAL in filters works the same as it does in MODx exect it can only be used 
        with basic filtering, not custom filtering (tagging, etc). Make sure that
        you return the value you wish Ditto to filter by and that the code is valid PHP.

    Default:
    [NULL]
    
    Related:
    - <localFilterDelimiter>
    - <globalFilterDelimiter>
    - <parseFilters>
*/
$keywords = (isset($keywords))? $keywords : 0;
/*  
    Param: keywords
    
    Purpose: 
    Enable fetching of associated keywords for each document
    Can be used as [+keywords+] or as a tagData source
    
    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
*/

$randomize = (isset($randomize))? $randomize : 0;
/*  
    Param: randomize
    
    Purpose: 
    Randomize the order of the output
    
    Options:
    0 - off
    1 - on
    Any MODx field or TV for weighted random
    
    Default:
    0 - off
*/
$save = (isset($save))? $save : 0;
/*
    Param: save

    Purpose:
    Saves the ditto object and results set to placeholders
    for use by other snippets

    Options:
    0 - off; returns output
    1 - remaining; returns output
    2 - all;
    3 - all; returns ph only

    Default:
        0 - off; returns output
*/
$templates = array(
    "default" => "@CODE".$_lang[\'default_template\'],
    "base" => $tpl,
    "alt" => $tplAlt,
    "first" => $tplFirst,
    "last" => $tplLast,
    "current" => $tplCurrentDocument
);
/*
    Param: tpl

    Purpose:
    User defined chunk to format the documents 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    [LANG]
*/
/*
    Param: tplAlt

    Purpose:
    User defined chunk to format every other document

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplFirst

    Purpose:
    User defined chunk to format the first document 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplLast

    Purpose:
    User defined chunk to format the last document 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplCurrentDocument

    Purpose:
    User defined chunk to format the current document

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
$orderBy = $ditto->parseOrderBy($orderBy,$randomize);
/*
    Param: orderBy

    Purpose:
    Sort the result set

    Options:
    Any valid MySQL style orderBy statement

    Default:
    createdon DESC
*/
//-------------------------------------------------------------------- */
$templates = $ditto->template->process($templates);
    // parse the templates for TV\'s and store them for later use

$ditto->setDisplayFields($ditto->template->fields,$hiddenFields);
    // parse hidden fields
    
$ditto->parseFields($placeholders,$seeThruUnpub,$dateSource,$randomize);
    // parse the fields into the field array
    
$documentIDs = $ditto->determineIDs($IDs, $idType, $ditto->fields["backend"]["tv"], $orderBy, $depth, $showPublishedOnly, $seeThruUnpub, $hideFolders, $hidePrivate, $showInMenuOnly, $where, $keywords, $dateSource, $queryLimit, $display, $filter,$paginate, $randomize);
    // retrieves a list of document IDs that meet the criteria and populates the $resources array with them
$count = count($documentIDs);
    // count the number of documents to be retrieved
$count = $count-$offset;
    // handle the offset

if ($count > 0) {
    // if documents are returned continue with execution
    
    $total = ($total == "all") ? $count : min($total,$count);
        // set total equal to count if all documents are to be included
    
    $display = ($display == "all") ? min($count,$total) : min($display,$total);
        // allow show to use all option

    $stop = ($save != "1") ? min($total-$start,$display) : min($count,$total);
        // set initial stop count

    if($paginate == 1) {
        $paginateAlwaysShowLinks = isset($paginateAlwaysShowLinks)? $paginateAlwaysShowLinks : 0;
        /*
            Param: paginateAlwaysShowLinks

            Purpose:
            Determine whether or not to always show previous next links

            Options:
            0 - off
            1 - on

            Default:
            0 - off
        
            Related:
            - <paginate>
            - <paginateSplitterCharacter>
        */
        $paginateSplitterCharacter = isset($paginateSplitterCharacter)? $paginateSplitterCharacter : $_lang[\'button_splitter\'];
        /*
            Param: paginateSplitterCharacter

            Purpose:
            Splitter to use if always show is disabled

            Options:
            Any valid character

            Default:
            [LANG]
        
            Related:
            - <paginate>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePrevious = isset($tplPaginatePrevious)? $ditto->template->fetch($tplPaginatePrevious) : "<a href=\'[+url+]\' class=\'ditto_previous_link\'>[+lang:previous+]</a>";
        /*
            Param: tplPaginatePrevious

            Purpose:
            Template for the previous link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - URL for the previous link
            lang:previous - value of \'prev\' from the language file
        
            Related:
            - <tplPaginateNext>
            - <paginateSplitterCharacter>
        */
        $tplPaginateNext = isset($tplPaginateNext)? $ditto->template->fetch($tplPaginateNext) : "<a href=\'[+url+]\' class=\'ditto_next_link\'>[+lang:next+]</a>";
        /*
            Param: tplPaginateNext

            Purpose:
            Template for the next link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - URL for the next link
            lang:next - value of \'next\' from the language file
        
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginateNextOff = isset($tplPaginateNextOff)? $ditto->template->fetch($tplPaginateNextOff) : "<span class=\'ditto_next_off ditto_off\'>[+lang:next+]</span>";
        /*
            Param: tplPaginateNextOff

            Purpose:
            Template for the inside of the next link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            lang:next - value of \'next\' from the language file
        
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePreviousOff = isset($tplPaginatePreviousOff)? $ditto->template->fetch($tplPaginatePreviousOff) : "<span class=\'ditto_previous_off ditto_off\'>[+lang:previous+]</span>";
        /*
            Param: tplPaginatePreviousOff

            Purpose:
            Template for the previous link when it is off

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            lang:previous - value of \'prev\' from the language file
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePage = isset($tplPaginatePage)? $ditto->template->fetch($tplPaginatePage) : "<a class=\'ditto_page\' href=\'[+url+]\'>[+page+]</a>";
        /*
            Param: tplPaginatePage

            Purpose:
            Template for the page link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - url for the page
            page - number of the page
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginateCurrentPage = isset($tplPaginateCurrentPage)? $ditto->template->fetch($tplPaginateCurrentPage) : "<span class=\'ditto_currentpage\'>[+page+]</span>";
        /*
            Param: tplPaginateCurrentPage

            Purpose:
            Template for the current page link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            page - number of the page
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        
        $ditto->paginate($start, $stop, $total, $display, $tplPaginateNext, $tplPaginatePrevious, $tplPaginateNextOff, $tplPaginatePreviousOff, $tplPaginatePage, $tplPaginateCurrentPage, $paginateAlwaysShowLinks, $paginateSplitterCharacter);
            // generate the pagination placeholders
    }

    $dbFields = $ditto->fields["display"]["db"];
        // get the database fields
    $TVs = $ditto->fields["display"]["tv"];
        // get the TVs
    
    switch($orderBy[\'parsed\'][0][1]) {
        case "DESC":
            $stop = ($ditto->prefetch === false) ? $stop + $start + $offset : $stop + $offset; 
            $start += $offset;
        break;
        case "ASC":
            $start += $offset;
            $stop += $start;
        break;
    }

    if ($ditto->prefetch !== false) {
        $documentIDs = array_slice($documentIDs,$start,$stop);
            // set the document IDs equal to the trimmed array
        $dbFields = array_diff($dbFields,$ditto->prefetch["fields"]["db"]);
            // calculate the difference between the database fields and those already prefetched
        $dbFields[] = "id";
            // append id to the db fields array
        $TVs = array_diff($TVs,$ditto->prefetch["fields"]["tv"]);
            // calculate the difference between the tv fields and those already prefetched
        $start = 0;
        $stop = min($display,($queryLimit != 0) ? $queryLimit : $display,count($documentIDs));
    } else {
        $queryLimit = ($queryLimit == 0) ? "" : $queryLimit;
    }
    
    $resource = $ditto->getDocuments($documentIDs, $dbFields, $TVs, $orderBy, $showPublishedOnly, 0, $hidePrivate, $where, $queryLimit, $keywords, $randomize, $dateSource);
        // retrieves documents
    $output = $header;
        // initialize the output variable and send the header

    if ($resource) {
        if ($randomize != "0" && $randomize != "1") {
            $resource = $ditto->weightedRandom($resource,$randomize,$stop);
                // randomize the documents
        }
        
        $resource = array_values($resource);

        for ($x=$start;$x<$stop;$x++) {
            $template = $ditto->template->determine($templates,$x,0,$stop,$resource[$x]["id"]);
                // choose the template to use and set the code of that template to the template variable
            $renderedOutput = $ditto->render($resource[$x], $template, $removeChunk, $dateSource, $dateFormat, $placeholders,$phx,abs($start-$x));
                // render the output using the correct template, in the correct format and language
            $modx->setPlaceholder($dittoID."item[".abs($start-$x)."]",$renderedOutput);
            /*
                Placeholder: item[x]

                Content:
                Individual items rendered output
            */
            $output .= $renderedOutput;
                // send the rendered output to the buffer
        }
    } else {
        $output .= $ditto->noResults($noResults,$paginate);
            // if no documents are found return a no documents found string
    }
    $output .= $footer;
        // send the footer

    // ---------------------------------------------------
    // Save Object
    // ---------------------------------------------------

    if($save) {
        $modx->setPlaceholder($dittoID."ditto_object", $ditto);
        $modx->setPlaceholder($dittoID."ditto_resource", ($save == "1") ? array_slice($resource,$display) : $resource);
    }
} else {
    $output = $header.$ditto->noResults($noResults,$paginate).$footer;
}
// ---------------------------------------------------
// Handle Debugging
// ---------------------------------------------------

if ($debug == 1) {
    $ditto_params =& $modx->event_params;
    if (!isset($_GET["ditto_".$dittoID."debug"])) {
    $_SESSION["ditto_debug_$dittoID"] = $ditto->debug->render_popup($ditto, $ditto_base, $ditto_version, $ditto_params, $documentIDs, array("db"=>$dbFields,"tv"=>$TVs), $display, $templates, $orderBy, $start, $stop, $total,$filter,$resource);
    }
    if (isset($_GET["ditto_".$dittoID."debug"])) {
        switch ($_GET["ditto_".$dittoID."debug"]) {
            case "open" :
                exit($_SESSION["ditto_debug_$dittoID"]);
            break;
            case "save" :
                $ditto->debug->save($_SESSION["ditto_debug_$dittoID"],"ditto".strtolower($ditto_version)."_debug_doc".$modx->documentIdentifier.".html");
            break;
        }
    } else {
        $output = $ditto->debug->render_link($dittoID,$ditto_base).$output;
    }
}

return ($save != 3) ? $output : "";';
$s['Ditto'] = '/* Description:
 *      Aggregates documents to create blogs, article/news
 *      collections, and more,with full support for templating.
 * 
 * Author: 
 *      Mark Kaplan for MODx CMF
*/

//---Core Settings---------------------------------------------------- //

$ditto_version = "2.1.0";
    // Ditto version being executed

$ditto_base = isset($ditto_base) ? $modx->config[\'base_path\'].$ditto_base : $modx->config[\'base_path\']."assets/snippets/ditto/";
/*
    Param: ditto_base
    
    Purpose:
    Location of Ditto files

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    [(base_path)]assets/snippets/ditto/
*/
$dittoID = (!isset($id)) ? "" : $id."_";
$GLOBALS["dittoID"] = $dittoID;
/*
    Param: id

    Purpose:
    Unique ID for this Ditto instance for connection with other scripts (like Reflect) and unique URL parameters

    Options:
    Any combination of characters a-z, underscores, and numbers 0-9
    
    Note:
    This is case sensitive

    Default:
    "" - blank
*/      
$language = (isset($language))? $language : $modx->config[\'manager_language\'];
if (!file_exists($ditto_base."lang/".$language.".inc.php")) {
    $language ="english";
}
/*
    Param: language

    Purpose:
    language for defaults, debug, and error messages

    Options:
    Any language name with a corresponding file in the &ditto_base/lang folder

    Default:
    "english"
*/
$format = (isset($format)) ? strtolower($format) : "html" ;
/*
    Param: format

    Purpose:
    Output format to use

    Options:
    - "html"
    - "json"
    - "xml"
    - "atom"
    - "rss"

    Default:
    "html"
*/
$config = (isset($config)) ? $config : "default";
/*
    Param: config

    Purpose:
    Load a custom configuration

    Options:
    "default" - default blank config file
    CONFIG_NAME - Other configs installed in the configs folder or in any folder within the MODx base path via @FILE

    Default:
    "default"
    
    Related:
    - <extenders>
*/
$debug = isset($debug)? $debug : 0;
/*
    Param: debug

    Purpose:
    Output debugging information

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <debug>
*/
$phx = (isset($phx))? $phx : 1;
/*
    Param: phx

    Purpose:
    Use PHx formatting

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/      
$extenders = isset($extenders) ? explode(",",$extenders) : array();
/*
    Param: extenders

    Purpose:
    Load an extender which adds functionality to Ditto

    Options:
    Any extender in the extenders folder or in any folder within the MODx base path via @FILE

    Default:
    [NULL]

    Related:
    - <config>
*/
    // Variable: extenders
    // Array that can be added to by configs or formats to load that extender
    
$placeholders = array();
    // Variable: placeholders
    // Initialize custom placeholders array for configs or extenders to add to

$filters = array("custom"=>array(),"parsed"=>array());
    // Variable: filters
    // Holds both the custom filters array for configs or extenders to add to 
    // and the parsed filters array. To add to this array, use the following format
    // (code)
    // $filters["parsed"][] = array("name" => array("source"=>$source,"value"=>$value,"mode"=>$mode));
    // $filters["custom"][] = array("source","callback_function");

$orderBy = array(\'parsed\'=>array(),\'custom\'=>array(),\'unparsed\'=>$orderBy);
    // Variable: orderBy
    // An array that holds all criteria to sort the result set by. 
    // Note that using a custom sort will disable all other sorting.
    // (code)
    // $orderBy["parsed"][] = array("sortBy","sortDir");
    // $orderBy["custom"][] = array("sortBy","callback_function");
        
//---Includes-------------------------------------------------------- //

$files = array (
    "base_language" => $ditto_base."lang/english.inc.php",
    "language" => $ditto_base."lang/$language.inc.php",
    "main_class" => $ditto_base."classes/ditto.class.inc.php",
    "template_class" => $ditto_base."classes/template.class.inc.php",
    "filter_class" => $ditto_base."classes/filter.class.inc.php",
    "format" => $ditto_base."formats/$format.format.inc.php",
    "config" => $ditto_base."configs/default.config.php",
    "user_config" => (substr($config, 0, 5) != "@FILE") ? $ditto_base."configs/$config.config.php" : $modx->config[\'base_path\'].trim(substr($config, 5))
);

if ($phx == 1) {
    $files["prePHx_class"] = $ditto_base."classes/phx.pre.class.inc.php";
}
if (isset($randomize)) {
    $files["randomize_class"] = $ditto_base."classes/random.class.inc.php";
}
if ($debug == 1) {
    $files["modx_debug_class"] = $ditto_base."debug/modxDebugConsole.class.php";
    $files["debug_class"] = $ditto_base."classes/debug.class.inc.php";
    $files["debug_templates"] = $ditto_base."debug/debug.templates.php";
}

$files = array_unique($files);
foreach ($files as $filename => $filevalue) {
    if (file_exists($filevalue) && strpos($filename,"class")) {
        include_once($filevalue);
    } else if (file_exists($filevalue)) {
        include($filevalue);
    } else if ($filename == "language") {
        $modx->logEvent(1, 3, "Language file does not exist Please check: " . $filevalue, "Ditto " . $ditto_version);
        return "Language file does not exist Please check: " . $filevalue;
    } else {
        $modx->logEvent(1, 3, $filevalue . " " . $_lang[\'file_does_not_exist\'], "Ditto " . $ditto_version);
        return $filevalue . " " . $_lang[\'file_does_not_exist\'];
    }
}

//---Initiate Class-------------------------------------------------- //
if (class_exists(\'ditto\')) {
    $ditto = new ditto($dittoID,$format,$_lang,$dbg_templates);
        // create a new Ditto instance in the specified format and language with the requested debug level
} else {
    $modx->logEvent(1,3,$_lang[\'invalid_class\'],"Ditto ".$ditto_version);
    return $_lang[\'invalid_class\'];
}

//---Initiate Extenders---------------------------------------------- //
if (isset($tagData)) {
    $extenders[] = "tagging";
}
if(count($extenders) > 0) {
    $extenders = array_unique($extenders);
    foreach ($extenders as $extender) {
            if(substr($extender, 0, 5) != "@FILE") {
                $extender_path = $ditto_base."extenders/".$extender.".extender.inc.php";                
            } else {
                $extender_path = $modx->config[\'base_path\'].trim(substr($extender, 5));
            }
            
            if (file_exists($extender_path)){
                include($extender_path);
            } else {
                $modx->logEvent(1, 3, $extender . " " . $_lang[\'extender_does_not_exist\'], "Ditto ".$ditto_version);
                return $extender . " " . $_lang[\'extender_does_not_exist\'];
            }       
    }   
}

//---Parameters------------------------------------------------------- /*
if (isset($startID)) {$parents = $startID;}
if (isset($summarize)) {$display = $summarize;}
if (isset($limit)) {$queryLimit = $limit;}
if (isset($sortBy) || isset($sortDir) || is_null($orderBy[\'unparsed\'])) {
    $sortDir = isset($sortDir) ? strtoupper($sortDir) : \'DESC\';
    $sortBy = isset($sortBy) ? $sortBy : "createdon";
    $orderBy[\'parsed\'][]=array($sortBy,$sortDir);
}
    // Allow backwards compatibility

$idType = isset($documents) ? "documents" : "parents";
    // Variable: idType
    // type of IDs provided; can be either parents or documents

$parents = isset($parents) ? $ditto->cleanIDs($parents) : $modx->documentIdentifier;

/*
    Param: parents

    Purpose:
    IDs of containers for Ditto to retrieve their children to &depth depth

    Options:
    Any valid MODx document marked as a container

    Default:
    Current MODx Document

    Related:
    - <documents>
    - <depth>
*/
$documents = isset($documents) ? $ditto->cleanIDs($documents) : false;
/*
    Param: documents

    Purpose:
    IDs of documents for Ditto to retrieve

    Options:
    Any valid MODx document marked as a container

    Default:
    None

    Related:
    - <parents>
*/

$IDs = ($idType == "parents") ? $parents : $documents;
    // Variable: IDs
    // Internal variable which holds the set of IDs for Ditto to fetch

$depth = isset($depth) ? $depth : 1;
/*
    Param: depth

    Purpose:
    Number of levels deep to retrieve documents

    Options:
    Any number greater than or equal to 1
    0 - infinite depth

    Default:
    1

    Related:
    - <seeThruUnpub>
*/
$paginate = isset($paginate)? $paginate : 0;
/*
    Param: paginate

    Purpose:
    Paginate the results set into pages of &display length.
    Use &total to limit the number of documents retreived.

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <paginateAlwaysShowLinks>
    - <paginateSplitterCharacter>
    - <display>
*/
$dateSource = isset($dateSource) ? $dateSource : "createdon";
/*
    Param: dateSource

    Purpose:
    Source of the [+date+] placeholder

    Options:
    # - Any UNIX timestamp from MODx fields or TVs such as createdon, pub_date, or editedon
    
    Default:
    "createdon"
    
    Related:
    - <dateFormat>
*/
$dateFormat = isset($dateFormat)? $dateFormat : $_lang["dateFormat"];
/*
    Param: dateFormat

    Purpose:
    Format the [+date+] placeholder in human readable form

    Options:
    Any PHP valid strftime option

    Default:
    [LANG]
    
    Related:
    - <dateSource>
*/
$display = isset($display) ? $display : "all";
/*
    Param: display

    Purpose:
    Number of documents to display in the results

    Options:
    # - Any number
    "all" - All documents found

    Default:
    "all"
    
    Related:
    - <queryLimit>
    - <total>
*/
$total = isset($total) ? $total : "all";
/*
    Param: total

    Purpose:
    Number of documents to retrieve
    
    Options:
    # - Any number
    "all" - All documents found

    Default:
    "all" - All documents found
    
    Related:
    - <display>
    - <queryLimit>
*/
$showPublishedOnly = isset($showPublishedOnly) ? $showPublishedOnly : 1;
/*
    Param: showPublishedOnly

    Purpose:
    Show only published documents

    Options:
    0 - show only unpublished documents
    1 - show both published and unpublished documents
    
    Default:
    1 - show both published and unpublished documents
    
    Related:
    - <seeThruUnpub>
    - <hideFolders>
    - <showPublishedOnly>
    - <where>
*/
$showInMenuOnly = isset($showInMenuOnly) ? $showInMenuOnly : 0;
/*
    Param: showInMenuOnly

    Purpose:
    Show only documents visible in the menu

    Options:
    0 - show all documents
    1 - show only documents with the show in menu flag checked
    
    Default:
    0 - show all documents
    
    Related:
    - <seeThruUnpub>
    - <hideFolders>
    - <where>
*/
$hideFolders = isset($hideFolders)? $hideFolders : 0;
/*
    Param: hideFolders

    Purpose:
    Don\'t show folders in the returned results

    Options:
    0 - keep folders
    1 - remove folders
    
    Default:
    0 - keep folders
    
    Related:
    - <seeThruUnpub>
    - <showInMenuOnly>
    - <where>
*/
$hidePrivate = isset($hidePrivate)? $hidePrivate : 1;
/*
    Param: hidePrivate

    Purpose:
    Don\'t show documents the guest or user does not have permission to see

    Options:
    0 - show private documents
    1 - hide private documents
    
    Default:
    1 - hide private documents
    
    Related:
    - <seeThruUnpub>
    - <showInMenuOnly>
    - <where>
*/
$seeThruUnpub = (isset($seeThruUnpub))? $seeThruUnpub : 1 ;
/*
    Param: seeThruUnpub

    Purpose:
    See through unpublished folders to retrive their children
    Used when depth is greater than 1

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <hideFolders>
    - <showInMenuOnly>
    - <where>
*/
$queryLimit = (isset($queryLimit))? $queryLimit : 0;
/*
    Param: queryLimit

    Purpose:
    Number of documents to retrieve from the database, same as MySQL LIMIT

    Options:
    # - Any number
    0 - automatic

    Default:
    0 - automatic
    
    Related:
    - <where>
*/
$where = (isset($where))? $where : "";
/*
    Param: where

    Purpose:
    Custom MySQL WHERE statement

    Options:
    A valid MySQL WHERE statement using only document object items (no TVs)

    Default:
    [NULL]
    
    Related:
    - <queryLimit>
*/
$noResults = isset($noResults)? $ditto->getParam($noResults,"no_documents") : $_lang[\'no_documents\'];
/*
    Param: noResults

    Purpose:
    Text or chunk to display when there are no results

    Options:
    Any valid chunk name or text

    Default:
    [LANG]
*/
$removeChunk = isset($removeChunk) ? explode(",",$removeChunk) : false;
/*
    Param: removeChunk

    Purpose:
    Name of chunks to be stripped from content separated by commas
    - Commonly used to remove comments

    Options:
    Any valid chunkname that appears in the output

    Default:
    [NULL]
*/
$hiddenFields = isset($hiddenFields) ? explode(",",$hiddenFields) : false;
/*
    Param: hiddenFields

    Purpose:
    Allow Ditto to retrieve fields its template parser cannot handle such as nested placeholders and [*fields*]

    Options:
    Any valid MODx fieldnames or TVs comma separated

    Default:
    [NULL]
*/
$offset = isset($start) ? $start : 0;
$start = (isset($_GET[$dittoID.\'start\'])) ? intval($_GET[$dittoID.\'start\']) : 0;
/*
    Param: start

    Purpose:
    Number of documents to skip in the results
    
    Options:
    Any number

    Default:
    0
*/
$globalFilterDelimiter = isset($globalFilterDelimiter) ? $globalFilterDelimiter : "|";
/*
    Param: globalFilterDelimiter

    Purpose:
    Filter delimiter used to separate filters in the filter string
    
    Options:
    Any character not used in the filters

    Default:
    "|"
    
    Related:
    - <localFilterDelimiter>
    - <filter>
    - <parseFilters>
*/
    
$localFilterDelimiter = isset($localFilterDelimiter) ? $localFilterDelimiter : ",";
/*
    Param: localFilterDelimiter

    Purpose:
    Delimiter used to separate individual parameters within each filter string
    
    Options:
    Any character not used in the filter itself

    Default:
    ","
    
    Related:
    - <globalFilterDelimiter>
    - <filter>
    - <parseFilters>
*/
$filters["custom"] = isset($cFilters) ? array_merge($filters["custom"],$cFilters) : $filters["custom"];
$filters["parsed"] = isset($parsedFilters) ? array_merge($filters["parsed"],$parsedFilters) : $filters["parsed"];
    // handle 2.0.0 compatibility
$filter = (isset($filter) || ($filters["custom"] != false) || ($filters["parsed"] != false)) ? $ditto->parseFilters($filter,$filters["custom"],$filters["parsed"],$globalFilterDelimiter,$localFilterDelimiter) : false;
/*
    Param: filter

    Purpose:
    Removes items not meeting a critera. Thus, if pagetitle == joe then it will be removed.
    Use in the format field,criteria,mode with the comma being the local delimiter

    *Mode* *Meaning*
    
    1 - !=
    2 - ==
    3 - <
    4 - >
    5 - <=
    6 - >=
    7 - Text not in field value
    8 - Text in field value
    9 - case insenstive version of #7
    10 - case insenstive version of #8
    11 - checks leading character of the field
    
    @EVAL:
        @EVAL in filters works the same as it does in MODx exect it can only be used 
        with basic filtering, not custom filtering (tagging, etc). Make sure that
        you return the value you wish Ditto to filter by and that the code is valid PHP.

    Default:
    [NULL]
    
    Related:
    - <localFilterDelimiter>
    - <globalFilterDelimiter>
    - <parseFilters>
*/
$keywords = (isset($keywords))? $keywords : 0;
/*  
    Param: keywords
    
    Purpose: 
    Enable fetching of associated keywords for each document
    Can be used as [+keywords+] or as a tagData source
    
    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
*/

$randomize = (isset($randomize))? $randomize : 0;
/*  
    Param: randomize
    
    Purpose: 
    Randomize the order of the output
    
    Options:
    0 - off
    1 - on
    Any MODx field or TV for weighted random
    
    Default:
    0 - off
*/
$save = (isset($save))? $save : 0;
/*
    Param: save

    Purpose:
    Saves the ditto object and results set to placeholders
    for use by other snippets

    Options:
    0 - off; returns output
    1 - remaining; returns output
    2 - all;
    3 - all; returns ph only

    Default:
        0 - off; returns output
*/
$templates = array(
    "default" => "@CODE".$_lang[\'default_template\'],
    "base" => $tpl,
    "alt" => $tplAlt,
    "first" => $tplFirst,
    "last" => $tplLast,
    "current" => $tplCurrentDocument
);
/*
    Param: tpl

    Purpose:
    User defined chunk to format the documents 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    [LANG]
*/
/*
    Param: tplAlt

    Purpose:
    User defined chunk to format every other document

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplFirst

    Purpose:
    User defined chunk to format the first document 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplLast

    Purpose:
    User defined chunk to format the last document 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplCurrentDocument

    Purpose:
    User defined chunk to format the current document

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
$orderBy = $ditto->parseOrderBy($orderBy,$randomize);
/*
    Param: orderBy

    Purpose:
    Sort the result set

    Options:
    Any valid MySQL style orderBy statement

    Default:
    createdon DESC
*/
//-------------------------------------------------------------------- */
$templates = $ditto->template->process($templates);
    // parse the templates for TV\'s and store them for later use

$ditto->setDisplayFields($ditto->template->fields,$hiddenFields);
    // parse hidden fields
    
$ditto->parseFields($placeholders,$seeThruUnpub,$dateSource,$randomize);
    // parse the fields into the field array
    
$documentIDs = $ditto->determineIDs($IDs, $idType, $ditto->fields["backend"]["tv"], $orderBy, $depth, $showPublishedOnly, $seeThruUnpub, $hideFolders, $hidePrivate, $showInMenuOnly, $where, $keywords, $dateSource, $queryLimit, $display, $filter,$paginate, $randomize);
    // retrieves a list of document IDs that meet the criteria and populates the $resources array with them
$count = count($documentIDs);
    // count the number of documents to be retrieved
$count = $count-$offset;
    // handle the offset

if ($count > 0) {
    // if documents are returned continue with execution
    
    $total = ($total == "all") ? $count : min($total,$count);
        // set total equal to count if all documents are to be included
    
    $display = ($display == "all") ? min($count,$total) : min($display,$total);
        // allow show to use all option

    $stop = ($save != "1") ? min($total-$start,$display) : min($count,$total);
        // set initial stop count

    if($paginate == 1) {
        $paginateAlwaysShowLinks = isset($paginateAlwaysShowLinks)? $paginateAlwaysShowLinks : 0;
        /*
            Param: paginateAlwaysShowLinks

            Purpose:
            Determine whether or not to always show previous next links

            Options:
            0 - off
            1 - on

            Default:
            0 - off
        
            Related:
            - <paginate>
            - <paginateSplitterCharacter>
        */
        $paginateSplitterCharacter = isset($paginateSplitterCharacter)? $paginateSplitterCharacter : $_lang[\'button_splitter\'];
        /*
            Param: paginateSplitterCharacter

            Purpose:
            Splitter to use if always show is disabled

            Options:
            Any valid character

            Default:
            [LANG]
        
            Related:
            - <paginate>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePrevious = isset($tplPaginatePrevious)? $ditto->template->fetch($tplPaginatePrevious) : "<a href=\'[+url+]\' class=\'ditto_previous_link\'>[+lang:previous+]</a>";
        /*
            Param: tplPaginatePrevious

            Purpose:
            Template for the previous link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - URL for the previous link
            lang:previous - value of \'prev\' from the language file
        
            Related:
            - <tplPaginateNext>
            - <paginateSplitterCharacter>
        */
        $tplPaginateNext = isset($tplPaginateNext)? $ditto->template->fetch($tplPaginateNext) : "<a href=\'[+url+]\' class=\'ditto_next_link\'>[+lang:next+]</a>";
        /*
            Param: tplPaginateNext

            Purpose:
            Template for the next link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - URL for the next link
            lang:next - value of \'next\' from the language file
        
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginateNextOff = isset($tplPaginateNextOff)? $ditto->template->fetch($tplPaginateNextOff) : "<span class=\'ditto_next_off ditto_off\'>[+lang:next+]</span>";
        /*
            Param: tplPaginateNextOff

            Purpose:
            Template for the inside of the next link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            lang:next - value of \'next\' from the language file
        
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePreviousOff = isset($tplPaginatePreviousOff)? $ditto->template->fetch($tplPaginatePreviousOff) : "<span class=\'ditto_previous_off ditto_off\'>[+lang:previous+]</span>";
        /*
            Param: tplPaginatePreviousOff

            Purpose:
            Template for the previous link when it is off

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            lang:previous - value of \'prev\' from the language file
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePage = isset($tplPaginatePage)? $ditto->template->fetch($tplPaginatePage) : "<a class=\'ditto_page\' href=\'[+url+]\'>[+page+]</a>";
        /*
            Param: tplPaginatePage

            Purpose:
            Template for the page link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - url for the page
            page - number of the page
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginateCurrentPage = isset($tplPaginateCurrentPage)? $ditto->template->fetch($tplPaginateCurrentPage) : "<span class=\'ditto_currentpage\'>[+page+]</span>";
        /*
            Param: tplPaginateCurrentPage

            Purpose:
            Template for the current page link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            page - number of the page
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        
        $ditto->paginate($start, $stop, $total, $display, $tplPaginateNext, $tplPaginatePrevious, $tplPaginateNextOff, $tplPaginatePreviousOff, $tplPaginatePage, $tplPaginateCurrentPage, $paginateAlwaysShowLinks, $paginateSplitterCharacter);
            // generate the pagination placeholders
    }

    $dbFields = $ditto->fields["display"]["db"];
        // get the database fields
    $TVs = $ditto->fields["display"]["tv"];
        // get the TVs
    
    switch($orderBy[\'parsed\'][0][1]) {
        case "DESC":
            $stop = ($ditto->prefetch === false) ? $stop + $start + $offset : $stop + $offset; 
            $start += $offset;
        break;
        case "ASC":
            $start += $offset;
            $stop += $start;
        break;
    }

    if ($ditto->prefetch !== false) {
        $documentIDs = array_slice($documentIDs,$start,$stop);
            // set the document IDs equal to the trimmed array
        $dbFields = array_diff($dbFields,$ditto->prefetch["fields"]["db"]);
            // calculate the difference between the database fields and those already prefetched
        $dbFields[] = "id";
            // append id to the db fields array
        $TVs = array_diff($TVs,$ditto->prefetch["fields"]["tv"]);
            // calculate the difference between the tv fields and those already prefetched
        $start = 0;
        $stop = min($display,($queryLimit != 0) ? $queryLimit : $display,count($documentIDs));
    } else {
        $queryLimit = ($queryLimit == 0) ? "" : $queryLimit;
    }
    
    $resource = $ditto->getDocuments($documentIDs, $dbFields, $TVs, $orderBy, $showPublishedOnly, 0, $hidePrivate, $where, $queryLimit, $keywords, $randomize, $dateSource);
        // retrieves documents
    $output = $header;
        // initialize the output variable and send the header

    if ($resource) {
        if ($randomize != "0" && $randomize != "1") {
            $resource = $ditto->weightedRandom($resource,$randomize,$stop);
                // randomize the documents
        }
        
        $resource = array_values($resource);

        for ($x=$start;$x<$stop;$x++) {
            $template = $ditto->template->determine($templates,$x,0,$stop,$resource[$x]["id"]);
                // choose the template to use and set the code of that template to the template variable
            $renderedOutput = $ditto->render($resource[$x], $template, $removeChunk, $dateSource, $dateFormat, $placeholders,$phx,abs($start-$x));
                // render the output using the correct template, in the correct format and language
            $modx->setPlaceholder($dittoID."item[".abs($start-$x)."]",$renderedOutput);
            /*
                Placeholder: item[x]

                Content:
                Individual items rendered output
            */
            $output .= $renderedOutput;
                // send the rendered output to the buffer
        }
    } else {
        $output .= $ditto->noResults($noResults,$paginate);
            // if no documents are found return a no documents found string
    }
    $output .= $footer;
        // send the footer

    // ---------------------------------------------------
    // Save Object
    // ---------------------------------------------------

    if($save) {
        $modx->setPlaceholder($dittoID."ditto_object", $ditto);
        $modx->setPlaceholder($dittoID."ditto_resource", ($save == "1") ? array_slice($resource,$display) : $resource);
    }
} else {
    $output = $header.$ditto->noResults($noResults,$paginate).$footer;
}
// ---------------------------------------------------
// Handle Debugging
// ---------------------------------------------------

if ($debug == 1) {
    $ditto_params =& $modx->event_params;
    if (!isset($_GET["ditto_".$dittoID."debug"])) {
    $_SESSION["ditto_debug_$dittoID"] = $ditto->debug->render_popup($ditto, $ditto_base, $ditto_version, $ditto_params, $documentIDs, array("db"=>$dbFields,"tv"=>$TVs), $display, $templates, $orderBy, $start, $stop, $total,$filter,$resource);
    }
    if (isset($_GET["ditto_".$dittoID."debug"])) {
        switch ($_GET["ditto_".$dittoID."debug"]) {
            case "open" :
                exit($_SESSION["ditto_debug_$dittoID"]);
            break;
            case "save" :
                $ditto->debug->save($_SESSION["ditto_debug_$dittoID"],"ditto".strtolower($ditto_version)."_debug_doc".$modx->documentIdentifier.".html");
            break;
        }
    } else {
        $output = $ditto->debug->render_link($dittoID,$ditto_base).$output;
    }
}

return ($save != 3) ? $output : "";';
$s['DittoProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['Ditto'] = '/* Description:
 *      Aggregates documents to create blogs, article/news
 *      collections, and more,with full support for templating.
 * 
 * Author: 
 *      Mark Kaplan for MODx CMF
*/

//---Core Settings---------------------------------------------------- //

$ditto_version = "2.1.0";
    // Ditto version being executed

$ditto_base = isset($ditto_base) ? $modx->config[\'base_path\'].$ditto_base : $modx->config[\'base_path\']."assets/snippets/ditto/";
/*
    Param: ditto_base
    
    Purpose:
    Location of Ditto files

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    [(base_path)]assets/snippets/ditto/
*/
$dittoID = (!isset($id)) ? "" : $id."_";
$GLOBALS["dittoID"] = $dittoID;
/*
    Param: id

    Purpose:
    Unique ID for this Ditto instance for connection with other scripts (like Reflect) and unique URL parameters

    Options:
    Any combination of characters a-z, underscores, and numbers 0-9
    
    Note:
    This is case sensitive

    Default:
    "" - blank
*/      
$language = (isset($language))? $language : $modx->config[\'manager_language\'];
if (!file_exists($ditto_base."lang/".$language.".inc.php")) {
    $language ="english";
}
/*
    Param: language

    Purpose:
    language for defaults, debug, and error messages

    Options:
    Any language name with a corresponding file in the &ditto_base/lang folder

    Default:
    "english"
*/
$format = (isset($format)) ? strtolower($format) : "html" ;
/*
    Param: format

    Purpose:
    Output format to use

    Options:
    - "html"
    - "json"
    - "xml"
    - "atom"
    - "rss"

    Default:
    "html"
*/
$config = (isset($config)) ? $config : "default";
/*
    Param: config

    Purpose:
    Load a custom configuration

    Options:
    "default" - default blank config file
    CONFIG_NAME - Other configs installed in the configs folder or in any folder within the MODx base path via @FILE

    Default:
    "default"
    
    Related:
    - <extenders>
*/
$debug = isset($debug)? $debug : 0;
/*
    Param: debug

    Purpose:
    Output debugging information

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <debug>
*/
$phx = (isset($phx))? $phx : 1;
/*
    Param: phx

    Purpose:
    Use PHx formatting

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/      
$extenders = isset($extenders) ? explode(",",$extenders) : array();
/*
    Param: extenders

    Purpose:
    Load an extender which adds functionality to Ditto

    Options:
    Any extender in the extenders folder or in any folder within the MODx base path via @FILE

    Default:
    [NULL]

    Related:
    - <config>
*/
    // Variable: extenders
    // Array that can be added to by configs or formats to load that extender
    
$placeholders = array();
    // Variable: placeholders
    // Initialize custom placeholders array for configs or extenders to add to

$filters = array("custom"=>array(),"parsed"=>array());
    // Variable: filters
    // Holds both the custom filters array for configs or extenders to add to 
    // and the parsed filters array. To add to this array, use the following format
    // (code)
    // $filters["parsed"][] = array("name" => array("source"=>$source,"value"=>$value,"mode"=>$mode));
    // $filters["custom"][] = array("source","callback_function");

$orderBy = array(\'parsed\'=>array(),\'custom\'=>array(),\'unparsed\'=>$orderBy);
    // Variable: orderBy
    // An array that holds all criteria to sort the result set by. 
    // Note that using a custom sort will disable all other sorting.
    // (code)
    // $orderBy["parsed"][] = array("sortBy","sortDir");
    // $orderBy["custom"][] = array("sortBy","callback_function");
        
//---Includes-------------------------------------------------------- //

$files = array (
    "base_language" => $ditto_base."lang/english.inc.php",
    "language" => $ditto_base."lang/$language.inc.php",
    "main_class" => $ditto_base."classes/ditto.class.inc.php",
    "template_class" => $ditto_base."classes/template.class.inc.php",
    "filter_class" => $ditto_base."classes/filter.class.inc.php",
    "format" => $ditto_base."formats/$format.format.inc.php",
    "config" => $ditto_base."configs/default.config.php",
    "user_config" => (substr($config, 0, 5) != "@FILE") ? $ditto_base."configs/$config.config.php" : $modx->config[\'base_path\'].trim(substr($config, 5))
);

if ($phx == 1) {
    $files["prePHx_class"] = $ditto_base."classes/phx.pre.class.inc.php";
}
if (isset($randomize)) {
    $files["randomize_class"] = $ditto_base."classes/random.class.inc.php";
}
if ($debug == 1) {
    $files["modx_debug_class"] = $ditto_base."debug/modxDebugConsole.class.php";
    $files["debug_class"] = $ditto_base."classes/debug.class.inc.php";
    $files["debug_templates"] = $ditto_base."debug/debug.templates.php";
}

$files = array_unique($files);
foreach ($files as $filename => $filevalue) {
    if (file_exists($filevalue) && strpos($filename,"class")) {
        include_once($filevalue);
    } else if (file_exists($filevalue)) {
        include($filevalue);
    } else if ($filename == "language") {
        $modx->logEvent(1, 3, "Language file does not exist Please check: " . $filevalue, "Ditto " . $ditto_version);
        return "Language file does not exist Please check: " . $filevalue;
    } else {
        $modx->logEvent(1, 3, $filevalue . " " . $_lang[\'file_does_not_exist\'], "Ditto " . $ditto_version);
        return $filevalue . " " . $_lang[\'file_does_not_exist\'];
    }
}

//---Initiate Class-------------------------------------------------- //
if (class_exists(\'ditto\')) {
    $ditto = new ditto($dittoID,$format,$_lang,$dbg_templates);
        // create a new Ditto instance in the specified format and language with the requested debug level
} else {
    $modx->logEvent(1,3,$_lang[\'invalid_class\'],"Ditto ".$ditto_version);
    return $_lang[\'invalid_class\'];
}

//---Initiate Extenders---------------------------------------------- //
if (isset($tagData)) {
    $extenders[] = "tagging";
}
if(count($extenders) > 0) {
    $extenders = array_unique($extenders);
    foreach ($extenders as $extender) {
            if(substr($extender, 0, 5) != "@FILE") {
                $extender_path = $ditto_base."extenders/".$extender.".extender.inc.php";                
            } else {
                $extender_path = $modx->config[\'base_path\'].trim(substr($extender, 5));
            }
            
            if (file_exists($extender_path)){
                include($extender_path);
            } else {
                $modx->logEvent(1, 3, $extender . " " . $_lang[\'extender_does_not_exist\'], "Ditto ".$ditto_version);
                return $extender . " " . $_lang[\'extender_does_not_exist\'];
            }       
    }   
}

//---Parameters------------------------------------------------------- /*
if (isset($startID)) {$parents = $startID;}
if (isset($summarize)) {$display = $summarize;}
if (isset($limit)) {$queryLimit = $limit;}
if (isset($sortBy) || isset($sortDir) || is_null($orderBy[\'unparsed\'])) {
    $sortDir = isset($sortDir) ? strtoupper($sortDir) : \'DESC\';
    $sortBy = isset($sortBy) ? $sortBy : "createdon";
    $orderBy[\'parsed\'][]=array($sortBy,$sortDir);
}
    // Allow backwards compatibility

$idType = isset($documents) ? "documents" : "parents";
    // Variable: idType
    // type of IDs provided; can be either parents or documents

$parents = isset($parents) ? $ditto->cleanIDs($parents) : $modx->documentIdentifier;

/*
    Param: parents

    Purpose:
    IDs of containers for Ditto to retrieve their children to &depth depth

    Options:
    Any valid MODx document marked as a container

    Default:
    Current MODx Document

    Related:
    - <documents>
    - <depth>
*/
$documents = isset($documents) ? $ditto->cleanIDs($documents) : false;
/*
    Param: documents

    Purpose:
    IDs of documents for Ditto to retrieve

    Options:
    Any valid MODx document marked as a container

    Default:
    None

    Related:
    - <parents>
*/

$IDs = ($idType == "parents") ? $parents : $documents;
    // Variable: IDs
    // Internal variable which holds the set of IDs for Ditto to fetch

$depth = isset($depth) ? $depth : 1;
/*
    Param: depth

    Purpose:
    Number of levels deep to retrieve documents

    Options:
    Any number greater than or equal to 1
    0 - infinite depth

    Default:
    1

    Related:
    - <seeThruUnpub>
*/
$paginate = isset($paginate)? $paginate : 0;
/*
    Param: paginate

    Purpose:
    Paginate the results set into pages of &display length.
    Use &total to limit the number of documents retreived.

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <paginateAlwaysShowLinks>
    - <paginateSplitterCharacter>
    - <display>
*/
$dateSource = isset($dateSource) ? $dateSource : "createdon";
/*
    Param: dateSource

    Purpose:
    Source of the [+date+] placeholder

    Options:
    # - Any UNIX timestamp from MODx fields or TVs such as createdon, pub_date, or editedon
    
    Default:
    "createdon"
    
    Related:
    - <dateFormat>
*/
$dateFormat = isset($dateFormat)? $dateFormat : $_lang["dateFormat"];
/*
    Param: dateFormat

    Purpose:
    Format the [+date+] placeholder in human readable form

    Options:
    Any PHP valid strftime option

    Default:
    [LANG]
    
    Related:
    - <dateSource>
*/
$display = isset($display) ? $display : "all";
/*
    Param: display

    Purpose:
    Number of documents to display in the results

    Options:
    # - Any number
    "all" - All documents found

    Default:
    "all"
    
    Related:
    - <queryLimit>
    - <total>
*/
$total = isset($total) ? $total : "all";
/*
    Param: total

    Purpose:
    Number of documents to retrieve
    
    Options:
    # - Any number
    "all" - All documents found

    Default:
    "all" - All documents found
    
    Related:
    - <display>
    - <queryLimit>
*/
$showPublishedOnly = isset($showPublishedOnly) ? $showPublishedOnly : 1;
/*
    Param: showPublishedOnly

    Purpose:
    Show only published documents

    Options:
    0 - show only unpublished documents
    1 - show both published and unpublished documents
    
    Default:
    1 - show both published and unpublished documents
    
    Related:
    - <seeThruUnpub>
    - <hideFolders>
    - <showPublishedOnly>
    - <where>
*/
$showInMenuOnly = isset($showInMenuOnly) ? $showInMenuOnly : 0;
/*
    Param: showInMenuOnly

    Purpose:
    Show only documents visible in the menu

    Options:
    0 - show all documents
    1 - show only documents with the show in menu flag checked
    
    Default:
    0 - show all documents
    
    Related:
    - <seeThruUnpub>
    - <hideFolders>
    - <where>
*/
$hideFolders = isset($hideFolders)? $hideFolders : 0;
/*
    Param: hideFolders

    Purpose:
    Don\'t show folders in the returned results

    Options:
    0 - keep folders
    1 - remove folders
    
    Default:
    0 - keep folders
    
    Related:
    - <seeThruUnpub>
    - <showInMenuOnly>
    - <where>
*/
$hidePrivate = isset($hidePrivate)? $hidePrivate : 1;
/*
    Param: hidePrivate

    Purpose:
    Don\'t show documents the guest or user does not have permission to see

    Options:
    0 - show private documents
    1 - hide private documents
    
    Default:
    1 - hide private documents
    
    Related:
    - <seeThruUnpub>
    - <showInMenuOnly>
    - <where>
*/
$seeThruUnpub = (isset($seeThruUnpub))? $seeThruUnpub : 1 ;
/*
    Param: seeThruUnpub

    Purpose:
    See through unpublished folders to retrive their children
    Used when depth is greater than 1

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
    
    Related:
    - <hideFolders>
    - <showInMenuOnly>
    - <where>
*/
$queryLimit = (isset($queryLimit))? $queryLimit : 0;
/*
    Param: queryLimit

    Purpose:
    Number of documents to retrieve from the database, same as MySQL LIMIT

    Options:
    # - Any number
    0 - automatic

    Default:
    0 - automatic
    
    Related:
    - <where>
*/
$where = (isset($where))? $where : "";
/*
    Param: where

    Purpose:
    Custom MySQL WHERE statement

    Options:
    A valid MySQL WHERE statement using only document object items (no TVs)

    Default:
    [NULL]
    
    Related:
    - <queryLimit>
*/
$noResults = isset($noResults)? $ditto->getParam($noResults,"no_documents") : $_lang[\'no_documents\'];
/*
    Param: noResults

    Purpose:
    Text or chunk to display when there are no results

    Options:
    Any valid chunk name or text

    Default:
    [LANG]
*/
$removeChunk = isset($removeChunk) ? explode(",",$removeChunk) : false;
/*
    Param: removeChunk

    Purpose:
    Name of chunks to be stripped from content separated by commas
    - Commonly used to remove comments

    Options:
    Any valid chunkname that appears in the output

    Default:
    [NULL]
*/
$hiddenFields = isset($hiddenFields) ? explode(",",$hiddenFields) : false;
/*
    Param: hiddenFields

    Purpose:
    Allow Ditto to retrieve fields its template parser cannot handle such as nested placeholders and [*fields*]

    Options:
    Any valid MODx fieldnames or TVs comma separated

    Default:
    [NULL]
*/
$offset = isset($start) ? $start : 0;
$start = (isset($_GET[$dittoID.\'start\'])) ? intval($_GET[$dittoID.\'start\']) : 0;
/*
    Param: start

    Purpose:
    Number of documents to skip in the results
    
    Options:
    Any number

    Default:
    0
*/
$globalFilterDelimiter = isset($globalFilterDelimiter) ? $globalFilterDelimiter : "|";
/*
    Param: globalFilterDelimiter

    Purpose:
    Filter delimiter used to separate filters in the filter string
    
    Options:
    Any character not used in the filters

    Default:
    "|"
    
    Related:
    - <localFilterDelimiter>
    - <filter>
    - <parseFilters>
*/
    
$localFilterDelimiter = isset($localFilterDelimiter) ? $localFilterDelimiter : ",";
/*
    Param: localFilterDelimiter

    Purpose:
    Delimiter used to separate individual parameters within each filter string
    
    Options:
    Any character not used in the filter itself

    Default:
    ","
    
    Related:
    - <globalFilterDelimiter>
    - <filter>
    - <parseFilters>
*/
$filters["custom"] = isset($cFilters) ? array_merge($filters["custom"],$cFilters) : $filters["custom"];
$filters["parsed"] = isset($parsedFilters) ? array_merge($filters["parsed"],$parsedFilters) : $filters["parsed"];
    // handle 2.0.0 compatibility
$filter = (isset($filter) || ($filters["custom"] != false) || ($filters["parsed"] != false)) ? $ditto->parseFilters($filter,$filters["custom"],$filters["parsed"],$globalFilterDelimiter,$localFilterDelimiter) : false;
/*
    Param: filter

    Purpose:
    Removes items not meeting a critera. Thus, if pagetitle == joe then it will be removed.
    Use in the format field,criteria,mode with the comma being the local delimiter

    *Mode* *Meaning*
    
    1 - !=
    2 - ==
    3 - <
    4 - >
    5 - <=
    6 - >=
    7 - Text not in field value
    8 - Text in field value
    9 - case insenstive version of #7
    10 - case insenstive version of #8
    11 - checks leading character of the field
    
    @EVAL:
        @EVAL in filters works the same as it does in MODx exect it can only be used 
        with basic filtering, not custom filtering (tagging, etc). Make sure that
        you return the value you wish Ditto to filter by and that the code is valid PHP.

    Default:
    [NULL]
    
    Related:
    - <localFilterDelimiter>
    - <globalFilterDelimiter>
    - <parseFilters>
*/
$keywords = (isset($keywords))? $keywords : 0;
/*  
    Param: keywords
    
    Purpose: 
    Enable fetching of associated keywords for each document
    Can be used as [+keywords+] or as a tagData source
    
    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
*/

$randomize = (isset($randomize))? $randomize : 0;
/*  
    Param: randomize
    
    Purpose: 
    Randomize the order of the output
    
    Options:
    0 - off
    1 - on
    Any MODx field or TV for weighted random
    
    Default:
    0 - off
*/
$save = (isset($save))? $save : 0;
/*
    Param: save

    Purpose:
    Saves the ditto object and results set to placeholders
    for use by other snippets

    Options:
    0 - off; returns output
    1 - remaining; returns output
    2 - all;
    3 - all; returns ph only

    Default:
        0 - off; returns output
*/
$templates = array(
    "default" => "@CODE".$_lang[\'default_template\'],
    "base" => $tpl,
    "alt" => $tplAlt,
    "first" => $tplFirst,
    "last" => $tplLast,
    "current" => $tplCurrentDocument
);
/*
    Param: tpl

    Purpose:
    User defined chunk to format the documents 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    [LANG]
*/
/*
    Param: tplAlt

    Purpose:
    User defined chunk to format every other document

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplFirst

    Purpose:
    User defined chunk to format the first document 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplLast

    Purpose:
    User defined chunk to format the last document 

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
/*
    Param: tplCurrentDocument

    Purpose:
    User defined chunk to format the current document

    Options:
    - Any valid chunk name
    - Code via @CODE
    - File via @FILE

    Default:
    &tpl
*/
$orderBy = $ditto->parseOrderBy($orderBy,$randomize);
/*
    Param: orderBy

    Purpose:
    Sort the result set

    Options:
    Any valid MySQL style orderBy statement

    Default:
    createdon DESC
*/
//-------------------------------------------------------------------- */
$templates = $ditto->template->process($templates);
    // parse the templates for TV\'s and store them for later use

$ditto->setDisplayFields($ditto->template->fields,$hiddenFields);
    // parse hidden fields
    
$ditto->parseFields($placeholders,$seeThruUnpub,$dateSource,$randomize);
    // parse the fields into the field array
    
$documentIDs = $ditto->determineIDs($IDs, $idType, $ditto->fields["backend"]["tv"], $orderBy, $depth, $showPublishedOnly, $seeThruUnpub, $hideFolders, $hidePrivate, $showInMenuOnly, $where, $keywords, $dateSource, $queryLimit, $display, $filter,$paginate, $randomize);
    // retrieves a list of document IDs that meet the criteria and populates the $resources array with them
$count = count($documentIDs);
    // count the number of documents to be retrieved
$count = $count-$offset;
    // handle the offset

if ($count > 0) {
    // if documents are returned continue with execution
    
    $total = ($total == "all") ? $count : min($total,$count);
        // set total equal to count if all documents are to be included
    
    $display = ($display == "all") ? min($count,$total) : min($display,$total);
        // allow show to use all option

    $stop = ($save != "1") ? min($total-$start,$display) : min($count,$total);
        // set initial stop count

    if($paginate == 1) {
        $paginateAlwaysShowLinks = isset($paginateAlwaysShowLinks)? $paginateAlwaysShowLinks : 0;
        /*
            Param: paginateAlwaysShowLinks

            Purpose:
            Determine whether or not to always show previous next links

            Options:
            0 - off
            1 - on

            Default:
            0 - off
        
            Related:
            - <paginate>
            - <paginateSplitterCharacter>
        */
        $paginateSplitterCharacter = isset($paginateSplitterCharacter)? $paginateSplitterCharacter : $_lang[\'button_splitter\'];
        /*
            Param: paginateSplitterCharacter

            Purpose:
            Splitter to use if always show is disabled

            Options:
            Any valid character

            Default:
            [LANG]
        
            Related:
            - <paginate>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePrevious = isset($tplPaginatePrevious)? $ditto->template->fetch($tplPaginatePrevious) : "<a href=\'[+url+]\' class=\'ditto_previous_link\'>[+lang:previous+]</a>";
        /*
            Param: tplPaginatePrevious

            Purpose:
            Template for the previous link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - URL for the previous link
            lang:previous - value of \'prev\' from the language file
        
            Related:
            - <tplPaginateNext>
            - <paginateSplitterCharacter>
        */
        $tplPaginateNext = isset($tplPaginateNext)? $ditto->template->fetch($tplPaginateNext) : "<a href=\'[+url+]\' class=\'ditto_next_link\'>[+lang:next+]</a>";
        /*
            Param: tplPaginateNext

            Purpose:
            Template for the next link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - URL for the next link
            lang:next - value of \'next\' from the language file
        
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginateNextOff = isset($tplPaginateNextOff)? $ditto->template->fetch($tplPaginateNextOff) : "<span class=\'ditto_next_off ditto_off\'>[+lang:next+]</span>";
        /*
            Param: tplPaginateNextOff

            Purpose:
            Template for the inside of the next link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            lang:next - value of \'next\' from the language file
        
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePreviousOff = isset($tplPaginatePreviousOff)? $ditto->template->fetch($tplPaginatePreviousOff) : "<span class=\'ditto_previous_off ditto_off\'>[+lang:previous+]</span>";
        /*
            Param: tplPaginatePreviousOff

            Purpose:
            Template for the previous link when it is off

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            lang:previous - value of \'prev\' from the language file
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginatePage = isset($tplPaginatePage)? $ditto->template->fetch($tplPaginatePage) : "<a class=\'ditto_page\' href=\'[+url+]\'>[+page+]</a>";
        /*
            Param: tplPaginatePage

            Purpose:
            Template for the page link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            url - url for the page
            page - number of the page
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        $tplPaginateCurrentPage = isset($tplPaginateCurrentPage)? $ditto->template->fetch($tplPaginateCurrentPage) : "<span class=\'ditto_currentpage\'>[+page+]</span>";
        /*
            Param: tplPaginateCurrentPage

            Purpose:
            Template for the current page link

            Options:
            - Any valid chunk name
            - Code via @CODE
            - File via @FILE

            Placeholders:
            page - number of the page
    
            Related:
            - <tplPaginatePrevious>
            - <paginateSplitterCharacter>
        */
        
        $ditto->paginate($start, $stop, $total, $display, $tplPaginateNext, $tplPaginatePrevious, $tplPaginateNextOff, $tplPaginatePreviousOff, $tplPaginatePage, $tplPaginateCurrentPage, $paginateAlwaysShowLinks, $paginateSplitterCharacter);
            // generate the pagination placeholders
    }

    $dbFields = $ditto->fields["display"]["db"];
        // get the database fields
    $TVs = $ditto->fields["display"]["tv"];
        // get the TVs
    
    switch($orderBy[\'parsed\'][0][1]) {
        case "DESC":
            $stop = ($ditto->prefetch === false) ? $stop + $start + $offset : $stop + $offset; 
            $start += $offset;
        break;
        case "ASC":
            $start += $offset;
            $stop += $start;
        break;
    }

    if ($ditto->prefetch !== false) {
        $documentIDs = array_slice($documentIDs,$start,$stop);
            // set the document IDs equal to the trimmed array
        $dbFields = array_diff($dbFields,$ditto->prefetch["fields"]["db"]);
            // calculate the difference between the database fields and those already prefetched
        $dbFields[] = "id";
            // append id to the db fields array
        $TVs = array_diff($TVs,$ditto->prefetch["fields"]["tv"]);
            // calculate the difference between the tv fields and those already prefetched
        $start = 0;
        $stop = min($display,($queryLimit != 0) ? $queryLimit : $display,count($documentIDs));
    } else {
        $queryLimit = ($queryLimit == 0) ? "" : $queryLimit;
    }
    
    $resource = $ditto->getDocuments($documentIDs, $dbFields, $TVs, $orderBy, $showPublishedOnly, 0, $hidePrivate, $where, $queryLimit, $keywords, $randomize, $dateSource);
        // retrieves documents
    $output = $header;
        // initialize the output variable and send the header

    if ($resource) {
        if ($randomize != "0" && $randomize != "1") {
            $resource = $ditto->weightedRandom($resource,$randomize,$stop);
                // randomize the documents
        }
        
        $resource = array_values($resource);

        for ($x=$start;$x<$stop;$x++) {
            $template = $ditto->template->determine($templates,$x,0,$stop,$resource[$x]["id"]);
                // choose the template to use and set the code of that template to the template variable
            $renderedOutput = $ditto->render($resource[$x], $template, $removeChunk, $dateSource, $dateFormat, $placeholders,$phx,abs($start-$x));
                // render the output using the correct template, in the correct format and language
            $modx->setPlaceholder($dittoID."item[".abs($start-$x)."]",$renderedOutput);
            /*
                Placeholder: item[x]

                Content:
                Individual items rendered output
            */
            $output .= $renderedOutput;
                // send the rendered output to the buffer
        }
    } else {
        $output .= $ditto->noResults($noResults,$paginate);
            // if no documents are found return a no documents found string
    }
    $output .= $footer;
        // send the footer

    // ---------------------------------------------------
    // Save Object
    // ---------------------------------------------------

    if($save) {
        $modx->setPlaceholder($dittoID."ditto_object", $ditto);
        $modx->setPlaceholder($dittoID."ditto_resource", ($save == "1") ? array_slice($resource,$display) : $resource);
    }
} else {
    $output = $header.$ditto->noResults($noResults,$paginate).$footer;
}
// ---------------------------------------------------
// Handle Debugging
// ---------------------------------------------------

if ($debug == 1) {
    $ditto_params =& $modx->event_params;
    if (!isset($_GET["ditto_".$dittoID."debug"])) {
    $_SESSION["ditto_debug_$dittoID"] = $ditto->debug->render_popup($ditto, $ditto_base, $ditto_version, $ditto_params, $documentIDs, array("db"=>$dbFields,"tv"=>$TVs), $display, $templates, $orderBy, $start, $stop, $total,$filter,$resource);
    }
    if (isset($_GET["ditto_".$dittoID."debug"])) {
        switch ($_GET["ditto_".$dittoID."debug"]) {
            case "open" :
                exit($_SESSION["ditto_debug_$dittoID"]);
            break;
            case "save" :
                $ditto->debug->save($_SESSION["ditto_debug_$dittoID"],"ditto".strtolower($ditto_version)."_debug_doc".$modx->documentIdentifier.".html");
            break;
        }
    } else {
        $output = $ditto->debug->render_link($dittoID,$ditto_base).$output;
    }
}

return ($save != 3) ? $output : "";';
$s['eForm'] = '# eForm 1.4.4.7 - Electronic Form Snippet
# Original created by Raymond Irving 15-Dec-2004.
# Version 1.3+ extended by Jelle Jager (TobyL) September 2006
# -----------------------------------------------------
# Captcha image support - thanks to Djamoer
# Multi checkbox, radio, select support - thanks to Djamoer
# Form Parser and extened validation - by Jelle Jager
#
# see eform/docs/eform.htm for history, usage and examples
#

# Set Snippet Paths
$snipFolder = isset($snipFolder)?$snipFolder:\'eform\';
$snipPath = $modx->config["base_path"].\'assets/snippets/\'.$snipFolder.\'/\';


# check if inside manager
if ($modx->isBackend()) {
return \'\'; # don\'t go any further when inside manager
}

//tidying up some casing errors in parameters
if(isset($eformOnValidate)) $eFormOnValidate = $eformOnValidate;
if(isset($eformOnBeforeMailSent)) $eFormOnBeforeMailSent = $eformOnBeforeMailSent;
if(isset($eformOnMailSent)) $eFormOnMailSent = $eformOnMailSent;
if(isset($eformOnValidate)) $eFormOnValidate = $eformOnValidate;
if(isset($eformOnBeforeFormMerge)) $eFormOnBeforeFormMerge = $eformOnBeforeFormMerge;
if(isset($eformOnBeforeFormParse)) $eFormOnBeforeFormParse = $eformOnBeforeFormParse;
//for sottwell :)
if(isset($eFormCSS)) $cssStyle = $eFormCSS;

# Snippet customize settings
$params = array (
   // Snippet Path
   \'snipPath\' => $snipPath, //includes $snipFolder
	 \'snipFolder\' => $snipFolder,

// eForm Params
   \'vericode\' => isset($vericode)? $vericode:"",
   \'formid\' => isset($formid)? $formid:"",
   \'from\' => isset($from)? $from:$modx->config[\'emailsender\'],
   \'fromname\' => isset($fromname)? $fromname:$modx->config[\'site_name\'],
   \'to\' => isset($to)? $to:$modx->config[\'emailsender\'],
   \'cc\' => isset($cc)? $cc:"",
   \'bcc\' => isset($bcc)? $bcc:"",
   \'subject\' => isset($subject)? $subject:"",
   \'ccsender\' => isset($ccsender)?$ccsender:0,
   \'sendirect\' => isset($sendirect)? $sendirect:0,
   \'mselector\' => isset($mailselector)? $mailselector:0,
   \'mobile\' => isset($mobile)? $mobile:\'\',
   \'mobiletext\' => isset($mobiletext)? $mobiletext:\'\',
   \'autosender\' => isset($autosender)? $autosender:$from,
   \'autotext\' => isset($automessage)? $automessage:"",
   \'category\' => isset($category)? $category:0,
   \'keywords\' => isset($keywords)? $keywords:"",
   \'gid\' => isset($gotoid)? $gotoid:$modx->documentIdentifier,
   \'noemail\' => isset($noemail)? ($noemail):false,
   \'saveform\' => isset($saveform)? ($saveform? true:false):true,
   \'tpl\' => isset($tpl)? $tpl:"",
   \'report\' => isset($report)? $report:"",
   \'allowhtml\' => isset($allowhtml)? $allowhtml:0,
   //Added by JJ
   \'replyto\' => isset($replyto)? $replyto:"",
   \'language\' => isset($language)? $language:$modx->config[\'manager_language\'],
   \'thankyou\' => isset($thankyou)? $thankyou:"",
   \'isDebug\' => isset($debug)? $debug:0,
   \'reportAbuse\' => isset($reportAbuse)? $reportAbuse:false,
   \'disclaimer\' => isset($disclaimer)?$disclaimer:\'\',
   \'sendAsHtml\' => isset($sendAsHtml)?$sendAsHtml:false,
   \'sendAsText\' => isset($sendAsText)?$sendAsText:false,
   \'sessionVars\' => isset($sessionVars)?$sessionVars:false,
   \'postOverides\' => isset($postOverides)?$postOverides:0,
   \'eFormOnBeforeMailSent\' => isset($eFormOnBeforeMailSent)?$eFormOnBeforeMailSent:\'\',
   \'eFormOnMailSent\' => isset($eFormOnMailSent)?$eFormOnMailSent:\'\',
   \'eFormOnValidate\' => isset($eFormOnValidate)?$eFormOnValidate:\'\',
   \'eFormOnBeforeFormMerge\' => isset($eFormOnBeforeFormMerge)?$eFormOnBeforeFormMerge:\'\',
   \'eFormOnBeforeFormParse\' => isset($eFormOnBeforeFormParse)?$eFormOnBeforeFormParse:\'\',
   \'cssStyle\' => isset($cssStyle)?$cssStyle:\'\',
   \'jScript\' => isset($jScript)?$jScript:\'\',
   \'submitLimit\' => (isset($submitLimit) &&  is_numeric($submitLimit))?$submitLimit*60:0,
   \'protectSubmit\' => isset($protectSubmit)?$protectSubmit:1,
   \'requiredClass\' => isset($requiredClass)?$requiredClass:"required",
   \'invalidClass\' => isset($invalidClass)?$invalidClass:"invalid",
   \'runSnippet\' => ( isset($runSnippet) && !is_numeric($runSnippet) )?$runSnippet:\'\',
   \'autoSenderName\' => isset($autoSenderName)?$autoSenderName:\'\',
   \'version\' => \'1.4.4\'
);

// pixelchutes PHx workaround
foreach( $params as $key=>$val ) $params[ $key ] = str_replace( array(\'((\',\'))\'), array(\'[+\',\'+]\'), $val );

# Start processing

include_once ($snipPath."eform.inc.php");

$output = eForm($modx,$params);

# Return
return $output;';
$s['eForm'] = '# eForm 1.4.4.7 - Electronic Form Snippet
# Original created by Raymond Irving 15-Dec-2004.
# Version 1.3+ extended by Jelle Jager (TobyL) September 2006
# -----------------------------------------------------
# Captcha image support - thanks to Djamoer
# Multi checkbox, radio, select support - thanks to Djamoer
# Form Parser and extened validation - by Jelle Jager
#
# see eform/docs/eform.htm for history, usage and examples
#

# Set Snippet Paths
$snipFolder = isset($snipFolder)?$snipFolder:\'eform\';
$snipPath = $modx->config["base_path"].\'assets/snippets/\'.$snipFolder.\'/\';


# check if inside manager
if ($modx->isBackend()) {
return \'\'; # don\'t go any further when inside manager
}

//tidying up some casing errors in parameters
if(isset($eformOnValidate)) $eFormOnValidate = $eformOnValidate;
if(isset($eformOnBeforeMailSent)) $eFormOnBeforeMailSent = $eformOnBeforeMailSent;
if(isset($eformOnMailSent)) $eFormOnMailSent = $eformOnMailSent;
if(isset($eformOnValidate)) $eFormOnValidate = $eformOnValidate;
if(isset($eformOnBeforeFormMerge)) $eFormOnBeforeFormMerge = $eformOnBeforeFormMerge;
if(isset($eformOnBeforeFormParse)) $eFormOnBeforeFormParse = $eformOnBeforeFormParse;
//for sottwell :)
if(isset($eFormCSS)) $cssStyle = $eFormCSS;

# Snippet customize settings
$params = array (
   // Snippet Path
   \'snipPath\' => $snipPath, //includes $snipFolder
	 \'snipFolder\' => $snipFolder,

// eForm Params
   \'vericode\' => isset($vericode)? $vericode:"",
   \'formid\' => isset($formid)? $formid:"",
   \'from\' => isset($from)? $from:$modx->config[\'emailsender\'],
   \'fromname\' => isset($fromname)? $fromname:$modx->config[\'site_name\'],
   \'to\' => isset($to)? $to:$modx->config[\'emailsender\'],
   \'cc\' => isset($cc)? $cc:"",
   \'bcc\' => isset($bcc)? $bcc:"",
   \'subject\' => isset($subject)? $subject:"",
   \'ccsender\' => isset($ccsender)?$ccsender:0,
   \'sendirect\' => isset($sendirect)? $sendirect:0,
   \'mselector\' => isset($mailselector)? $mailselector:0,
   \'mobile\' => isset($mobile)? $mobile:\'\',
   \'mobiletext\' => isset($mobiletext)? $mobiletext:\'\',
   \'autosender\' => isset($autosender)? $autosender:$from,
   \'autotext\' => isset($automessage)? $automessage:"",
   \'category\' => isset($category)? $category:0,
   \'keywords\' => isset($keywords)? $keywords:"",
   \'gid\' => isset($gotoid)? $gotoid:$modx->documentIdentifier,
   \'noemail\' => isset($noemail)? ($noemail):false,
   \'saveform\' => isset($saveform)? ($saveform? true:false):true,
   \'tpl\' => isset($tpl)? $tpl:"",
   \'report\' => isset($report)? $report:"",
   \'allowhtml\' => isset($allowhtml)? $allowhtml:0,
   //Added by JJ
   \'replyto\' => isset($replyto)? $replyto:"",
   \'language\' => isset($language)? $language:$modx->config[\'manager_language\'],
   \'thankyou\' => isset($thankyou)? $thankyou:"",
   \'isDebug\' => isset($debug)? $debug:0,
   \'reportAbuse\' => isset($reportAbuse)? $reportAbuse:false,
   \'disclaimer\' => isset($disclaimer)?$disclaimer:\'\',
   \'sendAsHtml\' => isset($sendAsHtml)?$sendAsHtml:false,
   \'sendAsText\' => isset($sendAsText)?$sendAsText:false,
   \'sessionVars\' => isset($sessionVars)?$sessionVars:false,
   \'postOverides\' => isset($postOverides)?$postOverides:0,
   \'eFormOnBeforeMailSent\' => isset($eFormOnBeforeMailSent)?$eFormOnBeforeMailSent:\'\',
   \'eFormOnMailSent\' => isset($eFormOnMailSent)?$eFormOnMailSent:\'\',
   \'eFormOnValidate\' => isset($eFormOnValidate)?$eFormOnValidate:\'\',
   \'eFormOnBeforeFormMerge\' => isset($eFormOnBeforeFormMerge)?$eFormOnBeforeFormMerge:\'\',
   \'eFormOnBeforeFormParse\' => isset($eFormOnBeforeFormParse)?$eFormOnBeforeFormParse:\'\',
   \'cssStyle\' => isset($cssStyle)?$cssStyle:\'\',
   \'jScript\' => isset($jScript)?$jScript:\'\',
   \'submitLimit\' => (isset($submitLimit) &&  is_numeric($submitLimit))?$submitLimit*60:0,
   \'protectSubmit\' => isset($protectSubmit)?$protectSubmit:1,
   \'requiredClass\' => isset($requiredClass)?$requiredClass:"required",
   \'invalidClass\' => isset($invalidClass)?$invalidClass:"invalid",
   \'runSnippet\' => ( isset($runSnippet) && !is_numeric($runSnippet) )?$runSnippet:\'\',
   \'autoSenderName\' => isset($autoSenderName)?$autoSenderName:\'\',
   \'version\' => \'1.4.4\'
);

// pixelchutes PHx workaround
foreach( $params as $key=>$val ) $params[ $key ] = str_replace( array(\'((\',\'))\'), array(\'[+\',\'+]\'), $val );

# Start processing

include_once ($snipPath."eform.inc.php");

$output = eForm($modx,$params);

# Return
return $output;';
$s['eForm'] = '# eForm 1.4.4.7 - Electronic Form Snippet
# Original created by Raymond Irving 15-Dec-2004.
# Version 1.3+ extended by Jelle Jager (TobyL) September 2006
# -----------------------------------------------------
# Captcha image support - thanks to Djamoer
# Multi checkbox, radio, select support - thanks to Djamoer
# Form Parser and extened validation - by Jelle Jager
#
# see eform/docs/eform.htm for history, usage and examples
#

# Set Snippet Paths
$snipFolder = isset($snipFolder)?$snipFolder:\'eform\';
$snipPath = $modx->config["base_path"].\'assets/snippets/\'.$snipFolder.\'/\';


# check if inside manager
if ($modx->isBackend()) {
return \'\'; # don\'t go any further when inside manager
}

//tidying up some casing errors in parameters
if(isset($eformOnValidate)) $eFormOnValidate = $eformOnValidate;
if(isset($eformOnBeforeMailSent)) $eFormOnBeforeMailSent = $eformOnBeforeMailSent;
if(isset($eformOnMailSent)) $eFormOnMailSent = $eformOnMailSent;
if(isset($eformOnValidate)) $eFormOnValidate = $eformOnValidate;
if(isset($eformOnBeforeFormMerge)) $eFormOnBeforeFormMerge = $eformOnBeforeFormMerge;
if(isset($eformOnBeforeFormParse)) $eFormOnBeforeFormParse = $eformOnBeforeFormParse;
//for sottwell :)
if(isset($eFormCSS)) $cssStyle = $eFormCSS;

# Snippet customize settings
$params = array (
   // Snippet Path
   \'snipPath\' => $snipPath, //includes $snipFolder
	 \'snipFolder\' => $snipFolder,

// eForm Params
   \'vericode\' => isset($vericode)? $vericode:"",
   \'formid\' => isset($formid)? $formid:"",
   \'from\' => isset($from)? $from:$modx->config[\'emailsender\'],
   \'fromname\' => isset($fromname)? $fromname:$modx->config[\'site_name\'],
   \'to\' => isset($to)? $to:$modx->config[\'emailsender\'],
   \'cc\' => isset($cc)? $cc:"",
   \'bcc\' => isset($bcc)? $bcc:"",
   \'subject\' => isset($subject)? $subject:"",
   \'ccsender\' => isset($ccsender)?$ccsender:0,
   \'sendirect\' => isset($sendirect)? $sendirect:0,
   \'mselector\' => isset($mailselector)? $mailselector:0,
   \'mobile\' => isset($mobile)? $mobile:\'\',
   \'mobiletext\' => isset($mobiletext)? $mobiletext:\'\',
   \'autosender\' => isset($autosender)? $autosender:$from,
   \'autotext\' => isset($automessage)? $automessage:"",
   \'category\' => isset($category)? $category:0,
   \'keywords\' => isset($keywords)? $keywords:"",
   \'gid\' => isset($gotoid)? $gotoid:$modx->documentIdentifier,
   \'noemail\' => isset($noemail)? ($noemail):false,
   \'saveform\' => isset($saveform)? ($saveform? true:false):true,
   \'tpl\' => isset($tpl)? $tpl:"",
   \'report\' => isset($report)? $report:"",
   \'allowhtml\' => isset($allowhtml)? $allowhtml:0,
   //Added by JJ
   \'replyto\' => isset($replyto)? $replyto:"",
   \'language\' => isset($language)? $language:$modx->config[\'manager_language\'],
   \'thankyou\' => isset($thankyou)? $thankyou:"",
   \'isDebug\' => isset($debug)? $debug:0,
   \'reportAbuse\' => isset($reportAbuse)? $reportAbuse:false,
   \'disclaimer\' => isset($disclaimer)?$disclaimer:\'\',
   \'sendAsHtml\' => isset($sendAsHtml)?$sendAsHtml:false,
   \'sendAsText\' => isset($sendAsText)?$sendAsText:false,
   \'sessionVars\' => isset($sessionVars)?$sessionVars:false,
   \'postOverides\' => isset($postOverides)?$postOverides:0,
   \'eFormOnBeforeMailSent\' => isset($eFormOnBeforeMailSent)?$eFormOnBeforeMailSent:\'\',
   \'eFormOnMailSent\' => isset($eFormOnMailSent)?$eFormOnMailSent:\'\',
   \'eFormOnValidate\' => isset($eFormOnValidate)?$eFormOnValidate:\'\',
   \'eFormOnBeforeFormMerge\' => isset($eFormOnBeforeFormMerge)?$eFormOnBeforeFormMerge:\'\',
   \'eFormOnBeforeFormParse\' => isset($eFormOnBeforeFormParse)?$eFormOnBeforeFormParse:\'\',
   \'cssStyle\' => isset($cssStyle)?$cssStyle:\'\',
   \'jScript\' => isset($jScript)?$jScript:\'\',
   \'submitLimit\' => (isset($submitLimit) &&  is_numeric($submitLimit))?$submitLimit*60:0,
   \'protectSubmit\' => isset($protectSubmit)?$protectSubmit:1,
   \'requiredClass\' => isset($requiredClass)?$requiredClass:"required",
   \'invalidClass\' => isset($invalidClass)?$invalidClass:"invalid",
   \'runSnippet\' => ( isset($runSnippet) && !is_numeric($runSnippet) )?$runSnippet:\'\',
   \'autoSenderName\' => isset($autoSenderName)?$autoSenderName:\'\',
   \'version\' => \'1.4.4\'
);

// pixelchutes PHx workaround
foreach( $params as $key=>$val ) $params[ $key ] = str_replace( array(\'((\',\'))\'), array(\'[+\',\'+]\'), $val );

# Start processing

include_once ($snipPath."eform.inc.php");

$output = eForm($modx,$params);

# Return
return $output;';
$s['eFormProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['eForm'] = '# eForm 1.4.4.7 - Electronic Form Snippet
# Original created by Raymond Irving 15-Dec-2004.
# Version 1.3+ extended by Jelle Jager (TobyL) September 2006
# -----------------------------------------------------
# Captcha image support - thanks to Djamoer
# Multi checkbox, radio, select support - thanks to Djamoer
# Form Parser and extened validation - by Jelle Jager
#
# see eform/docs/eform.htm for history, usage and examples
#

# Set Snippet Paths
$snipFolder = isset($snipFolder)?$snipFolder:\'eform\';
$snipPath = $modx->config["base_path"].\'assets/snippets/\'.$snipFolder.\'/\';


# check if inside manager
if ($modx->isBackend()) {
return \'\'; # don\'t go any further when inside manager
}

//tidying up some casing errors in parameters
if(isset($eformOnValidate)) $eFormOnValidate = $eformOnValidate;
if(isset($eformOnBeforeMailSent)) $eFormOnBeforeMailSent = $eformOnBeforeMailSent;
if(isset($eformOnMailSent)) $eFormOnMailSent = $eformOnMailSent;
if(isset($eformOnValidate)) $eFormOnValidate = $eformOnValidate;
if(isset($eformOnBeforeFormMerge)) $eFormOnBeforeFormMerge = $eformOnBeforeFormMerge;
if(isset($eformOnBeforeFormParse)) $eFormOnBeforeFormParse = $eformOnBeforeFormParse;
//for sottwell :)
if(isset($eFormCSS)) $cssStyle = $eFormCSS;

# Snippet customize settings
$params = array (
   // Snippet Path
   \'snipPath\' => $snipPath, //includes $snipFolder
	 \'snipFolder\' => $snipFolder,

// eForm Params
   \'vericode\' => isset($vericode)? $vericode:"",
   \'formid\' => isset($formid)? $formid:"",
   \'from\' => isset($from)? $from:$modx->config[\'emailsender\'],
   \'fromname\' => isset($fromname)? $fromname:$modx->config[\'site_name\'],
   \'to\' => isset($to)? $to:$modx->config[\'emailsender\'],
   \'cc\' => isset($cc)? $cc:"",
   \'bcc\' => isset($bcc)? $bcc:"",
   \'subject\' => isset($subject)? $subject:"",
   \'ccsender\' => isset($ccsender)?$ccsender:0,
   \'sendirect\' => isset($sendirect)? $sendirect:0,
   \'mselector\' => isset($mailselector)? $mailselector:0,
   \'mobile\' => isset($mobile)? $mobile:\'\',
   \'mobiletext\' => isset($mobiletext)? $mobiletext:\'\',
   \'autosender\' => isset($autosender)? $autosender:$from,
   \'autotext\' => isset($automessage)? $automessage:"",
   \'category\' => isset($category)? $category:0,
   \'keywords\' => isset($keywords)? $keywords:"",
   \'gid\' => isset($gotoid)? $gotoid:$modx->documentIdentifier,
   \'noemail\' => isset($noemail)? ($noemail):false,
   \'saveform\' => isset($saveform)? ($saveform? true:false):true,
   \'tpl\' => isset($tpl)? $tpl:"",
   \'report\' => isset($report)? $report:"",
   \'allowhtml\' => isset($allowhtml)? $allowhtml:0,
   //Added by JJ
   \'replyto\' => isset($replyto)? $replyto:"",
   \'language\' => isset($language)? $language:$modx->config[\'manager_language\'],
   \'thankyou\' => isset($thankyou)? $thankyou:"",
   \'isDebug\' => isset($debug)? $debug:0,
   \'reportAbuse\' => isset($reportAbuse)? $reportAbuse:false,
   \'disclaimer\' => isset($disclaimer)?$disclaimer:\'\',
   \'sendAsHtml\' => isset($sendAsHtml)?$sendAsHtml:false,
   \'sendAsText\' => isset($sendAsText)?$sendAsText:false,
   \'sessionVars\' => isset($sessionVars)?$sessionVars:false,
   \'postOverides\' => isset($postOverides)?$postOverides:0,
   \'eFormOnBeforeMailSent\' => isset($eFormOnBeforeMailSent)?$eFormOnBeforeMailSent:\'\',
   \'eFormOnMailSent\' => isset($eFormOnMailSent)?$eFormOnMailSent:\'\',
   \'eFormOnValidate\' => isset($eFormOnValidate)?$eFormOnValidate:\'\',
   \'eFormOnBeforeFormMerge\' => isset($eFormOnBeforeFormMerge)?$eFormOnBeforeFormMerge:\'\',
   \'eFormOnBeforeFormParse\' => isset($eFormOnBeforeFormParse)?$eFormOnBeforeFormParse:\'\',
   \'cssStyle\' => isset($cssStyle)?$cssStyle:\'\',
   \'jScript\' => isset($jScript)?$jScript:\'\',
   \'submitLimit\' => (isset($submitLimit) &&  is_numeric($submitLimit))?$submitLimit*60:0,
   \'protectSubmit\' => isset($protectSubmit)?$protectSubmit:1,
   \'requiredClass\' => isset($requiredClass)?$requiredClass:"required",
   \'invalidClass\' => isset($invalidClass)?$invalidClass:"invalid",
   \'runSnippet\' => ( isset($runSnippet) && !is_numeric($runSnippet) )?$runSnippet:\'\',
   \'autoSenderName\' => isset($autoSenderName)?$autoSenderName:\'\',
   \'version\' => \'1.4.4\'
);

// pixelchutes PHx workaround
foreach( $params as $key=>$val ) $params[ $key ] = str_replace( array(\'((\',\'))\'), array(\'[+\',\'+]\'), $val );

# Start processing

include_once ($snipPath."eform.inc.php");

$output = eForm($modx,$params);

# Return
return $output;';
$s['AjaxSearch'] = '/**
--------------------------------------------------------------------------------
:: Preamble
--------------------------------------------------------------------------------
The release 1.9 looks like the previous release, but it is a completely
refactored development.

It is partially based on the previous releases of AjaxSearch written by the
following authors:

 Coroico <coroico@wangba.fr>
 Jason Coward <jason@opengeek.com>
 Kyle Jaebker <kjaebker@muddydogpaws.com>
 Ryan Thrash  <ryan@vertexworks.com>

--------------------------------------------------------------------------------
:: Description
--------------------------------------------------------------------------------

        Ajax and non-Ajax search that supports results highlighting.

This snippet adds AJAX functionality on top of the robust content searching.

What AjaxSearch do:
- search in fields of the content an TV MODx tables
- several customizable input forms available
- search in a subset of documents
- highlighting of searchword in the results returned
- allow a filtering of search results
- displaying of search results customizable thru templates
- group the search results by categories
- filter features (allow to set up specific search forms)

It could works in two modes:

ajax mode :
- search results displayed in current page through AJAX request
- multiple search options including live search
- available link to view all results in a new page when only a subset is returned
- customize the number of results returned
- offer two types for paginating the results
- uses the MooTools or JQuery js library for AJAX and visual effects

non-ajax mode :
- search results displayed in a new page or below on the same page
- offer two types for paginating the results
- works without JS enabled

What AjaxSearch don\'t :
- search in dynamic content. AjaxSearch could retreive only data stored in
database. It can\'t find something stored in a chunk or generated by a snippet.

MORE : See the ajaxSearch.readme.txt file for more informations. 

----------------------------------------------------------------------------- */

// ajaxSearch version being executed
define(\'AS_VERSION\', \'1.9.2\');
// Path where ajaxSearch is installed
define(\'AS_SPATH\', \'assets/snippets/ajaxSearch/\');
//include snippet file
define(\'AS_PATH\', MODX_BASE_PATH . AS_SPATH);

//------------------------------------------------------------------------------
// Configuration - general AjaxSearch snippet setup options
//------------------------------------------------------------------------------
global $modx;
$tstart = $modx->getMicroTime();

$cfg = array(); // current configuration
$cfg[\'version\'] = AS_VERSION;

// Load the default configuration $dcfg to get the default values
$default = AS_PATH . \'configs/default.config.php\';
if (file_exists($default)) include $default;
else return "<h3>AjaxSearch error: $default not found !<br />Check the existing of this file!</h3>";
if (!isset($dcfg)) return "<h3>AjaxSearch error: default configuration array not defined in $default!<br /> Check the content of this file!</h3>";

if ($dcfg[\'version\'] != AS_VERSION) return "<h3>AjaxSearch error: Version number mismatch. Check the content of the default configuration file!</h3>";

// check the possible use of deprecated parameters (since 1.8.5)
$readme = "ajaxSearch_version_192.txt";
if (isset($searchWordList)) return "<h3>AjaxSearch error: searchWordList is a deprecated parameter. Read " . $readme . " file.</h3>";
if (isset($resultsPage)) return "<h3>AjaxSearch error: resultsPage is a deprecated parameter. Read " . $readme . " file.</h3>";
if (isset($AS_showForm)) return "<h3>AjaxSearch error: AS_showForm parameter has been renamed showInputForm. Read " . $readme . " file.</h3>";
if (isset($AS_landing)) return "<h3>AjaxSearch error: AS_landing parameter has been renamed landingPage. Read " . $readme . " file.</h3>";
if (isset($AS_showResults)) return "<h3>AjaxSearch error: AS_showResults parameter has been renamed showResults. Read " . $readme . " file.</h3>";

// Load a custom configuration file if required
// config_name - Other config installed in the configs folder or in any folder within the MODx base path via @FILE
// Configuration files should be named in the form: <config_name>.config.php
// Default: \'\' - no custom config
$cfg[\'config\'] = isset($config) ? $config : $dcfg[\'config\'];
if ($cfg[\'config\']) {
    $config = $cfg[\'config\'];
    $lconfig = (substr($config, 0, 6) != "@FILE:") ? AS_PATH . "configs/$config.config.php" : $modx->config[\'base_path\'] . trim(substr($config, 6, strlen($config)-6));
    if (file_exists($lconfig)) include $lconfig;
    else return "<h3>AjaxSearch error: " . $lconfig . " not found !<br />Check your config parameter or your config file name!</h3>";
}

// &debug = [ 0 | 1 | 2 | 3 ]
// 1,2,3 : File mode - Output logged into a file named ajaxSearch_log.txt in ajaxSearch/debug/ directory.
// this directory should be writable.
// Default: 0 - no logs
$cfg[\'debug\'] = isset($debug) ? $debug : (isset($__debug) ? $__debug : $dcfg[\'debug\']);

// &timeLimit = [ int | 60 ]
// Max execution time in seconds for the AjaxSearch script
// 0 - If set to zero, no time limit is imposed
// Default: 60 - 1 minute.
$cfg[\'timeLimit\'] = isset($timeLimit) ? $timeLimit : (isset($__timeLimit) ? $__timeLimit : $dcfg[\'timeLimit\']);

// &language [ language_name | manager_language ] (optional)
// Default: $modx->config[\'manager_language\'] - manager language used
$cfg[\'language\'] = isset($language) ? $language : (isset($__language) ? $__language : $dcfg[\'language\']);

// &ajaxSearch [1 | 0] (as passed in snippet variable ONLY)
// Use this to display the search results using ajax You must include the Mootools library in your template
// Default: 1 - ajax mode selected
$cfg[\'ajaxSearch\'] = isset($ajaxSearch) ? $ajaxSearch : (isset($__ajaxSearch) ? $__ajaxSearch : $dcfg[\'ajaxSearch\']);

// &advSearch [ \'exactphrase\' | \'allwords\' | \'nowords\' | \'oneword\' ]
// Advanced search:
// - exactphrase : provides the documents which contain the exact phrase
// - allwords : provides the documents which contain all the words
// - nowords : provides the documents which do not contain the words
// - oneword : provides the document which contain at least one word
// Default: \'oneword\'
$cfg[\'advSearch\'] = isset($advSearch) ? $advSearch : (isset($__advSearch) ? $__advSearch : $dcfg[\'advSearch\']);

// &asId - Unique id for AjaxSearch instance
// this allows to distinguish several Ajaxsearch instances on the same page
// Any combination of characters a-z, underscores, and numbers 0-9
// This is case sensitive. Default = empty string
// With ajax mode, the first snippet call of the page shouldn\'t use the asId parameter
$cfg[\'asId\'] = isset($asId) ? $asId : (isset($__asId) ? $__asId : $dcfg[\'asId\']);

// &whereSearch
// Define where should occur the search
// a separated list of keywords describing the tables where to search
// keywords allowed :
// "content" for site_content, "tv" for site_tmplvar_contentvalues, "jot" for jot_content, "maxigallery" for maxigallery
// you could add your own keywords. But the keyword should be a user function which describes the tables to use
// all the text fields are searchable but you could specify the fields like this:
// whereSearch=`content:pagetitle,introtext,content|tv:tv_value|maxigallery:gal_title`
// Default: \'content|tv\'
$cfg[\'whereSearch\'] = isset($whereSearch) ? $whereSearch : (isset($__whereSearch) ? $__whereSearch : $dcfg[\'whereSearch\']);

// &sites : [comma separated list of sites]
// sites allow to define sites where to do the search
$cfg[\'sites\'] = isset($sites) ? $sites : (isset($__sites) ? $__sites : $dcfg[\'sites\']);

// &subSearch  [comma separated list of subsites]
// subSearch allow to define sub-domains or subsites where to do the search
$cfg[\'subSearch\'] = isset($subSearch) ? $subSearch : (isset($__subSearch) ? $__subSearch : $dcfg[\'subSearch\']);

// &category  [ tv_name ]
// Any combination of characters a-z, underscores, and numbers 0-9
// This is case sensitive. Default = empty string
// Name of a TV. The category of a MODx document is provided by this TV content
$cfg[\'category\'] = isset($category) ? $category : (isset($__category) ? $__category : $dcfg[\'category\']);

// &display [ \'mixed\' | \'unmixed\' ]
// When results comes from differents sites, subsites or categories, you could choose to display the results mixed or unmixed.
// Default: unmixed
// Unmixed mode display the results grouped by site, subsite or category. Each group of results could be paginated.
// Mixed mode mixe all the results coming from the differents area.
// With unmixed mode, results are ordered by the field provided by the first field of the order parameter
$cfg[\'display\'] = isset($display) ? $display : (isset($__display) ? $__display : $dcfg[\'display\']);

// &init  [ \'none\' | \'all\' ]
// init defines if the search display all the results or none when the search term is an empty string
// Default: none
$cfg[\'init\'] = isset($init) ? $init : (isset($__init) ? $__init : $dcfg[\'init\']);

// &withTvs - Define which Tvs are used for the search in Tvs
// a comma separated list of TV names
// Default: \'\' - all TVs are used (empty list)
$cfg[\'withTvs\'] = isset($withTvs) ? $withTvs : (isset($__withTvs) ? $__withTvs : $dcfg[\'withTvs\']);

// &order - Define the sort order of results
// Comma separated list of fields defined as searchable in the table definition
// to suppress the sorting, use &order=``
// Default: \'pub_date,pagetitle\'
$cfg[\'order\'] = isset($order) ? $order : (isset($__order) ? $__order : $dcfg[\'order\']);

// &rank - Define the rank of search results. Results are sorted by rank value
// Comma separated list of fields with optionally user defined weight
// Default: \'pagetitle:100,extract\'
// to suppress the rank sorting, use &rank=``;
// &rank sort occurs after the &order sort
$cfg[\'rank\'] = isset($rank) ? $rank : (isset($__rank) ? $__rank : $dcfg[\'rank\']);

// &maxWords [ 1 < int < 10 ]
// Maximum number of words for searching
// Default: 5
$cfg[\'maxWords\'] = isset($maxWords) ? intval($maxWords) : (isset($__maxWords) ? intval($__maxWords) : $dcfg[\'maxWords\']);

// &minChars [  2 < int < 100 ]
// Minimum number of characters to require for a word to be valid for searching.
// length of each word with $advSearch = \'allwords\', \'oneword\' or \'nowords\'
// length of the search string with possible spaces with $advSearch = \'exactphrase\'
// Default: 3
$cfg[\'minChars\'] = isset($minChars) ? intval($minChars) : (isset($__minChars) ? intval($__minChars) : $dcfg[\'minChars\']);

// &showInputForm [0 | 1]
// If you would like to turn off the search form when showing results you can set this to false.(1=true, 0=false)
// Default: 1
$cfg[\'showInputForm\'] = isset($showInputForm) ? $showInputForm : (isset($__showInputForm) ? $__showInputForm : $dcfg[\'showInputForm\']);

// &showIntro [0 | 1]
// If you would like to turn off the intro message beyond the input form you can set this to false.(1=true, 0=false)
// Default: 1
$cfg[\'showIntro\'] = isset($showIntro) ? $showIntro : (isset($__showIntro) ? $__showIntro : $dcfg[\'showIntro\']);

// &grabMax [ int ]
// Set to the max number of records you would like on each page. Set to 0 if unlimited.
// Default: 10
$cfg[\'grabMax\'] = isset($grabMax) ? intval($grabMax) : (isset($__grabMax) ? intval($__grabMax) : $dcfg[\'grabMax\']);

// &extract [ n:searchable fields list | 1:content,description,introtext,tv_content]
// show the search terms highlighted in a little extract
// n : maximum number of extracts displayed
// ordered searchable fields list : separated list of fields define as searchable in the table definition
// Default: \'1:content,description,introtext,tv_value\' - One extract from content then description,introtext,tv_value
$cfg[\'extract\'] = isset($extract) ? $extract : (isset($__extract) ? $__extract : $dcfg[\'extract\']);

// &extractLength [ 50 < int < 800]
// Length of extract around the search words found - between 50 and 800 characters
// Default: 200
$cfg[\'extractLength\'] = isset($extractLength) ? intval($extractLength) : (isset($__extractLength) ? intval($__extractLength) : $dcfg[\'extractLength\']);

// &extractEllips [ string ]
// Ellipside to mark the star and the end of  an extract when the sentence is cutting
// Default: \'...\'
$cfg[\'extractEllips\'] = isset($extractEllips) ? $extractEllips : (isset($__extractEllips) ? $__extractEllips : $dcfg[\'extractEllips\']);

// &extractSeparator [ string ]
// Any html tag to mark the separation between extracts
// Default: \'<br />\' - but you could also choose for instance \'<hr />\'
$cfg[\'extractSeparator\'] = isset($extractSeparator) ? $extractSeparator : (isset($__extractSeparator) ? $__extractSeparator : $dcfg[\'extractSeparator\']);

// &formatDate [ string ]
// The format of outputted dates. See http://www.php.net/manual/en/function.date.php
// Default: \'d/m/y : H:i:s\' - e.g: 21/01/08 : 23:09:22
$cfg[\'formatDate\'] = isset($formatDate) ? $formatDate : (isset($__formatDate) ? $__formatDate : $dcfg[\'formatDate\']);

// &highlightResult [1 | 0]
// create links so that search terms will be highlighted when linked page clicked
// Default: 1 - Results highlighted
$cfg[\'highlightResult\'] = isset($highlightResult) ? $highlightResult : (isset($__highlightResult) ? $__highlightResult : $dcfg[\'highlightResult\']);

// &pagingType[ 0 | 1 | 2 ]
// Determine the pagination type used - Default 1 : Previous - X-Y/Z - Next
$cfg[\'pagingType\'] = isset($pagingType) ? $pagingType : (isset($__pagingType) ? $__pagingType : $dcfg[\'pagingType\']);

// &pageLinkSeparator [ string ]
// What you want, if anything, between your page link numbers
// Default: \' | \'
$cfg[\'pageLinkSeparator\'] = isset($pageLinkSeparator) ? $pageLinkSeparator : (isset($__pageLinkSeparator) ? $__pageLinkSeparator : $dcfg[\'pageLinkSeparator\']);

// &showPagingAlways[1 | 0]
// Determine whether or not to always show paging
$cfg[\'showPagingAlways\'] = isset($showPagingAlways) ? $showPagingAlways : (isset($__showPagingAlways) ? $__showPagingAlways : $dcfg[\'showPagingAlways\']);

// &landingPage  [int] set the page to show the results page (non Ajax search)
// Default: false
$cfg[\'landingPage\'] = isset($landingPage) ? $landingPage : (isset($__landingPage) ? $__landingPage : $dcfg[\'landingPage\']);

// &showResults  [1 | 0]  establish whether to show the results or not
// Default: 1
$cfg[\'showResults\'] = isset($showResults) ? $showResults : (isset($__showResults) ? $__showResults : $dcfg[\'showResults\']);

// &parents [ [ in | not in ] : comma separated list of Ids | \'\' ]
// Ids of documents to retrieve their children to &depth depth  where to do the search in or not in
// Default: \'\' - empty list
$cfg[\'parents\'] = isset($parents) ? $parents : (isset($__parents) ? $__parents : $dcfg[\'parents\']);

// &documents [ [ in | not in ] : comma separated list of Ids | \'\' ]
// Ids of documents where to do the search in or not in
// Default: \'\' - empty list
$cfg[\'documents\'] = isset($documents) ? $documents : (isset($__documents) ? $__documents : $dcfg[\'documents\']);

// &depth [ 0 < int ] Number of levels deep to retrieve documents
// Default: 10
$cfg[\'depth\'] = isset($depth) ? intval($depth) : (isset($__depth) ? intval($__depth) : $dcfg[\'depth\']);

// &hideMenu [0 | 1| 2]  Search in hidden documents from menu.
// 0 - search only in documents visible from menu
// 1 - search only in documents hidden from menu
// 2 - search in hidden or visible documents from menu
// Default: 2
$cfg[\'hideMenu\'] = isset($hideMenu) ? $hideMenu : (isset($__hideMenu) ? $__hideMenu : $dcfg[\'hideMenu\']);

// &hideLink [0 | 1 ]   Search in content of type reference (link)
// 0 - search in content of type document AND reference
// 1 - search only in content of type document
// Default: 1
$cfg[\'hideLink\'] = isset($hideLink) ? $hideLink : (isset($__hideLink) ? $__hideLink : $dcfg[\'hideLink\']);

// &filter - Basic filtering : remove unwanted documents that meets the criteria of the filter
// See Ditto 2 Basic filtering and the ajaxSearch demo site for more information
// Default: \'\' - empty list
$cfg[\'filter\'] = isset($filter) ? $filter : (isset($__filter) ? $__filter : $dcfg[\'filter\']);

// &output [0 | 1 ]Custom layout
// Default: 0 - Results are listed just under the input form
// 1 - custom layout. put [+as.inputForm+] and [+as.results+] where you want to define the layout
$cfg[\'output\'] = isset($output) ? $output : (isset($__output) ? $__output : $dcfg[\'output\']);

// &tplInput - Chunk to style the ajaxSearch input form
// Default: \'@FILE:\' . AS_SPATH . \'templates/input.tpl.html\'
$cfg[\'tplInput\'] = isset($tplInput) ? $tplInput : (isset($__tplInput) ? $__tplInput : $dcfg[\'tplInput\']);

// &tplResults - Chunk to style the non-ajax output results outer
// Default: \'@FILE:\' . AS_SPATH . \'templates/results.tpl.html\'
$cfg[\'tplResults\'] = isset($tplResults) ? $tplResults : (isset($__tplResults) ? $__tplResults : $dcfg[\'tplResults\']);

// &tplGrpResult - Chunk to style the non-ajax output group result outer
// Default: \'@FILE:\' . AS_SPATH . \'templates/grpResult.tpl.html\'
$cfg[\'tplGrpResult\'] = isset($tplGrpResult) ? $tplGrpResult : (isset($__tplGrpResult) ? $__tplGrpResult : $dcfg[\'tplGrpResult\']);

// &tplResult - Chunk to style each output result
// Default: "@FILE:" . AS_SPATH . \'templates/result.tpl.html\'
$cfg[\'tplResult\'] = isset($tplResult) ? $tplResult : (isset($__tplResult) ? $__tplResult : $dcfg[\'tplResult\']);

// &tplComment - Chunk to style the comment form (Also used with the ajax mode)
// Default: \'@FILE:\' . AS_SPATH . \'templates/comment.tpl.html\'
$cfg[\'tplComment\'] = isset($tplComment) ? $tplComment : (isset($__tplComment) ? $__tplComment : $dcfg[\'tplComment\']);

// &tplPaging0 - Chunk to style the paging links - type 0
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging0.tpl.html\'
$cfg[\'tplPaging0\'] = isset($tplPaging0) ? $tplPaging0 : (isset($__tplPaging0) ? $__tplPaging0 : $dcfg[\'tplPaging0\']);

// &tplPaging1 - Chunk to style the paging links - type 1
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging1.tpl.html\'
$cfg[\'tplPaging1\'] = isset($tplPaging1) ? $tplPaging1 : (isset($__tplPaging1) ? $__tplPaging1 : $dcfg[\'tplPaging1\']);

// &tplPaging2 - Chunk to style the paging links - type 2
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging2.tpl.html\'
$cfg[\'tplPaging2\'] = isset($tplPaging2) ? $tplPaging2 : (isset($__tplPaging2) ? $__tplPaging2 : $dcfg[\'tplPaging2\']);

// &stripInput - stripInput user function name
// Default: \'defaultStripInput\'
$cfg[\'stripInput\'] = isset($stripInput) ? $stripInput : (isset($__stripInput) ? $__stripInput : $dcfg[\'stripInput\']);

// &stripOutput - stripOutput user function name
// Default: \'defaultStripOutput\'
$cfg[\'stripOutput\'] = isset($stripOutput) ? $stripOutput : (isset($__stripOutput) ? $__stripOutput : $dcfg[\'stripOutput\']);

// &breadcrumbs
// 0 : disallow the breadcrumbs link
// Name of the breadcrumbs function : allow the breadcrumbs link
// The function name could be followed by some parameter initialization
// e.g: &breadcrumbs=`Breadcrumbs,showHomeCrumb:0,showCrumbsAtHome:1`
// Default: \'\' - empty string
$cfg[\'breadcrumbs\'] = isset($breadcrumbs) ? $breadcrumbs : (isset($__breadcrumbs) ? $__breadcrumbs : $dcfg[\'breadcrumbs\']);

// &tvPhx - display and set placeHolders for TV (template variables)
// 0 : disallow the feature
// 1 : allow the display of all Modx TVs of the document found (default)
// \'tb_alias:display_function_name[,[tb_alias:display_function_name]*]\' : set up placeholders for custom joined tables
// Default: 1 - tvPhx allowed for TV only
$cfg[\'tvPhx\'] = isset($tvPhx) ? $tvPhx : (isset($__tvPhx) ? $__tvPhx : $dcfg[\'tvPhx\']);

// &clearDefault - Clearing default text
// Set this to 1 if you would like to include the clear default js function
// add the class "cleardefault" to your input text form and set this parameter
// Default: 0
$cfg[\'clearDefault\'] = isset($clearDefault) ? $clearDefault : (isset($__clearDefault) ? $__clearDefault : $dcfg[\'clearDefault\']);

// &jsClearDefault - Location of the js library
// Default: AS_SPATH . \'js/clearDefault.js\'
$cfg[\'jsClearDefault\'] = $dcfg[\'jsClearDefault\'];

// &mbstring - php_mbstring extension available [0 | 1]
// Default: 1 - extension available
$cfg[\'mbstring\'] = isset($mbstring) ? $mbstring : (isset($__mbstring) ? $__mbstring : $dcfg[\'mbstring\']);

//  &asLog - ajaxSearch log [ level [: comment [: purge]]]
//  level:
//        0 : disallow the ajaxSearch log (Default)
//        1 : failed search requests are logged
//        2 : all ajaxSearch requests are logged
//  comment:
//        0 : user comment not allowed (Default)
//        1 : user comment allowed
//  purge: number of logs allowed before to do an automatic purge of the table
//        Default: 200
$cfg[\'asLog\'] = isset($asLog) ? $asLog : (isset($__asLog) ? $__asLog : $dcfg[\'asLog\']);


//------------------------------------------------------------------------------
// Configuration - Simple Ajax mode
//------------------------------------------------------------------------------

if ($cfg[\'ajaxSearch\']) {

    // $liveSearch [1 | 0] (as passed in snippet variable ONLY)
    // Set this to 1 if you would like to use the live search (i.e. results as you type)
    // Default: 0 - livesearch mode inactivated
    $cfg[\'liveSearch\'] = isset($liveSearch) ? $liveSearch : (isset($__liveSearch) ? $__liveSearch : $dcfg[\'liveSearch\']);

    // &ajaxMax [int] - The maximum number of results to show for the ajaxsearch
    // Default: 6
    $cfg[\'ajaxMax\'] = isset($ajaxMax) ? $ajaxMax : (isset($__ajaxMax) ? $__ajaxMax : $dcfg[\'ajaxMax\']);

    // &moreResultsPage [int]
    // The document id of the page you want the more results link to point to
    // Default: 0
    $cfg[\'moreResultsPage\'] = isset($moreResultsPage) ? $moreResultsPage : (isset($__moreResultsPage) ? $__moreResultsPage : $dcfg[\'moreResultsPage\']);

    // &opacity - set the opacity of the div ajaxSearch_output
    // Should be a float value: [ 0. < float <= 1. ]
    // Default: 1.
    $cfg[\'opacity\'] = isset($opacity) ? $opacity : (isset($__opacity) ? $__opacity : $dcfg[\'opacity\']);

    // &tplAjaxResults - Chunk to style the ajax output results outer
    // Default: \'\' - empty string
    $cfg[\'tplAjaxResults\'] = isset($tplAjaxResults) ? $tplAjaxResults : (isset($__tplAjaxResults) ? $__tplAjaxResults : $dcfg[\'tplAjaxResults\']);

    // &tplAjaxGrpResult - Chunk to style each ajax output group result outer
    // Default: \'\' - empty string
    $cfg[\'tplAjaxGrpResult\'] = isset($tplAjaxGrpResult) ? $tplAjaxGrpResult : (isset($__tplAjaxGrpResult) ? $__tplAjaxGrpResult : $dcfg[\'tplAjaxGrpResult\']);

    // &tplAjaxResult - Chunk to style each ajax output result
    // Default: \'\' - empty string
    $cfg[\'tplAjaxResult\'] = isset($tplAjaxResult) ? $tplAjaxResult : (isset($__tplAjaxResult) ? $__tplAjaxResult : $dcfg[\'tplAjaxResult\']);

    // &jscript [\'jquery\'|\'mootools2\'|\'mootools\']
    // Set this to jquery if you would like use the jquery library
    // set mootools2 to use the version 1.2 of mootools (limited to JS functions used by AS)
    // Default: \'mootools\' - use the version 1.11 of mootools provided with MODx
    $cfg[\'jscript\'] = isset($jscript) ? $jscript : (isset($__jscript) ? $__jscript : $dcfg[\'jscript\']);

    // &addJscript [1 | 0]
    // Set this to 1 if you would like to include or not the mootool/jquery library in the header of your pages automatically
    // Default: 1
    $cfg[\'addJscript\'] = isset($addJscript) ? $addJscript : (isset($__addJscript) ? $__addJscript : $dcfg[\'addJscript\']);

    // &jsMooTools - Location of the mootools javascript library (current version of MODx)
    // Default: \'manager/media/script/mootools/mootools.js\'
    $cfg[\'jsMooTools\'] = isset($jsMooTools) ? $jsMooTools : (isset($__jsMooTools) ? $__jsMooTools : $dcfg[\'jsMooTools\']);

    // &jsMooTools2 - Location of an alternative mootools javascript library
    // Default: AS_SPATH . \'js/mootools1.2/mootools.js\' - contains only the required functions for AS
    // to use an another library, use this parameter and change the ajaxSearch/js/ajaxSearch1/ajaxSearch-mootools2.js file
    $cfg[\'jsMooTools2\'] = isset($jsMooTools2) ? $jsMooTools2 : (isset($__jsMooTools2) ? $__jsMooTools2 : $dcfg[\'jsMooTools2\']);

    // &jsQuery - Location of the jquery javascript library
    // Default: AS_SPATH . \'js/jquery/jquery.js\'
    $cfg[\'jsJquery\'] = isset($jsJquery) ? $jsJquery : (isset($__jsJquery) ? $__jsJquery : $dcfg[\'jsJquery\']);
}

// ========================================================== End of config
include_once AS_PATH . "classes/ajaxSearch.class.inc.php";
if (class_exists(\'AjaxSearch\')) {
    $as = new AjaxSearch();
    $output = $as->run($tstart, $dcfg, $cfg);
} else {
    $output = "<h3>error: AjaxSearch class not found</h3>";
}
$elapsedTime = $modx->getMicroTime() - $tstart;
$etime = sprintf("%.4fs",$elapsedTime);
//$f=fopen(\'test.txt\',\'a+\');fwrite($f,"etime=".$etime."\\n\\n");
return $output;';
$s['AjaxSearch'] = '/**
--------------------------------------------------------------------------------
:: Preamble
--------------------------------------------------------------------------------
The release 1.9 looks like the previous release, but it is a completely
refactored development.

It is partially based on the previous releases of AjaxSearch written by the
following authors:

 Coroico <coroico@wangba.fr>
 Jason Coward <jason@opengeek.com>
 Kyle Jaebker <kjaebker@muddydogpaws.com>
 Ryan Thrash  <ryan@vertexworks.com>

--------------------------------------------------------------------------------
:: Description
--------------------------------------------------------------------------------

        Ajax and non-Ajax search that supports results highlighting.

This snippet adds AJAX functionality on top of the robust content searching.

What AjaxSearch do:
- search in fields of the content an TV MODx tables
- several customizable input forms available
- search in a subset of documents
- highlighting of searchword in the results returned
- allow a filtering of search results
- displaying of search results customizable thru templates
- group the search results by categories
- filter features (allow to set up specific search forms)

It could works in two modes:

ajax mode :
- search results displayed in current page through AJAX request
- multiple search options including live search
- available link to view all results in a new page when only a subset is returned
- customize the number of results returned
- offer two types for paginating the results
- uses the MooTools or JQuery js library for AJAX and visual effects

non-ajax mode :
- search results displayed in a new page or below on the same page
- offer two types for paginating the results
- works without JS enabled

What AjaxSearch don\'t :
- search in dynamic content. AjaxSearch could retreive only data stored in
database. It can\'t find something stored in a chunk or generated by a snippet.

MORE : See the ajaxSearch.readme.txt file for more informations. 

----------------------------------------------------------------------------- */

// ajaxSearch version being executed
define(\'AS_VERSION\', \'1.9.2\');
// Path where ajaxSearch is installed
define(\'AS_SPATH\', \'assets/snippets/ajaxSearch/\');
//include snippet file
define(\'AS_PATH\', MODX_BASE_PATH . AS_SPATH);

//------------------------------------------------------------------------------
// Configuration - general AjaxSearch snippet setup options
//------------------------------------------------------------------------------
global $modx;
$tstart = $modx->getMicroTime();

$cfg = array(); // current configuration
$cfg[\'version\'] = AS_VERSION;

// Load the default configuration $dcfg to get the default values
$default = AS_PATH . \'configs/default.config.php\';
if (file_exists($default)) include $default;
else return "<h3>AjaxSearch error: $default not found !<br />Check the existing of this file!</h3>";
if (!isset($dcfg)) return "<h3>AjaxSearch error: default configuration array not defined in $default!<br /> Check the content of this file!</h3>";

if ($dcfg[\'version\'] != AS_VERSION) return "<h3>AjaxSearch error: Version number mismatch. Check the content of the default configuration file!</h3>";

// check the possible use of deprecated parameters (since 1.8.5)
$readme = "ajaxSearch_version_192.txt";
if (isset($searchWordList)) return "<h3>AjaxSearch error: searchWordList is a deprecated parameter. Read " . $readme . " file.</h3>";
if (isset($resultsPage)) return "<h3>AjaxSearch error: resultsPage is a deprecated parameter. Read " . $readme . " file.</h3>";
if (isset($AS_showForm)) return "<h3>AjaxSearch error: AS_showForm parameter has been renamed showInputForm. Read " . $readme . " file.</h3>";
if (isset($AS_landing)) return "<h3>AjaxSearch error: AS_landing parameter has been renamed landingPage. Read " . $readme . " file.</h3>";
if (isset($AS_showResults)) return "<h3>AjaxSearch error: AS_showResults parameter has been renamed showResults. Read " . $readme . " file.</h3>";

// Load a custom configuration file if required
// config_name - Other config installed in the configs folder or in any folder within the MODx base path via @FILE
// Configuration files should be named in the form: <config_name>.config.php
// Default: \'\' - no custom config
$cfg[\'config\'] = isset($config) ? $config : $dcfg[\'config\'];
if ($cfg[\'config\']) {
    $config = $cfg[\'config\'];
    $lconfig = (substr($config, 0, 6) != "@FILE:") ? AS_PATH . "configs/$config.config.php" : $modx->config[\'base_path\'] . trim(substr($config, 6, strlen($config)-6));
    if (file_exists($lconfig)) include $lconfig;
    else return "<h3>AjaxSearch error: " . $lconfig . " not found !<br />Check your config parameter or your config file name!</h3>";
}

// &debug = [ 0 | 1 | 2 | 3 ]
// 1,2,3 : File mode - Output logged into a file named ajaxSearch_log.txt in ajaxSearch/debug/ directory.
// this directory should be writable.
// Default: 0 - no logs
$cfg[\'debug\'] = isset($debug) ? $debug : (isset($__debug) ? $__debug : $dcfg[\'debug\']);

// &timeLimit = [ int | 60 ]
// Max execution time in seconds for the AjaxSearch script
// 0 - If set to zero, no time limit is imposed
// Default: 60 - 1 minute.
$cfg[\'timeLimit\'] = isset($timeLimit) ? $timeLimit : (isset($__timeLimit) ? $__timeLimit : $dcfg[\'timeLimit\']);

// &language [ language_name | manager_language ] (optional)
// Default: $modx->config[\'manager_language\'] - manager language used
$cfg[\'language\'] = isset($language) ? $language : (isset($__language) ? $__language : $dcfg[\'language\']);

// &ajaxSearch [1 | 0] (as passed in snippet variable ONLY)
// Use this to display the search results using ajax You must include the Mootools library in your template
// Default: 1 - ajax mode selected
$cfg[\'ajaxSearch\'] = isset($ajaxSearch) ? $ajaxSearch : (isset($__ajaxSearch) ? $__ajaxSearch : $dcfg[\'ajaxSearch\']);

// &advSearch [ \'exactphrase\' | \'allwords\' | \'nowords\' | \'oneword\' ]
// Advanced search:
// - exactphrase : provides the documents which contain the exact phrase
// - allwords : provides the documents which contain all the words
// - nowords : provides the documents which do not contain the words
// - oneword : provides the document which contain at least one word
// Default: \'oneword\'
$cfg[\'advSearch\'] = isset($advSearch) ? $advSearch : (isset($__advSearch) ? $__advSearch : $dcfg[\'advSearch\']);

// &asId - Unique id for AjaxSearch instance
// this allows to distinguish several Ajaxsearch instances on the same page
// Any combination of characters a-z, underscores, and numbers 0-9
// This is case sensitive. Default = empty string
// With ajax mode, the first snippet call of the page shouldn\'t use the asId parameter
$cfg[\'asId\'] = isset($asId) ? $asId : (isset($__asId) ? $__asId : $dcfg[\'asId\']);

// &whereSearch
// Define where should occur the search
// a separated list of keywords describing the tables where to search
// keywords allowed :
// "content" for site_content, "tv" for site_tmplvar_contentvalues, "jot" for jot_content, "maxigallery" for maxigallery
// you could add your own keywords. But the keyword should be a user function which describes the tables to use
// all the text fields are searchable but you could specify the fields like this:
// whereSearch=`content:pagetitle,introtext,content|tv:tv_value|maxigallery:gal_title`
// Default: \'content|tv\'
$cfg[\'whereSearch\'] = isset($whereSearch) ? $whereSearch : (isset($__whereSearch) ? $__whereSearch : $dcfg[\'whereSearch\']);

// &sites : [comma separated list of sites]
// sites allow to define sites where to do the search
$cfg[\'sites\'] = isset($sites) ? $sites : (isset($__sites) ? $__sites : $dcfg[\'sites\']);

// &subSearch  [comma separated list of subsites]
// subSearch allow to define sub-domains or subsites where to do the search
$cfg[\'subSearch\'] = isset($subSearch) ? $subSearch : (isset($__subSearch) ? $__subSearch : $dcfg[\'subSearch\']);

// &category  [ tv_name ]
// Any combination of characters a-z, underscores, and numbers 0-9
// This is case sensitive. Default = empty string
// Name of a TV. The category of a MODx document is provided by this TV content
$cfg[\'category\'] = isset($category) ? $category : (isset($__category) ? $__category : $dcfg[\'category\']);

// &display [ \'mixed\' | \'unmixed\' ]
// When results comes from differents sites, subsites or categories, you could choose to display the results mixed or unmixed.
// Default: unmixed
// Unmixed mode display the results grouped by site, subsite or category. Each group of results could be paginated.
// Mixed mode mixe all the results coming from the differents area.
// With unmixed mode, results are ordered by the field provided by the first field of the order parameter
$cfg[\'display\'] = isset($display) ? $display : (isset($__display) ? $__display : $dcfg[\'display\']);

// &init  [ \'none\' | \'all\' ]
// init defines if the search display all the results or none when the search term is an empty string
// Default: none
$cfg[\'init\'] = isset($init) ? $init : (isset($__init) ? $__init : $dcfg[\'init\']);

// &withTvs - Define which Tvs are used for the search in Tvs
// a comma separated list of TV names
// Default: \'\' - all TVs are used (empty list)
$cfg[\'withTvs\'] = isset($withTvs) ? $withTvs : (isset($__withTvs) ? $__withTvs : $dcfg[\'withTvs\']);

// &order - Define the sort order of results
// Comma separated list of fields defined as searchable in the table definition
// to suppress the sorting, use &order=``
// Default: \'pub_date,pagetitle\'
$cfg[\'order\'] = isset($order) ? $order : (isset($__order) ? $__order : $dcfg[\'order\']);

// &rank - Define the rank of search results. Results are sorted by rank value
// Comma separated list of fields with optionally user defined weight
// Default: \'pagetitle:100,extract\'
// to suppress the rank sorting, use &rank=``;
// &rank sort occurs after the &order sort
$cfg[\'rank\'] = isset($rank) ? $rank : (isset($__rank) ? $__rank : $dcfg[\'rank\']);

// &maxWords [ 1 < int < 10 ]
// Maximum number of words for searching
// Default: 5
$cfg[\'maxWords\'] = isset($maxWords) ? intval($maxWords) : (isset($__maxWords) ? intval($__maxWords) : $dcfg[\'maxWords\']);

// &minChars [  2 < int < 100 ]
// Minimum number of characters to require for a word to be valid for searching.
// length of each word with $advSearch = \'allwords\', \'oneword\' or \'nowords\'
// length of the search string with possible spaces with $advSearch = \'exactphrase\'
// Default: 3
$cfg[\'minChars\'] = isset($minChars) ? intval($minChars) : (isset($__minChars) ? intval($__minChars) : $dcfg[\'minChars\']);

// &showInputForm [0 | 1]
// If you would like to turn off the search form when showing results you can set this to false.(1=true, 0=false)
// Default: 1
$cfg[\'showInputForm\'] = isset($showInputForm) ? $showInputForm : (isset($__showInputForm) ? $__showInputForm : $dcfg[\'showInputForm\']);

// &showIntro [0 | 1]
// If you would like to turn off the intro message beyond the input form you can set this to false.(1=true, 0=false)
// Default: 1
$cfg[\'showIntro\'] = isset($showIntro) ? $showIntro : (isset($__showIntro) ? $__showIntro : $dcfg[\'showIntro\']);

// &grabMax [ int ]
// Set to the max number of records you would like on each page. Set to 0 if unlimited.
// Default: 10
$cfg[\'grabMax\'] = isset($grabMax) ? intval($grabMax) : (isset($__grabMax) ? intval($__grabMax) : $dcfg[\'grabMax\']);

// &extract [ n:searchable fields list | 1:content,description,introtext,tv_content]
// show the search terms highlighted in a little extract
// n : maximum number of extracts displayed
// ordered searchable fields list : separated list of fields define as searchable in the table definition
// Default: \'1:content,description,introtext,tv_value\' - One extract from content then description,introtext,tv_value
$cfg[\'extract\'] = isset($extract) ? $extract : (isset($__extract) ? $__extract : $dcfg[\'extract\']);

// &extractLength [ 50 < int < 800]
// Length of extract around the search words found - between 50 and 800 characters
// Default: 200
$cfg[\'extractLength\'] = isset($extractLength) ? intval($extractLength) : (isset($__extractLength) ? intval($__extractLength) : $dcfg[\'extractLength\']);

// &extractEllips [ string ]
// Ellipside to mark the star and the end of  an extract when the sentence is cutting
// Default: \'...\'
$cfg[\'extractEllips\'] = isset($extractEllips) ? $extractEllips : (isset($__extractEllips) ? $__extractEllips : $dcfg[\'extractEllips\']);

// &extractSeparator [ string ]
// Any html tag to mark the separation between extracts
// Default: \'<br />\' - but you could also choose for instance \'<hr />\'
$cfg[\'extractSeparator\'] = isset($extractSeparator) ? $extractSeparator : (isset($__extractSeparator) ? $__extractSeparator : $dcfg[\'extractSeparator\']);

// &formatDate [ string ]
// The format of outputted dates. See http://www.php.net/manual/en/function.date.php
// Default: \'d/m/y : H:i:s\' - e.g: 21/01/08 : 23:09:22
$cfg[\'formatDate\'] = isset($formatDate) ? $formatDate : (isset($__formatDate) ? $__formatDate : $dcfg[\'formatDate\']);

// &highlightResult [1 | 0]
// create links so that search terms will be highlighted when linked page clicked
// Default: 1 - Results highlighted
$cfg[\'highlightResult\'] = isset($highlightResult) ? $highlightResult : (isset($__highlightResult) ? $__highlightResult : $dcfg[\'highlightResult\']);

// &pagingType[ 0 | 1 | 2 ]
// Determine the pagination type used - Default 1 : Previous - X-Y/Z - Next
$cfg[\'pagingType\'] = isset($pagingType) ? $pagingType : (isset($__pagingType) ? $__pagingType : $dcfg[\'pagingType\']);

// &pageLinkSeparator [ string ]
// What you want, if anything, between your page link numbers
// Default: \' | \'
$cfg[\'pageLinkSeparator\'] = isset($pageLinkSeparator) ? $pageLinkSeparator : (isset($__pageLinkSeparator) ? $__pageLinkSeparator : $dcfg[\'pageLinkSeparator\']);

// &showPagingAlways[1 | 0]
// Determine whether or not to always show paging
$cfg[\'showPagingAlways\'] = isset($showPagingAlways) ? $showPagingAlways : (isset($__showPagingAlways) ? $__showPagingAlways : $dcfg[\'showPagingAlways\']);

// &landingPage  [int] set the page to show the results page (non Ajax search)
// Default: false
$cfg[\'landingPage\'] = isset($landingPage) ? $landingPage : (isset($__landingPage) ? $__landingPage : $dcfg[\'landingPage\']);

// &showResults  [1 | 0]  establish whether to show the results or not
// Default: 1
$cfg[\'showResults\'] = isset($showResults) ? $showResults : (isset($__showResults) ? $__showResults : $dcfg[\'showResults\']);

// &parents [ [ in | not in ] : comma separated list of Ids | \'\' ]
// Ids of documents to retrieve their children to &depth depth  where to do the search in or not in
// Default: \'\' - empty list
$cfg[\'parents\'] = isset($parents) ? $parents : (isset($__parents) ? $__parents : $dcfg[\'parents\']);

// &documents [ [ in | not in ] : comma separated list of Ids | \'\' ]
// Ids of documents where to do the search in or not in
// Default: \'\' - empty list
$cfg[\'documents\'] = isset($documents) ? $documents : (isset($__documents) ? $__documents : $dcfg[\'documents\']);

// &depth [ 0 < int ] Number of levels deep to retrieve documents
// Default: 10
$cfg[\'depth\'] = isset($depth) ? intval($depth) : (isset($__depth) ? intval($__depth) : $dcfg[\'depth\']);

// &hideMenu [0 | 1| 2]  Search in hidden documents from menu.
// 0 - search only in documents visible from menu
// 1 - search only in documents hidden from menu
// 2 - search in hidden or visible documents from menu
// Default: 2
$cfg[\'hideMenu\'] = isset($hideMenu) ? $hideMenu : (isset($__hideMenu) ? $__hideMenu : $dcfg[\'hideMenu\']);

// &hideLink [0 | 1 ]   Search in content of type reference (link)
// 0 - search in content of type document AND reference
// 1 - search only in content of type document
// Default: 1
$cfg[\'hideLink\'] = isset($hideLink) ? $hideLink : (isset($__hideLink) ? $__hideLink : $dcfg[\'hideLink\']);

// &filter - Basic filtering : remove unwanted documents that meets the criteria of the filter
// See Ditto 2 Basic filtering and the ajaxSearch demo site for more information
// Default: \'\' - empty list
$cfg[\'filter\'] = isset($filter) ? $filter : (isset($__filter) ? $__filter : $dcfg[\'filter\']);

// &output [0 | 1 ]Custom layout
// Default: 0 - Results are listed just under the input form
// 1 - custom layout. put [+as.inputForm+] and [+as.results+] where you want to define the layout
$cfg[\'output\'] = isset($output) ? $output : (isset($__output) ? $__output : $dcfg[\'output\']);

// &tplInput - Chunk to style the ajaxSearch input form
// Default: \'@FILE:\' . AS_SPATH . \'templates/input.tpl.html\'
$cfg[\'tplInput\'] = isset($tplInput) ? $tplInput : (isset($__tplInput) ? $__tplInput : $dcfg[\'tplInput\']);

// &tplResults - Chunk to style the non-ajax output results outer
// Default: \'@FILE:\' . AS_SPATH . \'templates/results.tpl.html\'
$cfg[\'tplResults\'] = isset($tplResults) ? $tplResults : (isset($__tplResults) ? $__tplResults : $dcfg[\'tplResults\']);

// &tplGrpResult - Chunk to style the non-ajax output group result outer
// Default: \'@FILE:\' . AS_SPATH . \'templates/grpResult.tpl.html\'
$cfg[\'tplGrpResult\'] = isset($tplGrpResult) ? $tplGrpResult : (isset($__tplGrpResult) ? $__tplGrpResult : $dcfg[\'tplGrpResult\']);

// &tplResult - Chunk to style each output result
// Default: "@FILE:" . AS_SPATH . \'templates/result.tpl.html\'
$cfg[\'tplResult\'] = isset($tplResult) ? $tplResult : (isset($__tplResult) ? $__tplResult : $dcfg[\'tplResult\']);

// &tplComment - Chunk to style the comment form (Also used with the ajax mode)
// Default: \'@FILE:\' . AS_SPATH . \'templates/comment.tpl.html\'
$cfg[\'tplComment\'] = isset($tplComment) ? $tplComment : (isset($__tplComment) ? $__tplComment : $dcfg[\'tplComment\']);

// &tplPaging0 - Chunk to style the paging links - type 0
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging0.tpl.html\'
$cfg[\'tplPaging0\'] = isset($tplPaging0) ? $tplPaging0 : (isset($__tplPaging0) ? $__tplPaging0 : $dcfg[\'tplPaging0\']);

// &tplPaging1 - Chunk to style the paging links - type 1
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging1.tpl.html\'
$cfg[\'tplPaging1\'] = isset($tplPaging1) ? $tplPaging1 : (isset($__tplPaging1) ? $__tplPaging1 : $dcfg[\'tplPaging1\']);

// &tplPaging2 - Chunk to style the paging links - type 2
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging2.tpl.html\'
$cfg[\'tplPaging2\'] = isset($tplPaging2) ? $tplPaging2 : (isset($__tplPaging2) ? $__tplPaging2 : $dcfg[\'tplPaging2\']);

// &stripInput - stripInput user function name
// Default: \'defaultStripInput\'
$cfg[\'stripInput\'] = isset($stripInput) ? $stripInput : (isset($__stripInput) ? $__stripInput : $dcfg[\'stripInput\']);

// &stripOutput - stripOutput user function name
// Default: \'defaultStripOutput\'
$cfg[\'stripOutput\'] = isset($stripOutput) ? $stripOutput : (isset($__stripOutput) ? $__stripOutput : $dcfg[\'stripOutput\']);

// &breadcrumbs
// 0 : disallow the breadcrumbs link
// Name of the breadcrumbs function : allow the breadcrumbs link
// The function name could be followed by some parameter initialization
// e.g: &breadcrumbs=`Breadcrumbs,showHomeCrumb:0,showCrumbsAtHome:1`
// Default: \'\' - empty string
$cfg[\'breadcrumbs\'] = isset($breadcrumbs) ? $breadcrumbs : (isset($__breadcrumbs) ? $__breadcrumbs : $dcfg[\'breadcrumbs\']);

// &tvPhx - display and set placeHolders for TV (template variables)
// 0 : disallow the feature
// 1 : allow the display of all Modx TVs of the document found (default)
// \'tb_alias:display_function_name[,[tb_alias:display_function_name]*]\' : set up placeholders for custom joined tables
// Default: 1 - tvPhx allowed for TV only
$cfg[\'tvPhx\'] = isset($tvPhx) ? $tvPhx : (isset($__tvPhx) ? $__tvPhx : $dcfg[\'tvPhx\']);

// &clearDefault - Clearing default text
// Set this to 1 if you would like to include the clear default js function
// add the class "cleardefault" to your input text form and set this parameter
// Default: 0
$cfg[\'clearDefault\'] = isset($clearDefault) ? $clearDefault : (isset($__clearDefault) ? $__clearDefault : $dcfg[\'clearDefault\']);

// &jsClearDefault - Location of the js library
// Default: AS_SPATH . \'js/clearDefault.js\'
$cfg[\'jsClearDefault\'] = $dcfg[\'jsClearDefault\'];

// &mbstring - php_mbstring extension available [0 | 1]
// Default: 1 - extension available
$cfg[\'mbstring\'] = isset($mbstring) ? $mbstring : (isset($__mbstring) ? $__mbstring : $dcfg[\'mbstring\']);

//  &asLog - ajaxSearch log [ level [: comment [: purge]]]
//  level:
//        0 : disallow the ajaxSearch log (Default)
//        1 : failed search requests are logged
//        2 : all ajaxSearch requests are logged
//  comment:
//        0 : user comment not allowed (Default)
//        1 : user comment allowed
//  purge: number of logs allowed before to do an automatic purge of the table
//        Default: 200
$cfg[\'asLog\'] = isset($asLog) ? $asLog : (isset($__asLog) ? $__asLog : $dcfg[\'asLog\']);


//------------------------------------------------------------------------------
// Configuration - Simple Ajax mode
//------------------------------------------------------------------------------

if ($cfg[\'ajaxSearch\']) {

    // $liveSearch [1 | 0] (as passed in snippet variable ONLY)
    // Set this to 1 if you would like to use the live search (i.e. results as you type)
    // Default: 0 - livesearch mode inactivated
    $cfg[\'liveSearch\'] = isset($liveSearch) ? $liveSearch : (isset($__liveSearch) ? $__liveSearch : $dcfg[\'liveSearch\']);

    // &ajaxMax [int] - The maximum number of results to show for the ajaxsearch
    // Default: 6
    $cfg[\'ajaxMax\'] = isset($ajaxMax) ? $ajaxMax : (isset($__ajaxMax) ? $__ajaxMax : $dcfg[\'ajaxMax\']);

    // &moreResultsPage [int]
    // The document id of the page you want the more results link to point to
    // Default: 0
    $cfg[\'moreResultsPage\'] = isset($moreResultsPage) ? $moreResultsPage : (isset($__moreResultsPage) ? $__moreResultsPage : $dcfg[\'moreResultsPage\']);

    // &opacity - set the opacity of the div ajaxSearch_output
    // Should be a float value: [ 0. < float <= 1. ]
    // Default: 1.
    $cfg[\'opacity\'] = isset($opacity) ? $opacity : (isset($__opacity) ? $__opacity : $dcfg[\'opacity\']);

    // &tplAjaxResults - Chunk to style the ajax output results outer
    // Default: \'\' - empty string
    $cfg[\'tplAjaxResults\'] = isset($tplAjaxResults) ? $tplAjaxResults : (isset($__tplAjaxResults) ? $__tplAjaxResults : $dcfg[\'tplAjaxResults\']);

    // &tplAjaxGrpResult - Chunk to style each ajax output group result outer
    // Default: \'\' - empty string
    $cfg[\'tplAjaxGrpResult\'] = isset($tplAjaxGrpResult) ? $tplAjaxGrpResult : (isset($__tplAjaxGrpResult) ? $__tplAjaxGrpResult : $dcfg[\'tplAjaxGrpResult\']);

    // &tplAjaxResult - Chunk to style each ajax output result
    // Default: \'\' - empty string
    $cfg[\'tplAjaxResult\'] = isset($tplAjaxResult) ? $tplAjaxResult : (isset($__tplAjaxResult) ? $__tplAjaxResult : $dcfg[\'tplAjaxResult\']);

    // &jscript [\'jquery\'|\'mootools2\'|\'mootools\']
    // Set this to jquery if you would like use the jquery library
    // set mootools2 to use the version 1.2 of mootools (limited to JS functions used by AS)
    // Default: \'mootools\' - use the version 1.11 of mootools provided with MODx
    $cfg[\'jscript\'] = isset($jscript) ? $jscript : (isset($__jscript) ? $__jscript : $dcfg[\'jscript\']);

    // &addJscript [1 | 0]
    // Set this to 1 if you would like to include or not the mootool/jquery library in the header of your pages automatically
    // Default: 1
    $cfg[\'addJscript\'] = isset($addJscript) ? $addJscript : (isset($__addJscript) ? $__addJscript : $dcfg[\'addJscript\']);

    // &jsMooTools - Location of the mootools javascript library (current version of MODx)
    // Default: \'manager/media/script/mootools/mootools.js\'
    $cfg[\'jsMooTools\'] = isset($jsMooTools) ? $jsMooTools : (isset($__jsMooTools) ? $__jsMooTools : $dcfg[\'jsMooTools\']);

    // &jsMooTools2 - Location of an alternative mootools javascript library
    // Default: AS_SPATH . \'js/mootools1.2/mootools.js\' - contains only the required functions for AS
    // to use an another library, use this parameter and change the ajaxSearch/js/ajaxSearch1/ajaxSearch-mootools2.js file
    $cfg[\'jsMooTools2\'] = isset($jsMooTools2) ? $jsMooTools2 : (isset($__jsMooTools2) ? $__jsMooTools2 : $dcfg[\'jsMooTools2\']);

    // &jsQuery - Location of the jquery javascript library
    // Default: AS_SPATH . \'js/jquery/jquery.js\'
    $cfg[\'jsJquery\'] = isset($jsJquery) ? $jsJquery : (isset($__jsJquery) ? $__jsJquery : $dcfg[\'jsJquery\']);
}

// ========================================================== End of config
include_once AS_PATH . "classes/ajaxSearch.class.inc.php";
if (class_exists(\'AjaxSearch\')) {
    $as = new AjaxSearch();
    $output = $as->run($tstart, $dcfg, $cfg);
} else {
    $output = "<h3>error: AjaxSearch class not found</h3>";
}
$elapsedTime = $modx->getMicroTime() - $tstart;
$etime = sprintf("%.4fs",$elapsedTime);
//$f=fopen(\'test.txt\',\'a+\');fwrite($f,"etime=".$etime."\\n\\n");
return $output;';
$s['AjaxSearch'] = '/**
--------------------------------------------------------------------------------
:: Preamble
--------------------------------------------------------------------------------
The release 1.9 looks like the previous release, but it is a completely
refactored development.

It is partially based on the previous releases of AjaxSearch written by the
following authors:

 Coroico <coroico@wangba.fr>
 Jason Coward <jason@opengeek.com>
 Kyle Jaebker <kjaebker@muddydogpaws.com>
 Ryan Thrash  <ryan@vertexworks.com>

--------------------------------------------------------------------------------
:: Description
--------------------------------------------------------------------------------

        Ajax and non-Ajax search that supports results highlighting.

This snippet adds AJAX functionality on top of the robust content searching.

What AjaxSearch do:
- search in fields of the content an TV MODx tables
- several customizable input forms available
- search in a subset of documents
- highlighting of searchword in the results returned
- allow a filtering of search results
- displaying of search results customizable thru templates
- group the search results by categories
- filter features (allow to set up specific search forms)

It could works in two modes:

ajax mode :
- search results displayed in current page through AJAX request
- multiple search options including live search
- available link to view all results in a new page when only a subset is returned
- customize the number of results returned
- offer two types for paginating the results
- uses the MooTools or JQuery js library for AJAX and visual effects

non-ajax mode :
- search results displayed in a new page or below on the same page
- offer two types for paginating the results
- works without JS enabled

What AjaxSearch don\'t :
- search in dynamic content. AjaxSearch could retreive only data stored in
database. It can\'t find something stored in a chunk or generated by a snippet.

MORE : See the ajaxSearch.readme.txt file for more informations. 

----------------------------------------------------------------------------- */

// ajaxSearch version being executed
define(\'AS_VERSION\', \'1.9.2\');
// Path where ajaxSearch is installed
define(\'AS_SPATH\', \'assets/snippets/ajaxSearch/\');
//include snippet file
define(\'AS_PATH\', MODX_BASE_PATH . AS_SPATH);

//------------------------------------------------------------------------------
// Configuration - general AjaxSearch snippet setup options
//------------------------------------------------------------------------------
global $modx;
$tstart = $modx->getMicroTime();

$cfg = array(); // current configuration
$cfg[\'version\'] = AS_VERSION;

// Load the default configuration $dcfg to get the default values
$default = AS_PATH . \'configs/default.config.php\';
if (file_exists($default)) include $default;
else return "<h3>AjaxSearch error: $default not found !<br />Check the existing of this file!</h3>";
if (!isset($dcfg)) return "<h3>AjaxSearch error: default configuration array not defined in $default!<br /> Check the content of this file!</h3>";

if ($dcfg[\'version\'] != AS_VERSION) return "<h3>AjaxSearch error: Version number mismatch. Check the content of the default configuration file!</h3>";

// check the possible use of deprecated parameters (since 1.8.5)
$readme = "ajaxSearch_version_192.txt";
if (isset($searchWordList)) return "<h3>AjaxSearch error: searchWordList is a deprecated parameter. Read " . $readme . " file.</h3>";
if (isset($resultsPage)) return "<h3>AjaxSearch error: resultsPage is a deprecated parameter. Read " . $readme . " file.</h3>";
if (isset($AS_showForm)) return "<h3>AjaxSearch error: AS_showForm parameter has been renamed showInputForm. Read " . $readme . " file.</h3>";
if (isset($AS_landing)) return "<h3>AjaxSearch error: AS_landing parameter has been renamed landingPage. Read " . $readme . " file.</h3>";
if (isset($AS_showResults)) return "<h3>AjaxSearch error: AS_showResults parameter has been renamed showResults. Read " . $readme . " file.</h3>";

// Load a custom configuration file if required
// config_name - Other config installed in the configs folder or in any folder within the MODx base path via @FILE
// Configuration files should be named in the form: <config_name>.config.php
// Default: \'\' - no custom config
$cfg[\'config\'] = isset($config) ? $config : $dcfg[\'config\'];
if ($cfg[\'config\']) {
    $config = $cfg[\'config\'];
    $lconfig = (substr($config, 0, 6) != "@FILE:") ? AS_PATH . "configs/$config.config.php" : $modx->config[\'base_path\'] . trim(substr($config, 6, strlen($config)-6));
    if (file_exists($lconfig)) include $lconfig;
    else return "<h3>AjaxSearch error: " . $lconfig . " not found !<br />Check your config parameter or your config file name!</h3>";
}

// &debug = [ 0 | 1 | 2 | 3 ]
// 1,2,3 : File mode - Output logged into a file named ajaxSearch_log.txt in ajaxSearch/debug/ directory.
// this directory should be writable.
// Default: 0 - no logs
$cfg[\'debug\'] = isset($debug) ? $debug : (isset($__debug) ? $__debug : $dcfg[\'debug\']);

// &timeLimit = [ int | 60 ]
// Max execution time in seconds for the AjaxSearch script
// 0 - If set to zero, no time limit is imposed
// Default: 60 - 1 minute.
$cfg[\'timeLimit\'] = isset($timeLimit) ? $timeLimit : (isset($__timeLimit) ? $__timeLimit : $dcfg[\'timeLimit\']);

// &language [ language_name | manager_language ] (optional)
// Default: $modx->config[\'manager_language\'] - manager language used
$cfg[\'language\'] = isset($language) ? $language : (isset($__language) ? $__language : $dcfg[\'language\']);

// &ajaxSearch [1 | 0] (as passed in snippet variable ONLY)
// Use this to display the search results using ajax You must include the Mootools library in your template
// Default: 1 - ajax mode selected
$cfg[\'ajaxSearch\'] = isset($ajaxSearch) ? $ajaxSearch : (isset($__ajaxSearch) ? $__ajaxSearch : $dcfg[\'ajaxSearch\']);

// &advSearch [ \'exactphrase\' | \'allwords\' | \'nowords\' | \'oneword\' ]
// Advanced search:
// - exactphrase : provides the documents which contain the exact phrase
// - allwords : provides the documents which contain all the words
// - nowords : provides the documents which do not contain the words
// - oneword : provides the document which contain at least one word
// Default: \'oneword\'
$cfg[\'advSearch\'] = isset($advSearch) ? $advSearch : (isset($__advSearch) ? $__advSearch : $dcfg[\'advSearch\']);

// &asId - Unique id for AjaxSearch instance
// this allows to distinguish several Ajaxsearch instances on the same page
// Any combination of characters a-z, underscores, and numbers 0-9
// This is case sensitive. Default = empty string
// With ajax mode, the first snippet call of the page shouldn\'t use the asId parameter
$cfg[\'asId\'] = isset($asId) ? $asId : (isset($__asId) ? $__asId : $dcfg[\'asId\']);

// &whereSearch
// Define where should occur the search
// a separated list of keywords describing the tables where to search
// keywords allowed :
// "content" for site_content, "tv" for site_tmplvar_contentvalues, "jot" for jot_content, "maxigallery" for maxigallery
// you could add your own keywords. But the keyword should be a user function which describes the tables to use
// all the text fields are searchable but you could specify the fields like this:
// whereSearch=`content:pagetitle,introtext,content|tv:tv_value|maxigallery:gal_title`
// Default: \'content|tv\'
$cfg[\'whereSearch\'] = isset($whereSearch) ? $whereSearch : (isset($__whereSearch) ? $__whereSearch : $dcfg[\'whereSearch\']);

// &sites : [comma separated list of sites]
// sites allow to define sites where to do the search
$cfg[\'sites\'] = isset($sites) ? $sites : (isset($__sites) ? $__sites : $dcfg[\'sites\']);

// &subSearch  [comma separated list of subsites]
// subSearch allow to define sub-domains or subsites where to do the search
$cfg[\'subSearch\'] = isset($subSearch) ? $subSearch : (isset($__subSearch) ? $__subSearch : $dcfg[\'subSearch\']);

// &category  [ tv_name ]
// Any combination of characters a-z, underscores, and numbers 0-9
// This is case sensitive. Default = empty string
// Name of a TV. The category of a MODx document is provided by this TV content
$cfg[\'category\'] = isset($category) ? $category : (isset($__category) ? $__category : $dcfg[\'category\']);

// &display [ \'mixed\' | \'unmixed\' ]
// When results comes from differents sites, subsites or categories, you could choose to display the results mixed or unmixed.
// Default: unmixed
// Unmixed mode display the results grouped by site, subsite or category. Each group of results could be paginated.
// Mixed mode mixe all the results coming from the differents area.
// With unmixed mode, results are ordered by the field provided by the first field of the order parameter
$cfg[\'display\'] = isset($display) ? $display : (isset($__display) ? $__display : $dcfg[\'display\']);

// &init  [ \'none\' | \'all\' ]
// init defines if the search display all the results or none when the search term is an empty string
// Default: none
$cfg[\'init\'] = isset($init) ? $init : (isset($__init) ? $__init : $dcfg[\'init\']);

// &withTvs - Define which Tvs are used for the search in Tvs
// a comma separated list of TV names
// Default: \'\' - all TVs are used (empty list)
$cfg[\'withTvs\'] = isset($withTvs) ? $withTvs : (isset($__withTvs) ? $__withTvs : $dcfg[\'withTvs\']);

// &order - Define the sort order of results
// Comma separated list of fields defined as searchable in the table definition
// to suppress the sorting, use &order=``
// Default: \'pub_date,pagetitle\'
$cfg[\'order\'] = isset($order) ? $order : (isset($__order) ? $__order : $dcfg[\'order\']);

// &rank - Define the rank of search results. Results are sorted by rank value
// Comma separated list of fields with optionally user defined weight
// Default: \'pagetitle:100,extract\'
// to suppress the rank sorting, use &rank=``;
// &rank sort occurs after the &order sort
$cfg[\'rank\'] = isset($rank) ? $rank : (isset($__rank) ? $__rank : $dcfg[\'rank\']);

// &maxWords [ 1 < int < 10 ]
// Maximum number of words for searching
// Default: 5
$cfg[\'maxWords\'] = isset($maxWords) ? intval($maxWords) : (isset($__maxWords) ? intval($__maxWords) : $dcfg[\'maxWords\']);

// &minChars [  2 < int < 100 ]
// Minimum number of characters to require for a word to be valid for searching.
// length of each word with $advSearch = \'allwords\', \'oneword\' or \'nowords\'
// length of the search string with possible spaces with $advSearch = \'exactphrase\'
// Default: 3
$cfg[\'minChars\'] = isset($minChars) ? intval($minChars) : (isset($__minChars) ? intval($__minChars) : $dcfg[\'minChars\']);

// &showInputForm [0 | 1]
// If you would like to turn off the search form when showing results you can set this to false.(1=true, 0=false)
// Default: 1
$cfg[\'showInputForm\'] = isset($showInputForm) ? $showInputForm : (isset($__showInputForm) ? $__showInputForm : $dcfg[\'showInputForm\']);

// &showIntro [0 | 1]
// If you would like to turn off the intro message beyond the input form you can set this to false.(1=true, 0=false)
// Default: 1
$cfg[\'showIntro\'] = isset($showIntro) ? $showIntro : (isset($__showIntro) ? $__showIntro : $dcfg[\'showIntro\']);

// &grabMax [ int ]
// Set to the max number of records you would like on each page. Set to 0 if unlimited.
// Default: 10
$cfg[\'grabMax\'] = isset($grabMax) ? intval($grabMax) : (isset($__grabMax) ? intval($__grabMax) : $dcfg[\'grabMax\']);

// &extract [ n:searchable fields list | 1:content,description,introtext,tv_content]
// show the search terms highlighted in a little extract
// n : maximum number of extracts displayed
// ordered searchable fields list : separated list of fields define as searchable in the table definition
// Default: \'1:content,description,introtext,tv_value\' - One extract from content then description,introtext,tv_value
$cfg[\'extract\'] = isset($extract) ? $extract : (isset($__extract) ? $__extract : $dcfg[\'extract\']);

// &extractLength [ 50 < int < 800]
// Length of extract around the search words found - between 50 and 800 characters
// Default: 200
$cfg[\'extractLength\'] = isset($extractLength) ? intval($extractLength) : (isset($__extractLength) ? intval($__extractLength) : $dcfg[\'extractLength\']);

// &extractEllips [ string ]
// Ellipside to mark the star and the end of  an extract when the sentence is cutting
// Default: \'...\'
$cfg[\'extractEllips\'] = isset($extractEllips) ? $extractEllips : (isset($__extractEllips) ? $__extractEllips : $dcfg[\'extractEllips\']);

// &extractSeparator [ string ]
// Any html tag to mark the separation between extracts
// Default: \'<br />\' - but you could also choose for instance \'<hr />\'
$cfg[\'extractSeparator\'] = isset($extractSeparator) ? $extractSeparator : (isset($__extractSeparator) ? $__extractSeparator : $dcfg[\'extractSeparator\']);

// &formatDate [ string ]
// The format of outputted dates. See http://www.php.net/manual/en/function.date.php
// Default: \'d/m/y : H:i:s\' - e.g: 21/01/08 : 23:09:22
$cfg[\'formatDate\'] = isset($formatDate) ? $formatDate : (isset($__formatDate) ? $__formatDate : $dcfg[\'formatDate\']);

// &highlightResult [1 | 0]
// create links so that search terms will be highlighted when linked page clicked
// Default: 1 - Results highlighted
$cfg[\'highlightResult\'] = isset($highlightResult) ? $highlightResult : (isset($__highlightResult) ? $__highlightResult : $dcfg[\'highlightResult\']);

// &pagingType[ 0 | 1 | 2 ]
// Determine the pagination type used - Default 1 : Previous - X-Y/Z - Next
$cfg[\'pagingType\'] = isset($pagingType) ? $pagingType : (isset($__pagingType) ? $__pagingType : $dcfg[\'pagingType\']);

// &pageLinkSeparator [ string ]
// What you want, if anything, between your page link numbers
// Default: \' | \'
$cfg[\'pageLinkSeparator\'] = isset($pageLinkSeparator) ? $pageLinkSeparator : (isset($__pageLinkSeparator) ? $__pageLinkSeparator : $dcfg[\'pageLinkSeparator\']);

// &showPagingAlways[1 | 0]
// Determine whether or not to always show paging
$cfg[\'showPagingAlways\'] = isset($showPagingAlways) ? $showPagingAlways : (isset($__showPagingAlways) ? $__showPagingAlways : $dcfg[\'showPagingAlways\']);

// &landingPage  [int] set the page to show the results page (non Ajax search)
// Default: false
$cfg[\'landingPage\'] = isset($landingPage) ? $landingPage : (isset($__landingPage) ? $__landingPage : $dcfg[\'landingPage\']);

// &showResults  [1 | 0]  establish whether to show the results or not
// Default: 1
$cfg[\'showResults\'] = isset($showResults) ? $showResults : (isset($__showResults) ? $__showResults : $dcfg[\'showResults\']);

// &parents [ [ in | not in ] : comma separated list of Ids | \'\' ]
// Ids of documents to retrieve their children to &depth depth  where to do the search in or not in
// Default: \'\' - empty list
$cfg[\'parents\'] = isset($parents) ? $parents : (isset($__parents) ? $__parents : $dcfg[\'parents\']);

// &documents [ [ in | not in ] : comma separated list of Ids | \'\' ]
// Ids of documents where to do the search in or not in
// Default: \'\' - empty list
$cfg[\'documents\'] = isset($documents) ? $documents : (isset($__documents) ? $__documents : $dcfg[\'documents\']);

// &depth [ 0 < int ] Number of levels deep to retrieve documents
// Default: 10
$cfg[\'depth\'] = isset($depth) ? intval($depth) : (isset($__depth) ? intval($__depth) : $dcfg[\'depth\']);

// &hideMenu [0 | 1| 2]  Search in hidden documents from menu.
// 0 - search only in documents visible from menu
// 1 - search only in documents hidden from menu
// 2 - search in hidden or visible documents from menu
// Default: 2
$cfg[\'hideMenu\'] = isset($hideMenu) ? $hideMenu : (isset($__hideMenu) ? $__hideMenu : $dcfg[\'hideMenu\']);

// &hideLink [0 | 1 ]   Search in content of type reference (link)
// 0 - search in content of type document AND reference
// 1 - search only in content of type document
// Default: 1
$cfg[\'hideLink\'] = isset($hideLink) ? $hideLink : (isset($__hideLink) ? $__hideLink : $dcfg[\'hideLink\']);

// &filter - Basic filtering : remove unwanted documents that meets the criteria of the filter
// See Ditto 2 Basic filtering and the ajaxSearch demo site for more information
// Default: \'\' - empty list
$cfg[\'filter\'] = isset($filter) ? $filter : (isset($__filter) ? $__filter : $dcfg[\'filter\']);

// &output [0 | 1 ]Custom layout
// Default: 0 - Results are listed just under the input form
// 1 - custom layout. put [+as.inputForm+] and [+as.results+] where you want to define the layout
$cfg[\'output\'] = isset($output) ? $output : (isset($__output) ? $__output : $dcfg[\'output\']);

// &tplInput - Chunk to style the ajaxSearch input form
// Default: \'@FILE:\' . AS_SPATH . \'templates/input.tpl.html\'
$cfg[\'tplInput\'] = isset($tplInput) ? $tplInput : (isset($__tplInput) ? $__tplInput : $dcfg[\'tplInput\']);

// &tplResults - Chunk to style the non-ajax output results outer
// Default: \'@FILE:\' . AS_SPATH . \'templates/results.tpl.html\'
$cfg[\'tplResults\'] = isset($tplResults) ? $tplResults : (isset($__tplResults) ? $__tplResults : $dcfg[\'tplResults\']);

// &tplGrpResult - Chunk to style the non-ajax output group result outer
// Default: \'@FILE:\' . AS_SPATH . \'templates/grpResult.tpl.html\'
$cfg[\'tplGrpResult\'] = isset($tplGrpResult) ? $tplGrpResult : (isset($__tplGrpResult) ? $__tplGrpResult : $dcfg[\'tplGrpResult\']);

// &tplResult - Chunk to style each output result
// Default: "@FILE:" . AS_SPATH . \'templates/result.tpl.html\'
$cfg[\'tplResult\'] = isset($tplResult) ? $tplResult : (isset($__tplResult) ? $__tplResult : $dcfg[\'tplResult\']);

// &tplComment - Chunk to style the comment form (Also used with the ajax mode)
// Default: \'@FILE:\' . AS_SPATH . \'templates/comment.tpl.html\'
$cfg[\'tplComment\'] = isset($tplComment) ? $tplComment : (isset($__tplComment) ? $__tplComment : $dcfg[\'tplComment\']);

// &tplPaging0 - Chunk to style the paging links - type 0
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging0.tpl.html\'
$cfg[\'tplPaging0\'] = isset($tplPaging0) ? $tplPaging0 : (isset($__tplPaging0) ? $__tplPaging0 : $dcfg[\'tplPaging0\']);

// &tplPaging1 - Chunk to style the paging links - type 1
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging1.tpl.html\'
$cfg[\'tplPaging1\'] = isset($tplPaging1) ? $tplPaging1 : (isset($__tplPaging1) ? $__tplPaging1 : $dcfg[\'tplPaging1\']);

// &tplPaging2 - Chunk to style the paging links - type 2
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging2.tpl.html\'
$cfg[\'tplPaging2\'] = isset($tplPaging2) ? $tplPaging2 : (isset($__tplPaging2) ? $__tplPaging2 : $dcfg[\'tplPaging2\']);

// &stripInput - stripInput user function name
// Default: \'defaultStripInput\'
$cfg[\'stripInput\'] = isset($stripInput) ? $stripInput : (isset($__stripInput) ? $__stripInput : $dcfg[\'stripInput\']);

// &stripOutput - stripOutput user function name
// Default: \'defaultStripOutput\'
$cfg[\'stripOutput\'] = isset($stripOutput) ? $stripOutput : (isset($__stripOutput) ? $__stripOutput : $dcfg[\'stripOutput\']);

// &breadcrumbs
// 0 : disallow the breadcrumbs link
// Name of the breadcrumbs function : allow the breadcrumbs link
// The function name could be followed by some parameter initialization
// e.g: &breadcrumbs=`Breadcrumbs,showHomeCrumb:0,showCrumbsAtHome:1`
// Default: \'\' - empty string
$cfg[\'breadcrumbs\'] = isset($breadcrumbs) ? $breadcrumbs : (isset($__breadcrumbs) ? $__breadcrumbs : $dcfg[\'breadcrumbs\']);

// &tvPhx - display and set placeHolders for TV (template variables)
// 0 : disallow the feature
// 1 : allow the display of all Modx TVs of the document found (default)
// \'tb_alias:display_function_name[,[tb_alias:display_function_name]*]\' : set up placeholders for custom joined tables
// Default: 1 - tvPhx allowed for TV only
$cfg[\'tvPhx\'] = isset($tvPhx) ? $tvPhx : (isset($__tvPhx) ? $__tvPhx : $dcfg[\'tvPhx\']);

// &clearDefault - Clearing default text
// Set this to 1 if you would like to include the clear default js function
// add the class "cleardefault" to your input text form and set this parameter
// Default: 0
$cfg[\'clearDefault\'] = isset($clearDefault) ? $clearDefault : (isset($__clearDefault) ? $__clearDefault : $dcfg[\'clearDefault\']);

// &jsClearDefault - Location of the js library
// Default: AS_SPATH . \'js/clearDefault.js\'
$cfg[\'jsClearDefault\'] = $dcfg[\'jsClearDefault\'];

// &mbstring - php_mbstring extension available [0 | 1]
// Default: 1 - extension available
$cfg[\'mbstring\'] = isset($mbstring) ? $mbstring : (isset($__mbstring) ? $__mbstring : $dcfg[\'mbstring\']);

//  &asLog - ajaxSearch log [ level [: comment [: purge]]]
//  level:
//        0 : disallow the ajaxSearch log (Default)
//        1 : failed search requests are logged
//        2 : all ajaxSearch requests are logged
//  comment:
//        0 : user comment not allowed (Default)
//        1 : user comment allowed
//  purge: number of logs allowed before to do an automatic purge of the table
//        Default: 200
$cfg[\'asLog\'] = isset($asLog) ? $asLog : (isset($__asLog) ? $__asLog : $dcfg[\'asLog\']);


//------------------------------------------------------------------------------
// Configuration - Simple Ajax mode
//------------------------------------------------------------------------------

if ($cfg[\'ajaxSearch\']) {

    // $liveSearch [1 | 0] (as passed in snippet variable ONLY)
    // Set this to 1 if you would like to use the live search (i.e. results as you type)
    // Default: 0 - livesearch mode inactivated
    $cfg[\'liveSearch\'] = isset($liveSearch) ? $liveSearch : (isset($__liveSearch) ? $__liveSearch : $dcfg[\'liveSearch\']);

    // &ajaxMax [int] - The maximum number of results to show for the ajaxsearch
    // Default: 6
    $cfg[\'ajaxMax\'] = isset($ajaxMax) ? $ajaxMax : (isset($__ajaxMax) ? $__ajaxMax : $dcfg[\'ajaxMax\']);

    // &moreResultsPage [int]
    // The document id of the page you want the more results link to point to
    // Default: 0
    $cfg[\'moreResultsPage\'] = isset($moreResultsPage) ? $moreResultsPage : (isset($__moreResultsPage) ? $__moreResultsPage : $dcfg[\'moreResultsPage\']);

    // &opacity - set the opacity of the div ajaxSearch_output
    // Should be a float value: [ 0. < float <= 1. ]
    // Default: 1.
    $cfg[\'opacity\'] = isset($opacity) ? $opacity : (isset($__opacity) ? $__opacity : $dcfg[\'opacity\']);

    // &tplAjaxResults - Chunk to style the ajax output results outer
    // Default: \'\' - empty string
    $cfg[\'tplAjaxResults\'] = isset($tplAjaxResults) ? $tplAjaxResults : (isset($__tplAjaxResults) ? $__tplAjaxResults : $dcfg[\'tplAjaxResults\']);

    // &tplAjaxGrpResult - Chunk to style each ajax output group result outer
    // Default: \'\' - empty string
    $cfg[\'tplAjaxGrpResult\'] = isset($tplAjaxGrpResult) ? $tplAjaxGrpResult : (isset($__tplAjaxGrpResult) ? $__tplAjaxGrpResult : $dcfg[\'tplAjaxGrpResult\']);

    // &tplAjaxResult - Chunk to style each ajax output result
    // Default: \'\' - empty string
    $cfg[\'tplAjaxResult\'] = isset($tplAjaxResult) ? $tplAjaxResult : (isset($__tplAjaxResult) ? $__tplAjaxResult : $dcfg[\'tplAjaxResult\']);

    // &jscript [\'jquery\'|\'mootools2\'|\'mootools\']
    // Set this to jquery if you would like use the jquery library
    // set mootools2 to use the version 1.2 of mootools (limited to JS functions used by AS)
    // Default: \'mootools\' - use the version 1.11 of mootools provided with MODx
    $cfg[\'jscript\'] = isset($jscript) ? $jscript : (isset($__jscript) ? $__jscript : $dcfg[\'jscript\']);

    // &addJscript [1 | 0]
    // Set this to 1 if you would like to include or not the mootool/jquery library in the header of your pages automatically
    // Default: 1
    $cfg[\'addJscript\'] = isset($addJscript) ? $addJscript : (isset($__addJscript) ? $__addJscript : $dcfg[\'addJscript\']);

    // &jsMooTools - Location of the mootools javascript library (current version of MODx)
    // Default: \'manager/media/script/mootools/mootools.js\'
    $cfg[\'jsMooTools\'] = isset($jsMooTools) ? $jsMooTools : (isset($__jsMooTools) ? $__jsMooTools : $dcfg[\'jsMooTools\']);

    // &jsMooTools2 - Location of an alternative mootools javascript library
    // Default: AS_SPATH . \'js/mootools1.2/mootools.js\' - contains only the required functions for AS
    // to use an another library, use this parameter and change the ajaxSearch/js/ajaxSearch1/ajaxSearch-mootools2.js file
    $cfg[\'jsMooTools2\'] = isset($jsMooTools2) ? $jsMooTools2 : (isset($__jsMooTools2) ? $__jsMooTools2 : $dcfg[\'jsMooTools2\']);

    // &jsQuery - Location of the jquery javascript library
    // Default: AS_SPATH . \'js/jquery/jquery.js\'
    $cfg[\'jsJquery\'] = isset($jsJquery) ? $jsJquery : (isset($__jsJquery) ? $__jsJquery : $dcfg[\'jsJquery\']);
}

// ========================================================== End of config
include_once AS_PATH . "classes/ajaxSearch.class.inc.php";
if (class_exists(\'AjaxSearch\')) {
    $as = new AjaxSearch();
    $output = $as->run($tstart, $dcfg, $cfg);
} else {
    $output = "<h3>error: AjaxSearch class not found</h3>";
}
$elapsedTime = $modx->getMicroTime() - $tstart;
$etime = sprintf("%.4fs",$elapsedTime);
//$f=fopen(\'test.txt\',\'a+\');fwrite($f,"etime=".$etime."\\n\\n");
return $output;';
$s['AjaxSearchProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['AjaxSearch'] = '/**
--------------------------------------------------------------------------------
:: Preamble
--------------------------------------------------------------------------------
The release 1.9 looks like the previous release, but it is a completely
refactored development.

It is partially based on the previous releases of AjaxSearch written by the
following authors:

 Coroico <coroico@wangba.fr>
 Jason Coward <jason@opengeek.com>
 Kyle Jaebker <kjaebker@muddydogpaws.com>
 Ryan Thrash  <ryan@vertexworks.com>

--------------------------------------------------------------------------------
:: Description
--------------------------------------------------------------------------------

        Ajax and non-Ajax search that supports results highlighting.

This snippet adds AJAX functionality on top of the robust content searching.

What AjaxSearch do:
- search in fields of the content an TV MODx tables
- several customizable input forms available
- search in a subset of documents
- highlighting of searchword in the results returned
- allow a filtering of search results
- displaying of search results customizable thru templates
- group the search results by categories
- filter features (allow to set up specific search forms)

It could works in two modes:

ajax mode :
- search results displayed in current page through AJAX request
- multiple search options including live search
- available link to view all results in a new page when only a subset is returned
- customize the number of results returned
- offer two types for paginating the results
- uses the MooTools or JQuery js library for AJAX and visual effects

non-ajax mode :
- search results displayed in a new page or below on the same page
- offer two types for paginating the results
- works without JS enabled

What AjaxSearch don\'t :
- search in dynamic content. AjaxSearch could retreive only data stored in
database. It can\'t find something stored in a chunk or generated by a snippet.

MORE : See the ajaxSearch.readme.txt file for more informations. 

----------------------------------------------------------------------------- */

// ajaxSearch version being executed
define(\'AS_VERSION\', \'1.9.2\');
// Path where ajaxSearch is installed
define(\'AS_SPATH\', \'assets/snippets/ajaxSearch/\');
//include snippet file
define(\'AS_PATH\', MODX_BASE_PATH . AS_SPATH);

//------------------------------------------------------------------------------
// Configuration - general AjaxSearch snippet setup options
//------------------------------------------------------------------------------
global $modx;
$tstart = $modx->getMicroTime();

$cfg = array(); // current configuration
$cfg[\'version\'] = AS_VERSION;

// Load the default configuration $dcfg to get the default values
$default = AS_PATH . \'configs/default.config.php\';
if (file_exists($default)) include $default;
else return "<h3>AjaxSearch error: $default not found !<br />Check the existing of this file!</h3>";
if (!isset($dcfg)) return "<h3>AjaxSearch error: default configuration array not defined in $default!<br /> Check the content of this file!</h3>";

if ($dcfg[\'version\'] != AS_VERSION) return "<h3>AjaxSearch error: Version number mismatch. Check the content of the default configuration file!</h3>";

// check the possible use of deprecated parameters (since 1.8.5)
$readme = "ajaxSearch_version_192.txt";
if (isset($searchWordList)) return "<h3>AjaxSearch error: searchWordList is a deprecated parameter. Read " . $readme . " file.</h3>";
if (isset($resultsPage)) return "<h3>AjaxSearch error: resultsPage is a deprecated parameter. Read " . $readme . " file.</h3>";
if (isset($AS_showForm)) return "<h3>AjaxSearch error: AS_showForm parameter has been renamed showInputForm. Read " . $readme . " file.</h3>";
if (isset($AS_landing)) return "<h3>AjaxSearch error: AS_landing parameter has been renamed landingPage. Read " . $readme . " file.</h3>";
if (isset($AS_showResults)) return "<h3>AjaxSearch error: AS_showResults parameter has been renamed showResults. Read " . $readme . " file.</h3>";

// Load a custom configuration file if required
// config_name - Other config installed in the configs folder or in any folder within the MODx base path via @FILE
// Configuration files should be named in the form: <config_name>.config.php
// Default: \'\' - no custom config
$cfg[\'config\'] = isset($config) ? $config : $dcfg[\'config\'];
if ($cfg[\'config\']) {
    $config = $cfg[\'config\'];
    $lconfig = (substr($config, 0, 6) != "@FILE:") ? AS_PATH . "configs/$config.config.php" : $modx->config[\'base_path\'] . trim(substr($config, 6, strlen($config)-6));
    if (file_exists($lconfig)) include $lconfig;
    else return "<h3>AjaxSearch error: " . $lconfig . " not found !<br />Check your config parameter or your config file name!</h3>";
}

// &debug = [ 0 | 1 | 2 | 3 ]
// 1,2,3 : File mode - Output logged into a file named ajaxSearch_log.txt in ajaxSearch/debug/ directory.
// this directory should be writable.
// Default: 0 - no logs
$cfg[\'debug\'] = isset($debug) ? $debug : (isset($__debug) ? $__debug : $dcfg[\'debug\']);

// &timeLimit = [ int | 60 ]
// Max execution time in seconds for the AjaxSearch script
// 0 - If set to zero, no time limit is imposed
// Default: 60 - 1 minute.
$cfg[\'timeLimit\'] = isset($timeLimit) ? $timeLimit : (isset($__timeLimit) ? $__timeLimit : $dcfg[\'timeLimit\']);

// &language [ language_name | manager_language ] (optional)
// Default: $modx->config[\'manager_language\'] - manager language used
$cfg[\'language\'] = isset($language) ? $language : (isset($__language) ? $__language : $dcfg[\'language\']);

// &ajaxSearch [1 | 0] (as passed in snippet variable ONLY)
// Use this to display the search results using ajax You must include the Mootools library in your template
// Default: 1 - ajax mode selected
$cfg[\'ajaxSearch\'] = isset($ajaxSearch) ? $ajaxSearch : (isset($__ajaxSearch) ? $__ajaxSearch : $dcfg[\'ajaxSearch\']);

// &advSearch [ \'exactphrase\' | \'allwords\' | \'nowords\' | \'oneword\' ]
// Advanced search:
// - exactphrase : provides the documents which contain the exact phrase
// - allwords : provides the documents which contain all the words
// - nowords : provides the documents which do not contain the words
// - oneword : provides the document which contain at least one word
// Default: \'oneword\'
$cfg[\'advSearch\'] = isset($advSearch) ? $advSearch : (isset($__advSearch) ? $__advSearch : $dcfg[\'advSearch\']);

// &asId - Unique id for AjaxSearch instance
// this allows to distinguish several Ajaxsearch instances on the same page
// Any combination of characters a-z, underscores, and numbers 0-9
// This is case sensitive. Default = empty string
// With ajax mode, the first snippet call of the page shouldn\'t use the asId parameter
$cfg[\'asId\'] = isset($asId) ? $asId : (isset($__asId) ? $__asId : $dcfg[\'asId\']);

// &whereSearch
// Define where should occur the search
// a separated list of keywords describing the tables where to search
// keywords allowed :
// "content" for site_content, "tv" for site_tmplvar_contentvalues, "jot" for jot_content, "maxigallery" for maxigallery
// you could add your own keywords. But the keyword should be a user function which describes the tables to use
// all the text fields are searchable but you could specify the fields like this:
// whereSearch=`content:pagetitle,introtext,content|tv:tv_value|maxigallery:gal_title`
// Default: \'content|tv\'
$cfg[\'whereSearch\'] = isset($whereSearch) ? $whereSearch : (isset($__whereSearch) ? $__whereSearch : $dcfg[\'whereSearch\']);

// &sites : [comma separated list of sites]
// sites allow to define sites where to do the search
$cfg[\'sites\'] = isset($sites) ? $sites : (isset($__sites) ? $__sites : $dcfg[\'sites\']);

// &subSearch  [comma separated list of subsites]
// subSearch allow to define sub-domains or subsites where to do the search
$cfg[\'subSearch\'] = isset($subSearch) ? $subSearch : (isset($__subSearch) ? $__subSearch : $dcfg[\'subSearch\']);

// &category  [ tv_name ]
// Any combination of characters a-z, underscores, and numbers 0-9
// This is case sensitive. Default = empty string
// Name of a TV. The category of a MODx document is provided by this TV content
$cfg[\'category\'] = isset($category) ? $category : (isset($__category) ? $__category : $dcfg[\'category\']);

// &display [ \'mixed\' | \'unmixed\' ]
// When results comes from differents sites, subsites or categories, you could choose to display the results mixed or unmixed.
// Default: unmixed
// Unmixed mode display the results grouped by site, subsite or category. Each group of results could be paginated.
// Mixed mode mixe all the results coming from the differents area.
// With unmixed mode, results are ordered by the field provided by the first field of the order parameter
$cfg[\'display\'] = isset($display) ? $display : (isset($__display) ? $__display : $dcfg[\'display\']);

// &init  [ \'none\' | \'all\' ]
// init defines if the search display all the results or none when the search term is an empty string
// Default: none
$cfg[\'init\'] = isset($init) ? $init : (isset($__init) ? $__init : $dcfg[\'init\']);

// &withTvs - Define which Tvs are used for the search in Tvs
// a comma separated list of TV names
// Default: \'\' - all TVs are used (empty list)
$cfg[\'withTvs\'] = isset($withTvs) ? $withTvs : (isset($__withTvs) ? $__withTvs : $dcfg[\'withTvs\']);

// &order - Define the sort order of results
// Comma separated list of fields defined as searchable in the table definition
// to suppress the sorting, use &order=``
// Default: \'pub_date,pagetitle\'
$cfg[\'order\'] = isset($order) ? $order : (isset($__order) ? $__order : $dcfg[\'order\']);

// &rank - Define the rank of search results. Results are sorted by rank value
// Comma separated list of fields with optionally user defined weight
// Default: \'pagetitle:100,extract\'
// to suppress the rank sorting, use &rank=``;
// &rank sort occurs after the &order sort
$cfg[\'rank\'] = isset($rank) ? $rank : (isset($__rank) ? $__rank : $dcfg[\'rank\']);

// &maxWords [ 1 < int < 10 ]
// Maximum number of words for searching
// Default: 5
$cfg[\'maxWords\'] = isset($maxWords) ? intval($maxWords) : (isset($__maxWords) ? intval($__maxWords) : $dcfg[\'maxWords\']);

// &minChars [  2 < int < 100 ]
// Minimum number of characters to require for a word to be valid for searching.
// length of each word with $advSearch = \'allwords\', \'oneword\' or \'nowords\'
// length of the search string with possible spaces with $advSearch = \'exactphrase\'
// Default: 3
$cfg[\'minChars\'] = isset($minChars) ? intval($minChars) : (isset($__minChars) ? intval($__minChars) : $dcfg[\'minChars\']);

// &showInputForm [0 | 1]
// If you would like to turn off the search form when showing results you can set this to false.(1=true, 0=false)
// Default: 1
$cfg[\'showInputForm\'] = isset($showInputForm) ? $showInputForm : (isset($__showInputForm) ? $__showInputForm : $dcfg[\'showInputForm\']);

// &showIntro [0 | 1]
// If you would like to turn off the intro message beyond the input form you can set this to false.(1=true, 0=false)
// Default: 1
$cfg[\'showIntro\'] = isset($showIntro) ? $showIntro : (isset($__showIntro) ? $__showIntro : $dcfg[\'showIntro\']);

// &grabMax [ int ]
// Set to the max number of records you would like on each page. Set to 0 if unlimited.
// Default: 10
$cfg[\'grabMax\'] = isset($grabMax) ? intval($grabMax) : (isset($__grabMax) ? intval($__grabMax) : $dcfg[\'grabMax\']);

// &extract [ n:searchable fields list | 1:content,description,introtext,tv_content]
// show the search terms highlighted in a little extract
// n : maximum number of extracts displayed
// ordered searchable fields list : separated list of fields define as searchable in the table definition
// Default: \'1:content,description,introtext,tv_value\' - One extract from content then description,introtext,tv_value
$cfg[\'extract\'] = isset($extract) ? $extract : (isset($__extract) ? $__extract : $dcfg[\'extract\']);

// &extractLength [ 50 < int < 800]
// Length of extract around the search words found - between 50 and 800 characters
// Default: 200
$cfg[\'extractLength\'] = isset($extractLength) ? intval($extractLength) : (isset($__extractLength) ? intval($__extractLength) : $dcfg[\'extractLength\']);

// &extractEllips [ string ]
// Ellipside to mark the star and the end of  an extract when the sentence is cutting
// Default: \'...\'
$cfg[\'extractEllips\'] = isset($extractEllips) ? $extractEllips : (isset($__extractEllips) ? $__extractEllips : $dcfg[\'extractEllips\']);

// &extractSeparator [ string ]
// Any html tag to mark the separation between extracts
// Default: \'<br />\' - but you could also choose for instance \'<hr />\'
$cfg[\'extractSeparator\'] = isset($extractSeparator) ? $extractSeparator : (isset($__extractSeparator) ? $__extractSeparator : $dcfg[\'extractSeparator\']);

// &formatDate [ string ]
// The format of outputted dates. See http://www.php.net/manual/en/function.date.php
// Default: \'d/m/y : H:i:s\' - e.g: 21/01/08 : 23:09:22
$cfg[\'formatDate\'] = isset($formatDate) ? $formatDate : (isset($__formatDate) ? $__formatDate : $dcfg[\'formatDate\']);

// &highlightResult [1 | 0]
// create links so that search terms will be highlighted when linked page clicked
// Default: 1 - Results highlighted
$cfg[\'highlightResult\'] = isset($highlightResult) ? $highlightResult : (isset($__highlightResult) ? $__highlightResult : $dcfg[\'highlightResult\']);

// &pagingType[ 0 | 1 | 2 ]
// Determine the pagination type used - Default 1 : Previous - X-Y/Z - Next
$cfg[\'pagingType\'] = isset($pagingType) ? $pagingType : (isset($__pagingType) ? $__pagingType : $dcfg[\'pagingType\']);

// &pageLinkSeparator [ string ]
// What you want, if anything, between your page link numbers
// Default: \' | \'
$cfg[\'pageLinkSeparator\'] = isset($pageLinkSeparator) ? $pageLinkSeparator : (isset($__pageLinkSeparator) ? $__pageLinkSeparator : $dcfg[\'pageLinkSeparator\']);

// &showPagingAlways[1 | 0]
// Determine whether or not to always show paging
$cfg[\'showPagingAlways\'] = isset($showPagingAlways) ? $showPagingAlways : (isset($__showPagingAlways) ? $__showPagingAlways : $dcfg[\'showPagingAlways\']);

// &landingPage  [int] set the page to show the results page (non Ajax search)
// Default: false
$cfg[\'landingPage\'] = isset($landingPage) ? $landingPage : (isset($__landingPage) ? $__landingPage : $dcfg[\'landingPage\']);

// &showResults  [1 | 0]  establish whether to show the results or not
// Default: 1
$cfg[\'showResults\'] = isset($showResults) ? $showResults : (isset($__showResults) ? $__showResults : $dcfg[\'showResults\']);

// &parents [ [ in | not in ] : comma separated list of Ids | \'\' ]
// Ids of documents to retrieve their children to &depth depth  where to do the search in or not in
// Default: \'\' - empty list
$cfg[\'parents\'] = isset($parents) ? $parents : (isset($__parents) ? $__parents : $dcfg[\'parents\']);

// &documents [ [ in | not in ] : comma separated list of Ids | \'\' ]
// Ids of documents where to do the search in or not in
// Default: \'\' - empty list
$cfg[\'documents\'] = isset($documents) ? $documents : (isset($__documents) ? $__documents : $dcfg[\'documents\']);

// &depth [ 0 < int ] Number of levels deep to retrieve documents
// Default: 10
$cfg[\'depth\'] = isset($depth) ? intval($depth) : (isset($__depth) ? intval($__depth) : $dcfg[\'depth\']);

// &hideMenu [0 | 1| 2]  Search in hidden documents from menu.
// 0 - search only in documents visible from menu
// 1 - search only in documents hidden from menu
// 2 - search in hidden or visible documents from menu
// Default: 2
$cfg[\'hideMenu\'] = isset($hideMenu) ? $hideMenu : (isset($__hideMenu) ? $__hideMenu : $dcfg[\'hideMenu\']);

// &hideLink [0 | 1 ]   Search in content of type reference (link)
// 0 - search in content of type document AND reference
// 1 - search only in content of type document
// Default: 1
$cfg[\'hideLink\'] = isset($hideLink) ? $hideLink : (isset($__hideLink) ? $__hideLink : $dcfg[\'hideLink\']);

// &filter - Basic filtering : remove unwanted documents that meets the criteria of the filter
// See Ditto 2 Basic filtering and the ajaxSearch demo site for more information
// Default: \'\' - empty list
$cfg[\'filter\'] = isset($filter) ? $filter : (isset($__filter) ? $__filter : $dcfg[\'filter\']);

// &output [0 | 1 ]Custom layout
// Default: 0 - Results are listed just under the input form
// 1 - custom layout. put [+as.inputForm+] and [+as.results+] where you want to define the layout
$cfg[\'output\'] = isset($output) ? $output : (isset($__output) ? $__output : $dcfg[\'output\']);

// &tplInput - Chunk to style the ajaxSearch input form
// Default: \'@FILE:\' . AS_SPATH . \'templates/input.tpl.html\'
$cfg[\'tplInput\'] = isset($tplInput) ? $tplInput : (isset($__tplInput) ? $__tplInput : $dcfg[\'tplInput\']);

// &tplResults - Chunk to style the non-ajax output results outer
// Default: \'@FILE:\' . AS_SPATH . \'templates/results.tpl.html\'
$cfg[\'tplResults\'] = isset($tplResults) ? $tplResults : (isset($__tplResults) ? $__tplResults : $dcfg[\'tplResults\']);

// &tplGrpResult - Chunk to style the non-ajax output group result outer
// Default: \'@FILE:\' . AS_SPATH . \'templates/grpResult.tpl.html\'
$cfg[\'tplGrpResult\'] = isset($tplGrpResult) ? $tplGrpResult : (isset($__tplGrpResult) ? $__tplGrpResult : $dcfg[\'tplGrpResult\']);

// &tplResult - Chunk to style each output result
// Default: "@FILE:" . AS_SPATH . \'templates/result.tpl.html\'
$cfg[\'tplResult\'] = isset($tplResult) ? $tplResult : (isset($__tplResult) ? $__tplResult : $dcfg[\'tplResult\']);

// &tplComment - Chunk to style the comment form (Also used with the ajax mode)
// Default: \'@FILE:\' . AS_SPATH . \'templates/comment.tpl.html\'
$cfg[\'tplComment\'] = isset($tplComment) ? $tplComment : (isset($__tplComment) ? $__tplComment : $dcfg[\'tplComment\']);

// &tplPaging0 - Chunk to style the paging links - type 0
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging0.tpl.html\'
$cfg[\'tplPaging0\'] = isset($tplPaging0) ? $tplPaging0 : (isset($__tplPaging0) ? $__tplPaging0 : $dcfg[\'tplPaging0\']);

// &tplPaging1 - Chunk to style the paging links - type 1
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging1.tpl.html\'
$cfg[\'tplPaging1\'] = isset($tplPaging1) ? $tplPaging1 : (isset($__tplPaging1) ? $__tplPaging1 : $dcfg[\'tplPaging1\']);

// &tplPaging2 - Chunk to style the paging links - type 2
// Default: \'@FILE:\' . AS_SPATH . \'templates/paging2.tpl.html\'
$cfg[\'tplPaging2\'] = isset($tplPaging2) ? $tplPaging2 : (isset($__tplPaging2) ? $__tplPaging2 : $dcfg[\'tplPaging2\']);

// &stripInput - stripInput user function name
// Default: \'defaultStripInput\'
$cfg[\'stripInput\'] = isset($stripInput) ? $stripInput : (isset($__stripInput) ? $__stripInput : $dcfg[\'stripInput\']);

// &stripOutput - stripOutput user function name
// Default: \'defaultStripOutput\'
$cfg[\'stripOutput\'] = isset($stripOutput) ? $stripOutput : (isset($__stripOutput) ? $__stripOutput : $dcfg[\'stripOutput\']);

// &breadcrumbs
// 0 : disallow the breadcrumbs link
// Name of the breadcrumbs function : allow the breadcrumbs link
// The function name could be followed by some parameter initialization
// e.g: &breadcrumbs=`Breadcrumbs,showHomeCrumb:0,showCrumbsAtHome:1`
// Default: \'\' - empty string
$cfg[\'breadcrumbs\'] = isset($breadcrumbs) ? $breadcrumbs : (isset($__breadcrumbs) ? $__breadcrumbs : $dcfg[\'breadcrumbs\']);

// &tvPhx - display and set placeHolders for TV (template variables)
// 0 : disallow the feature
// 1 : allow the display of all Modx TVs of the document found (default)
// \'tb_alias:display_function_name[,[tb_alias:display_function_name]*]\' : set up placeholders for custom joined tables
// Default: 1 - tvPhx allowed for TV only
$cfg[\'tvPhx\'] = isset($tvPhx) ? $tvPhx : (isset($__tvPhx) ? $__tvPhx : $dcfg[\'tvPhx\']);

// &clearDefault - Clearing default text
// Set this to 1 if you would like to include the clear default js function
// add the class "cleardefault" to your input text form and set this parameter
// Default: 0
$cfg[\'clearDefault\'] = isset($clearDefault) ? $clearDefault : (isset($__clearDefault) ? $__clearDefault : $dcfg[\'clearDefault\']);

// &jsClearDefault - Location of the js library
// Default: AS_SPATH . \'js/clearDefault.js\'
$cfg[\'jsClearDefault\'] = $dcfg[\'jsClearDefault\'];

// &mbstring - php_mbstring extension available [0 | 1]
// Default: 1 - extension available
$cfg[\'mbstring\'] = isset($mbstring) ? $mbstring : (isset($__mbstring) ? $__mbstring : $dcfg[\'mbstring\']);

//  &asLog - ajaxSearch log [ level [: comment [: purge]]]
//  level:
//        0 : disallow the ajaxSearch log (Default)
//        1 : failed search requests are logged
//        2 : all ajaxSearch requests are logged
//  comment:
//        0 : user comment not allowed (Default)
//        1 : user comment allowed
//  purge: number of logs allowed before to do an automatic purge of the table
//        Default: 200
$cfg[\'asLog\'] = isset($asLog) ? $asLog : (isset($__asLog) ? $__asLog : $dcfg[\'asLog\']);


//------------------------------------------------------------------------------
// Configuration - Simple Ajax mode
//------------------------------------------------------------------------------

if ($cfg[\'ajaxSearch\']) {

    // $liveSearch [1 | 0] (as passed in snippet variable ONLY)
    // Set this to 1 if you would like to use the live search (i.e. results as you type)
    // Default: 0 - livesearch mode inactivated
    $cfg[\'liveSearch\'] = isset($liveSearch) ? $liveSearch : (isset($__liveSearch) ? $__liveSearch : $dcfg[\'liveSearch\']);

    // &ajaxMax [int] - The maximum number of results to show for the ajaxsearch
    // Default: 6
    $cfg[\'ajaxMax\'] = isset($ajaxMax) ? $ajaxMax : (isset($__ajaxMax) ? $__ajaxMax : $dcfg[\'ajaxMax\']);

    // &moreResultsPage [int]
    // The document id of the page you want the more results link to point to
    // Default: 0
    $cfg[\'moreResultsPage\'] = isset($moreResultsPage) ? $moreResultsPage : (isset($__moreResultsPage) ? $__moreResultsPage : $dcfg[\'moreResultsPage\']);

    // &opacity - set the opacity of the div ajaxSearch_output
    // Should be a float value: [ 0. < float <= 1. ]
    // Default: 1.
    $cfg[\'opacity\'] = isset($opacity) ? $opacity : (isset($__opacity) ? $__opacity : $dcfg[\'opacity\']);

    // &tplAjaxResults - Chunk to style the ajax output results outer
    // Default: \'\' - empty string
    $cfg[\'tplAjaxResults\'] = isset($tplAjaxResults) ? $tplAjaxResults : (isset($__tplAjaxResults) ? $__tplAjaxResults : $dcfg[\'tplAjaxResults\']);

    // &tplAjaxGrpResult - Chunk to style each ajax output group result outer
    // Default: \'\' - empty string
    $cfg[\'tplAjaxGrpResult\'] = isset($tplAjaxGrpResult) ? $tplAjaxGrpResult : (isset($__tplAjaxGrpResult) ? $__tplAjaxGrpResult : $dcfg[\'tplAjaxGrpResult\']);

    // &tplAjaxResult - Chunk to style each ajax output result
    // Default: \'\' - empty string
    $cfg[\'tplAjaxResult\'] = isset($tplAjaxResult) ? $tplAjaxResult : (isset($__tplAjaxResult) ? $__tplAjaxResult : $dcfg[\'tplAjaxResult\']);

    // &jscript [\'jquery\'|\'mootools2\'|\'mootools\']
    // Set this to jquery if you would like use the jquery library
    // set mootools2 to use the version 1.2 of mootools (limited to JS functions used by AS)
    // Default: \'mootools\' - use the version 1.11 of mootools provided with MODx
    $cfg[\'jscript\'] = isset($jscript) ? $jscript : (isset($__jscript) ? $__jscript : $dcfg[\'jscript\']);

    // &addJscript [1 | 0]
    // Set this to 1 if you would like to include or not the mootool/jquery library in the header of your pages automatically
    // Default: 1
    $cfg[\'addJscript\'] = isset($addJscript) ? $addJscript : (isset($__addJscript) ? $__addJscript : $dcfg[\'addJscript\']);

    // &jsMooTools - Location of the mootools javascript library (current version of MODx)
    // Default: \'manager/media/script/mootools/mootools.js\'
    $cfg[\'jsMooTools\'] = isset($jsMooTools) ? $jsMooTools : (isset($__jsMooTools) ? $__jsMooTools : $dcfg[\'jsMooTools\']);

    // &jsMooTools2 - Location of an alternative mootools javascript library
    // Default: AS_SPATH . \'js/mootools1.2/mootools.js\' - contains only the required functions for AS
    // to use an another library, use this parameter and change the ajaxSearch/js/ajaxSearch1/ajaxSearch-mootools2.js file
    $cfg[\'jsMooTools2\'] = isset($jsMooTools2) ? $jsMooTools2 : (isset($__jsMooTools2) ? $__jsMooTools2 : $dcfg[\'jsMooTools2\']);

    // &jsQuery - Location of the jquery javascript library
    // Default: AS_SPATH . \'js/jquery/jquery.js\'
    $cfg[\'jsJquery\'] = isset($jsJquery) ? $jsJquery : (isset($__jsJquery) ? $__jsJquery : $dcfg[\'jsJquery\']);
}

// ========================================================== End of config
include_once AS_PATH . "classes/ajaxSearch.class.inc.php";
if (class_exists(\'AjaxSearch\')) {
    $as = new AjaxSearch();
    $output = $as->run($tstart, $dcfg, $cfg);
} else {
    $output = "<h3>error: AjaxSearch class not found</h3>";
}
$elapsedTime = $modx->getMicroTime() - $tstart;
$etime = sprintf("%.4fs",$elapsedTime);
//$f=fopen(\'test.txt\',\'a+\');fwrite($f,"etime=".$etime."\\n\\n");
return $output;';
$s['ListIndexer'] = '// added in 1.0.1: hidePrivate (hide items from unauthorized users)
//
// Derived from ListIndex 0.6j by jaredc@honeydewdesign.com
// Now supports Show In Menu
//
// This snippet was designed to be a VERY flexible way
// of showing what has been recently added. You can use
// this snippet to show news from one folder, or what has
// been recently added site wide. You can even show what\'s
// new in a \'section\' (everything under a defined folder)!

// Configuration Settings

   // Set the following snippet defaults the way you would normally
   // use this snippet, then use snippet variables in other situations
   // to override the default behaviors.

   // GENERAL OPTIONS

   // $rootFolder [ NULL | string (comma separated page id\'s) ]
   // Decide which folder to pull recent documents from.
   // If you want to specify a few folders, comma separate them.
   // The default NULL will set current page as root. Using 0
   // would search site wide. Can be set with snippet parameter
   // $LIn_root like:
   // [[ListIndexer?LIn_root=3,6,88]] 
   $rootFolder = NULL;

   // $descendentDepth [ int ]
   // How many levels below the root folder(s) do you want to
   // include? Can be overridden in snippet call with LIn_depth:
   // [[ListIndexer?LIn_depth=2]]
   // Uncomment one of these common two or create your own:
   // $descendentDepth = 1; // just children of root folder(s)
   $descendentDepth = 0; // all decendents of root folder(s)

   // $seeThruUnpub [ true | false ]
   // When using descendents, do you want to consider files below
   // an unpublished (hidden) folder? Usually no. But you decide.
   // Snippet parameter: LIn_seeThru
   // [[ListIndexer?LIn_seeThru=1]]
   $seeThruUnpub = false;

   // $seeShowInMenu [ true | false ]
   // When using descendents, do you want to consider files flagged
   // to be hidden from the menus? Usually no. But you decide.
   // Snippet parameter: LIn_seeShowInMenu
   // [[ListIndexer?LIn_seeShowInMenu=1]]
   $seeShowInMenu = false;
   
   // $hidePrivate [ true | false ]
   // Hide items from users that don\'t have appropriate
   // rights to view. Usually true. But you decide.
   // Snippet parameter: LIn_hidePrivate
   // [[ListIndexer?LIn_hidePrivate=0]]
   $hidePrivate = true;

   // $mode [ \'short\' | \'full\' ]
   // Defines whether this list should be a full, paged
   // list of all documents, or a short list of the most
   // recent few (how many will be defined next). Can be
   // overridden in snippet call with $LIn_mode:
   // [[ListIndexer?LIn_mode=full]]
   $mode = \'short\';
   
   // $sortBy [ \'alpha\' | \'date\' | \'menuindex\' ]
   // The default date will sort by most recent items first, but
   // by using the \'alpha\' option, and using full mode, you could
   // use this to create an index, or directory.
   // Settable with snippet call $LIn_sort:
   // [[ListIndexer?LIn_sort=alpha]]
   $sortBy = \'date\';
   
   // $sortDir [ \'ASC\' | \'DESC\' ]
   // Sort direction ascending or descending. Is applied to whatever $sortBy
   // field you have chosen above. If left blank, menuindex and alpha will sort
   // ASC and date DESC.
   // $LIn_dir in snippet call:
   // [[ListIndexer?LIn_dir=ASC&LIn_sortBy=menuindex]]
   $sortDir = \'\';

   // WHAT TO DISPLAY

   // $defaultTitle [ string ]
   // If you want a default title for your list
   // you can declare it here. Or use an empty
   // string to leave this off. This can be overridden
   // in the snippet call with the variable $LIn_title:
   // [[ListIndexer?LIn_title=Some new title]]
   $defaultTitle = \'\';

   // $shortDesc [ true | false ]
   // Show the description on the short list, or not. Snippet
   // parameter $LIn_sDesc:
   // [[ListIndexer?LIn_sDesc=0]]
   $shortDesc = true;

   // $fullDesc [ true | false ]
   // Show the description on the full list, or not. Snippet
   // parameter $LIn_fDesc:
   // [[ListIndexer?LIn_fDesc=0]]
   $fullDesc = true;

   // $linkToIndex [ int ]
   // If you have a page set up as an \'index\' for all the 
   // documents in this list, you can link to it by specifying 
   // its id- can also be set in snippet call with LIn_link:
   // [[ListIndexer?LIn_link=8]]
   // The default 0 will eliminate this link
   $linkToIndex = 0;

   // $indexText [ string ]
   // If you want a link to an index (probably a page running this
   // snippet in "full" mode), you can declare what you want that
   // link to say here. Or in the snippet call with LIn_indexText:
   // [[ListIndexer?LIn_indexText=Financial News Index]]
   $indexText = \'Index\';

   // $showCreationDate [ true | false ]
   // Decide to include date of creation in output or not. From
   // snippet call $LIn_showDate use 1 (true) or 0 (false)
   // [[ListIndexer?LIn_showDate=1]]
   $showCreationDate = true;

   // $dateFormat [ string ]
   // Used to define how date will be displayed (if using date)
   // Y = 4 digit year     y = 2 digit year
   // M = Jan - Dec        m = 01 - 12
   // D = Sun - Sat        d = 01 -31
   // Other standard PHP characters may be used
   $dateFormat = \'Y.m.d\';

   // $shortQty [ int ]
   // Number of entries to list in the short list. Can be
   // overridden in snippet call with $LIn_sQty:
   //[[ListIndexer?LIn_sQty=3]]
   $shortQty = 3;

   // PAGING

   // $fullQty [ int ]
   // Number of entries PER PAGE to list in the full list
   // Can be overridden in snippet call with $LIn_fQty:
   // [[ListIndexer?LIn_fQty=20]]
   // To show all set to 0 here or in snippet call
   $fullQty = 10;
   
   // $pageSeparator [ string ]
   // What you want your page number links to be separated by.
   // You NEED to include spaces if you want them. They are NOT
   // created automatically to facilitate styling ability.
   // For instance, " | " will render links like:
   // 1 | 2 | 3 | 4
   $pageSeparator = " | ";
   
   // $pgPosition [ \'top\' | \'bottom\' | \'both\']
   // Pick where you want your pagination links to appear.
   $pgPosition = \'both\';

   // PERFORMANCE

   // $useFastUrls [ true | false ]
   // IMPORTANT- using fast urls will reduce database queries
   // and improve performance WHEN IN FULL MODE ONLY and 
   // should NOT be used when multiple instances of this snippet
   // appear on the same page. With snippet call LIn_fast use 1
   // (true) or 0 (false)
   // [[ListIndexer?LIn_fast=0]]
   $useFastUrls = false;

   // $newLinesForLists [ true | false ]
   // Depending on how you want to style your list, you may
   // or may not want your <li>s on new lines. Generally, if you
   // are displaying then inline (horizontal, you do not want new
   // lines, but standard vertical block styling you do. This is
   // for IE, real browsers don\'t care.
   $newLinesForLists = true;

// Styles
//
// The following are the styles included in this snippet. It is up
// to you to include these styles in your stylesheet to get them to
// look the way you want.

   // div.LIn_title {}          List title div
   // ul.LIn_fullMode {}        UL class
   // ul.LIn_shortMode {}       UL class
   // span.LIn_date {}          Span surrounding pub/created date
   // span.LIn_desc {}          Span surrounding description
   // div.LIn_pagination        Div surrounding pagination links
   // span.LIn_currentPage {}   Span surrounding current page of
   //                           pagination (which wouldn\'t be css-able
   //                           by virtue of its <a> tag)


// **********************************************************************
// END CONFIG SETTINGS
// THE REST SHOULD TAKE CARE OF ITSELF
// **********************************************************************

// Take care of IE list issue
$ie = ($newLinesForLists)? "\\n" : \'\' ;

// Use snippet call defined variables if set
$activeTitle = (isset($LIn_title))? $LIn_title : $defaultTitle ;
$mode = (isset($LIn_mode))? $LIn_mode : $mode ;
$descendentDepth = (isset($LIn_depth))? $LIn_depth : $descendentDepth ;
$seeThruUnpub = (isset($LIn_seeThru))? $LIn_seeThru : $seeThruUnpub ;
$seeShowInMenu = (isset($LIn_seeShowInMenu))? $LIn_seeShowInMenu : $seeShowInMenu ;
$hidePrivate = (isset($LIn_hidePrivate))? $LIn_hidePrivate : $hidePrivate;
$linkToIndex = (isset($LIn_link))? $LIn_link : $linkToIndex ;
$rootFolder = (isset($LIn_root))? $LIn_root : $rootFolder ;
$shortQty = (isset($LIn_sQty))? $LIn_sQty : $shortQty ;
$fullQty = (isset($LIn_fQty))? $LIn_fQty : $fullQty ;
$showCreationDate = (isset($LIn_showDate))? $LIn_showDate : $showCreationDate ;
$indexText = (isset($LIn_indexText))? $LIn_indexText : $indexText ;
$useFastUrls = (isset($LIn_fast))? $LIn_fast : $useFastUrls ;
$sortBy = (isset($LIn_sort))? $LIn_sort : $sortBy;
$shortDesc = (isset($LIn_sDesc))? $LIn_sDesc : $shortDesc ;
$fullDesc = (isset($LIn_fDesc))? $LIn_fDesc : $fullDesc ;
$sortDir = (isset($LIn_dir))? $LIn_dir : $sortDir ;
if ($sortDir == \'\') $sortDir = ($sortBy == \'date\')? \'DESC\' : \'ASC\' ;


// Make useful variable shortcut for the content table
//$tbl = $modx->dbConfig[\'dbase\'] . "." . $modx->dbConfig[\'table_prefix\'] . "site_content";
$tblsc = $modx->getFullTableName("site_content");
$tbldg = $modx->getFullTableName("document_groups");

// Initialize output
$output = \'\';

// ---------------------------------------------------
// ---------------------------------------------------
// Query db for parent folders, or not. First check to
// see if a querystring cheat has been provided- this
// should speed things up considerably when using this
// in full mode. (a.k.a. fastUrls)
// ---------------------------------------------------
// ---------------------------------------------------
$inFolder= isset($_GET[\'LIn_f\'])? $_GET[\'LIn_f\']: 0;
if ((!$inFolder && $useFastUrls) || !$useFastUrls ){
  // Only run all the database queries if we don\'t already
  // know the folders AND fastUrls are desired.

  // ---------------------------------------------------
  // Seed list of viable parents
  // ---------------------------------------------------

  if ($rootFolder == NULL){
    $rootFolder = $modx->documentIdentifier;
  }
  // Set root level parent array
  $seedArray = explode(\',\',$rootFolder);
  $parentsArray = array();
  foreach($seedArray AS $seed){
    $parentsArray[\'level_0\'][] = $seed;
  }

  // ---------------------------------------------------
  // Make array of all allowed parents
  // ---------------------------------------------------

  // Process valid parents
  $levelCounter = 1;

  while (((count($parentsArray) < $descendentDepth) || ($descendentDepth == 0)) && ($levelCounter <= count($parentsArray)) && ($levelCounter < 10)){

    // Find all decendant parents for this level
    $pLevel = \'level_\'.($levelCounter - 1);
    $tempLevelArray = $parentsArray[$pLevel];

    foreach($tempLevelArray AS $p){

      // Get children who are parents (isfolder = 1)
      $validParentSql = "";
      $validParentSql .= "SELECT id FROM $tblsc sc WHERE ";
      $validParentSql .= "isfolder = 1 AND parent = $p ";
      $validParentSql .= "AND sc.deleted=0 ";
      $validParentSql .= ($seeThruUnpub)? ";" : "AND sc.published = 1;";

      // Run statement
      $rsTempParents = $modx->dbQuery($validParentSql);
      // Get number of results
      $countTempParents = $modx->recordCount($rsTempParents);

      // If there are results, put them in an array
      $tempValidArray = false;
      if ($countTempParents){
        for ($i=0;$i<$countTempParents;$i++){
          $tempId = $modx->fetchRow($rsTempParents);
          $tempValidArray[] = $tempId[\'id\'];
        } // end while
      } // end if

	  // populate next level of array 
	  if ($tempValidArray){
	    foreach($tempValidArray AS $kid){
	      $kidLevel = \'level_\'.$levelCounter;
	      $parentsArray[$kidLevel][] = $kid;
	    } // end foreach

	  } // end if
    } // end foreach

    // Do next level
    $levelCounter++;

  } // end while

  // Finalize list of parents
  $validParents = \'\';
  foreach ($parentsArray AS $level){
    foreach ($level AS $validP){
      $validParents .= $validP . \',\';
    }
  }

  // Remove trailing comma
  $validParents = substr($validParents,0,strlen($validParents)-1);

} else {
  $validParents = $_GET[\'LIn_f\'];
}

// ---------------------------------------------------
// Make appropriate SQL statement to pull recent items
// ---------------------------------------------------

// get document groups for current user
if($docgrp = $modx->getUserDocGroups()) $docgrp = implode(",",$docgrp);

$access = " (".($modx->isFrontend() ? "sc.privateweb=0":"1=\'".$_SESSION[\'mgrRole\']."\' OR sc.privatemgr=0").
          (!$docgrp ? "":" OR dg.document_group IN ($docgrp)").") AND ";

// Initialize
$recentSql = "";
$recentSql .= "SELECT sc.id, pagetitle, description";
// Include pub_date or createdon date if date is desired
$recentSql .= ($showCreationDate)? ", IF(pub_date > 0, pub_date, createdon) AS pubDate ": " " ;
$recentSql .= "FROM $tblsc sc LEFT JOIN $tbldg dg on dg.document = sc.id ";
$recentSql .= "WHERE ";
$recentSql .= ($hidePrivate)? $access:"";
// Look everywhere, or just under valid parents
$recentSql .= (($rootFolder == 0) && $seeThruUnpub && ($descendentDepth == 0))? "" : "parent IN ($validParents) AND " ;
// Published
$recentSql .= "sc.published = 1 ";
// Show In Menu
$recentSql .= ($seeShowInMenu)? " " : " AND sc.hidemenu=0 " ;
// Not deleted
$recentSql .= "AND sc.deleted=0 ";
// Choose sort method
switch ($sortBy){
  case \'alpha\':
    $recentSql .= "ORDER BY pagetitle ";
    break;
  case \'menuindex\':
    $recentSql .= "ORDER BY menuindex ";
    break;
  default:
    $recentSql .= "ORDER BY IF(pub_date>0, pub_date, createdon) ";
    break;
}
// Provide a sort direction
$recentSql .= $sortDir;

// If this is a short list, just pull a limited number
$recentSql .= ($mode == \'short\')? " LIMIT $shortQty;" : ";" ;

// Run statement
$rsRecent = $modx->dbQuery($recentSql);
// Count records
$recentLimit = $modx->recordCount($rsRecent);

// ---------------------------------------------------
// Generate pagination string if needed
// ---------------------------------------------------
$offsetParam = isset($_GET[\'LIn_o\'])? $_GET[\'LIn_o\']: 0;
$offset = ($offsetParam && ($mode == \'full\'))? $offsetParam : 0 ;
$pagination = \'\';

// Don\'t bother unless there are enough records to justify it
if ( ($mode == \'full\') && ($recentLimit > $fullQty) && ($fullQty) ){
  $fullUrl = $_SERVER[\'REQUEST_URI\'];
  $urlPieces = parse_url($fullUrl);
  $urlPath = $urlPieces[\'path\'];
  $otherQs = \'\';

  if ($urlPieces[\'query\']){
    foreach($_GET AS $qsKey=>$qsValue){
	  if (($qsKey != \'LIn_o\') && ($qsKey != \'LIn_f\')){
	    $otherQs .= \'&\'.$qsKey.\'=\'.$qsValue;
	  }
	}
  } 
  
  $fastUrl = $urlPath.\'?LIn_f=\'.$validParents.$otherQs;

  // Determine number of pages needed to show results
  $totalPages = ceil($recentLimit/$fullQty);
  
  // Make links
  for ($j = 0 ; $j < $totalPages; $j++){
    // only include links to OTHER pages, not current page
    if($offset == $j*$fullQty){
	  $pagination .= \'<span class="LIn_currentPage">\'.($j+1) .\'</span>\';
	} else {
      $pagination .= \'<a href="\'.$fastUrl.\'&LIn_o=\'.($j*$fullQty).\'" title="\'.($j+1).\'">\'.($j+1) .\'</a>\';
	}
	if ($j < $totalPages-1){
	  $pagination .= $pageSeparator;
	}
  }
  
  // Make final pagination link set in it\'s own div
  $pagination = \'<div class="LIn_pagination">\'."\\n".$pagination."\\n</div>\\n";
  
}


// ---------------------------------------------------
// Create title if wanted
// ---------------------------------------------------

if ($activeTitle){
  $output .= \'<div class="LIn_title">\'.$activeTitle.\'</div>\'."\\n";
}

// ---------------------------------------------------
// Create list of recent items
// ---------------------------------------------------

// Include pagination
$output .= ($pgPosition == \'top\' || $pgPosition == \'both\')? $pagination : \'\' ;

$output .= \'<ul class="LIn_\'.$mode.\'Mode">\' . $ie;

$recentCounter = $offset;
if ($mode == \'short\') {
  $recentCounterLimit = min($shortQty,$recentLimit);
} else {
  $recentCounterLimit = ($fullQty)? min(($fullQty+$offset),$recentLimit) : $recentLimit ;
}

while (($recentCounter < $recentCounterLimit) && $rsRecent && ($recentLimit > 0)){
  mysql_data_seek($rsRecent,$recentCounter);
  $recentRecord = $modx->fetchRow($rsRecent);
  $output .= \'<li>\';
  // Link to page
  $output .= \'<a href="[~\'.$recentRecord[\'id\'].\'~]" title="\'.strip_tags($recentRecord[\'pagetitle\']).\'">\'.$recentRecord[\'pagetitle\'].\'</a> \';
  // Date if desired
  if ($showCreationDate){
    $output .= \'<span class="LIn_date">\'.date($dateFormat,$recentRecord[\'pubDate\']).\'</span> \';
  }
  // Description if desired
  if ((($mode == \'short\') && ($shortDesc)) || (($mode == \'full\') && ($fullDesc))){
   $output .= \'<span class="LIn_desc">\'.$recentRecord[\'description\'].\'</span>\';
  }
  // wrap it up
  $output .= \'</li>\' . $ie;
  $recentCounter ++;
}

$output .= \'</ul>\' . $ie;

$output .= ($pgPosition == \'bottom\' || $pgPosition == \'both\')? $pagination : \'\' ;

// ---------------------------------------------------
// Link to index
// ---------------------------------------------------

if ($linkToIndex) {

  $output .= \'<div class="LIn_index">\';
  $output .= \'<a href="[~\'.$linkToIndex.\'~]" title="\'.$indexText.\'">\'.$indexText.\'</a>\';
  $output .= \'</div>\';

}

// ---------------------------------------------------
// Send to browser
// ---------------------------------------------------

return $output;';
$s['ListIndexer'] = '// added in 1.0.1: hidePrivate (hide items from unauthorized users)
//
// Derived from ListIndex 0.6j by jaredc@honeydewdesign.com
// Now supports Show In Menu
//
// This snippet was designed to be a VERY flexible way
// of showing what has been recently added. You can use
// this snippet to show news from one folder, or what has
// been recently added site wide. You can even show what\'s
// new in a \'section\' (everything under a defined folder)!

// Configuration Settings

   // Set the following snippet defaults the way you would normally
   // use this snippet, then use snippet variables in other situations
   // to override the default behaviors.

   // GENERAL OPTIONS

   // $rootFolder [ NULL | string (comma separated page id\'s) ]
   // Decide which folder to pull recent documents from.
   // If you want to specify a few folders, comma separate them.
   // The default NULL will set current page as root. Using 0
   // would search site wide. Can be set with snippet parameter
   // $LIn_root like:
   // [[ListIndexer?LIn_root=3,6,88]] 
   $rootFolder = NULL;

   // $descendentDepth [ int ]
   // How many levels below the root folder(s) do you want to
   // include? Can be overridden in snippet call with LIn_depth:
   // [[ListIndexer?LIn_depth=2]]
   // Uncomment one of these common two or create your own:
   // $descendentDepth = 1; // just children of root folder(s)
   $descendentDepth = 0; // all decendents of root folder(s)

   // $seeThruUnpub [ true | false ]
   // When using descendents, do you want to consider files below
   // an unpublished (hidden) folder? Usually no. But you decide.
   // Snippet parameter: LIn_seeThru
   // [[ListIndexer?LIn_seeThru=1]]
   $seeThruUnpub = false;

   // $seeShowInMenu [ true | false ]
   // When using descendents, do you want to consider files flagged
   // to be hidden from the menus? Usually no. But you decide.
   // Snippet parameter: LIn_seeShowInMenu
   // [[ListIndexer?LIn_seeShowInMenu=1]]
   $seeShowInMenu = false;
   
   // $hidePrivate [ true | false ]
   // Hide items from users that don\'t have appropriate
   // rights to view. Usually true. But you decide.
   // Snippet parameter: LIn_hidePrivate
   // [[ListIndexer?LIn_hidePrivate=0]]
   $hidePrivate = true;

   // $mode [ \'short\' | \'full\' ]
   // Defines whether this list should be a full, paged
   // list of all documents, or a short list of the most
   // recent few (how many will be defined next). Can be
   // overridden in snippet call with $LIn_mode:
   // [[ListIndexer?LIn_mode=full]]
   $mode = \'short\';
   
   // $sortBy [ \'alpha\' | \'date\' | \'menuindex\' ]
   // The default date will sort by most recent items first, but
   // by using the \'alpha\' option, and using full mode, you could
   // use this to create an index, or directory.
   // Settable with snippet call $LIn_sort:
   // [[ListIndexer?LIn_sort=alpha]]
   $sortBy = \'date\';
   
   // $sortDir [ \'ASC\' | \'DESC\' ]
   // Sort direction ascending or descending. Is applied to whatever $sortBy
   // field you have chosen above. If left blank, menuindex and alpha will sort
   // ASC and date DESC.
   // $LIn_dir in snippet call:
   // [[ListIndexer?LIn_dir=ASC&LIn_sortBy=menuindex]]
   $sortDir = \'\';

   // WHAT TO DISPLAY

   // $defaultTitle [ string ]
   // If you want a default title for your list
   // you can declare it here. Or use an empty
   // string to leave this off. This can be overridden
   // in the snippet call with the variable $LIn_title:
   // [[ListIndexer?LIn_title=Some new title]]
   $defaultTitle = \'\';

   // $shortDesc [ true | false ]
   // Show the description on the short list, or not. Snippet
   // parameter $LIn_sDesc:
   // [[ListIndexer?LIn_sDesc=0]]
   $shortDesc = true;

   // $fullDesc [ true | false ]
   // Show the description on the full list, or not. Snippet
   // parameter $LIn_fDesc:
   // [[ListIndexer?LIn_fDesc=0]]
   $fullDesc = true;

   // $linkToIndex [ int ]
   // If you have a page set up as an \'index\' for all the 
   // documents in this list, you can link to it by specifying 
   // its id- can also be set in snippet call with LIn_link:
   // [[ListIndexer?LIn_link=8]]
   // The default 0 will eliminate this link
   $linkToIndex = 0;

   // $indexText [ string ]
   // If you want a link to an index (probably a page running this
   // snippet in "full" mode), you can declare what you want that
   // link to say here. Or in the snippet call with LIn_indexText:
   // [[ListIndexer?LIn_indexText=Financial News Index]]
   $indexText = \'Index\';

   // $showCreationDate [ true | false ]
   // Decide to include date of creation in output or not. From
   // snippet call $LIn_showDate use 1 (true) or 0 (false)
   // [[ListIndexer?LIn_showDate=1]]
   $showCreationDate = true;

   // $dateFormat [ string ]
   // Used to define how date will be displayed (if using date)
   // Y = 4 digit year     y = 2 digit year
   // M = Jan - Dec        m = 01 - 12
   // D = Sun - Sat        d = 01 -31
   // Other standard PHP characters may be used
   $dateFormat = \'Y.m.d\';

   // $shortQty [ int ]
   // Number of entries to list in the short list. Can be
   // overridden in snippet call with $LIn_sQty:
   //[[ListIndexer?LIn_sQty=3]]
   $shortQty = 3;

   // PAGING

   // $fullQty [ int ]
   // Number of entries PER PAGE to list in the full list
   // Can be overridden in snippet call with $LIn_fQty:
   // [[ListIndexer?LIn_fQty=20]]
   // To show all set to 0 here or in snippet call
   $fullQty = 10;
   
   // $pageSeparator [ string ]
   // What you want your page number links to be separated by.
   // You NEED to include spaces if you want them. They are NOT
   // created automatically to facilitate styling ability.
   // For instance, " | " will render links like:
   // 1 | 2 | 3 | 4
   $pageSeparator = " | ";
   
   // $pgPosition [ \'top\' | \'bottom\' | \'both\']
   // Pick where you want your pagination links to appear.
   $pgPosition = \'both\';

   // PERFORMANCE

   // $useFastUrls [ true | false ]
   // IMPORTANT- using fast urls will reduce database queries
   // and improve performance WHEN IN FULL MODE ONLY and 
   // should NOT be used when multiple instances of this snippet
   // appear on the same page. With snippet call LIn_fast use 1
   // (true) or 0 (false)
   // [[ListIndexer?LIn_fast=0]]
   $useFastUrls = false;

   // $newLinesForLists [ true | false ]
   // Depending on how you want to style your list, you may
   // or may not want your <li>s on new lines. Generally, if you
   // are displaying then inline (horizontal, you do not want new
   // lines, but standard vertical block styling you do. This is
   // for IE, real browsers don\'t care.
   $newLinesForLists = true;

// Styles
//
// The following are the styles included in this snippet. It is up
// to you to include these styles in your stylesheet to get them to
// look the way you want.

   // div.LIn_title {}          List title div
   // ul.LIn_fullMode {}        UL class
   // ul.LIn_shortMode {}       UL class
   // span.LIn_date {}          Span surrounding pub/created date
   // span.LIn_desc {}          Span surrounding description
   // div.LIn_pagination        Div surrounding pagination links
   // span.LIn_currentPage {}   Span surrounding current page of
   //                           pagination (which wouldn\'t be css-able
   //                           by virtue of its <a> tag)


// **********************************************************************
// END CONFIG SETTINGS
// THE REST SHOULD TAKE CARE OF ITSELF
// **********************************************************************

// Take care of IE list issue
$ie = ($newLinesForLists)? "\\n" : \'\' ;

// Use snippet call defined variables if set
$activeTitle = (isset($LIn_title))? $LIn_title : $defaultTitle ;
$mode = (isset($LIn_mode))? $LIn_mode : $mode ;
$descendentDepth = (isset($LIn_depth))? $LIn_depth : $descendentDepth ;
$seeThruUnpub = (isset($LIn_seeThru))? $LIn_seeThru : $seeThruUnpub ;
$seeShowInMenu = (isset($LIn_seeShowInMenu))? $LIn_seeShowInMenu : $seeShowInMenu ;
$hidePrivate = (isset($LIn_hidePrivate))? $LIn_hidePrivate : $hidePrivate;
$linkToIndex = (isset($LIn_link))? $LIn_link : $linkToIndex ;
$rootFolder = (isset($LIn_root))? $LIn_root : $rootFolder ;
$shortQty = (isset($LIn_sQty))? $LIn_sQty : $shortQty ;
$fullQty = (isset($LIn_fQty))? $LIn_fQty : $fullQty ;
$showCreationDate = (isset($LIn_showDate))? $LIn_showDate : $showCreationDate ;
$indexText = (isset($LIn_indexText))? $LIn_indexText : $indexText ;
$useFastUrls = (isset($LIn_fast))? $LIn_fast : $useFastUrls ;
$sortBy = (isset($LIn_sort))? $LIn_sort : $sortBy;
$shortDesc = (isset($LIn_sDesc))? $LIn_sDesc : $shortDesc ;
$fullDesc = (isset($LIn_fDesc))? $LIn_fDesc : $fullDesc ;
$sortDir = (isset($LIn_dir))? $LIn_dir : $sortDir ;
if ($sortDir == \'\') $sortDir = ($sortBy == \'date\')? \'DESC\' : \'ASC\' ;


// Make useful variable shortcut for the content table
//$tbl = $modx->dbConfig[\'dbase\'] . "." . $modx->dbConfig[\'table_prefix\'] . "site_content";
$tblsc = $modx->getFullTableName("site_content");
$tbldg = $modx->getFullTableName("document_groups");

// Initialize output
$output = \'\';

// ---------------------------------------------------
// ---------------------------------------------------
// Query db for parent folders, or not. First check to
// see if a querystring cheat has been provided- this
// should speed things up considerably when using this
// in full mode. (a.k.a. fastUrls)
// ---------------------------------------------------
// ---------------------------------------------------
$inFolder= isset($_GET[\'LIn_f\'])? $_GET[\'LIn_f\']: 0;
if ((!$inFolder && $useFastUrls) || !$useFastUrls ){
  // Only run all the database queries if we don\'t already
  // know the folders AND fastUrls are desired.

  // ---------------------------------------------------
  // Seed list of viable parents
  // ---------------------------------------------------

  if ($rootFolder == NULL){
    $rootFolder = $modx->documentIdentifier;
  }
  // Set root level parent array
  $seedArray = explode(\',\',$rootFolder);
  $parentsArray = array();
  foreach($seedArray AS $seed){
    $parentsArray[\'level_0\'][] = $seed;
  }

  // ---------------------------------------------------
  // Make array of all allowed parents
  // ---------------------------------------------------

  // Process valid parents
  $levelCounter = 1;

  while (((count($parentsArray) < $descendentDepth) || ($descendentDepth == 0)) && ($levelCounter <= count($parentsArray)) && ($levelCounter < 10)){

    // Find all decendant parents for this level
    $pLevel = \'level_\'.($levelCounter - 1);
    $tempLevelArray = $parentsArray[$pLevel];

    foreach($tempLevelArray AS $p){

      // Get children who are parents (isfolder = 1)
      $validParentSql = "";
      $validParentSql .= "SELECT id FROM $tblsc sc WHERE ";
      $validParentSql .= "isfolder = 1 AND parent = $p ";
      $validParentSql .= "AND sc.deleted=0 ";
      $validParentSql .= ($seeThruUnpub)? ";" : "AND sc.published = 1;";

      // Run statement
      $rsTempParents = $modx->dbQuery($validParentSql);
      // Get number of results
      $countTempParents = $modx->recordCount($rsTempParents);

      // If there are results, put them in an array
      $tempValidArray = false;
      if ($countTempParents){
        for ($i=0;$i<$countTempParents;$i++){
          $tempId = $modx->fetchRow($rsTempParents);
          $tempValidArray[] = $tempId[\'id\'];
        } // end while
      } // end if

	  // populate next level of array 
	  if ($tempValidArray){
	    foreach($tempValidArray AS $kid){
	      $kidLevel = \'level_\'.$levelCounter;
	      $parentsArray[$kidLevel][] = $kid;
	    } // end foreach

	  } // end if
    } // end foreach

    // Do next level
    $levelCounter++;

  } // end while

  // Finalize list of parents
  $validParents = \'\';
  foreach ($parentsArray AS $level){
    foreach ($level AS $validP){
      $validParents .= $validP . \',\';
    }
  }

  // Remove trailing comma
  $validParents = substr($validParents,0,strlen($validParents)-1);

} else {
  $validParents = $_GET[\'LIn_f\'];
}

// ---------------------------------------------------
// Make appropriate SQL statement to pull recent items
// ---------------------------------------------------

// get document groups for current user
if($docgrp = $modx->getUserDocGroups()) $docgrp = implode(",",$docgrp);

$access = " (".($modx->isFrontend() ? "sc.privateweb=0":"1=\'".$_SESSION[\'mgrRole\']."\' OR sc.privatemgr=0").
          (!$docgrp ? "":" OR dg.document_group IN ($docgrp)").") AND ";

// Initialize
$recentSql = "";
$recentSql .= "SELECT sc.id, pagetitle, description";
// Include pub_date or createdon date if date is desired
$recentSql .= ($showCreationDate)? ", IF(pub_date > 0, pub_date, createdon) AS pubDate ": " " ;
$recentSql .= "FROM $tblsc sc LEFT JOIN $tbldg dg on dg.document = sc.id ";
$recentSql .= "WHERE ";
$recentSql .= ($hidePrivate)? $access:"";
// Look everywhere, or just under valid parents
$recentSql .= (($rootFolder == 0) && $seeThruUnpub && ($descendentDepth == 0))? "" : "parent IN ($validParents) AND " ;
// Published
$recentSql .= "sc.published = 1 ";
// Show In Menu
$recentSql .= ($seeShowInMenu)? " " : " AND sc.hidemenu=0 " ;
// Not deleted
$recentSql .= "AND sc.deleted=0 ";
// Choose sort method
switch ($sortBy){
  case \'alpha\':
    $recentSql .= "ORDER BY pagetitle ";
    break;
  case \'menuindex\':
    $recentSql .= "ORDER BY menuindex ";
    break;
  default:
    $recentSql .= "ORDER BY IF(pub_date>0, pub_date, createdon) ";
    break;
}
// Provide a sort direction
$recentSql .= $sortDir;

// If this is a short list, just pull a limited number
$recentSql .= ($mode == \'short\')? " LIMIT $shortQty;" : ";" ;

// Run statement
$rsRecent = $modx->dbQuery($recentSql);
// Count records
$recentLimit = $modx->recordCount($rsRecent);

// ---------------------------------------------------
// Generate pagination string if needed
// ---------------------------------------------------
$offsetParam = isset($_GET[\'LIn_o\'])? $_GET[\'LIn_o\']: 0;
$offset = ($offsetParam && ($mode == \'full\'))? $offsetParam : 0 ;
$pagination = \'\';

// Don\'t bother unless there are enough records to justify it
if ( ($mode == \'full\') && ($recentLimit > $fullQty) && ($fullQty) ){
  $fullUrl = $_SERVER[\'REQUEST_URI\'];
  $urlPieces = parse_url($fullUrl);
  $urlPath = $urlPieces[\'path\'];
  $otherQs = \'\';

  if ($urlPieces[\'query\']){
    foreach($_GET AS $qsKey=>$qsValue){
	  if (($qsKey != \'LIn_o\') && ($qsKey != \'LIn_f\')){
	    $otherQs .= \'&\'.$qsKey.\'=\'.$qsValue;
	  }
	}
  } 
  
  $fastUrl = $urlPath.\'?LIn_f=\'.$validParents.$otherQs;

  // Determine number of pages needed to show results
  $totalPages = ceil($recentLimit/$fullQty);
  
  // Make links
  for ($j = 0 ; $j < $totalPages; $j++){
    // only include links to OTHER pages, not current page
    if($offset == $j*$fullQty){
	  $pagination .= \'<span class="LIn_currentPage">\'.($j+1) .\'</span>\';
	} else {
      $pagination .= \'<a href="\'.$fastUrl.\'&LIn_o=\'.($j*$fullQty).\'" title="\'.($j+1).\'">\'.($j+1) .\'</a>\';
	}
	if ($j < $totalPages-1){
	  $pagination .= $pageSeparator;
	}
  }
  
  // Make final pagination link set in it\'s own div
  $pagination = \'<div class="LIn_pagination">\'."\\n".$pagination."\\n</div>\\n";
  
}


// ---------------------------------------------------
// Create title if wanted
// ---------------------------------------------------

if ($activeTitle){
  $output .= \'<div class="LIn_title">\'.$activeTitle.\'</div>\'."\\n";
}

// ---------------------------------------------------
// Create list of recent items
// ---------------------------------------------------

// Include pagination
$output .= ($pgPosition == \'top\' || $pgPosition == \'both\')? $pagination : \'\' ;

$output .= \'<ul class="LIn_\'.$mode.\'Mode">\' . $ie;

$recentCounter = $offset;
if ($mode == \'short\') {
  $recentCounterLimit = min($shortQty,$recentLimit);
} else {
  $recentCounterLimit = ($fullQty)? min(($fullQty+$offset),$recentLimit) : $recentLimit ;
}

while (($recentCounter < $recentCounterLimit) && $rsRecent && ($recentLimit > 0)){
  mysql_data_seek($rsRecent,$recentCounter);
  $recentRecord = $modx->fetchRow($rsRecent);
  $output .= \'<li>\';
  // Link to page
  $output .= \'<a href="[~\'.$recentRecord[\'id\'].\'~]" title="\'.strip_tags($recentRecord[\'pagetitle\']).\'">\'.$recentRecord[\'pagetitle\'].\'</a> \';
  // Date if desired
  if ($showCreationDate){
    $output .= \'<span class="LIn_date">\'.date($dateFormat,$recentRecord[\'pubDate\']).\'</span> \';
  }
  // Description if desired
  if ((($mode == \'short\') && ($shortDesc)) || (($mode == \'full\') && ($fullDesc))){
   $output .= \'<span class="LIn_desc">\'.$recentRecord[\'description\'].\'</span>\';
  }
  // wrap it up
  $output .= \'</li>\' . $ie;
  $recentCounter ++;
}

$output .= \'</ul>\' . $ie;

$output .= ($pgPosition == \'bottom\' || $pgPosition == \'both\')? $pagination : \'\' ;

// ---------------------------------------------------
// Link to index
// ---------------------------------------------------

if ($linkToIndex) {

  $output .= \'<div class="LIn_index">\';
  $output .= \'<a href="[~\'.$linkToIndex.\'~]" title="\'.$indexText.\'">\'.$indexText.\'</a>\';
  $output .= \'</div>\';

}

// ---------------------------------------------------
// Send to browser
// ---------------------------------------------------

return $output;';
$s['ListIndexer'] = '// added in 1.0.1: hidePrivate (hide items from unauthorized users)
//
// Derived from ListIndex 0.6j by jaredc@honeydewdesign.com
// Now supports Show In Menu
//
// This snippet was designed to be a VERY flexible way
// of showing what has been recently added. You can use
// this snippet to show news from one folder, or what has
// been recently added site wide. You can even show what\'s
// new in a \'section\' (everything under a defined folder)!

// Configuration Settings

   // Set the following snippet defaults the way you would normally
   // use this snippet, then use snippet variables in other situations
   // to override the default behaviors.

   // GENERAL OPTIONS

   // $rootFolder [ NULL | string (comma separated page id\'s) ]
   // Decide which folder to pull recent documents from.
   // If you want to specify a few folders, comma separate them.
   // The default NULL will set current page as root. Using 0
   // would search site wide. Can be set with snippet parameter
   // $LIn_root like:
   // [[ListIndexer?LIn_root=3,6,88]] 
   $rootFolder = NULL;

   // $descendentDepth [ int ]
   // How many levels below the root folder(s) do you want to
   // include? Can be overridden in snippet call with LIn_depth:
   // [[ListIndexer?LIn_depth=2]]
   // Uncomment one of these common two or create your own:
   // $descendentDepth = 1; // just children of root folder(s)
   $descendentDepth = 0; // all decendents of root folder(s)

   // $seeThruUnpub [ true | false ]
   // When using descendents, do you want to consider files below
   // an unpublished (hidden) folder? Usually no. But you decide.
   // Snippet parameter: LIn_seeThru
   // [[ListIndexer?LIn_seeThru=1]]
   $seeThruUnpub = false;

   // $seeShowInMenu [ true | false ]
   // When using descendents, do you want to consider files flagged
   // to be hidden from the menus? Usually no. But you decide.
   // Snippet parameter: LIn_seeShowInMenu
   // [[ListIndexer?LIn_seeShowInMenu=1]]
   $seeShowInMenu = false;
   
   // $hidePrivate [ true | false ]
   // Hide items from users that don\'t have appropriate
   // rights to view. Usually true. But you decide.
   // Snippet parameter: LIn_hidePrivate
   // [[ListIndexer?LIn_hidePrivate=0]]
   $hidePrivate = true;

   // $mode [ \'short\' | \'full\' ]
   // Defines whether this list should be a full, paged
   // list of all documents, or a short list of the most
   // recent few (how many will be defined next). Can be
   // overridden in snippet call with $LIn_mode:
   // [[ListIndexer?LIn_mode=full]]
   $mode = \'short\';
   
   // $sortBy [ \'alpha\' | \'date\' | \'menuindex\' ]
   // The default date will sort by most recent items first, but
   // by using the \'alpha\' option, and using full mode, you could
   // use this to create an index, or directory.
   // Settable with snippet call $LIn_sort:
   // [[ListIndexer?LIn_sort=alpha]]
   $sortBy = \'date\';
   
   // $sortDir [ \'ASC\' | \'DESC\' ]
   // Sort direction ascending or descending. Is applied to whatever $sortBy
   // field you have chosen above. If left blank, menuindex and alpha will sort
   // ASC and date DESC.
   // $LIn_dir in snippet call:
   // [[ListIndexer?LIn_dir=ASC&LIn_sortBy=menuindex]]
   $sortDir = \'\';

   // WHAT TO DISPLAY

   // $defaultTitle [ string ]
   // If you want a default title for your list
   // you can declare it here. Or use an empty
   // string to leave this off. This can be overridden
   // in the snippet call with the variable $LIn_title:
   // [[ListIndexer?LIn_title=Some new title]]
   $defaultTitle = \'\';

   // $shortDesc [ true | false ]
   // Show the description on the short list, or not. Snippet
   // parameter $LIn_sDesc:
   // [[ListIndexer?LIn_sDesc=0]]
   $shortDesc = true;

   // $fullDesc [ true | false ]
   // Show the description on the full list, or not. Snippet
   // parameter $LIn_fDesc:
   // [[ListIndexer?LIn_fDesc=0]]
   $fullDesc = true;

   // $linkToIndex [ int ]
   // If you have a page set up as an \'index\' for all the 
   // documents in this list, you can link to it by specifying 
   // its id- can also be set in snippet call with LIn_link:
   // [[ListIndexer?LIn_link=8]]
   // The default 0 will eliminate this link
   $linkToIndex = 0;

   // $indexText [ string ]
   // If you want a link to an index (probably a page running this
   // snippet in "full" mode), you can declare what you want that
   // link to say here. Or in the snippet call with LIn_indexText:
   // [[ListIndexer?LIn_indexText=Financial News Index]]
   $indexText = \'Index\';

   // $showCreationDate [ true | false ]
   // Decide to include date of creation in output or not. From
   // snippet call $LIn_showDate use 1 (true) or 0 (false)
   // [[ListIndexer?LIn_showDate=1]]
   $showCreationDate = true;

   // $dateFormat [ string ]
   // Used to define how date will be displayed (if using date)
   // Y = 4 digit year     y = 2 digit year
   // M = Jan - Dec        m = 01 - 12
   // D = Sun - Sat        d = 01 -31
   // Other standard PHP characters may be used
   $dateFormat = \'Y.m.d\';

   // $shortQty [ int ]
   // Number of entries to list in the short list. Can be
   // overridden in snippet call with $LIn_sQty:
   //[[ListIndexer?LIn_sQty=3]]
   $shortQty = 3;

   // PAGING

   // $fullQty [ int ]
   // Number of entries PER PAGE to list in the full list
   // Can be overridden in snippet call with $LIn_fQty:
   // [[ListIndexer?LIn_fQty=20]]
   // To show all set to 0 here or in snippet call
   $fullQty = 10;
   
   // $pageSeparator [ string ]
   // What you want your page number links to be separated by.
   // You NEED to include spaces if you want them. They are NOT
   // created automatically to facilitate styling ability.
   // For instance, " | " will render links like:
   // 1 | 2 | 3 | 4
   $pageSeparator = " | ";
   
   // $pgPosition [ \'top\' | \'bottom\' | \'both\']
   // Pick where you want your pagination links to appear.
   $pgPosition = \'both\';

   // PERFORMANCE

   // $useFastUrls [ true | false ]
   // IMPORTANT- using fast urls will reduce database queries
   // and improve performance WHEN IN FULL MODE ONLY and 
   // should NOT be used when multiple instances of this snippet
   // appear on the same page. With snippet call LIn_fast use 1
   // (true) or 0 (false)
   // [[ListIndexer?LIn_fast=0]]
   $useFastUrls = false;

   // $newLinesForLists [ true | false ]
   // Depending on how you want to style your list, you may
   // or may not want your <li>s on new lines. Generally, if you
   // are displaying then inline (horizontal, you do not want new
   // lines, but standard vertical block styling you do. This is
   // for IE, real browsers don\'t care.
   $newLinesForLists = true;

// Styles
//
// The following are the styles included in this snippet. It is up
// to you to include these styles in your stylesheet to get them to
// look the way you want.

   // div.LIn_title {}          List title div
   // ul.LIn_fullMode {}        UL class
   // ul.LIn_shortMode {}       UL class
   // span.LIn_date {}          Span surrounding pub/created date
   // span.LIn_desc {}          Span surrounding description
   // div.LIn_pagination        Div surrounding pagination links
   // span.LIn_currentPage {}   Span surrounding current page of
   //                           pagination (which wouldn\'t be css-able
   //                           by virtue of its <a> tag)


// **********************************************************************
// END CONFIG SETTINGS
// THE REST SHOULD TAKE CARE OF ITSELF
// **********************************************************************

// Take care of IE list issue
$ie = ($newLinesForLists)? "\\n" : \'\' ;

// Use snippet call defined variables if set
$activeTitle = (isset($LIn_title))? $LIn_title : $defaultTitle ;
$mode = (isset($LIn_mode))? $LIn_mode : $mode ;
$descendentDepth = (isset($LIn_depth))? $LIn_depth : $descendentDepth ;
$seeThruUnpub = (isset($LIn_seeThru))? $LIn_seeThru : $seeThruUnpub ;
$seeShowInMenu = (isset($LIn_seeShowInMenu))? $LIn_seeShowInMenu : $seeShowInMenu ;
$hidePrivate = (isset($LIn_hidePrivate))? $LIn_hidePrivate : $hidePrivate;
$linkToIndex = (isset($LIn_link))? $LIn_link : $linkToIndex ;
$rootFolder = (isset($LIn_root))? $LIn_root : $rootFolder ;
$shortQty = (isset($LIn_sQty))? $LIn_sQty : $shortQty ;
$fullQty = (isset($LIn_fQty))? $LIn_fQty : $fullQty ;
$showCreationDate = (isset($LIn_showDate))? $LIn_showDate : $showCreationDate ;
$indexText = (isset($LIn_indexText))? $LIn_indexText : $indexText ;
$useFastUrls = (isset($LIn_fast))? $LIn_fast : $useFastUrls ;
$sortBy = (isset($LIn_sort))? $LIn_sort : $sortBy;
$shortDesc = (isset($LIn_sDesc))? $LIn_sDesc : $shortDesc ;
$fullDesc = (isset($LIn_fDesc))? $LIn_fDesc : $fullDesc ;
$sortDir = (isset($LIn_dir))? $LIn_dir : $sortDir ;
if ($sortDir == \'\') $sortDir = ($sortBy == \'date\')? \'DESC\' : \'ASC\' ;


// Make useful variable shortcut for the content table
//$tbl = $modx->dbConfig[\'dbase\'] . "." . $modx->dbConfig[\'table_prefix\'] . "site_content";
$tblsc = $modx->getFullTableName("site_content");
$tbldg = $modx->getFullTableName("document_groups");

// Initialize output
$output = \'\';

// ---------------------------------------------------
// ---------------------------------------------------
// Query db for parent folders, or not. First check to
// see if a querystring cheat has been provided- this
// should speed things up considerably when using this
// in full mode. (a.k.a. fastUrls)
// ---------------------------------------------------
// ---------------------------------------------------
$inFolder= isset($_GET[\'LIn_f\'])? $_GET[\'LIn_f\']: 0;
if ((!$inFolder && $useFastUrls) || !$useFastUrls ){
  // Only run all the database queries if we don\'t already
  // know the folders AND fastUrls are desired.

  // ---------------------------------------------------
  // Seed list of viable parents
  // ---------------------------------------------------

  if ($rootFolder == NULL){
    $rootFolder = $modx->documentIdentifier;
  }
  // Set root level parent array
  $seedArray = explode(\',\',$rootFolder);
  $parentsArray = array();
  foreach($seedArray AS $seed){
    $parentsArray[\'level_0\'][] = $seed;
  }

  // ---------------------------------------------------
  // Make array of all allowed parents
  // ---------------------------------------------------

  // Process valid parents
  $levelCounter = 1;

  while (((count($parentsArray) < $descendentDepth) || ($descendentDepth == 0)) && ($levelCounter <= count($parentsArray)) && ($levelCounter < 10)){

    // Find all decendant parents for this level
    $pLevel = \'level_\'.($levelCounter - 1);
    $tempLevelArray = $parentsArray[$pLevel];

    foreach($tempLevelArray AS $p){

      // Get children who are parents (isfolder = 1)
      $validParentSql = "";
      $validParentSql .= "SELECT id FROM $tblsc sc WHERE ";
      $validParentSql .= "isfolder = 1 AND parent = $p ";
      $validParentSql .= "AND sc.deleted=0 ";
      $validParentSql .= ($seeThruUnpub)? ";" : "AND sc.published = 1;";

      // Run statement
      $rsTempParents = $modx->dbQuery($validParentSql);
      // Get number of results
      $countTempParents = $modx->recordCount($rsTempParents);

      // If there are results, put them in an array
      $tempValidArray = false;
      if ($countTempParents){
        for ($i=0;$i<$countTempParents;$i++){
          $tempId = $modx->fetchRow($rsTempParents);
          $tempValidArray[] = $tempId[\'id\'];
        } // end while
      } // end if

	  // populate next level of array 
	  if ($tempValidArray){
	    foreach($tempValidArray AS $kid){
	      $kidLevel = \'level_\'.$levelCounter;
	      $parentsArray[$kidLevel][] = $kid;
	    } // end foreach

	  } // end if
    } // end foreach

    // Do next level
    $levelCounter++;

  } // end while

  // Finalize list of parents
  $validParents = \'\';
  foreach ($parentsArray AS $level){
    foreach ($level AS $validP){
      $validParents .= $validP . \',\';
    }
  }

  // Remove trailing comma
  $validParents = substr($validParents,0,strlen($validParents)-1);

} else {
  $validParents = $_GET[\'LIn_f\'];
}

// ---------------------------------------------------
// Make appropriate SQL statement to pull recent items
// ---------------------------------------------------

// get document groups for current user
if($docgrp = $modx->getUserDocGroups()) $docgrp = implode(",",$docgrp);

$access = " (".($modx->isFrontend() ? "sc.privateweb=0":"1=\'".$_SESSION[\'mgrRole\']."\' OR sc.privatemgr=0").
          (!$docgrp ? "":" OR dg.document_group IN ($docgrp)").") AND ";

// Initialize
$recentSql = "";
$recentSql .= "SELECT sc.id, pagetitle, description";
// Include pub_date or createdon date if date is desired
$recentSql .= ($showCreationDate)? ", IF(pub_date > 0, pub_date, createdon) AS pubDate ": " " ;
$recentSql .= "FROM $tblsc sc LEFT JOIN $tbldg dg on dg.document = sc.id ";
$recentSql .= "WHERE ";
$recentSql .= ($hidePrivate)? $access:"";
// Look everywhere, or just under valid parents
$recentSql .= (($rootFolder == 0) && $seeThruUnpub && ($descendentDepth == 0))? "" : "parent IN ($validParents) AND " ;
// Published
$recentSql .= "sc.published = 1 ";
// Show In Menu
$recentSql .= ($seeShowInMenu)? " " : " AND sc.hidemenu=0 " ;
// Not deleted
$recentSql .= "AND sc.deleted=0 ";
// Choose sort method
switch ($sortBy){
  case \'alpha\':
    $recentSql .= "ORDER BY pagetitle ";
    break;
  case \'menuindex\':
    $recentSql .= "ORDER BY menuindex ";
    break;
  default:
    $recentSql .= "ORDER BY IF(pub_date>0, pub_date, createdon) ";
    break;
}
// Provide a sort direction
$recentSql .= $sortDir;

// If this is a short list, just pull a limited number
$recentSql .= ($mode == \'short\')? " LIMIT $shortQty;" : ";" ;

// Run statement
$rsRecent = $modx->dbQuery($recentSql);
// Count records
$recentLimit = $modx->recordCount($rsRecent);

// ---------------------------------------------------
// Generate pagination string if needed
// ---------------------------------------------------
$offsetParam = isset($_GET[\'LIn_o\'])? $_GET[\'LIn_o\']: 0;
$offset = ($offsetParam && ($mode == \'full\'))? $offsetParam : 0 ;
$pagination = \'\';

// Don\'t bother unless there are enough records to justify it
if ( ($mode == \'full\') && ($recentLimit > $fullQty) && ($fullQty) ){
  $fullUrl = $_SERVER[\'REQUEST_URI\'];
  $urlPieces = parse_url($fullUrl);
  $urlPath = $urlPieces[\'path\'];
  $otherQs = \'\';

  if ($urlPieces[\'query\']){
    foreach($_GET AS $qsKey=>$qsValue){
	  if (($qsKey != \'LIn_o\') && ($qsKey != \'LIn_f\')){
	    $otherQs .= \'&\'.$qsKey.\'=\'.$qsValue;
	  }
	}
  } 
  
  $fastUrl = $urlPath.\'?LIn_f=\'.$validParents.$otherQs;

  // Determine number of pages needed to show results
  $totalPages = ceil($recentLimit/$fullQty);
  
  // Make links
  for ($j = 0 ; $j < $totalPages; $j++){
    // only include links to OTHER pages, not current page
    if($offset == $j*$fullQty){
	  $pagination .= \'<span class="LIn_currentPage">\'.($j+1) .\'</span>\';
	} else {
      $pagination .= \'<a href="\'.$fastUrl.\'&LIn_o=\'.($j*$fullQty).\'" title="\'.($j+1).\'">\'.($j+1) .\'</a>\';
	}
	if ($j < $totalPages-1){
	  $pagination .= $pageSeparator;
	}
  }
  
  // Make final pagination link set in it\'s own div
  $pagination = \'<div class="LIn_pagination">\'."\\n".$pagination."\\n</div>\\n";
  
}


// ---------------------------------------------------
// Create title if wanted
// ---------------------------------------------------

if ($activeTitle){
  $output .= \'<div class="LIn_title">\'.$activeTitle.\'</div>\'."\\n";
}

// ---------------------------------------------------
// Create list of recent items
// ---------------------------------------------------

// Include pagination
$output .= ($pgPosition == \'top\' || $pgPosition == \'both\')? $pagination : \'\' ;

$output .= \'<ul class="LIn_\'.$mode.\'Mode">\' . $ie;

$recentCounter = $offset;
if ($mode == \'short\') {
  $recentCounterLimit = min($shortQty,$recentLimit);
} else {
  $recentCounterLimit = ($fullQty)? min(($fullQty+$offset),$recentLimit) : $recentLimit ;
}

while (($recentCounter < $recentCounterLimit) && $rsRecent && ($recentLimit > 0)){
  mysql_data_seek($rsRecent,$recentCounter);
  $recentRecord = $modx->fetchRow($rsRecent);
  $output .= \'<li>\';
  // Link to page
  $output .= \'<a href="[~\'.$recentRecord[\'id\'].\'~]" title="\'.strip_tags($recentRecord[\'pagetitle\']).\'">\'.$recentRecord[\'pagetitle\'].\'</a> \';
  // Date if desired
  if ($showCreationDate){
    $output .= \'<span class="LIn_date">\'.date($dateFormat,$recentRecord[\'pubDate\']).\'</span> \';
  }
  // Description if desired
  if ((($mode == \'short\') && ($shortDesc)) || (($mode == \'full\') && ($fullDesc))){
   $output .= \'<span class="LIn_desc">\'.$recentRecord[\'description\'].\'</span>\';
  }
  // wrap it up
  $output .= \'</li>\' . $ie;
  $recentCounter ++;
}

$output .= \'</ul>\' . $ie;

$output .= ($pgPosition == \'bottom\' || $pgPosition == \'both\')? $pagination : \'\' ;

// ---------------------------------------------------
// Link to index
// ---------------------------------------------------

if ($linkToIndex) {

  $output .= \'<div class="LIn_index">\';
  $output .= \'<a href="[~\'.$linkToIndex.\'~]" title="\'.$indexText.\'">\'.$indexText.\'</a>\';
  $output .= \'</div>\';

}

// ---------------------------------------------------
// Send to browser
// ---------------------------------------------------

return $output;';
$s['ListIndexerProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['ListIndexer'] = '// added in 1.0.1: hidePrivate (hide items from unauthorized users)
//
// Derived from ListIndex 0.6j by jaredc@honeydewdesign.com
// Now supports Show In Menu
//
// This snippet was designed to be a VERY flexible way
// of showing what has been recently added. You can use
// this snippet to show news from one folder, or what has
// been recently added site wide. You can even show what\'s
// new in a \'section\' (everything under a defined folder)!

// Configuration Settings

   // Set the following snippet defaults the way you would normally
   // use this snippet, then use snippet variables in other situations
   // to override the default behaviors.

   // GENERAL OPTIONS

   // $rootFolder [ NULL | string (comma separated page id\'s) ]
   // Decide which folder to pull recent documents from.
   // If you want to specify a few folders, comma separate them.
   // The default NULL will set current page as root. Using 0
   // would search site wide. Can be set with snippet parameter
   // $LIn_root like:
   // [[ListIndexer?LIn_root=3,6,88]] 
   $rootFolder = NULL;

   // $descendentDepth [ int ]
   // How many levels below the root folder(s) do you want to
   // include? Can be overridden in snippet call with LIn_depth:
   // [[ListIndexer?LIn_depth=2]]
   // Uncomment one of these common two or create your own:
   // $descendentDepth = 1; // just children of root folder(s)
   $descendentDepth = 0; // all decendents of root folder(s)

   // $seeThruUnpub [ true | false ]
   // When using descendents, do you want to consider files below
   // an unpublished (hidden) folder? Usually no. But you decide.
   // Snippet parameter: LIn_seeThru
   // [[ListIndexer?LIn_seeThru=1]]
   $seeThruUnpub = false;

   // $seeShowInMenu [ true | false ]
   // When using descendents, do you want to consider files flagged
   // to be hidden from the menus? Usually no. But you decide.
   // Snippet parameter: LIn_seeShowInMenu
   // [[ListIndexer?LIn_seeShowInMenu=1]]
   $seeShowInMenu = false;
   
   // $hidePrivate [ true | false ]
   // Hide items from users that don\'t have appropriate
   // rights to view. Usually true. But you decide.
   // Snippet parameter: LIn_hidePrivate
   // [[ListIndexer?LIn_hidePrivate=0]]
   $hidePrivate = true;

   // $mode [ \'short\' | \'full\' ]
   // Defines whether this list should be a full, paged
   // list of all documents, or a short list of the most
   // recent few (how many will be defined next). Can be
   // overridden in snippet call with $LIn_mode:
   // [[ListIndexer?LIn_mode=full]]
   $mode = \'short\';
   
   // $sortBy [ \'alpha\' | \'date\' | \'menuindex\' ]
   // The default date will sort by most recent items first, but
   // by using the \'alpha\' option, and using full mode, you could
   // use this to create an index, or directory.
   // Settable with snippet call $LIn_sort:
   // [[ListIndexer?LIn_sort=alpha]]
   $sortBy = \'date\';
   
   // $sortDir [ \'ASC\' | \'DESC\' ]
   // Sort direction ascending or descending. Is applied to whatever $sortBy
   // field you have chosen above. If left blank, menuindex and alpha will sort
   // ASC and date DESC.
   // $LIn_dir in snippet call:
   // [[ListIndexer?LIn_dir=ASC&LIn_sortBy=menuindex]]
   $sortDir = \'\';

   // WHAT TO DISPLAY

   // $defaultTitle [ string ]
   // If you want a default title for your list
   // you can declare it here. Or use an empty
   // string to leave this off. This can be overridden
   // in the snippet call with the variable $LIn_title:
   // [[ListIndexer?LIn_title=Some new title]]
   $defaultTitle = \'\';

   // $shortDesc [ true | false ]
   // Show the description on the short list, or not. Snippet
   // parameter $LIn_sDesc:
   // [[ListIndexer?LIn_sDesc=0]]
   $shortDesc = true;

   // $fullDesc [ true | false ]
   // Show the description on the full list, or not. Snippet
   // parameter $LIn_fDesc:
   // [[ListIndexer?LIn_fDesc=0]]
   $fullDesc = true;

   // $linkToIndex [ int ]
   // If you have a page set up as an \'index\' for all the 
   // documents in this list, you can link to it by specifying 
   // its id- can also be set in snippet call with LIn_link:
   // [[ListIndexer?LIn_link=8]]
   // The default 0 will eliminate this link
   $linkToIndex = 0;

   // $indexText [ string ]
   // If you want a link to an index (probably a page running this
   // snippet in "full" mode), you can declare what you want that
   // link to say here. Or in the snippet call with LIn_indexText:
   // [[ListIndexer?LIn_indexText=Financial News Index]]
   $indexText = \'Index\';

   // $showCreationDate [ true | false ]
   // Decide to include date of creation in output or not. From
   // snippet call $LIn_showDate use 1 (true) or 0 (false)
   // [[ListIndexer?LIn_showDate=1]]
   $showCreationDate = true;

   // $dateFormat [ string ]
   // Used to define how date will be displayed (if using date)
   // Y = 4 digit year     y = 2 digit year
   // M = Jan - Dec        m = 01 - 12
   // D = Sun - Sat        d = 01 -31
   // Other standard PHP characters may be used
   $dateFormat = \'Y.m.d\';

   // $shortQty [ int ]
   // Number of entries to list in the short list. Can be
   // overridden in snippet call with $LIn_sQty:
   //[[ListIndexer?LIn_sQty=3]]
   $shortQty = 3;

   // PAGING

   // $fullQty [ int ]
   // Number of entries PER PAGE to list in the full list
   // Can be overridden in snippet call with $LIn_fQty:
   // [[ListIndexer?LIn_fQty=20]]
   // To show all set to 0 here or in snippet call
   $fullQty = 10;
   
   // $pageSeparator [ string ]
   // What you want your page number links to be separated by.
   // You NEED to include spaces if you want them. They are NOT
   // created automatically to facilitate styling ability.
   // For instance, " | " will render links like:
   // 1 | 2 | 3 | 4
   $pageSeparator = " | ";
   
   // $pgPosition [ \'top\' | \'bottom\' | \'both\']
   // Pick where you want your pagination links to appear.
   $pgPosition = \'both\';

   // PERFORMANCE

   // $useFastUrls [ true | false ]
   // IMPORTANT- using fast urls will reduce database queries
   // and improve performance WHEN IN FULL MODE ONLY and 
   // should NOT be used when multiple instances of this snippet
   // appear on the same page. With snippet call LIn_fast use 1
   // (true) or 0 (false)
   // [[ListIndexer?LIn_fast=0]]
   $useFastUrls = false;

   // $newLinesForLists [ true | false ]
   // Depending on how you want to style your list, you may
   // or may not want your <li>s on new lines. Generally, if you
   // are displaying then inline (horizontal, you do not want new
   // lines, but standard vertical block styling you do. This is
   // for IE, real browsers don\'t care.
   $newLinesForLists = true;

// Styles
//
// The following are the styles included in this snippet. It is up
// to you to include these styles in your stylesheet to get them to
// look the way you want.

   // div.LIn_title {}          List title div
   // ul.LIn_fullMode {}        UL class
   // ul.LIn_shortMode {}       UL class
   // span.LIn_date {}          Span surrounding pub/created date
   // span.LIn_desc {}          Span surrounding description
   // div.LIn_pagination        Div surrounding pagination links
   // span.LIn_currentPage {}   Span surrounding current page of
   //                           pagination (which wouldn\'t be css-able
   //                           by virtue of its <a> tag)


// **********************************************************************
// END CONFIG SETTINGS
// THE REST SHOULD TAKE CARE OF ITSELF
// **********************************************************************

// Take care of IE list issue
$ie = ($newLinesForLists)? "\\n" : \'\' ;

// Use snippet call defined variables if set
$activeTitle = (isset($LIn_title))? $LIn_title : $defaultTitle ;
$mode = (isset($LIn_mode))? $LIn_mode : $mode ;
$descendentDepth = (isset($LIn_depth))? $LIn_depth : $descendentDepth ;
$seeThruUnpub = (isset($LIn_seeThru))? $LIn_seeThru : $seeThruUnpub ;
$seeShowInMenu = (isset($LIn_seeShowInMenu))? $LIn_seeShowInMenu : $seeShowInMenu ;
$hidePrivate = (isset($LIn_hidePrivate))? $LIn_hidePrivate : $hidePrivate;
$linkToIndex = (isset($LIn_link))? $LIn_link : $linkToIndex ;
$rootFolder = (isset($LIn_root))? $LIn_root : $rootFolder ;
$shortQty = (isset($LIn_sQty))? $LIn_sQty : $shortQty ;
$fullQty = (isset($LIn_fQty))? $LIn_fQty : $fullQty ;
$showCreationDate = (isset($LIn_showDate))? $LIn_showDate : $showCreationDate ;
$indexText = (isset($LIn_indexText))? $LIn_indexText : $indexText ;
$useFastUrls = (isset($LIn_fast))? $LIn_fast : $useFastUrls ;
$sortBy = (isset($LIn_sort))? $LIn_sort : $sortBy;
$shortDesc = (isset($LIn_sDesc))? $LIn_sDesc : $shortDesc ;
$fullDesc = (isset($LIn_fDesc))? $LIn_fDesc : $fullDesc ;
$sortDir = (isset($LIn_dir))? $LIn_dir : $sortDir ;
if ($sortDir == \'\') $sortDir = ($sortBy == \'date\')? \'DESC\' : \'ASC\' ;


// Make useful variable shortcut for the content table
//$tbl = $modx->dbConfig[\'dbase\'] . "." . $modx->dbConfig[\'table_prefix\'] . "site_content";
$tblsc = $modx->getFullTableName("site_content");
$tbldg = $modx->getFullTableName("document_groups");

// Initialize output
$output = \'\';

// ---------------------------------------------------
// ---------------------------------------------------
// Query db for parent folders, or not. First check to
// see if a querystring cheat has been provided- this
// should speed things up considerably when using this
// in full mode. (a.k.a. fastUrls)
// ---------------------------------------------------
// ---------------------------------------------------
$inFolder= isset($_GET[\'LIn_f\'])? $_GET[\'LIn_f\']: 0;
if ((!$inFolder && $useFastUrls) || !$useFastUrls ){
  // Only run all the database queries if we don\'t already
  // know the folders AND fastUrls are desired.

  // ---------------------------------------------------
  // Seed list of viable parents
  // ---------------------------------------------------

  if ($rootFolder == NULL){
    $rootFolder = $modx->documentIdentifier;
  }
  // Set root level parent array
  $seedArray = explode(\',\',$rootFolder);
  $parentsArray = array();
  foreach($seedArray AS $seed){
    $parentsArray[\'level_0\'][] = $seed;
  }

  // ---------------------------------------------------
  // Make array of all allowed parents
  // ---------------------------------------------------

  // Process valid parents
  $levelCounter = 1;

  while (((count($parentsArray) < $descendentDepth) || ($descendentDepth == 0)) && ($levelCounter <= count($parentsArray)) && ($levelCounter < 10)){

    // Find all decendant parents for this level
    $pLevel = \'level_\'.($levelCounter - 1);
    $tempLevelArray = $parentsArray[$pLevel];

    foreach($tempLevelArray AS $p){

      // Get children who are parents (isfolder = 1)
      $validParentSql = "";
      $validParentSql .= "SELECT id FROM $tblsc sc WHERE ";
      $validParentSql .= "isfolder = 1 AND parent = $p ";
      $validParentSql .= "AND sc.deleted=0 ";
      $validParentSql .= ($seeThruUnpub)? ";" : "AND sc.published = 1;";

      // Run statement
      $rsTempParents = $modx->dbQuery($validParentSql);
      // Get number of results
      $countTempParents = $modx->recordCount($rsTempParents);

      // If there are results, put them in an array
      $tempValidArray = false;
      if ($countTempParents){
        for ($i=0;$i<$countTempParents;$i++){
          $tempId = $modx->fetchRow($rsTempParents);
          $tempValidArray[] = $tempId[\'id\'];
        } // end while
      } // end if

	  // populate next level of array 
	  if ($tempValidArray){
	    foreach($tempValidArray AS $kid){
	      $kidLevel = \'level_\'.$levelCounter;
	      $parentsArray[$kidLevel][] = $kid;
	    } // end foreach

	  } // end if
    } // end foreach

    // Do next level
    $levelCounter++;

  } // end while

  // Finalize list of parents
  $validParents = \'\';
  foreach ($parentsArray AS $level){
    foreach ($level AS $validP){
      $validParents .= $validP . \',\';
    }
  }

  // Remove trailing comma
  $validParents = substr($validParents,0,strlen($validParents)-1);

} else {
  $validParents = $_GET[\'LIn_f\'];
}

// ---------------------------------------------------
// Make appropriate SQL statement to pull recent items
// ---------------------------------------------------

// get document groups for current user
if($docgrp = $modx->getUserDocGroups()) $docgrp = implode(",",$docgrp);

$access = " (".($modx->isFrontend() ? "sc.privateweb=0":"1=\'".$_SESSION[\'mgrRole\']."\' OR sc.privatemgr=0").
          (!$docgrp ? "":" OR dg.document_group IN ($docgrp)").") AND ";

// Initialize
$recentSql = "";
$recentSql .= "SELECT sc.id, pagetitle, description";
// Include pub_date or createdon date if date is desired
$recentSql .= ($showCreationDate)? ", IF(pub_date > 0, pub_date, createdon) AS pubDate ": " " ;
$recentSql .= "FROM $tblsc sc LEFT JOIN $tbldg dg on dg.document = sc.id ";
$recentSql .= "WHERE ";
$recentSql .= ($hidePrivate)? $access:"";
// Look everywhere, or just under valid parents
$recentSql .= (($rootFolder == 0) && $seeThruUnpub && ($descendentDepth == 0))? "" : "parent IN ($validParents) AND " ;
// Published
$recentSql .= "sc.published = 1 ";
// Show In Menu
$recentSql .= ($seeShowInMenu)? " " : " AND sc.hidemenu=0 " ;
// Not deleted
$recentSql .= "AND sc.deleted=0 ";
// Choose sort method
switch ($sortBy){
  case \'alpha\':
    $recentSql .= "ORDER BY pagetitle ";
    break;
  case \'menuindex\':
    $recentSql .= "ORDER BY menuindex ";
    break;
  default:
    $recentSql .= "ORDER BY IF(pub_date>0, pub_date, createdon) ";
    break;
}
// Provide a sort direction
$recentSql .= $sortDir;

// If this is a short list, just pull a limited number
$recentSql .= ($mode == \'short\')? " LIMIT $shortQty;" : ";" ;

// Run statement
$rsRecent = $modx->dbQuery($recentSql);
// Count records
$recentLimit = $modx->recordCount($rsRecent);

// ---------------------------------------------------
// Generate pagination string if needed
// ---------------------------------------------------
$offsetParam = isset($_GET[\'LIn_o\'])? $_GET[\'LIn_o\']: 0;
$offset = ($offsetParam && ($mode == \'full\'))? $offsetParam : 0 ;
$pagination = \'\';

// Don\'t bother unless there are enough records to justify it
if ( ($mode == \'full\') && ($recentLimit > $fullQty) && ($fullQty) ){
  $fullUrl = $_SERVER[\'REQUEST_URI\'];
  $urlPieces = parse_url($fullUrl);
  $urlPath = $urlPieces[\'path\'];
  $otherQs = \'\';

  if ($urlPieces[\'query\']){
    foreach($_GET AS $qsKey=>$qsValue){
	  if (($qsKey != \'LIn_o\') && ($qsKey != \'LIn_f\')){
	    $otherQs .= \'&\'.$qsKey.\'=\'.$qsValue;
	  }
	}
  } 
  
  $fastUrl = $urlPath.\'?LIn_f=\'.$validParents.$otherQs;

  // Determine number of pages needed to show results
  $totalPages = ceil($recentLimit/$fullQty);
  
  // Make links
  for ($j = 0 ; $j < $totalPages; $j++){
    // only include links to OTHER pages, not current page
    if($offset == $j*$fullQty){
	  $pagination .= \'<span class="LIn_currentPage">\'.($j+1) .\'</span>\';
	} else {
      $pagination .= \'<a href="\'.$fastUrl.\'&LIn_o=\'.($j*$fullQty).\'" title="\'.($j+1).\'">\'.($j+1) .\'</a>\';
	}
	if ($j < $totalPages-1){
	  $pagination .= $pageSeparator;
	}
  }
  
  // Make final pagination link set in it\'s own div
  $pagination = \'<div class="LIn_pagination">\'."\\n".$pagination."\\n</div>\\n";
  
}


// ---------------------------------------------------
// Create title if wanted
// ---------------------------------------------------

if ($activeTitle){
  $output .= \'<div class="LIn_title">\'.$activeTitle.\'</div>\'."\\n";
}

// ---------------------------------------------------
// Create list of recent items
// ---------------------------------------------------

// Include pagination
$output .= ($pgPosition == \'top\' || $pgPosition == \'both\')? $pagination : \'\' ;

$output .= \'<ul class="LIn_\'.$mode.\'Mode">\' . $ie;

$recentCounter = $offset;
if ($mode == \'short\') {
  $recentCounterLimit = min($shortQty,$recentLimit);
} else {
  $recentCounterLimit = ($fullQty)? min(($fullQty+$offset),$recentLimit) : $recentLimit ;
}

while (($recentCounter < $recentCounterLimit) && $rsRecent && ($recentLimit > 0)){
  mysql_data_seek($rsRecent,$recentCounter);
  $recentRecord = $modx->fetchRow($rsRecent);
  $output .= \'<li>\';
  // Link to page
  $output .= \'<a href="[~\'.$recentRecord[\'id\'].\'~]" title="\'.strip_tags($recentRecord[\'pagetitle\']).\'">\'.$recentRecord[\'pagetitle\'].\'</a> \';
  // Date if desired
  if ($showCreationDate){
    $output .= \'<span class="LIn_date">\'.date($dateFormat,$recentRecord[\'pubDate\']).\'</span> \';
  }
  // Description if desired
  if ((($mode == \'short\') && ($shortDesc)) || (($mode == \'full\') && ($fullDesc))){
   $output .= \'<span class="LIn_desc">\'.$recentRecord[\'description\'].\'</span>\';
  }
  // wrap it up
  $output .= \'</li>\' . $ie;
  $recentCounter ++;
}

$output .= \'</ul>\' . $ie;

$output .= ($pgPosition == \'bottom\' || $pgPosition == \'both\')? $pagination : \'\' ;

// ---------------------------------------------------
// Link to index
// ---------------------------------------------------

if ($linkToIndex) {

  $output .= \'<div class="LIn_index">\';
  $output .= \'<a href="[~\'.$linkToIndex.\'~]" title="\'.$indexText.\'">\'.$indexText.\'</a>\';
  $output .= \'</div>\';

}

// ---------------------------------------------------
// Send to browser
// ---------------------------------------------------

return $output;';
$s['Personalize'] = '#::::::::::::::::::::::::::::::::::::::::
# Created By:Ryan Thrash (modx@vertexworks.com),
#	and then powered up by kudo (kudo@kudolink.com)
#
# Date: Aug 03, 2006
#
# Changelog:
# Dec 01, 05 -- initial release
# Jun 19, 06 -- updated description
# Jul 19, 06 -- hacked by kudo to output chunks
# Aug 03, 06 -- added placeholder for username
# Aug 27, 10 -- powered up all code
#
#::::::::::::::::::::::::::::::::::::::::
# Description:
#	Checks to see if webusers are logged in and displays yesChunk if the user
#	is logged or noChunk if user is not logged. Insert only the chunk name as
#	param, without {{}}. Can use a placeholder to output the username.
#	TESTED: can be used more than once per page.
#	TESTED: chunks can contain snippets.
#
#
# Params:
#	&yesChunk [string] (optional)
#		Output for LOGGED users
#
#	&noChunk [string] (optional)
#		Output for NOT logged users
#
#	&ph [string] (optional)
#		Placeholder for placing the username
#		ATTENTION!: place this ph only in yesChunk!
#
#	&context [string] (optional)
#		web|mgr
#
#	&yesTV [string] (optional)
#		Output for LOGGED users
#
#	&noTV [string] (optional)
#		Output for NOT logged users
#
# Example Usage:
#
#	[[Personalize? &yesChunk=`Link` &noChunk=`Register` &ph=`name`]]
#
#	Having Chunks named {{Link}} and another {{Register}}, the first will be
#	published to registered user, the second to non-registered users.
#
#::::::::::::::::::::::::::::::::::::::::

# prepare params and variables

if     ($this->isFrontend() && isset ($_SESSION[\'webValidated\'])) $current_context = \'web\';
elseif ($this->isBackend()  && isset ($_SESSION[\'mgrValidated\'])) $current_context = \'mgr\';

$output = \'\';
$yesChunk = (isset($yesChunk))? $yesChunk : \'\';
$noChunk  = (isset($noChunk)) ? $noChunk  : \'\';
$ph       = (isset($ph))      ? $ph       : \'username\';
$context  = (isset($context)) ? $context     : $current_context;
$yesTV    = (isset($yesTV))   ? $yesTV : \'\';
$noTV     = (isset($noTV))    ? $noTV  : \'\';

/*
$referer = htmlspecialchars($_SERVER[\'HTTP_REFERER\'], ENT_QUOTES);
$ua =      htmlspecialchars($_SERVER[\'HTTP_USER_AGENT\'], ENT_QUOTES);
$ip =      htmlspecialchars($_SERVER[\'REMOTE_ADDR\'], ENT_QUOTES);
$host =    htmlspecialchars($_SERVER[\'REMOTE_HOST\'], ENT_QUOTES);

$ua_strtolower = strtolower($_SERVER[\'HTTP_USER_AGENT\']);
if    (strpos($ua_strtolower, \'firefox\') !== false)     $browser = \'firefox\';
elseif(strpos($ua_strtolower, \'trident/4.0\') !== false) $browser = \'internet explorer 8\';
elseif(strpos($ua_strtolower, \'msie\') !== false)        $browser = \'internet explorer\';
elseif(strpos($ua_strtolower, \'chrome\') !== false)      $browser = \'chrome\';
elseif(strpos($ua_strtolower, \'safari\') !== false)      $browser = \'safari\';
elseif(strpos($ua_strtolower, \'opera\') !== false)       $browser = \'opera\';
else $browser = \'other\';

$modx->setPlaceholder(\'referer\', $referer);
$modx->setPlaceholder(\'ua\',      $ua);
$modx->setPlaceholder(\'browser\', $browser);
$modx->setPlaceholder(\'ip\',      $ip);
$modx->setPlaceholder(\'host\',    $host);
*/

switch($context)
{
    case \'web\':
        $short_name = $_SESSION[\'webShortname\'];
        $full_name  = $_SESSION[\'webFullname\'];
        $email      = $_SESSION[\'webEmail\'];
        $last_login = $_SESSION[\'webLastlogin\'];
        break;
    case \'mgr\':
    case \'manager\':
        $short_name = $_SESSION[\'mgrShortname\'];
        $full_name  = $_SESSION[\'mgrFullname\'];
        $email      = $_SESSION[\'mgrEmail\'];
        $last_login = $_SESSION[\'mgrLastlogin\'];
        break;
    default:
        $short_name = \'\';
}
if (!empty($context))
{
    if($yesTV !== \'\')
    {
        $pre_output = $modx->documentObject[$yesTV];
        if(is_array($pre_output))
        {
            $output = $pre_output[1];
        }
        else
        {
            $output = $pre_output;
        }
    }
    elseif($yesChunk !== \'\')
    {
        $output = $modx->getChunk($yesChunk);
    }
    else
    {
        $output = \'username : \' . $short_name;
    }

    if(empty($last_login)) $last_login_text = \'first login\';
    else                   $last_login_text = $modx->toDateFormat($last_login);

    $modx->setPlaceholder($ph,$short_name);
    $modx->setPlaceholder(\'short_name\',  $short_name);
    $modx->setPlaceholder(\'full_name\',   $full_name);
    $modx->setPlaceholder(\'email\',       $email);
    $modx->setPlaceholder(\'last_login\', $last_login_text);
}
else
{
    if($noTV !== \'\')
    {
        $pre_output = $modx->documentObject[$noTV];
        if(is_array($pre_output))
        {
            $output = $pre_output[1];
        }
        else
        {
            $output = $pre_output;
        }
    }
    elseif($noChunk!==\'\')
    {
        $output = $modx->getChunk($noChunk);
    }
    else
    {
        $output = \'guest\';
    }
}
return $output;';
$s['Personalize'] = '#::::::::::::::::::::::::::::::::::::::::
# Created By:Ryan Thrash (modx@vertexworks.com),
#	and then powered up by kudo (kudo@kudolink.com)
#
# Date: Aug 03, 2006
#
# Changelog:
# Dec 01, 05 -- initial release
# Jun 19, 06 -- updated description
# Jul 19, 06 -- hacked by kudo to output chunks
# Aug 03, 06 -- added placeholder for username
# Aug 27, 10 -- powered up all code
#
#::::::::::::::::::::::::::::::::::::::::
# Description:
#	Checks to see if webusers are logged in and displays yesChunk if the user
#	is logged or noChunk if user is not logged. Insert only the chunk name as
#	param, without {{}}. Can use a placeholder to output the username.
#	TESTED: can be used more than once per page.
#	TESTED: chunks can contain snippets.
#
#
# Params:
#	&yesChunk [string] (optional)
#		Output for LOGGED users
#
#	&noChunk [string] (optional)
#		Output for NOT logged users
#
#	&ph [string] (optional)
#		Placeholder for placing the username
#		ATTENTION!: place this ph only in yesChunk!
#
#	&context [string] (optional)
#		web|mgr
#
#	&yesTV [string] (optional)
#		Output for LOGGED users
#
#	&noTV [string] (optional)
#		Output for NOT logged users
#
# Example Usage:
#
#	[[Personalize? &yesChunk=`Link` &noChunk=`Register` &ph=`name`]]
#
#	Having Chunks named {{Link}} and another {{Register}}, the first will be
#	published to registered user, the second to non-registered users.
#
#::::::::::::::::::::::::::::::::::::::::

# prepare params and variables

if     ($this->isFrontend() && isset ($_SESSION[\'webValidated\'])) $current_context = \'web\';
elseif ($this->isBackend()  && isset ($_SESSION[\'mgrValidated\'])) $current_context = \'mgr\';

$output = \'\';
$yesChunk = (isset($yesChunk))? $yesChunk : \'\';
$noChunk  = (isset($noChunk)) ? $noChunk  : \'\';
$ph       = (isset($ph))      ? $ph       : \'username\';
$context  = (isset($context)) ? $context     : $current_context;
$yesTV    = (isset($yesTV))   ? $yesTV : \'\';
$noTV     = (isset($noTV))    ? $noTV  : \'\';

/*
$referer = htmlspecialchars($_SERVER[\'HTTP_REFERER\'], ENT_QUOTES);
$ua =      htmlspecialchars($_SERVER[\'HTTP_USER_AGENT\'], ENT_QUOTES);
$ip =      htmlspecialchars($_SERVER[\'REMOTE_ADDR\'], ENT_QUOTES);
$host =    htmlspecialchars($_SERVER[\'REMOTE_HOST\'], ENT_QUOTES);

$ua_strtolower = strtolower($_SERVER[\'HTTP_USER_AGENT\']);
if    (strpos($ua_strtolower, \'firefox\') !== false)     $browser = \'firefox\';
elseif(strpos($ua_strtolower, \'trident/4.0\') !== false) $browser = \'internet explorer 8\';
elseif(strpos($ua_strtolower, \'msie\') !== false)        $browser = \'internet explorer\';
elseif(strpos($ua_strtolower, \'chrome\') !== false)      $browser = \'chrome\';
elseif(strpos($ua_strtolower, \'safari\') !== false)      $browser = \'safari\';
elseif(strpos($ua_strtolower, \'opera\') !== false)       $browser = \'opera\';
else $browser = \'other\';

$modx->setPlaceholder(\'referer\', $referer);
$modx->setPlaceholder(\'ua\',      $ua);
$modx->setPlaceholder(\'browser\', $browser);
$modx->setPlaceholder(\'ip\',      $ip);
$modx->setPlaceholder(\'host\',    $host);
*/

switch($context)
{
    case \'web\':
        $short_name = $_SESSION[\'webShortname\'];
        $full_name  = $_SESSION[\'webFullname\'];
        $email      = $_SESSION[\'webEmail\'];
        $last_login = $_SESSION[\'webLastlogin\'];
        break;
    case \'mgr\':
    case \'manager\':
        $short_name = $_SESSION[\'mgrShortname\'];
        $full_name  = $_SESSION[\'mgrFullname\'];
        $email      = $_SESSION[\'mgrEmail\'];
        $last_login = $_SESSION[\'mgrLastlogin\'];
        break;
    default:
        $short_name = \'\';
}
if (!empty($context))
{
    if($yesTV !== \'\')
    {
        $pre_output = $modx->documentObject[$yesTV];
        if(is_array($pre_output))
        {
            $output = $pre_output[1];
        }
        else
        {
            $output = $pre_output;
        }
    }
    elseif($yesChunk !== \'\')
    {
        $output = $modx->getChunk($yesChunk);
    }
    else
    {
        $output = \'username : \' . $short_name;
    }

    if(empty($last_login)) $last_login_text = \'first login\';
    else                   $last_login_text = $modx->toDateFormat($last_login);

    $modx->setPlaceholder($ph,$short_name);
    $modx->setPlaceholder(\'short_name\',  $short_name);
    $modx->setPlaceholder(\'full_name\',   $full_name);
    $modx->setPlaceholder(\'email\',       $email);
    $modx->setPlaceholder(\'last_login\', $last_login_text);
}
else
{
    if($noTV !== \'\')
    {
        $pre_output = $modx->documentObject[$noTV];
        if(is_array($pre_output))
        {
            $output = $pre_output[1];
        }
        else
        {
            $output = $pre_output;
        }
    }
    elseif($noChunk!==\'\')
    {
        $output = $modx->getChunk($noChunk);
    }
    else
    {
        $output = \'guest\';
    }
}
return $output;';
$s['Personalize'] = '#::::::::::::::::::::::::::::::::::::::::
# Created By:Ryan Thrash (modx@vertexworks.com),
#	and then powered up by kudo (kudo@kudolink.com)
#
# Date: Aug 03, 2006
#
# Changelog:
# Dec 01, 05 -- initial release
# Jun 19, 06 -- updated description
# Jul 19, 06 -- hacked by kudo to output chunks
# Aug 03, 06 -- added placeholder for username
# Aug 27, 10 -- powered up all code
#
#::::::::::::::::::::::::::::::::::::::::
# Description:
#	Checks to see if webusers are logged in and displays yesChunk if the user
#	is logged or noChunk if user is not logged. Insert only the chunk name as
#	param, without {{}}. Can use a placeholder to output the username.
#	TESTED: can be used more than once per page.
#	TESTED: chunks can contain snippets.
#
#
# Params:
#	&yesChunk [string] (optional)
#		Output for LOGGED users
#
#	&noChunk [string] (optional)
#		Output for NOT logged users
#
#	&ph [string] (optional)
#		Placeholder for placing the username
#		ATTENTION!: place this ph only in yesChunk!
#
#	&context [string] (optional)
#		web|mgr
#
#	&yesTV [string] (optional)
#		Output for LOGGED users
#
#	&noTV [string] (optional)
#		Output for NOT logged users
#
# Example Usage:
#
#	[[Personalize? &yesChunk=`Link` &noChunk=`Register` &ph=`name`]]
#
#	Having Chunks named {{Link}} and another {{Register}}, the first will be
#	published to registered user, the second to non-registered users.
#
#::::::::::::::::::::::::::::::::::::::::

# prepare params and variables

if     ($this->isFrontend() && isset ($_SESSION[\'webValidated\'])) $current_context = \'web\';
elseif ($this->isBackend()  && isset ($_SESSION[\'mgrValidated\'])) $current_context = \'mgr\';

$output = \'\';
$yesChunk = (isset($yesChunk))? $yesChunk : \'\';
$noChunk  = (isset($noChunk)) ? $noChunk  : \'\';
$ph       = (isset($ph))      ? $ph       : \'username\';
$context  = (isset($context)) ? $context     : $current_context;
$yesTV    = (isset($yesTV))   ? $yesTV : \'\';
$noTV     = (isset($noTV))    ? $noTV  : \'\';

/*
$referer = htmlspecialchars($_SERVER[\'HTTP_REFERER\'], ENT_QUOTES);
$ua =      htmlspecialchars($_SERVER[\'HTTP_USER_AGENT\'], ENT_QUOTES);
$ip =      htmlspecialchars($_SERVER[\'REMOTE_ADDR\'], ENT_QUOTES);
$host =    htmlspecialchars($_SERVER[\'REMOTE_HOST\'], ENT_QUOTES);

$ua_strtolower = strtolower($_SERVER[\'HTTP_USER_AGENT\']);
if    (strpos($ua_strtolower, \'firefox\') !== false)     $browser = \'firefox\';
elseif(strpos($ua_strtolower, \'trident/4.0\') !== false) $browser = \'internet explorer 8\';
elseif(strpos($ua_strtolower, \'msie\') !== false)        $browser = \'internet explorer\';
elseif(strpos($ua_strtolower, \'chrome\') !== false)      $browser = \'chrome\';
elseif(strpos($ua_strtolower, \'safari\') !== false)      $browser = \'safari\';
elseif(strpos($ua_strtolower, \'opera\') !== false)       $browser = \'opera\';
else $browser = \'other\';

$modx->setPlaceholder(\'referer\', $referer);
$modx->setPlaceholder(\'ua\',      $ua);
$modx->setPlaceholder(\'browser\', $browser);
$modx->setPlaceholder(\'ip\',      $ip);
$modx->setPlaceholder(\'host\',    $host);
*/

switch($context)
{
    case \'web\':
        $short_name = $_SESSION[\'webShortname\'];
        $full_name  = $_SESSION[\'webFullname\'];
        $email      = $_SESSION[\'webEmail\'];
        $last_login = $_SESSION[\'webLastlogin\'];
        break;
    case \'mgr\':
    case \'manager\':
        $short_name = $_SESSION[\'mgrShortname\'];
        $full_name  = $_SESSION[\'mgrFullname\'];
        $email      = $_SESSION[\'mgrEmail\'];
        $last_login = $_SESSION[\'mgrLastlogin\'];
        break;
    default:
        $short_name = \'\';
}
if (!empty($context))
{
    if($yesTV !== \'\')
    {
        $pre_output = $modx->documentObject[$yesTV];
        if(is_array($pre_output))
        {
            $output = $pre_output[1];
        }
        else
        {
            $output = $pre_output;
        }
    }
    elseif($yesChunk !== \'\')
    {
        $output = $modx->getChunk($yesChunk);
    }
    else
    {
        $output = \'username : \' . $short_name;
    }

    if(empty($last_login)) $last_login_text = \'first login\';
    else                   $last_login_text = $modx->toDateFormat($last_login);

    $modx->setPlaceholder($ph,$short_name);
    $modx->setPlaceholder(\'short_name\',  $short_name);
    $modx->setPlaceholder(\'full_name\',   $full_name);
    $modx->setPlaceholder(\'email\',       $email);
    $modx->setPlaceholder(\'last_login\', $last_login_text);
}
else
{
    if($noTV !== \'\')
    {
        $pre_output = $modx->documentObject[$noTV];
        if(is_array($pre_output))
        {
            $output = $pre_output[1];
        }
        else
        {
            $output = $pre_output;
        }
    }
    elseif($noChunk!==\'\')
    {
        $output = $modx->getChunk($noChunk);
    }
    else
    {
        $output = \'guest\';
    }
}
return $output;';
$s['PersonalizeProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['Personalize'] = '#::::::::::::::::::::::::::::::::::::::::
# Created By:Ryan Thrash (modx@vertexworks.com),
#	and then powered up by kudo (kudo@kudolink.com)
#
# Date: Aug 03, 2006
#
# Changelog:
# Dec 01, 05 -- initial release
# Jun 19, 06 -- updated description
# Jul 19, 06 -- hacked by kudo to output chunks
# Aug 03, 06 -- added placeholder for username
# Aug 27, 10 -- powered up all code
#
#::::::::::::::::::::::::::::::::::::::::
# Description:
#	Checks to see if webusers are logged in and displays yesChunk if the user
#	is logged or noChunk if user is not logged. Insert only the chunk name as
#	param, without {{}}. Can use a placeholder to output the username.
#	TESTED: can be used more than once per page.
#	TESTED: chunks can contain snippets.
#
#
# Params:
#	&yesChunk [string] (optional)
#		Output for LOGGED users
#
#	&noChunk [string] (optional)
#		Output for NOT logged users
#
#	&ph [string] (optional)
#		Placeholder for placing the username
#		ATTENTION!: place this ph only in yesChunk!
#
#	&context [string] (optional)
#		web|mgr
#
#	&yesTV [string] (optional)
#		Output for LOGGED users
#
#	&noTV [string] (optional)
#		Output for NOT logged users
#
# Example Usage:
#
#	[[Personalize? &yesChunk=`Link` &noChunk=`Register` &ph=`name`]]
#
#	Having Chunks named {{Link}} and another {{Register}}, the first will be
#	published to registered user, the second to non-registered users.
#
#::::::::::::::::::::::::::::::::::::::::

# prepare params and variables

if     ($this->isFrontend() && isset ($_SESSION[\'webValidated\'])) $current_context = \'web\';
elseif ($this->isBackend()  && isset ($_SESSION[\'mgrValidated\'])) $current_context = \'mgr\';

$output = \'\';
$yesChunk = (isset($yesChunk))? $yesChunk : \'\';
$noChunk  = (isset($noChunk)) ? $noChunk  : \'\';
$ph       = (isset($ph))      ? $ph       : \'username\';
$context  = (isset($context)) ? $context     : $current_context;
$yesTV    = (isset($yesTV))   ? $yesTV : \'\';
$noTV     = (isset($noTV))    ? $noTV  : \'\';

/*
$referer = htmlspecialchars($_SERVER[\'HTTP_REFERER\'], ENT_QUOTES);
$ua =      htmlspecialchars($_SERVER[\'HTTP_USER_AGENT\'], ENT_QUOTES);
$ip =      htmlspecialchars($_SERVER[\'REMOTE_ADDR\'], ENT_QUOTES);
$host =    htmlspecialchars($_SERVER[\'REMOTE_HOST\'], ENT_QUOTES);

$ua_strtolower = strtolower($_SERVER[\'HTTP_USER_AGENT\']);
if    (strpos($ua_strtolower, \'firefox\') !== false)     $browser = \'firefox\';
elseif(strpos($ua_strtolower, \'trident/4.0\') !== false) $browser = \'internet explorer 8\';
elseif(strpos($ua_strtolower, \'msie\') !== false)        $browser = \'internet explorer\';
elseif(strpos($ua_strtolower, \'chrome\') !== false)      $browser = \'chrome\';
elseif(strpos($ua_strtolower, \'safari\') !== false)      $browser = \'safari\';
elseif(strpos($ua_strtolower, \'opera\') !== false)       $browser = \'opera\';
else $browser = \'other\';

$modx->setPlaceholder(\'referer\', $referer);
$modx->setPlaceholder(\'ua\',      $ua);
$modx->setPlaceholder(\'browser\', $browser);
$modx->setPlaceholder(\'ip\',      $ip);
$modx->setPlaceholder(\'host\',    $host);
*/

switch($context)
{
    case \'web\':
        $short_name = $_SESSION[\'webShortname\'];
        $full_name  = $_SESSION[\'webFullname\'];
        $email      = $_SESSION[\'webEmail\'];
        $last_login = $_SESSION[\'webLastlogin\'];
        break;
    case \'mgr\':
    case \'manager\':
        $short_name = $_SESSION[\'mgrShortname\'];
        $full_name  = $_SESSION[\'mgrFullname\'];
        $email      = $_SESSION[\'mgrEmail\'];
        $last_login = $_SESSION[\'mgrLastlogin\'];
        break;
    default:
        $short_name = \'\';
}
if (!empty($context))
{
    if($yesTV !== \'\')
    {
        $pre_output = $modx->documentObject[$yesTV];
        if(is_array($pre_output))
        {
            $output = $pre_output[1];
        }
        else
        {
            $output = $pre_output;
        }
    }
    elseif($yesChunk !== \'\')
    {
        $output = $modx->getChunk($yesChunk);
    }
    else
    {
        $output = \'username : \' . $short_name;
    }

    if(empty($last_login)) $last_login_text = \'first login\';
    else                   $last_login_text = $modx->toDateFormat($last_login);

    $modx->setPlaceholder($ph,$short_name);
    $modx->setPlaceholder(\'short_name\',  $short_name);
    $modx->setPlaceholder(\'full_name\',   $full_name);
    $modx->setPlaceholder(\'email\',       $email);
    $modx->setPlaceholder(\'last_login\', $last_login_text);
}
else
{
    if($noTV !== \'\')
    {
        $pre_output = $modx->documentObject[$noTV];
        if(is_array($pre_output))
        {
            $output = $pre_output[1];
        }
        else
        {
            $output = $pre_output;
        }
    }
    elseif($noChunk!==\'\')
    {
        $output = $modx->getChunk($noChunk);
    }
    else
    {
        $output = \'guest\';
    }
}
return $output;';
$s['TvTable'] = '$tvname = isset($tvname) ? $tvname : \'prices\';
$classname = isset($classname) ? $classname : \'pricelist\';

if (isset($id)) {
	$tvt = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvt[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvt = $modx->documentObject[$tvname];
	$tvv = $tvt[1];
}
if (!$tvv || $tvv==\'[["",""],["",""]]\') return;
$tvtArr=json_decode($tvv);

$output=\'<table class="\'.$classname.\'">\'."\\n";
$output .=\'<tr>\'."\\n";
for($i=0; $i<count($tvtArr[0]); $i++) $output .=\'<th\'.($i ? \'\' : \' class="first"\').\'>\'.$tvtArr[0][$i].\'</th>\'."\\n";
$output.=\'</tr>\'."\\n";
for($row=1; $row<count($tvtArr); $row++) {
	$output .=\'<tr\'.(($row%2) ? \'\' : \' class="altrow"\').\'>\'."\\n";
	for($i=0; $i<count($tvtArr[$row]); $i++) $output .=\'<td\'.($i ? \'\' : \' class="first"\').\'>\'.$tvtArr[$row][$i].\'</td>\'."\\n";
	$output.=\'</tr>\'."\\n";
}
$output.=\'</table>\';
return $output;
?>';
$s['TvTable'] = '$tvname = isset($tvname) ? $tvname : \'prices\';
$classname = isset($classname) ? $classname : \'pricelist\';

if (isset($id)) {
	$tvt = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvt[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvt = $modx->documentObject[$tvname];
	$tvv = $tvt[1];
}
if (!$tvv || $tvv==\'[["",""],["",""]]\') return;
$tvtArr=json_decode($tvv);

$output=\'<table class="\'.$classname.\'">\'."\\n";
$output .=\'<tr>\'."\\n";
for($i=0; $i<count($tvtArr[0]); $i++) $output .=\'<th\'.($i ? \'\' : \' class="first"\').\'>\'.$tvtArr[0][$i].\'</th>\'."\\n";
$output.=\'</tr>\'."\\n";
for($row=1; $row<count($tvtArr); $row++) {
	$output .=\'<tr\'.(($row%2) ? \'\' : \' class="altrow"\').\'>\'."\\n";
	for($i=0; $i<count($tvtArr[$row]); $i++) $output .=\'<td\'.($i ? \'\' : \' class="first"\').\'>\'.$tvtArr[$row][$i].\'</td>\'."\\n";
	$output.=\'</tr>\'."\\n";
}
$output.=\'</table>\';
return $output;
?>';
$s['TvTable'] = '$tvname = isset($tvname) ? $tvname : \'prices\';
$classname = isset($classname) ? $classname : \'pricelist\';

if (isset($id)) {
	$tvt = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvt[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvt = $modx->documentObject[$tvname];
	$tvv = $tvt[1];
}
if (!$tvv || $tvv==\'[["",""],["",""]]\') return;
$tvtArr=json_decode($tvv);

$output=\'<table class="\'.$classname.\'">\'."\\n";
$output .=\'<tr>\'."\\n";
for($i=0; $i<count($tvtArr[0]); $i++) $output .=\'<th\'.($i ? \'\' : \' class="first"\').\'>\'.$tvtArr[0][$i].\'</th>\'."\\n";
$output.=\'</tr>\'."\\n";
for($row=1; $row<count($tvtArr); $row++) {
	$output .=\'<tr\'.(($row%2) ? \'\' : \' class="altrow"\').\'>\'."\\n";
	for($i=0; $i<count($tvtArr[$row]); $i++) $output .=\'<td\'.($i ? \'\' : \' class="first"\').\'>\'.$tvtArr[$row][$i].\'</td>\'."\\n";
	$output.=\'</tr>\'."\\n";
}
$output.=\'</table>\';
return $output;
?>';
$s['TvTableProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['TvTable'] = '$tvname = isset($tvname) ? $tvname : \'prices\';
$classname = isset($classname) ? $classname : \'pricelist\';

if (isset($id)) {
	$tvt = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvt[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvt = $modx->documentObject[$tvname];
	$tvv = $tvt[1];
}
if (!$tvv || $tvv==\'[["",""],["",""]]\') return;
$tvtArr=json_decode($tvv);

$output=\'<table class="\'.$classname.\'">\'."\\n";
$output .=\'<tr>\'."\\n";
for($i=0; $i<count($tvtArr[0]); $i++) $output .=\'<th\'.($i ? \'\' : \' class="first"\').\'>\'.$tvtArr[0][$i].\'</th>\'."\\n";
$output.=\'</tr>\'."\\n";
for($row=1; $row<count($tvtArr); $row++) {
	$output .=\'<tr\'.(($row%2) ? \'\' : \' class="altrow"\').\'>\'."\\n";
	for($i=0; $i<count($tvtArr[$row]); $i++) $output .=\'<td\'.($i ? \'\' : \' class="first"\').\'>\'.$tvtArr[$row][$i].\'</td>\'."\\n";
	$output.=\'</tr>\'."\\n";
}
$output.=\'</table>\';
return $output;
?>';
$s['include'] = '$output = \'\';

#############################################
if(!empty($file)){

  if(file_exists(MODX_BASE_PATH.$file))
    $output = include MODX_BASE_PATH.$file;
  else
    $output = \'File not found: \'.$file;

#############################################
}else if(!empty($chunk)){
  
  if(!function_exists(\'fetchTpl\')){
    function fetchTpl($tpl){
    	global $modx;
      $template = "";
    	if(substr($tpl, 0, 6) == "@FILE:"){
    	  $tpl_file = MODX_BASE_PATH . substr($tpl, 6);
    		$template = file_get_contents($tpl_file);
    	}else if(substr($tpl, 0, 6) == "@CODE:"){
    		$template = substr($tpl, 6);
    	}else if($modx->getChunk($tpl) != ""){
    		$template = $modx->getChunk($tpl);
    	}else{
    		$template = false;
    	}
    	return $template;
    }
  }
  
  if(!isset($parse)) $parse = true;
  
  $output = fetchTpl($chunk);
  if($parse){
    $output = str_replace(array(\'[!\',\'!]\'),array(\'[[\',\']]\'),$output);
    $output = $modx->parseDocumentSource($output);
  }

#############################################
}else if(!empty($placeholder)){

  $output = isset($modx->placeholders[$placeholder]) ? $modx->placeholders[$placeholder] : \'\';
  
#############################################
}else if(!empty($session)){

  $output = isset($_SESSION[$session]) && (!is_array($_SESSION[$session])) ? (string) $_SESSION[$session] : \'\';
  
}

return $output;

';
$s['include'] = '$output = \'\';

#############################################
if(!empty($file)){

  if(file_exists(MODX_BASE_PATH.$file))
    $output = include MODX_BASE_PATH.$file;
  else
    $output = \'File not found: \'.$file;

#############################################
}else if(!empty($chunk)){
  
  if(!function_exists(\'fetchTpl\')){
    function fetchTpl($tpl){
    	global $modx;
      $template = "";
    	if(substr($tpl, 0, 6) == "@FILE:"){
    	  $tpl_file = MODX_BASE_PATH . substr($tpl, 6);
    		$template = file_get_contents($tpl_file);
    	}else if(substr($tpl, 0, 6) == "@CODE:"){
    		$template = substr($tpl, 6);
    	}else if($modx->getChunk($tpl) != ""){
    		$template = $modx->getChunk($tpl);
    	}else{
    		$template = false;
    	}
    	return $template;
    }
  }
  
  if(!isset($parse)) $parse = true;
  
  $output = fetchTpl($chunk);
  if($parse){
    $output = str_replace(array(\'[!\',\'!]\'),array(\'[[\',\']]\'),$output);
    $output = $modx->parseDocumentSource($output);
  }

#############################################
}else if(!empty($placeholder)){

  $output = isset($modx->placeholders[$placeholder]) ? $modx->placeholders[$placeholder] : \'\';
  
#############################################
}else if(!empty($session)){

  $output = isset($_SESSION[$session]) && (!is_array($_SESSION[$session])) ? (string) $_SESSION[$session] : \'\';
  
}

return $output;

';
$s['include'] = '$output = \'\';

#############################################
if(!empty($file)){

  if(file_exists(MODX_BASE_PATH.$file))
    $output = include MODX_BASE_PATH.$file;
  else
    $output = \'File not found: \'.$file;

#############################################
}else if(!empty($chunk)){
  
  if(!function_exists(\'fetchTpl\')){
    function fetchTpl($tpl){
    	global $modx;
      $template = "";
    	if(substr($tpl, 0, 6) == "@FILE:"){
    	  $tpl_file = MODX_BASE_PATH . substr($tpl, 6);
    		$template = file_get_contents($tpl_file);
    	}else if(substr($tpl, 0, 6) == "@CODE:"){
    		$template = substr($tpl, 6);
    	}else if($modx->getChunk($tpl) != ""){
    		$template = $modx->getChunk($tpl);
    	}else{
    		$template = false;
    	}
    	return $template;
    }
  }
  
  if(!isset($parse)) $parse = true;
  
  $output = fetchTpl($chunk);
  if($parse){
    $output = str_replace(array(\'[!\',\'!]\'),array(\'[[\',\']]\'),$output);
    $output = $modx->parseDocumentSource($output);
  }

#############################################
}else if(!empty($placeholder)){

  $output = isset($modx->placeholders[$placeholder]) ? $modx->placeholders[$placeholder] : \'\';
  
#############################################
}else if(!empty($session)){

  $output = isset($_SESSION[$session]) && (!is_array($_SESSION[$session])) ? (string) $_SESSION[$session] : \'\';
  
}

return $output;

';
$s['includeProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['include'] = '$output = \'\';

#############################################
if(!empty($file)){

  if(file_exists(MODX_BASE_PATH.$file))
    $output = include MODX_BASE_PATH.$file;
  else
    $output = \'File not found: \'.$file;

#############################################
}else if(!empty($chunk)){
  
  if(!function_exists(\'fetchTpl\')){
    function fetchTpl($tpl){
    	global $modx;
      $template = "";
    	if(substr($tpl, 0, 6) == "@FILE:"){
    	  $tpl_file = MODX_BASE_PATH . substr($tpl, 6);
    		$template = file_get_contents($tpl_file);
    	}else if(substr($tpl, 0, 6) == "@CODE:"){
    		$template = substr($tpl, 6);
    	}else if($modx->getChunk($tpl) != ""){
    		$template = $modx->getChunk($tpl);
    	}else{
    		$template = false;
    	}
    	return $template;
    }
  }
  
  if(!isset($parse)) $parse = true;
  
  $output = fetchTpl($chunk);
  if($parse){
    $output = str_replace(array(\'[!\',\'!]\'),array(\'[[\',\']]\'),$output);
    $output = $modx->parseDocumentSource($output);
  }

#############################################
}else if(!empty($placeholder)){

  $output = isset($modx->placeholders[$placeholder]) ? $modx->placeholders[$placeholder] : \'\';
  
#############################################
}else if(!empty($session)){

  $output = isset($_SESSION[$session]) && (!is_array($_SESSION[$session])) ? (string) $_SESSION[$session] : \'\';
  
}

return $output;

';
$s['WebLogin'] = '# Created By Raymond Irving 2004
# 
# changed by Andchir 2010
# 
#::::::::::::::::::::::::::::::::::::::::
# Params:	
#
#	&loginhomeid 	- (Optional)
#		redirects the user to first authorized page in the list.
#		If no id was specified then the login home page id or 
#		the current document id will be used
#
#	&logouthomeid 	- (Optional)
#		document id to load when user logs out	
#
#	&pwdreqid 	- (Optional)
#		document id to load after the user has submited
#		a request for a new password
#
#	&pwdactid 	- (Optional)
#		document id to load when the after the user has activated
#		their new password
#
#	&logintext		- (Optional) 
#		Text to be displayed inside login button (for built-in form)
#
#	&logouttext 	- (Optional)
#		Text to be displayed inside logout link (for built-in form)
#	
#	&tpl			- (Optional)
#		Chunk name or document id to as a template
# 
# &alerttpl - template for alert messages
#				  
#	Note: Templats design:
#			section 1: login template
#			section 2: logout template 
#			section 3: password reminder template 
#
#			See weblogin.tpl for more information
#
# Examples:
#
#	[[WebLogin? &loginhomeid=`8` &logouthomeid=`1`]] 
#
#	[[WebLogin? &loginhomeid=`8,18,7,5` &tpl=`Login`]] 

# Set Snippet Paths 
$snipPath = $modx->config[\'base_path\'] . "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}

# deprecated params - only for backward compatibility
if(isset($loginid)) $loginhomeid=$loginid;
if(isset($logoutid)) $logouthomeid = $logoutid;
if(isset($template)) $tpl = $template;

if(!isset($alerttpl)) $alerttpl = \'\';


# Snippet customize settings
$liHomeId	= isset($loginhomeid)? explode(",",$loginhomeid):array($modx->config[\'login_home\'],$modx->documentIdentifier);
$loHomeId	= isset($logouthomeid)? $logouthomeid:$modx->documentIdentifier;
$pwdReqId	= isset($pwdreqid)? $pwdreqid:0;
$pwdActId	= isset($pwdactid)? $pwdactid:0;
$loginText	= isset($logintext)? $logintext:\'Login\';
$logoutText	= isset($logouttext)? $logouttext:\'Logout\';
$tpl		= isset($tpl)? $tpl:"";

# System settings
$webLoginMode = isset($_REQUEST[\'webloginmode\'])? $_REQUEST[\'webloginmode\']: \'\';
$isLogOut		= $webLoginMode==\'lo\' ? 1:0;
$isPWDActivate	= $webLoginMode==\'actp\' ? 1:0;
$isPostBack		= count($_POST) && (isset($_POST[\'cmdweblogin\']) || isset($_POST[\'cmdweblogin_x\']));
$txtPwdRem 		= isset($_REQUEST[\'txtpwdrem\'])? $_REQUEST[\'txtpwdrem\']: 0;
$isPWDReminder	= $isPostBack && $txtPwdRem==\'1\' ? 1:0;

$site_id = isset($site_id)? $site_id: \'\';
$cookieKey = substr(md5($site_id."Web-User"),0,15);

# Start processing
require $snipPath."weblogin/lang/russian-UTF-8.php";
require_once $snipPath."weblogin/weblogin.common.inc.php";
require_once $modx->config[\'base_path\'] . "manager/includes/crypt.class.inc.php";

if ($isPWDActivate || $isPWDReminder || $isLogOut || $isPostBack) {
	# include the logger class
	include_once $modx->config[\'base_path\'] . "manager/includes/log.class.inc.php";
	include_once $snipPath."weblogin/weblogin.processor.inc.php";
}

include_once $snipPath."weblogin/weblogin.inc.php";

# Return
return $output;
';
$s['WebLoginProps'] = '&loginhomeid=Login Home Id;string; &logouthomeid=Logout Home Id;string; &logintext=Login Button Text;string; &logouttext=Logout Button Text;string; &tpl=Template;string; ';
$s['WebLogin'] = '# Created By Raymond Irving 2004
# 
# changed by Andchir 2010
# 
#::::::::::::::::::::::::::::::::::::::::
# Params:	
#
#	&loginhomeid 	- (Optional)
#		redirects the user to first authorized page in the list.
#		If no id was specified then the login home page id or 
#		the current document id will be used
#
#	&logouthomeid 	- (Optional)
#		document id to load when user logs out	
#
#	&pwdreqid 	- (Optional)
#		document id to load after the user has submited
#		a request for a new password
#
#	&pwdactid 	- (Optional)
#		document id to load when the after the user has activated
#		their new password
#
#	&logintext		- (Optional) 
#		Text to be displayed inside login button (for built-in form)
#
#	&logouttext 	- (Optional)
#		Text to be displayed inside logout link (for built-in form)
#	
#	&tpl			- (Optional)
#		Chunk name or document id to as a template
# 
# &alerttpl - template for alert messages
#				  
#	Note: Templats design:
#			section 1: login template
#			section 2: logout template 
#			section 3: password reminder template 
#
#			See weblogin.tpl for more information
#
# Examples:
#
#	[[WebLogin? &loginhomeid=`8` &logouthomeid=`1`]] 
#
#	[[WebLogin? &loginhomeid=`8,18,7,5` &tpl=`Login`]] 

# Set Snippet Paths 
$snipPath = $modx->config[\'base_path\'] . "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}

# deprecated params - only for backward compatibility
if(isset($loginid)) $loginhomeid=$loginid;
if(isset($logoutid)) $logouthomeid = $logoutid;
if(isset($template)) $tpl = $template;

if(!isset($alerttpl)) $alerttpl = \'\';


# Snippet customize settings
$liHomeId	= isset($loginhomeid)? explode(",",$loginhomeid):array($modx->config[\'login_home\'],$modx->documentIdentifier);
$loHomeId	= isset($logouthomeid)? $logouthomeid:$modx->documentIdentifier;
$pwdReqId	= isset($pwdreqid)? $pwdreqid:0;
$pwdActId	= isset($pwdactid)? $pwdactid:0;
$loginText	= isset($logintext)? $logintext:\'Login\';
$logoutText	= isset($logouttext)? $logouttext:\'Logout\';
$tpl		= isset($tpl)? $tpl:"";

# System settings
$webLoginMode = isset($_REQUEST[\'webloginmode\'])? $_REQUEST[\'webloginmode\']: \'\';
$isLogOut		= $webLoginMode==\'lo\' ? 1:0;
$isPWDActivate	= $webLoginMode==\'actp\' ? 1:0;
$isPostBack		= count($_POST) && (isset($_POST[\'cmdweblogin\']) || isset($_POST[\'cmdweblogin_x\']));
$txtPwdRem 		= isset($_REQUEST[\'txtpwdrem\'])? $_REQUEST[\'txtpwdrem\']: 0;
$isPWDReminder	= $isPostBack && $txtPwdRem==\'1\' ? 1:0;

$site_id = isset($site_id)? $site_id: \'\';
$cookieKey = substr(md5($site_id."Web-User"),0,15);

# Start processing
require $snipPath."weblogin/lang/russian-UTF-8.php";
require_once $snipPath."weblogin/weblogin.common.inc.php";
require_once $modx->config[\'base_path\'] . "manager/includes/crypt.class.inc.php";

if ($isPWDActivate || $isPWDReminder || $isLogOut || $isPostBack) {
	# include the logger class
	include_once $modx->config[\'base_path\'] . "manager/includes/log.class.inc.php";
	include_once $snipPath."weblogin/weblogin.processor.inc.php";
}

include_once $snipPath."weblogin/weblogin.inc.php";

# Return
return $output;
';
$s['WebLoginProps'] = '&loginhomeid=Login Home Id;string; &logouthomeid=Logout Home Id;string; &logintext=Login Button Text;string; &logouttext=Logout Button Text;string; &tpl=Template;string; ';
$s['WebLogin'] = '# Created By Raymond Irving 2004
# 
# changed by Andchir 2010
# 
#::::::::::::::::::::::::::::::::::::::::
# Params:	
#
#	&loginhomeid 	- (Optional)
#		redirects the user to first authorized page in the list.
#		If no id was specified then the login home page id or 
#		the current document id will be used
#
#	&logouthomeid 	- (Optional)
#		document id to load when user logs out	
#
#	&pwdreqid 	- (Optional)
#		document id to load after the user has submited
#		a request for a new password
#
#	&pwdactid 	- (Optional)
#		document id to load when the after the user has activated
#		their new password
#
#	&logintext		- (Optional) 
#		Text to be displayed inside login button (for built-in form)
#
#	&logouttext 	- (Optional)
#		Text to be displayed inside logout link (for built-in form)
#	
#	&tpl			- (Optional)
#		Chunk name or document id to as a template
# 
# &alerttpl - template for alert messages
#				  
#	Note: Templats design:
#			section 1: login template
#			section 2: logout template 
#			section 3: password reminder template 
#
#			See weblogin.tpl for more information
#
# Examples:
#
#	[[WebLogin? &loginhomeid=`8` &logouthomeid=`1`]] 
#
#	[[WebLogin? &loginhomeid=`8,18,7,5` &tpl=`Login`]] 

# Set Snippet Paths 
$snipPath = $modx->config[\'base_path\'] . "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}

# deprecated params - only for backward compatibility
if(isset($loginid)) $loginhomeid=$loginid;
if(isset($logoutid)) $logouthomeid = $logoutid;
if(isset($template)) $tpl = $template;

if(!isset($alerttpl)) $alerttpl = \'\';


# Snippet customize settings
$liHomeId	= isset($loginhomeid)? explode(",",$loginhomeid):array($modx->config[\'login_home\'],$modx->documentIdentifier);
$loHomeId	= isset($logouthomeid)? $logouthomeid:$modx->documentIdentifier;
$pwdReqId	= isset($pwdreqid)? $pwdreqid:0;
$pwdActId	= isset($pwdactid)? $pwdactid:0;
$loginText	= isset($logintext)? $logintext:\'Login\';
$logoutText	= isset($logouttext)? $logouttext:\'Logout\';
$tpl		= isset($tpl)? $tpl:"";

# System settings
$webLoginMode = isset($_REQUEST[\'webloginmode\'])? $_REQUEST[\'webloginmode\']: \'\';
$isLogOut		= $webLoginMode==\'lo\' ? 1:0;
$isPWDActivate	= $webLoginMode==\'actp\' ? 1:0;
$isPostBack		= count($_POST) && (isset($_POST[\'cmdweblogin\']) || isset($_POST[\'cmdweblogin_x\']));
$txtPwdRem 		= isset($_REQUEST[\'txtpwdrem\'])? $_REQUEST[\'txtpwdrem\']: 0;
$isPWDReminder	= $isPostBack && $txtPwdRem==\'1\' ? 1:0;

$site_id = isset($site_id)? $site_id: \'\';
$cookieKey = substr(md5($site_id."Web-User"),0,15);

# Start processing
require $snipPath."weblogin/lang/russian-UTF-8.php";
require_once $snipPath."weblogin/weblogin.common.inc.php";
require_once $modx->config[\'base_path\'] . "manager/includes/crypt.class.inc.php";

if ($isPWDActivate || $isPWDReminder || $isLogOut || $isPostBack) {
	# include the logger class
	include_once $modx->config[\'base_path\'] . "manager/includes/log.class.inc.php";
	include_once $snipPath."weblogin/weblogin.processor.inc.php";
}

include_once $snipPath."weblogin/weblogin.inc.php";

# Return
return $output;
';
$s['WebLoginProps'] = '&loginhomeid=Login Home Id;string; &logouthomeid=Logout Home Id;string; &logintext=Login Button Text;string; &logouttext=Logout Button Text;string; &tpl=Template;string; &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['WebLogin'] = '# Created By Raymond Irving 2004
# 
# changed by Andchir 2010
# 
#::::::::::::::::::::::::::::::::::::::::
# Params:	
#
#	&loginhomeid 	- (Optional)
#		redirects the user to first authorized page in the list.
#		If no id was specified then the login home page id or 
#		the current document id will be used
#
#	&logouthomeid 	- (Optional)
#		document id to load when user logs out	
#
#	&pwdreqid 	- (Optional)
#		document id to load after the user has submited
#		a request for a new password
#
#	&pwdactid 	- (Optional)
#		document id to load when the after the user has activated
#		their new password
#
#	&logintext		- (Optional) 
#		Text to be displayed inside login button (for built-in form)
#
#	&logouttext 	- (Optional)
#		Text to be displayed inside logout link (for built-in form)
#	
#	&tpl			- (Optional)
#		Chunk name or document id to as a template
# 
# &alerttpl - template for alert messages
#				  
#	Note: Templats design:
#			section 1: login template
#			section 2: logout template 
#			section 3: password reminder template 
#
#			See weblogin.tpl for more information
#
# Examples:
#
#	[[WebLogin? &loginhomeid=`8` &logouthomeid=`1`]] 
#
#	[[WebLogin? &loginhomeid=`8,18,7,5` &tpl=`Login`]] 

# Set Snippet Paths 
$snipPath = $modx->config[\'base_path\'] . "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}

# deprecated params - only for backward compatibility
if(isset($loginid)) $loginhomeid=$loginid;
if(isset($logoutid)) $logouthomeid = $logoutid;
if(isset($template)) $tpl = $template;

if(!isset($alerttpl)) $alerttpl = \'\';


# Snippet customize settings
$liHomeId	= isset($loginhomeid)? explode(",",$loginhomeid):array($modx->config[\'login_home\'],$modx->documentIdentifier);
$loHomeId	= isset($logouthomeid)? $logouthomeid:$modx->documentIdentifier;
$pwdReqId	= isset($pwdreqid)? $pwdreqid:0;
$pwdActId	= isset($pwdactid)? $pwdactid:0;
$loginText	= isset($logintext)? $logintext:\'Login\';
$logoutText	= isset($logouttext)? $logouttext:\'Logout\';
$tpl		= isset($tpl)? $tpl:"";

# System settings
$webLoginMode = isset($_REQUEST[\'webloginmode\'])? $_REQUEST[\'webloginmode\']: \'\';
$isLogOut		= $webLoginMode==\'lo\' ? 1:0;
$isPWDActivate	= $webLoginMode==\'actp\' ? 1:0;
$isPostBack		= count($_POST) && (isset($_POST[\'cmdweblogin\']) || isset($_POST[\'cmdweblogin_x\']));
$txtPwdRem 		= isset($_REQUEST[\'txtpwdrem\'])? $_REQUEST[\'txtpwdrem\']: 0;
$isPWDReminder	= $isPostBack && $txtPwdRem==\'1\' ? 1:0;

$site_id = isset($site_id)? $site_id: \'\';
$cookieKey = substr(md5($site_id."Web-User"),0,15);

# Start processing
require $snipPath."weblogin/lang/russian-UTF-8.php";
require_once $snipPath."weblogin/weblogin.common.inc.php";
require_once $modx->config[\'base_path\'] . "manager/includes/crypt.class.inc.php";

if ($isPWDActivate || $isPWDReminder || $isLogOut || $isPostBack) {
	# include the logger class
	include_once $modx->config[\'base_path\'] . "manager/includes/log.class.inc.php";
	include_once $snipPath."weblogin/weblogin.processor.inc.php";
}

include_once $snipPath."weblogin/weblogin.inc.php";

# Return
return $output;
';
$s['WebLoginProps'] = '&loginhomeid=Login Home Id;string; &logouthomeid=Logout Home Id;string; &logintext=Login Button Text;string; &logouttext=Logout Button Text;string; &tpl=Template;string; ';
$s['Reflect'] = '/*
 * Author: 
 *      Mark Kaplan for MODx CMF
 * 
 * Note: 
 *      If Reflect is not retrieving its own documents, make sure that the
 *          Ditto call feeding it has all of the fields in it that you plan on
 *       calling in your Reflect template. Furthermore, Reflect will ONLY
 *          show what is currently in the Ditto result set.
 *       Thus, if pagination is on it will ONLY show that page\'s items.
*/
 

// ---------------------------------------------------
//  Includes
// ---------------------------------------------------

$reflect_base = isset($reflect_base) ? $modx->config[\'base_path\'].$reflect_base : $modx->config[\'base_path\']."assets/snippets/reflect/";
/*
    Param: ditto_base
    
    Purpose:
    Location of Ditto files

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    [(base_path)]assets/snippets/ditto/
*/

$config = (isset($config)) ? $config : "default";
/*
    Param: config

    Purpose:
    Load a custom configuration

    Options:
    "default" - default blank config file
    CONFIG_NAME - Other configs installed in the configs folder or in any folder within the MODx base path via @FILE

    Default:
    "default"
    
    Related:
    - <extenders>
*/

require($reflect_base."configs/default.config.php");
require($reflect_base."default.templates.php");
if ($config != "default") {
    require((substr($config, 0, 5) != "@FILE") ? $reflect_base."configs/$config.config.php" : $modx->config[\'base_path\'].trim(substr($config, 5)));
}

// ---------------------------------------------------
//  Parameters
// ---------------------------------------------------

$id = isset($id) ? $id."_" : false;
/*
    Param: id

    Purpose:
    Unique ID for this Ditto instance for connection with other scripts (like Reflect) and unique URL parameters

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    "" - blank
*/
$getDocuments = isset($getDocuments) ? $getDocuments : 0;
/*
    Param: getDocuments

    Purpose:
    Force Reflect to get documents

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
*/
$showItems = isset($showItems) ? $showItems : 1;
/*
    Param: showItems

    Purpose:
    Show individual items in the archive

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/
$groupByYears = isset($groupByYears)? $groupByYears : 1;
/*
    Param: groupByYears

    Purpose:
    Group the archive by years

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/
$targetID = isset($targetID) ? $targetID : $modx->documentObject[\'id\'];
/*
    Param: targetID

    Purpose:
    ID for archive links to point to

    Options:
    Any MODx document with a Ditto call setup with extenders=`dateFilter`
    
    Default:
    Current MODx Document
*/
$dateSource = isset($dateSource) ? $dateSource : "createdon";
/*
    Param: dateSource

    Purpose:
    Date source to display for archive items

    Options:
    # - Any UNIX timestamp from MODx fields or TVs such as createdon, pub_date, or editedon
    
    Default:
    "createdon"
    
    Related:
    - <dateFormat>
*/
$dateFormat = isset($dateFormat) ? $dateFormat : "%d-%b-%y %H:%M";  
/*
    Param: dateFormat

    Purpose:
    Format the [+date+] placeholder in human readable form

    Options:
    Any PHP valid strftime option

    Default:
    "%d-%b-%y %H:%M"
    
    Related:
    - <dateSource>
*/
$yearSortDir = isset($yearSortDir) ? $yearSortDir : "DESC";
/*
    Param: yearSortDir

    Purpose:
    Direction to sort documents

    Options:
    ASC - ascending
    DESC - descending

    Default:
    "DESC"
    
    Related:
    - <monthSortDir>
*/
$monthSortDir = isset($monthSortDir) ? $monthSortDir : "ASC";
/*
    Param: monthSortDir

    Purpose:
    Direction to sort the months

    Options:
    ASC - ascending
    DESC - descending

    Default:
    "ASC"
    
    Related:
    - <yearSortDir>
*/
$start = isset($start)? intval($start) : 0;
/*
    Param: start

    Purpose:
    Number of documents to skip in the results
    
    Options:
    Any number

    Default:
    0
*/  
$phx = (isset($phx))? $phx : 1;
/*
    Param: phx

    Purpose:
    Use PHx formatting

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/

// ---------------------------------------------------
//  Initialize Ditto
// ---------------------------------------------------
$placeholder = ($id != false && $getDocuments == 0) ? true : false;
if ($placeholder === false) {
    $rID = "reflect_".rand(1,1000);
    $itemTemplate = isset($tplItem) ? $tplItem: "@CODE:".$defaultTemplates[\'item\'];
    $dParams = array(
        "id" => "$rID",
        "save" => "3",  
        "summarize" => "all",
        "tpl" => $itemTemplate,
    );
    
    $source = $dittoSnippetName;
    $params = $dittoSnippetParameters;
        // TODO: Remove after 3.0
        
    if (isset($params)) {
        $givenParams = explode("|",$params);
        foreach ($givenParams as $parameter) {
            $p = explode(":",$parameter);
            $dParams[$p[0]] = $p[1];
        }
    }
    /*
        Param: params

        Purpose:
        Pass parameters to the Ditto instance used to retreive the documents

        Options:
        Any valid ditto parameters in the format name:value 
        with multiple parameters separated by a pipe (|)
        
        Note:
        This parameter is only needed for config, start, and phx as you can
        now simply use the parameter as if Reflect was Ditto

        Default:
        [NULL]
    */
    
    $reflectParameters = array(\'reflect_base\',\'config\',\'id\',\'getDocuments\',\'showItems\',\'groupByYears\',\'targetID\',\'yearSortDir\',\'monthSortDir\',\'start\',\'phx\',\'tplContainer\',\'tplYear\',\'tplMonth\',\'tplMonthInner\',\'tplItem\',\'save\');
    $params =& $modx->event->params;
    if(is_array($params)) {
        foreach ($params as $param=>$value) {
            if (!in_array($param,$reflectParameters) && substr($param,-3) != \'tpl\') {
                $dParams[$param] = $value;
            }
        }
    }

    $source = isset($source) ? $source : "Ditto";
    /*
        Param: source

        Purpose:
        Name of the Ditto snippet to use

        Options:
        Any valid snippet name

        Default:
        "Ditto"
    */
    $snippetOutput = $modx->runSnippet($source,$dParams);
    $ditto = $modx->getPlaceholder($rID."_ditto_object");
    $resource = $modx->getPlaceholder($rID."_ditto_resource");
} else {
    $ditto = $modx->getPlaceholder($id."ditto_object");
    $resource = $modx->getPlaceholder($id."ditto_resource");
}
if (!is_object($ditto) || !isset($ditto) || !isset($resource)) {
    return !empty($snippetOutput) ? $snippetOutput : "The Ditto object is invalid. Please check it.";
}

// ---------------------------------------------------
//  Templates
// ---------------------------------------------------

$templates[\'tpl\'] = isset($tplContainer) ? $ditto->template->fetch($tplContainer): $defaultTemplates[\'tpl\'];
/*
    Param: tplContainer

    Purpose:
    Container template for the archive

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'year\'] = isset($tplYear) ? $ditto->template->fetch($tplYear): $defaultTemplates[\'year\'];
/*
    Param: tplYear

    Purpose:
    Template for the year item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'year_inner\'] = isset($tplYearInner) ? $ditto->template->fetch($tplYearInner): $defaultTemplates[\'year_inner\'];
/*
    Param: tplYearInner

    Purpose:
    Template for the year item (the ul to hold the year template)

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'month\'] = isset($tplMonth) ? $ditto->template->fetch($tplMonth): $defaultTemplates[\'month\'];
/*
    Param: tplMonth

    Purpose:
    Template for the month item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'month_inner\'] = isset($tplMonthInner) ? $ditto->template->fetch($tplMonthInner): $defaultTemplates[\'month_inner\'];
/*
    Param: tplMonthInner

    Purpose:
    Template for the month item  (the ul to hold the month template)

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'item\'] = isset($tplItem) ? $ditto->template->fetch($tplItem): $defaultTemplates[\'item\'];
/*
    Param: tplItem

    Purpose:
    Template for the individual item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/

$ditto->addField("date","display","custom");
    // force add the date field if receiving data from a Ditto instance

// ---------------------------------------------------
//  Reflect
// ---------------------------------------------------

if (function_exists("reflect") === FALSE) {
function reflect($templatesDocumentID, $showItems, $groupByYears, $resource, $templatesDateSource, $dateFormat, $ditto, $templates,$id,$start,$yearSortDir,$monthSortDir) {
    global $modx;
    $cal = array();
    $output = \'\';
    $ph = array(\'year\'=>\'\',\'month\'=>\'\',\'item\'=>\'\',\'out\'=>\'\');
    $build = array();
    $stop = count($resource);

    // loop and fetch all the results
    for ($i = $start; $i < $stop; $i++) {
        $date = getdate($resource[$i][$templatesDateSource]);
        $year = $date["year"];
        $month = $date["mon"];
        $cal[$year][$month][] = $resource[$i];
    }
    if ($yearSortDir == "DESC") {
        krsort($cal);
    } else {
        ksort($cal);
    }
    foreach ($cal as $year=>$months) {
        if ($monthSortDir == "ASC") {
            ksort($months);
        } else {
            krsort($months);
        }
        $build[$year] = $months;
    }
    
    foreach ($build as $year=>$months) {
        $r_year = \'\';
        $r_month = \'\';
        $r_month_2 = \'\';
        $year_count = 0;
        $items = array();
        
        foreach ($months as $mon=>$month) {
            $month_text = strftime("%B", mktime(10, 10, 10, $mon, 10, $year));
            $month_url = $ditto->buildURL("month=".$mon."&year=".$year."&day=false&start=0",$templatesDocumentID,$id);
            $month_count = count($month);
            $year_count += $month_count;
            $r_month = $ditto->template->replace(array("year"=>$year,"month"=>$month_text,"url"=>$month_url,"count"=>$month_count),$templates[\'month\']);
            if ($showItems) {
                foreach ($month as $item) {
                    $items[$year][$mon][\'items\'][] = $ditto->render($item, $templates[\'item\'], false, $templatesDateSource, $dateFormat, array(),$phx);
                }
                $r_month_2 = $ditto->template->replace(array(\'wrapper\' => implode(\'\',$items[$year][$mon][\'items\'])),$templates[\'month_inner\']);
                $items[$year][$mon] = $ditto->template->replace(array(\'wrapper\' => $r_month_2),$r_month);
            } else {
                $items[$year][$mon] = $r_month;
            }
        }
        if ($groupByYears) {
            $year_url = $ditto->buildURL("year=".$year."&month=false&day=false&start=0",$templatesDocumentID,$id);
            $r_year =  $ditto->template->replace(array("year"=>$year,"url"=>$year_url,"count"=>$year_count),$templates[\'year\']);
            $var = $ditto->template->replace(array(\'wrapper\'=>implode(\'\',$items[$year])),$templates[\'year_inner\']);
            $output .= $ditto->template->replace(array(\'wrapper\'=>$var),$r_year);
        } else {
            $output .= implode(\'\',$items[$year]);
        }
    }

    $output = $ditto->template->replace(array(\'wrapper\'=>$output),$templates[\'tpl\']);
    $modx->setPlaceholder($id.\'reset\',$ditto->buildURL(\'year=false&month=false&day=false\',$templatesDocumentID,$id));

return $output;
    
}
}

return reflect($targetID, $showItems, $groupByYears, $resource, $dateSource, $dateFormat, $ditto, $templates,$id,$start,$yearSortDir,$monthSortDir);';
$s['Reflect'] = '/*
 * Author: 
 *      Mark Kaplan for MODx CMF
 * 
 * Note: 
 *      If Reflect is not retrieving its own documents, make sure that the
 *          Ditto call feeding it has all of the fields in it that you plan on
 *       calling in your Reflect template. Furthermore, Reflect will ONLY
 *          show what is currently in the Ditto result set.
 *       Thus, if pagination is on it will ONLY show that page\'s items.
*/
 

// ---------------------------------------------------
//  Includes
// ---------------------------------------------------

$reflect_base = isset($reflect_base) ? $modx->config[\'base_path\'].$reflect_base : $modx->config[\'base_path\']."assets/snippets/reflect/";
/*
    Param: ditto_base
    
    Purpose:
    Location of Ditto files

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    [(base_path)]assets/snippets/ditto/
*/

$config = (isset($config)) ? $config : "default";
/*
    Param: config

    Purpose:
    Load a custom configuration

    Options:
    "default" - default blank config file
    CONFIG_NAME - Other configs installed in the configs folder or in any folder within the MODx base path via @FILE

    Default:
    "default"
    
    Related:
    - <extenders>
*/

require($reflect_base."configs/default.config.php");
require($reflect_base."default.templates.php");
if ($config != "default") {
    require((substr($config, 0, 5) != "@FILE") ? $reflect_base."configs/$config.config.php" : $modx->config[\'base_path\'].trim(substr($config, 5)));
}

// ---------------------------------------------------
//  Parameters
// ---------------------------------------------------

$id = isset($id) ? $id."_" : false;
/*
    Param: id

    Purpose:
    Unique ID for this Ditto instance for connection with other scripts (like Reflect) and unique URL parameters

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    "" - blank
*/
$getDocuments = isset($getDocuments) ? $getDocuments : 0;
/*
    Param: getDocuments

    Purpose:
    Force Reflect to get documents

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
*/
$showItems = isset($showItems) ? $showItems : 1;
/*
    Param: showItems

    Purpose:
    Show individual items in the archive

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/
$groupByYears = isset($groupByYears)? $groupByYears : 1;
/*
    Param: groupByYears

    Purpose:
    Group the archive by years

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/
$targetID = isset($targetID) ? $targetID : $modx->documentObject[\'id\'];
/*
    Param: targetID

    Purpose:
    ID for archive links to point to

    Options:
    Any MODx document with a Ditto call setup with extenders=`dateFilter`
    
    Default:
    Current MODx Document
*/
$dateSource = isset($dateSource) ? $dateSource : "createdon";
/*
    Param: dateSource

    Purpose:
    Date source to display for archive items

    Options:
    # - Any UNIX timestamp from MODx fields or TVs such as createdon, pub_date, or editedon
    
    Default:
    "createdon"
    
    Related:
    - <dateFormat>
*/
$dateFormat = isset($dateFormat) ? $dateFormat : "%d-%b-%y %H:%M";  
/*
    Param: dateFormat

    Purpose:
    Format the [+date+] placeholder in human readable form

    Options:
    Any PHP valid strftime option

    Default:
    "%d-%b-%y %H:%M"
    
    Related:
    - <dateSource>
*/
$yearSortDir = isset($yearSortDir) ? $yearSortDir : "DESC";
/*
    Param: yearSortDir

    Purpose:
    Direction to sort documents

    Options:
    ASC - ascending
    DESC - descending

    Default:
    "DESC"
    
    Related:
    - <monthSortDir>
*/
$monthSortDir = isset($monthSortDir) ? $monthSortDir : "ASC";
/*
    Param: monthSortDir

    Purpose:
    Direction to sort the months

    Options:
    ASC - ascending
    DESC - descending

    Default:
    "ASC"
    
    Related:
    - <yearSortDir>
*/
$start = isset($start)? intval($start) : 0;
/*
    Param: start

    Purpose:
    Number of documents to skip in the results
    
    Options:
    Any number

    Default:
    0
*/  
$phx = (isset($phx))? $phx : 1;
/*
    Param: phx

    Purpose:
    Use PHx formatting

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/

// ---------------------------------------------------
//  Initialize Ditto
// ---------------------------------------------------
$placeholder = ($id != false && $getDocuments == 0) ? true : false;
if ($placeholder === false) {
    $rID = "reflect_".rand(1,1000);
    $itemTemplate = isset($tplItem) ? $tplItem: "@CODE:".$defaultTemplates[\'item\'];
    $dParams = array(
        "id" => "$rID",
        "save" => "3",  
        "summarize" => "all",
        "tpl" => $itemTemplate,
    );
    
    $source = $dittoSnippetName;
    $params = $dittoSnippetParameters;
        // TODO: Remove after 3.0
        
    if (isset($params)) {
        $givenParams = explode("|",$params);
        foreach ($givenParams as $parameter) {
            $p = explode(":",$parameter);
            $dParams[$p[0]] = $p[1];
        }
    }
    /*
        Param: params

        Purpose:
        Pass parameters to the Ditto instance used to retreive the documents

        Options:
        Any valid ditto parameters in the format name:value 
        with multiple parameters separated by a pipe (|)
        
        Note:
        This parameter is only needed for config, start, and phx as you can
        now simply use the parameter as if Reflect was Ditto

        Default:
        [NULL]
    */
    
    $reflectParameters = array(\'reflect_base\',\'config\',\'id\',\'getDocuments\',\'showItems\',\'groupByYears\',\'targetID\',\'yearSortDir\',\'monthSortDir\',\'start\',\'phx\',\'tplContainer\',\'tplYear\',\'tplMonth\',\'tplMonthInner\',\'tplItem\',\'save\');
    $params =& $modx->event->params;
    if(is_array($params)) {
        foreach ($params as $param=>$value) {
            if (!in_array($param,$reflectParameters) && substr($param,-3) != \'tpl\') {
                $dParams[$param] = $value;
            }
        }
    }

    $source = isset($source) ? $source : "Ditto";
    /*
        Param: source

        Purpose:
        Name of the Ditto snippet to use

        Options:
        Any valid snippet name

        Default:
        "Ditto"
    */
    $snippetOutput = $modx->runSnippet($source,$dParams);
    $ditto = $modx->getPlaceholder($rID."_ditto_object");
    $resource = $modx->getPlaceholder($rID."_ditto_resource");
} else {
    $ditto = $modx->getPlaceholder($id."ditto_object");
    $resource = $modx->getPlaceholder($id."ditto_resource");
}
if (!is_object($ditto) || !isset($ditto) || !isset($resource)) {
    return !empty($snippetOutput) ? $snippetOutput : "The Ditto object is invalid. Please check it.";
}

// ---------------------------------------------------
//  Templates
// ---------------------------------------------------

$templates[\'tpl\'] = isset($tplContainer) ? $ditto->template->fetch($tplContainer): $defaultTemplates[\'tpl\'];
/*
    Param: tplContainer

    Purpose:
    Container template for the archive

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'year\'] = isset($tplYear) ? $ditto->template->fetch($tplYear): $defaultTemplates[\'year\'];
/*
    Param: tplYear

    Purpose:
    Template for the year item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'year_inner\'] = isset($tplYearInner) ? $ditto->template->fetch($tplYearInner): $defaultTemplates[\'year_inner\'];
/*
    Param: tplYearInner

    Purpose:
    Template for the year item (the ul to hold the year template)

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'month\'] = isset($tplMonth) ? $ditto->template->fetch($tplMonth): $defaultTemplates[\'month\'];
/*
    Param: tplMonth

    Purpose:
    Template for the month item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'month_inner\'] = isset($tplMonthInner) ? $ditto->template->fetch($tplMonthInner): $defaultTemplates[\'month_inner\'];
/*
    Param: tplMonthInner

    Purpose:
    Template for the month item  (the ul to hold the month template)

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'item\'] = isset($tplItem) ? $ditto->template->fetch($tplItem): $defaultTemplates[\'item\'];
/*
    Param: tplItem

    Purpose:
    Template for the individual item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/

$ditto->addField("date","display","custom");
    // force add the date field if receiving data from a Ditto instance

// ---------------------------------------------------
//  Reflect
// ---------------------------------------------------

if (function_exists("reflect") === FALSE) {
function reflect($templatesDocumentID, $showItems, $groupByYears, $resource, $templatesDateSource, $dateFormat, $ditto, $templates,$id,$start,$yearSortDir,$monthSortDir) {
    global $modx;
    $cal = array();
    $output = \'\';
    $ph = array(\'year\'=>\'\',\'month\'=>\'\',\'item\'=>\'\',\'out\'=>\'\');
    $build = array();
    $stop = count($resource);

    // loop and fetch all the results
    for ($i = $start; $i < $stop; $i++) {
        $date = getdate($resource[$i][$templatesDateSource]);
        $year = $date["year"];
        $month = $date["mon"];
        $cal[$year][$month][] = $resource[$i];
    }
    if ($yearSortDir == "DESC") {
        krsort($cal);
    } else {
        ksort($cal);
    }
    foreach ($cal as $year=>$months) {
        if ($monthSortDir == "ASC") {
            ksort($months);
        } else {
            krsort($months);
        }
        $build[$year] = $months;
    }
    
    foreach ($build as $year=>$months) {
        $r_year = \'\';
        $r_month = \'\';
        $r_month_2 = \'\';
        $year_count = 0;
        $items = array();
        
        foreach ($months as $mon=>$month) {
            $month_text = strftime("%B", mktime(10, 10, 10, $mon, 10, $year));
            $month_url = $ditto->buildURL("month=".$mon."&year=".$year."&day=false&start=0",$templatesDocumentID,$id);
            $month_count = count($month);
            $year_count += $month_count;
            $r_month = $ditto->template->replace(array("year"=>$year,"month"=>$month_text,"url"=>$month_url,"count"=>$month_count),$templates[\'month\']);
            if ($showItems) {
                foreach ($month as $item) {
                    $items[$year][$mon][\'items\'][] = $ditto->render($item, $templates[\'item\'], false, $templatesDateSource, $dateFormat, array(),$phx);
                }
                $r_month_2 = $ditto->template->replace(array(\'wrapper\' => implode(\'\',$items[$year][$mon][\'items\'])),$templates[\'month_inner\']);
                $items[$year][$mon] = $ditto->template->replace(array(\'wrapper\' => $r_month_2),$r_month);
            } else {
                $items[$year][$mon] = $r_month;
            }
        }
        if ($groupByYears) {
            $year_url = $ditto->buildURL("year=".$year."&month=false&day=false&start=0",$templatesDocumentID,$id);
            $r_year =  $ditto->template->replace(array("year"=>$year,"url"=>$year_url,"count"=>$year_count),$templates[\'year\']);
            $var = $ditto->template->replace(array(\'wrapper\'=>implode(\'\',$items[$year])),$templates[\'year_inner\']);
            $output .= $ditto->template->replace(array(\'wrapper\'=>$var),$r_year);
        } else {
            $output .= implode(\'\',$items[$year]);
        }
    }

    $output = $ditto->template->replace(array(\'wrapper\'=>$output),$templates[\'tpl\']);
    $modx->setPlaceholder($id.\'reset\',$ditto->buildURL(\'year=false&month=false&day=false\',$templatesDocumentID,$id));

return $output;
    
}
}

return reflect($targetID, $showItems, $groupByYears, $resource, $dateSource, $dateFormat, $ditto, $templates,$id,$start,$yearSortDir,$monthSortDir);';
$s['Reflect'] = '/*
 * Author: 
 *      Mark Kaplan for MODx CMF
 * 
 * Note: 
 *      If Reflect is not retrieving its own documents, make sure that the
 *          Ditto call feeding it has all of the fields in it that you plan on
 *       calling in your Reflect template. Furthermore, Reflect will ONLY
 *          show what is currently in the Ditto result set.
 *       Thus, if pagination is on it will ONLY show that page\'s items.
*/
 

// ---------------------------------------------------
//  Includes
// ---------------------------------------------------

$reflect_base = isset($reflect_base) ? $modx->config[\'base_path\'].$reflect_base : $modx->config[\'base_path\']."assets/snippets/reflect/";
/*
    Param: ditto_base
    
    Purpose:
    Location of Ditto files

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    [(base_path)]assets/snippets/ditto/
*/

$config = (isset($config)) ? $config : "default";
/*
    Param: config

    Purpose:
    Load a custom configuration

    Options:
    "default" - default blank config file
    CONFIG_NAME - Other configs installed in the configs folder or in any folder within the MODx base path via @FILE

    Default:
    "default"
    
    Related:
    - <extenders>
*/

require($reflect_base."configs/default.config.php");
require($reflect_base."default.templates.php");
if ($config != "default") {
    require((substr($config, 0, 5) != "@FILE") ? $reflect_base."configs/$config.config.php" : $modx->config[\'base_path\'].trim(substr($config, 5)));
}

// ---------------------------------------------------
//  Parameters
// ---------------------------------------------------

$id = isset($id) ? $id."_" : false;
/*
    Param: id

    Purpose:
    Unique ID for this Ditto instance for connection with other scripts (like Reflect) and unique URL parameters

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    "" - blank
*/
$getDocuments = isset($getDocuments) ? $getDocuments : 0;
/*
    Param: getDocuments

    Purpose:
    Force Reflect to get documents

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
*/
$showItems = isset($showItems) ? $showItems : 1;
/*
    Param: showItems

    Purpose:
    Show individual items in the archive

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/
$groupByYears = isset($groupByYears)? $groupByYears : 1;
/*
    Param: groupByYears

    Purpose:
    Group the archive by years

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/
$targetID = isset($targetID) ? $targetID : $modx->documentObject[\'id\'];
/*
    Param: targetID

    Purpose:
    ID for archive links to point to

    Options:
    Any MODx document with a Ditto call setup with extenders=`dateFilter`
    
    Default:
    Current MODx Document
*/
$dateSource = isset($dateSource) ? $dateSource : "createdon";
/*
    Param: dateSource

    Purpose:
    Date source to display for archive items

    Options:
    # - Any UNIX timestamp from MODx fields or TVs such as createdon, pub_date, or editedon
    
    Default:
    "createdon"
    
    Related:
    - <dateFormat>
*/
$dateFormat = isset($dateFormat) ? $dateFormat : "%d-%b-%y %H:%M";  
/*
    Param: dateFormat

    Purpose:
    Format the [+date+] placeholder in human readable form

    Options:
    Any PHP valid strftime option

    Default:
    "%d-%b-%y %H:%M"
    
    Related:
    - <dateSource>
*/
$yearSortDir = isset($yearSortDir) ? $yearSortDir : "DESC";
/*
    Param: yearSortDir

    Purpose:
    Direction to sort documents

    Options:
    ASC - ascending
    DESC - descending

    Default:
    "DESC"
    
    Related:
    - <monthSortDir>
*/
$monthSortDir = isset($monthSortDir) ? $monthSortDir : "ASC";
/*
    Param: monthSortDir

    Purpose:
    Direction to sort the months

    Options:
    ASC - ascending
    DESC - descending

    Default:
    "ASC"
    
    Related:
    - <yearSortDir>
*/
$start = isset($start)? intval($start) : 0;
/*
    Param: start

    Purpose:
    Number of documents to skip in the results
    
    Options:
    Any number

    Default:
    0
*/  
$phx = (isset($phx))? $phx : 1;
/*
    Param: phx

    Purpose:
    Use PHx formatting

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/

// ---------------------------------------------------
//  Initialize Ditto
// ---------------------------------------------------
$placeholder = ($id != false && $getDocuments == 0) ? true : false;
if ($placeholder === false) {
    $rID = "reflect_".rand(1,1000);
    $itemTemplate = isset($tplItem) ? $tplItem: "@CODE:".$defaultTemplates[\'item\'];
    $dParams = array(
        "id" => "$rID",
        "save" => "3",  
        "summarize" => "all",
        "tpl" => $itemTemplate,
    );
    
    $source = $dittoSnippetName;
    $params = $dittoSnippetParameters;
        // TODO: Remove after 3.0
        
    if (isset($params)) {
        $givenParams = explode("|",$params);
        foreach ($givenParams as $parameter) {
            $p = explode(":",$parameter);
            $dParams[$p[0]] = $p[1];
        }
    }
    /*
        Param: params

        Purpose:
        Pass parameters to the Ditto instance used to retreive the documents

        Options:
        Any valid ditto parameters in the format name:value 
        with multiple parameters separated by a pipe (|)
        
        Note:
        This parameter is only needed for config, start, and phx as you can
        now simply use the parameter as if Reflect was Ditto

        Default:
        [NULL]
    */
    
    $reflectParameters = array(\'reflect_base\',\'config\',\'id\',\'getDocuments\',\'showItems\',\'groupByYears\',\'targetID\',\'yearSortDir\',\'monthSortDir\',\'start\',\'phx\',\'tplContainer\',\'tplYear\',\'tplMonth\',\'tplMonthInner\',\'tplItem\',\'save\');
    $params =& $modx->event->params;
    if(is_array($params)) {
        foreach ($params as $param=>$value) {
            if (!in_array($param,$reflectParameters) && substr($param,-3) != \'tpl\') {
                $dParams[$param] = $value;
            }
        }
    }

    $source = isset($source) ? $source : "Ditto";
    /*
        Param: source

        Purpose:
        Name of the Ditto snippet to use

        Options:
        Any valid snippet name

        Default:
        "Ditto"
    */
    $snippetOutput = $modx->runSnippet($source,$dParams);
    $ditto = $modx->getPlaceholder($rID."_ditto_object");
    $resource = $modx->getPlaceholder($rID."_ditto_resource");
} else {
    $ditto = $modx->getPlaceholder($id."ditto_object");
    $resource = $modx->getPlaceholder($id."ditto_resource");
}
if (!is_object($ditto) || !isset($ditto) || !isset($resource)) {
    return !empty($snippetOutput) ? $snippetOutput : "The Ditto object is invalid. Please check it.";
}

// ---------------------------------------------------
//  Templates
// ---------------------------------------------------

$templates[\'tpl\'] = isset($tplContainer) ? $ditto->template->fetch($tplContainer): $defaultTemplates[\'tpl\'];
/*
    Param: tplContainer

    Purpose:
    Container template for the archive

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'year\'] = isset($tplYear) ? $ditto->template->fetch($tplYear): $defaultTemplates[\'year\'];
/*
    Param: tplYear

    Purpose:
    Template for the year item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'year_inner\'] = isset($tplYearInner) ? $ditto->template->fetch($tplYearInner): $defaultTemplates[\'year_inner\'];
/*
    Param: tplYearInner

    Purpose:
    Template for the year item (the ul to hold the year template)

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'month\'] = isset($tplMonth) ? $ditto->template->fetch($tplMonth): $defaultTemplates[\'month\'];
/*
    Param: tplMonth

    Purpose:
    Template for the month item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'month_inner\'] = isset($tplMonthInner) ? $ditto->template->fetch($tplMonthInner): $defaultTemplates[\'month_inner\'];
/*
    Param: tplMonthInner

    Purpose:
    Template for the month item  (the ul to hold the month template)

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'item\'] = isset($tplItem) ? $ditto->template->fetch($tplItem): $defaultTemplates[\'item\'];
/*
    Param: tplItem

    Purpose:
    Template for the individual item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/

$ditto->addField("date","display","custom");
    // force add the date field if receiving data from a Ditto instance

// ---------------------------------------------------
//  Reflect
// ---------------------------------------------------

if (function_exists("reflect") === FALSE) {
function reflect($templatesDocumentID, $showItems, $groupByYears, $resource, $templatesDateSource, $dateFormat, $ditto, $templates,$id,$start,$yearSortDir,$monthSortDir) {
    global $modx;
    $cal = array();
    $output = \'\';
    $ph = array(\'year\'=>\'\',\'month\'=>\'\',\'item\'=>\'\',\'out\'=>\'\');
    $build = array();
    $stop = count($resource);

    // loop and fetch all the results
    for ($i = $start; $i < $stop; $i++) {
        $date = getdate($resource[$i][$templatesDateSource]);
        $year = $date["year"];
        $month = $date["mon"];
        $cal[$year][$month][] = $resource[$i];
    }
    if ($yearSortDir == "DESC") {
        krsort($cal);
    } else {
        ksort($cal);
    }
    foreach ($cal as $year=>$months) {
        if ($monthSortDir == "ASC") {
            ksort($months);
        } else {
            krsort($months);
        }
        $build[$year] = $months;
    }
    
    foreach ($build as $year=>$months) {
        $r_year = \'\';
        $r_month = \'\';
        $r_month_2 = \'\';
        $year_count = 0;
        $items = array();
        
        foreach ($months as $mon=>$month) {
            $month_text = strftime("%B", mktime(10, 10, 10, $mon, 10, $year));
            $month_url = $ditto->buildURL("month=".$mon."&year=".$year."&day=false&start=0",$templatesDocumentID,$id);
            $month_count = count($month);
            $year_count += $month_count;
            $r_month = $ditto->template->replace(array("year"=>$year,"month"=>$month_text,"url"=>$month_url,"count"=>$month_count),$templates[\'month\']);
            if ($showItems) {
                foreach ($month as $item) {
                    $items[$year][$mon][\'items\'][] = $ditto->render($item, $templates[\'item\'], false, $templatesDateSource, $dateFormat, array(),$phx);
                }
                $r_month_2 = $ditto->template->replace(array(\'wrapper\' => implode(\'\',$items[$year][$mon][\'items\'])),$templates[\'month_inner\']);
                $items[$year][$mon] = $ditto->template->replace(array(\'wrapper\' => $r_month_2),$r_month);
            } else {
                $items[$year][$mon] = $r_month;
            }
        }
        if ($groupByYears) {
            $year_url = $ditto->buildURL("year=".$year."&month=false&day=false&start=0",$templatesDocumentID,$id);
            $r_year =  $ditto->template->replace(array("year"=>$year,"url"=>$year_url,"count"=>$year_count),$templates[\'year\']);
            $var = $ditto->template->replace(array(\'wrapper\'=>implode(\'\',$items[$year])),$templates[\'year_inner\']);
            $output .= $ditto->template->replace(array(\'wrapper\'=>$var),$r_year);
        } else {
            $output .= implode(\'\',$items[$year]);
        }
    }

    $output = $ditto->template->replace(array(\'wrapper\'=>$output),$templates[\'tpl\']);
    $modx->setPlaceholder($id.\'reset\',$ditto->buildURL(\'year=false&month=false&day=false\',$templatesDocumentID,$id));

return $output;
    
}
}

return reflect($targetID, $showItems, $groupByYears, $resource, $dateSource, $dateFormat, $ditto, $templates,$id,$start,$yearSortDir,$monthSortDir);';
$s['ReflectProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['Reflect'] = '/*
 * Author: 
 *      Mark Kaplan for MODx CMF
 * 
 * Note: 
 *      If Reflect is not retrieving its own documents, make sure that the
 *          Ditto call feeding it has all of the fields in it that you plan on
 *       calling in your Reflect template. Furthermore, Reflect will ONLY
 *          show what is currently in the Ditto result set.
 *       Thus, if pagination is on it will ONLY show that page\'s items.
*/
 

// ---------------------------------------------------
//  Includes
// ---------------------------------------------------

$reflect_base = isset($reflect_base) ? $modx->config[\'base_path\'].$reflect_base : $modx->config[\'base_path\']."assets/snippets/reflect/";
/*
    Param: ditto_base
    
    Purpose:
    Location of Ditto files

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    [(base_path)]assets/snippets/ditto/
*/

$config = (isset($config)) ? $config : "default";
/*
    Param: config

    Purpose:
    Load a custom configuration

    Options:
    "default" - default blank config file
    CONFIG_NAME - Other configs installed in the configs folder or in any folder within the MODx base path via @FILE

    Default:
    "default"
    
    Related:
    - <extenders>
*/

require($reflect_base."configs/default.config.php");
require($reflect_base."default.templates.php");
if ($config != "default") {
    require((substr($config, 0, 5) != "@FILE") ? $reflect_base."configs/$config.config.php" : $modx->config[\'base_path\'].trim(substr($config, 5)));
}

// ---------------------------------------------------
//  Parameters
// ---------------------------------------------------

$id = isset($id) ? $id."_" : false;
/*
    Param: id

    Purpose:
    Unique ID for this Ditto instance for connection with other scripts (like Reflect) and unique URL parameters

    Options:
    Any valid folder location containing the Ditto source code with a trailing slash

    Default:
    "" - blank
*/
$getDocuments = isset($getDocuments) ? $getDocuments : 0;
/*
    Param: getDocuments

    Purpose:
    Force Reflect to get documents

    Options:
    0 - off
    1 - on
    
    Default:
    0 - off
*/
$showItems = isset($showItems) ? $showItems : 1;
/*
    Param: showItems

    Purpose:
    Show individual items in the archive

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/
$groupByYears = isset($groupByYears)? $groupByYears : 1;
/*
    Param: groupByYears

    Purpose:
    Group the archive by years

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/
$targetID = isset($targetID) ? $targetID : $modx->documentObject[\'id\'];
/*
    Param: targetID

    Purpose:
    ID for archive links to point to

    Options:
    Any MODx document with a Ditto call setup with extenders=`dateFilter`
    
    Default:
    Current MODx Document
*/
$dateSource = isset($dateSource) ? $dateSource : "createdon";
/*
    Param: dateSource

    Purpose:
    Date source to display for archive items

    Options:
    # - Any UNIX timestamp from MODx fields or TVs such as createdon, pub_date, or editedon
    
    Default:
    "createdon"
    
    Related:
    - <dateFormat>
*/
$dateFormat = isset($dateFormat) ? $dateFormat : "%d-%b-%y %H:%M";  
/*
    Param: dateFormat

    Purpose:
    Format the [+date+] placeholder in human readable form

    Options:
    Any PHP valid strftime option

    Default:
    "%d-%b-%y %H:%M"
    
    Related:
    - <dateSource>
*/
$yearSortDir = isset($yearSortDir) ? $yearSortDir : "DESC";
/*
    Param: yearSortDir

    Purpose:
    Direction to sort documents

    Options:
    ASC - ascending
    DESC - descending

    Default:
    "DESC"
    
    Related:
    - <monthSortDir>
*/
$monthSortDir = isset($monthSortDir) ? $monthSortDir : "ASC";
/*
    Param: monthSortDir

    Purpose:
    Direction to sort the months

    Options:
    ASC - ascending
    DESC - descending

    Default:
    "ASC"
    
    Related:
    - <yearSortDir>
*/
$start = isset($start)? intval($start) : 0;
/*
    Param: start

    Purpose:
    Number of documents to skip in the results
    
    Options:
    Any number

    Default:
    0
*/  
$phx = (isset($phx))? $phx : 1;
/*
    Param: phx

    Purpose:
    Use PHx formatting

    Options:
    0 - off
    1 - on
    
    Default:
    1 - on
*/

// ---------------------------------------------------
//  Initialize Ditto
// ---------------------------------------------------
$placeholder = ($id != false && $getDocuments == 0) ? true : false;
if ($placeholder === false) {
    $rID = "reflect_".rand(1,1000);
    $itemTemplate = isset($tplItem) ? $tplItem: "@CODE:".$defaultTemplates[\'item\'];
    $dParams = array(
        "id" => "$rID",
        "save" => "3",  
        "summarize" => "all",
        "tpl" => $itemTemplate,
    );
    
    $source = $dittoSnippetName;
    $params = $dittoSnippetParameters;
        // TODO: Remove after 3.0
        
    if (isset($params)) {
        $givenParams = explode("|",$params);
        foreach ($givenParams as $parameter) {
            $p = explode(":",$parameter);
            $dParams[$p[0]] = $p[1];
        }
    }
    /*
        Param: params

        Purpose:
        Pass parameters to the Ditto instance used to retreive the documents

        Options:
        Any valid ditto parameters in the format name:value 
        with multiple parameters separated by a pipe (|)
        
        Note:
        This parameter is only needed for config, start, and phx as you can
        now simply use the parameter as if Reflect was Ditto

        Default:
        [NULL]
    */
    
    $reflectParameters = array(\'reflect_base\',\'config\',\'id\',\'getDocuments\',\'showItems\',\'groupByYears\',\'targetID\',\'yearSortDir\',\'monthSortDir\',\'start\',\'phx\',\'tplContainer\',\'tplYear\',\'tplMonth\',\'tplMonthInner\',\'tplItem\',\'save\');
    $params =& $modx->event->params;
    if(is_array($params)) {
        foreach ($params as $param=>$value) {
            if (!in_array($param,$reflectParameters) && substr($param,-3) != \'tpl\') {
                $dParams[$param] = $value;
            }
        }
    }

    $source = isset($source) ? $source : "Ditto";
    /*
        Param: source

        Purpose:
        Name of the Ditto snippet to use

        Options:
        Any valid snippet name

        Default:
        "Ditto"
    */
    $snippetOutput = $modx->runSnippet($source,$dParams);
    $ditto = $modx->getPlaceholder($rID."_ditto_object");
    $resource = $modx->getPlaceholder($rID."_ditto_resource");
} else {
    $ditto = $modx->getPlaceholder($id."ditto_object");
    $resource = $modx->getPlaceholder($id."ditto_resource");
}
if (!is_object($ditto) || !isset($ditto) || !isset($resource)) {
    return !empty($snippetOutput) ? $snippetOutput : "The Ditto object is invalid. Please check it.";
}

// ---------------------------------------------------
//  Templates
// ---------------------------------------------------

$templates[\'tpl\'] = isset($tplContainer) ? $ditto->template->fetch($tplContainer): $defaultTemplates[\'tpl\'];
/*
    Param: tplContainer

    Purpose:
    Container template for the archive

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'year\'] = isset($tplYear) ? $ditto->template->fetch($tplYear): $defaultTemplates[\'year\'];
/*
    Param: tplYear

    Purpose:
    Template for the year item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'year_inner\'] = isset($tplYearInner) ? $ditto->template->fetch($tplYearInner): $defaultTemplates[\'year_inner\'];
/*
    Param: tplYearInner

    Purpose:
    Template for the year item (the ul to hold the year template)

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'month\'] = isset($tplMonth) ? $ditto->template->fetch($tplMonth): $defaultTemplates[\'month\'];
/*
    Param: tplMonth

    Purpose:
    Template for the month item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'month_inner\'] = isset($tplMonthInner) ? $ditto->template->fetch($tplMonthInner): $defaultTemplates[\'month_inner\'];
/*
    Param: tplMonthInner

    Purpose:
    Template for the month item  (the ul to hold the month template)

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/
$templates[\'item\'] = isset($tplItem) ? $ditto->template->fetch($tplItem): $defaultTemplates[\'item\'];
/*
    Param: tplItem

    Purpose:
    Template for the individual item

    Options:
    - Any valid chunk name
    - Code via @CODE:
    - File via @FILE:

    Default:
    See default.tempates.php
*/

$ditto->addField("date","display","custom");
    // force add the date field if receiving data from a Ditto instance

// ---------------------------------------------------
//  Reflect
// ---------------------------------------------------

if (function_exists("reflect") === FALSE) {
function reflect($templatesDocumentID, $showItems, $groupByYears, $resource, $templatesDateSource, $dateFormat, $ditto, $templates,$id,$start,$yearSortDir,$monthSortDir) {
    global $modx;
    $cal = array();
    $output = \'\';
    $ph = array(\'year\'=>\'\',\'month\'=>\'\',\'item\'=>\'\',\'out\'=>\'\');
    $build = array();
    $stop = count($resource);

    // loop and fetch all the results
    for ($i = $start; $i < $stop; $i++) {
        $date = getdate($resource[$i][$templatesDateSource]);
        $year = $date["year"];
        $month = $date["mon"];
        $cal[$year][$month][] = $resource[$i];
    }
    if ($yearSortDir == "DESC") {
        krsort($cal);
    } else {
        ksort($cal);
    }
    foreach ($cal as $year=>$months) {
        if ($monthSortDir == "ASC") {
            ksort($months);
        } else {
            krsort($months);
        }
        $build[$year] = $months;
    }
    
    foreach ($build as $year=>$months) {
        $r_year = \'\';
        $r_month = \'\';
        $r_month_2 = \'\';
        $year_count = 0;
        $items = array();
        
        foreach ($months as $mon=>$month) {
            $month_text = strftime("%B", mktime(10, 10, 10, $mon, 10, $year));
            $month_url = $ditto->buildURL("month=".$mon."&year=".$year."&day=false&start=0",$templatesDocumentID,$id);
            $month_count = count($month);
            $year_count += $month_count;
            $r_month = $ditto->template->replace(array("year"=>$year,"month"=>$month_text,"url"=>$month_url,"count"=>$month_count),$templates[\'month\']);
            if ($showItems) {
                foreach ($month as $item) {
                    $items[$year][$mon][\'items\'][] = $ditto->render($item, $templates[\'item\'], false, $templatesDateSource, $dateFormat, array(),$phx);
                }
                $r_month_2 = $ditto->template->replace(array(\'wrapper\' => implode(\'\',$items[$year][$mon][\'items\'])),$templates[\'month_inner\']);
                $items[$year][$mon] = $ditto->template->replace(array(\'wrapper\' => $r_month_2),$r_month);
            } else {
                $items[$year][$mon] = $r_month;
            }
        }
        if ($groupByYears) {
            $year_url = $ditto->buildURL("year=".$year."&month=false&day=false&start=0",$templatesDocumentID,$id);
            $r_year =  $ditto->template->replace(array("year"=>$year,"url"=>$year_url,"count"=>$year_count),$templates[\'year\']);
            $var = $ditto->template->replace(array(\'wrapper\'=>implode(\'\',$items[$year])),$templates[\'year_inner\']);
            $output .= $ditto->template->replace(array(\'wrapper\'=>$var),$r_year);
        } else {
            $output .= implode(\'\',$items[$year]);
        }
    }

    $output = $ditto->template->replace(array(\'wrapper\'=>$output),$templates[\'tpl\']);
    $modx->setPlaceholder($id.\'reset\',$ditto->buildURL(\'year=false&month=false&day=false\',$templatesDocumentID,$id));

return $output;
    
}
}

return reflect($targetID, $showItems, $groupByYears, $resource, $dateSource, $dateFormat, $ditto, $templates,$id,$start,$yearSortDir,$monthSortDir);';
$s['if'] = '/**
** if snippet
** Выводит строку из параметра then, если в параметр if равен is ; иначе выводит строку из параметра else
** !Не может использоваться в поле "Содержание документа"
** !Если в строках указан непосредственно html код, необходимо заменять "=" на "@eq"; следить, чтобы
    не было знака "&"
**
**  @Author: dmi3yy (dmi3yy@gmail.com)
**/

$if = isset($if) ? $if : \'\'; //ожидается значение TV в виде [*tvname*]
$is = isset($is) ? $is : \'\'; //ожидается значение с чем сравнивать  
$then = isset($then) ? $then : \'\'; //код или чанк в виде @CHUNK
$else = isset($else) ? $else : \'\'; //код или чанк в виде @CHUNK


//echo substr($in,1);

//выводим код, в зависимости от пустоты TV
if (trim($if) ==  trim($is)) { //уточнить условия
  if (substr($then, 0, 6) == \'@CHUNK\') {
     $then = $modx->getChunk(trim(substr($then, 7)));
  }  
  $then = str_replace(\'@eq\', \'=\', $then);
  return $then;
} else {
	if (substr($else, 0, 6) == \'@CHUNK\') {
	  $else = $modx->getChunk(trim(substr($else, 7)));
	}
  $else = str_replace(\'@eq\', \'=\', $else);
  return $else;
}';
$s['if'] = '/**
** if snippet
** Выводит строку из параметра then, если в параметр if равен is ; иначе выводит строку из параметра else
** !Не может использоваться в поле "Содержание документа"
** !Если в строках указан непосредственно html код, необходимо заменять "=" на "@eq"; следить, чтобы
    не было знака "&"
**
**  @Author: dmi3yy (dmi3yy@gmail.com)
**/

$if = isset($if) ? $if : \'\'; //ожидается значение TV в виде [*tvname*]
$is = isset($is) ? $is : \'\'; //ожидается значение с чем сравнивать  
$then = isset($then) ? $then : \'\'; //код или чанк в виде @CHUNK
$else = isset($else) ? $else : \'\'; //код или чанк в виде @CHUNK


//echo substr($in,1);

//выводим код, в зависимости от пустоты TV
if (trim($if) ==  trim($is)) { //уточнить условия
  if (substr($then, 0, 6) == \'@CHUNK\') {
     $then = $modx->getChunk(trim(substr($then, 7)));
  }  
  $then = str_replace(\'@eq\', \'=\', $then);
  return $then;
} else {
	if (substr($else, 0, 6) == \'@CHUNK\') {
	  $else = $modx->getChunk(trim(substr($else, 7)));
	}
  $else = str_replace(\'@eq\', \'=\', $else);
  return $else;
}';
$s['if'] = '/**
** if snippet
** Выводит строку из параметра then, если в параметр if равен is ; иначе выводит строку из параметра else
** !Не может использоваться в поле "Содержание документа"
** !Если в строках указан непосредственно html код, необходимо заменять "=" на "@eq"; следить, чтобы
    не было знака "&"
**
**  @Author: dmi3yy (dmi3yy@gmail.com)
**/

$if = isset($if) ? $if : \'\'; //ожидается значение TV в виде [*tvname*]
$is = isset($is) ? $is : \'\'; //ожидается значение с чем сравнивать  
$then = isset($then) ? $then : \'\'; //код или чанк в виде @CHUNK
$else = isset($else) ? $else : \'\'; //код или чанк в виде @CHUNK


//echo substr($in,1);

//выводим код, в зависимости от пустоты TV
if (trim($if) ==  trim($is)) { //уточнить условия
  if (substr($then, 0, 6) == \'@CHUNK\') {
     $then = $modx->getChunk(trim(substr($then, 7)));
  }  
  $then = str_replace(\'@eq\', \'=\', $then);
  return $then;
} else {
	if (substr($else, 0, 6) == \'@CHUNK\') {
	  $else = $modx->getChunk(trim(substr($else, 7)));
	}
  $else = str_replace(\'@eq\', \'=\', $else);
  return $else;
}';
$s['ifProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['if'] = '/**
** if snippet
** Выводит строку из параметра then, если в параметр if равен is ; иначе выводит строку из параметра else
** !Не может использоваться в поле "Содержание документа"
** !Если в строках указан непосредственно html код, необходимо заменять "=" на "@eq"; следить, чтобы
    не было знака "&"
**
**  @Author: dmi3yy (dmi3yy@gmail.com)
**/

$if = isset($if) ? $if : \'\'; //ожидается значение TV в виде [*tvname*]
$is = isset($is) ? $is : \'\'; //ожидается значение с чем сравнивать  
$then = isset($then) ? $then : \'\'; //код или чанк в виде @CHUNK
$else = isset($else) ? $else : \'\'; //код или чанк в виде @CHUNK


//echo substr($in,1);

//выводим код, в зависимости от пустоты TV
if (trim($if) ==  trim($is)) { //уточнить условия
  if (substr($then, 0, 6) == \'@CHUNK\') {
     $then = $modx->getChunk(trim(substr($then, 7)));
  }  
  $then = str_replace(\'@eq\', \'=\', $then);
  return $then;
} else {
	if (substr($else, 0, 6) == \'@CHUNK\') {
	  $else = $modx->getChunk(trim(substr($else, 7)));
	}
  $else = str_replace(\'@eq\', \'=\', $else);
  return $else;
}';
$s['GetField'] = '/*
==================================================
	GetField
==================================================

Returns any document field or template variable from any document or any of its parents.

Author: Grzegorz Adamiak [grad]
Version: 1.3 beta @2006-11-08 14:40:04
License: LGPL
MODx: 0.9.2.1+

See GetField.txt for instructions and version history.
--------------------------------------------------
*/

/* Parameters
----------------------------------------------- */

# $docid [ int ]
# ID of the document for which to get a field content.
# Default: current document

$gfIntDocId = (isset($docid)) ? $docid : $modx->documentIdentifier;

# $field [ string ]
# Name of the field for which to get the content:
# - any of the document object fields (http://modxcms.com/the-document-object.html)
# - template variable
# Default: \'pagetitle\'

$gfStrDocField = (isset($field)) ? trim($field) : \'pagetitle\';

# $parent [ 0 | 1 ]
# If set to 1, the snippet will return value for the document parent.
# Default: 0

$gfBoolParent = (isset($parent)) ? $parent : 0;

# $parentLevel [ int ]
# Specifies how high in the document tree to search for the parent of the document:
# - $parentLevel = 0 - returns the ultimate parent (right under site root)
# - $parentLevel = 1 - returns the direct parent
# Default: 0

$gfIntParentLevel = (isset($parentLevel) && is_int((int) $parentLevel)) ? $parentLevel : 0;

# $topid [ int ]
# Id of the topmost document in the document tree under which to search for a parent. Used only with $parent set to 1.
# Default: 0

$gfIntTopDocId = (isset($topid) && is_int((int) $topid)) ? $topid : 0;

/* Do not edit the code below!
----------------------------------------------- */

# Include logic
include_once(\'assets/snippets/getfield/getfield.inc.php\');

# Get parent document ID
if ($gfBoolParent)
	$gfIntDocId = gfGetParentId($modx, $gfIntDocId, $gfIntTopDocId, $gfIntParentLevel);

# Get content of the field
$output = gfGetFieldContent($modx,$gfIntDocId,$gfStrDocField);

unset($gfIntDocId, $gfStrDocField, $gfBoolParent, $gfIntParentLevel, $gfIntTopDocId);

return $output;';
$s['GetField'] = '/*
==================================================
	GetField
==================================================

Returns any document field or template variable from any document or any of its parents.

Author: Grzegorz Adamiak [grad]
Version: 1.3 beta @2006-11-08 14:40:04
License: LGPL
MODx: 0.9.2.1+

See GetField.txt for instructions and version history.
--------------------------------------------------
*/

/* Parameters
----------------------------------------------- */

# $docid [ int ]
# ID of the document for which to get a field content.
# Default: current document

$gfIntDocId = (isset($docid)) ? $docid : $modx->documentIdentifier;

# $field [ string ]
# Name of the field for which to get the content:
# - any of the document object fields (http://modxcms.com/the-document-object.html)
# - template variable
# Default: \'pagetitle\'

$gfStrDocField = (isset($field)) ? trim($field) : \'pagetitle\';

# $parent [ 0 | 1 ]
# If set to 1, the snippet will return value for the document parent.
# Default: 0

$gfBoolParent = (isset($parent)) ? $parent : 0;

# $parentLevel [ int ]
# Specifies how high in the document tree to search for the parent of the document:
# - $parentLevel = 0 - returns the ultimate parent (right under site root)
# - $parentLevel = 1 - returns the direct parent
# Default: 0

$gfIntParentLevel = (isset($parentLevel) && is_int((int) $parentLevel)) ? $parentLevel : 0;

# $topid [ int ]
# Id of the topmost document in the document tree under which to search for a parent. Used only with $parent set to 1.
# Default: 0

$gfIntTopDocId = (isset($topid) && is_int((int) $topid)) ? $topid : 0;

/* Do not edit the code below!
----------------------------------------------- */

# Include logic
include_once(\'assets/snippets/getfield/getfield.inc.php\');

# Get parent document ID
if ($gfBoolParent)
	$gfIntDocId = gfGetParentId($modx, $gfIntDocId, $gfIntTopDocId, $gfIntParentLevel);

# Get content of the field
$output = gfGetFieldContent($modx,$gfIntDocId,$gfStrDocField);

unset($gfIntDocId, $gfStrDocField, $gfBoolParent, $gfIntParentLevel, $gfIntTopDocId);

return $output;';
$s['GetField'] = '/*
==================================================
	GetField
==================================================

Returns any document field or template variable from any document or any of its parents.

Author: Grzegorz Adamiak [grad]
Version: 1.3 beta @2006-11-08 14:40:04
License: LGPL
MODx: 0.9.2.1+

See GetField.txt for instructions and version history.
--------------------------------------------------
*/

/* Parameters
----------------------------------------------- */

# $docid [ int ]
# ID of the document for which to get a field content.
# Default: current document

$gfIntDocId = (isset($docid)) ? $docid : $modx->documentIdentifier;

# $field [ string ]
# Name of the field for which to get the content:
# - any of the document object fields (http://modxcms.com/the-document-object.html)
# - template variable
# Default: \'pagetitle\'

$gfStrDocField = (isset($field)) ? trim($field) : \'pagetitle\';

# $parent [ 0 | 1 ]
# If set to 1, the snippet will return value for the document parent.
# Default: 0

$gfBoolParent = (isset($parent)) ? $parent : 0;

# $parentLevel [ int ]
# Specifies how high in the document tree to search for the parent of the document:
# - $parentLevel = 0 - returns the ultimate parent (right under site root)
# - $parentLevel = 1 - returns the direct parent
# Default: 0

$gfIntParentLevel = (isset($parentLevel) && is_int((int) $parentLevel)) ? $parentLevel : 0;

# $topid [ int ]
# Id of the topmost document in the document tree under which to search for a parent. Used only with $parent set to 1.
# Default: 0

$gfIntTopDocId = (isset($topid) && is_int((int) $topid)) ? $topid : 0;

/* Do not edit the code below!
----------------------------------------------- */

# Include logic
include_once(\'assets/snippets/getfield/getfield.inc.php\');

# Get parent document ID
if ($gfBoolParent)
	$gfIntDocId = gfGetParentId($modx, $gfIntDocId, $gfIntTopDocId, $gfIntParentLevel);

# Get content of the field
$output = gfGetFieldContent($modx,$gfIntDocId,$gfStrDocField);

unset($gfIntDocId, $gfStrDocField, $gfBoolParent, $gfIntParentLevel, $gfIntTopDocId);

return $output;';
$s['GetFieldProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['GetField'] = '/*
==================================================
	GetField
==================================================

Returns any document field or template variable from any document or any of its parents.

Author: Grzegorz Adamiak [grad]
Version: 1.3 beta @2006-11-08 14:40:04
License: LGPL
MODx: 0.9.2.1+

See GetField.txt for instructions and version history.
--------------------------------------------------
*/

/* Parameters
----------------------------------------------- */

# $docid [ int ]
# ID of the document for which to get a field content.
# Default: current document

$gfIntDocId = (isset($docid)) ? $docid : $modx->documentIdentifier;

# $field [ string ]
# Name of the field for which to get the content:
# - any of the document object fields (http://modxcms.com/the-document-object.html)
# - template variable
# Default: \'pagetitle\'

$gfStrDocField = (isset($field)) ? trim($field) : \'pagetitle\';

# $parent [ 0 | 1 ]
# If set to 1, the snippet will return value for the document parent.
# Default: 0

$gfBoolParent = (isset($parent)) ? $parent : 0;

# $parentLevel [ int ]
# Specifies how high in the document tree to search for the parent of the document:
# - $parentLevel = 0 - returns the ultimate parent (right under site root)
# - $parentLevel = 1 - returns the direct parent
# Default: 0

$gfIntParentLevel = (isset($parentLevel) && is_int((int) $parentLevel)) ? $parentLevel : 0;

# $topid [ int ]
# Id of the topmost document in the document tree under which to search for a parent. Used only with $parent set to 1.
# Default: 0

$gfIntTopDocId = (isset($topid) && is_int((int) $topid)) ? $topid : 0;

/* Do not edit the code below!
----------------------------------------------- */

# Include logic
include_once(\'assets/snippets/getfield/getfield.inc.php\');

# Get parent document ID
if ($gfBoolParent)
	$gfIntDocId = gfGetParentId($modx, $gfIntDocId, $gfIntTopDocId, $gfIntParentLevel);

# Get content of the field
$output = gfGetFieldContent($modx,$gfIntDocId,$gfStrDocField);

unset($gfIntDocId, $gfStrDocField, $gfBoolParent, $gfIntParentLevel, $gfIntTopDocId);

return $output;';
$s['truncate'] = '/**
[[truncate? &text=`[+content+]` &len=`100`]]
**/


 $lenf = $len; //Заменяет символы перевода строки на HTML тег 
   $order = array("\\r\\n", "\\n", "\\r");
   $replace = \'<br />\';
   $what = str_replace($order, $replace, $text);
   if (strlen($what) > $lenf) {
       $what = preg_replace(\'/^(.{\' . $lenf . \',}? ).*$/is\', \'$1\', $what) . \'...\'; 
   } 
   return $what;';
$s['truncate'] = '/**
[[truncate? &text=`[+content+]` &len=`100`]]
**/


 $lenf = $len; //Заменяет символы перевода строки на HTML тег 
   $order = array("\\r\\n", "\\n", "\\r");
   $replace = \'<br />\';
   $what = str_replace($order, $replace, $text);
   if (strlen($what) > $lenf) {
       $what = preg_replace(\'/^(.{\' . $lenf . \',}? ).*$/is\', \'$1\', $what) . \'...\'; 
   } 
   return $what;';
$s['truncate'] = '/**
[[truncate? &text=`[+content+]` &len=`100`]]
**/


 $lenf = $len; //Заменяет символы перевода строки на HTML тег 
   $order = array("\\r\\n", "\\n", "\\r");
   $replace = \'<br />\';
   $what = str_replace($order, $replace, $text);
   if (strlen($what) > $lenf) {
       $what = preg_replace(\'/^(.{\' . $lenf . \',}? ).*$/is\', \'$1\', $what) . \'...\'; 
   } 
   return $what;';
$s['truncateProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['truncate'] = '/**
[[truncate? &text=`[+content+]` &len=`100`]]
**/


 $lenf = $len; //Заменяет символы перевода строки на HTML тег 
   $order = array("\\r\\n", "\\n", "\\r");
   $replace = \'<br />\';
   $what = str_replace($order, $replace, $text);
   if (strlen($what) > $lenf) {
       $what = preg_replace(\'/^(.{\' . $lenf . \',}? ).*$/is\', \'$1\', $what) . \'...\'; 
   } 
   return $what;';
$s['WebChangePwd'] = '# Created By Raymond Irving April, 2005
#::::::::::::::::::::::::::::::::::::::::
# Params:	
#
#	&tpl			- (Optional)
#		Chunk name or document id to use as a template
#				  
#	Note: Templats design:
#			section 1: change pwd template
#			section 2: notification template 
#
# Examples:
#
#	[[WebChangePwd? &tpl=`ChangePwd`]] 

# Set Snippet Paths 
$snipPath  = (($modx->insideManager())? "../":"");
$snipPath .= "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}


# Snippet customize settings
$tpl		= isset($tpl)? $tpl:"";

# System settings
$isPostBack		= count($_POST) && isset($_POST[\'cmdwebchngpwd\']);

# Start processing
include_once $snipPath."weblogin/weblogin.common.inc.php";
include_once $snipPath."weblogin/webchangepwd.inc.php";

# Return
return $output;



';
$s['WebChangePwd'] = '# Created By Raymond Irving April, 2005
#::::::::::::::::::::::::::::::::::::::::
# Params:	
#
#	&tpl			- (Optional)
#		Chunk name or document id to use as a template
#				  
#	Note: Templats design:
#			section 1: change pwd template
#			section 2: notification template 
#
# Examples:
#
#	[[WebChangePwd? &tpl=`ChangePwd`]] 

# Set Snippet Paths 
$snipPath  = (($modx->insideManager())? "../":"");
$snipPath .= "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}


# Snippet customize settings
$tpl		= isset($tpl)? $tpl:"";

# System settings
$isPostBack		= count($_POST) && isset($_POST[\'cmdwebchngpwd\']);

# Start processing
include_once $snipPath."weblogin/weblogin.common.inc.php";
include_once $snipPath."weblogin/webchangepwd.inc.php";

# Return
return $output;



';
$s['WebChangePwd'] = '# Created By Raymond Irving April, 2005
#::::::::::::::::::::::::::::::::::::::::
# Params:	
#
#	&tpl			- (Optional)
#		Chunk name or document id to use as a template
#				  
#	Note: Templats design:
#			section 1: change pwd template
#			section 2: notification template 
#
# Examples:
#
#	[[WebChangePwd? &tpl=`ChangePwd`]] 

# Set Snippet Paths 
$snipPath  = (($modx->insideManager())? "../":"");
$snipPath .= "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}


# Snippet customize settings
$tpl		= isset($tpl)? $tpl:"";

# System settings
$isPostBack		= count($_POST) && isset($_POST[\'cmdwebchngpwd\']);

# Start processing
include_once $snipPath."weblogin/weblogin.common.inc.php";
include_once $snipPath."weblogin/webchangepwd.inc.php";

# Return
return $output;



';
$s['WebChangePwdProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['WebChangePwd'] = '# Created By Raymond Irving April, 2005
#::::::::::::::::::::::::::::::::::::::::
# Params:	
#
#	&tpl			- (Optional)
#		Chunk name or document id to use as a template
#				  
#	Note: Templats design:
#			section 1: change pwd template
#			section 2: notification template 
#
# Examples:
#
#	[[WebChangePwd? &tpl=`ChangePwd`]] 

# Set Snippet Paths 
$snipPath  = (($modx->insideManager())? "../":"");
$snipPath .= "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
	return \'\'; # don\'t go any further when inside manager
}


# Snippet customize settings
$tpl		= isset($tpl)? $tpl:"";

# System settings
$isPostBack		= count($_POST) && isset($_POST[\'cmdwebchngpwd\']);

# Start processing
include_once $snipPath."weblogin/weblogin.common.inc.php";
include_once $snipPath."weblogin/webchangepwd.inc.php";

# Return
return $output;



';
$s['DocInfo'] = '/* 
	*	Returns any document field or template variable from any document
	*	[[DocInfo? &docid=`15` &field=`pagetitle`]] - Для стандартных полей ресурса
	*	[[DocInfo? &docid=`10` &tv=`1` &field=`tvname`]] - Для TV-параметров ресурса добавляем &tv=`1`
	*/
$docid = (isset($docid) && (int)$docid>0) ? (int)$docid : $modx->documentIdentifier;
$field = (isset($field)) ? $field : \'pagetitle\';
$output=\'\';
if(isset($tv) && $tv==1){
   $tv=$modx->getTemplateVar($field,\'*\',$docid,1);
   if($tv[\'value\']!=\'\'){
      $output=$tv[\'value\'];
   }else{
      $output=$tv[\'defaultText\'];
   }
}else{
   $doc=$modx->getPageInfo($docid,\'1\',$field);
   $output=$doc[$field];
}
return $output;';
$s['DocInfo'] = '/* 
	*	Returns any document field or template variable from any document
	*	[[DocInfo? &docid=`15` &field=`pagetitle`]] - Для стандартных полей ресурса
	*	[[DocInfo? &docid=`10` &tv=`1` &field=`tvname`]] - Для TV-параметров ресурса добавляем &tv=`1`
	*/
$docid = (isset($docid) && (int)$docid>0) ? (int)$docid : $modx->documentIdentifier;
$field = (isset($field)) ? $field : \'pagetitle\';
$output=\'\';
if(isset($tv) && $tv==1){
   $tv=$modx->getTemplateVar($field,\'*\',$docid,1);
   if($tv[\'value\']!=\'\'){
      $output=$tv[\'value\'];
   }else{
      $output=$tv[\'defaultText\'];
   }
}else{
   $doc=$modx->getPageInfo($docid,\'1\',$field);
   $output=$doc[$field];
}
return $output;';
$s['DocInfo'] = '/* 
	*	Returns any document field or template variable from any document
	*	[[DocInfo? &docid=`15` &field=`pagetitle`]] - Для стандартных полей ресурса
	*	[[DocInfo? &docid=`10` &tv=`1` &field=`tvname`]] - Для TV-параметров ресурса добавляем &tv=`1`
	*/
$docid = (isset($docid) && (int)$docid>0) ? (int)$docid : $modx->documentIdentifier;
$field = (isset($field)) ? $field : \'pagetitle\';
$output=\'\';
if(isset($tv) && $tv==1){
   $tv=$modx->getTemplateVar($field,\'*\',$docid,1);
   if($tv[\'value\']!=\'\'){
      $output=$tv[\'value\'];
   }else{
      $output=$tv[\'defaultText\'];
   }
}else{
   $doc=$modx->getPageInfo($docid,\'1\',$field);
   $output=$doc[$field];
}
return $output;';
$s['DocInfoProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['DocInfo'] = '/* 
	*	Returns any document field or template variable from any document
	*	[[DocInfo? &docid=`15` &field=`pagetitle`]] - Для стандартных полей ресурса
	*	[[DocInfo? &docid=`10` &tv=`1` &field=`tvname`]] - Для TV-параметров ресурса добавляем &tv=`1`
	*/
$docid = (isset($docid) && (int)$docid>0) ? (int)$docid : $modx->documentIdentifier;
$field = (isset($field)) ? $field : \'pagetitle\';
$output=\'\';
if(isset($tv) && $tv==1){
   $tv=$modx->getTemplateVar($field,\'*\',$docid,1);
   if($tv[\'value\']!=\'\'){
      $output=$tv[\'value\'];
   }else{
      $output=$tv[\'defaultText\'];
   }
}else{
   $doc=$modx->getPageInfo($docid,\'1\',$field);
   $output=$doc[$field];
}
return $output;';
$s['FirstChildRedirect'] = '/*
 * @name FirstChildRedirect
 * @author Jason Coward <jason@opengeek.com>
 * @modified-by Ryan Thrash <ryan@vertexworks.com>
 * @license Public Domain
 * @version 1.0
 * 
 * This snippet redirects to the first child document of a folder in which this
 * snippet is included within the content (e.g. [!FirstChildRedirect!]).  This
 * allows MODx folders to emulate the behavior of real folders since MODx
 * usually treats folders as actual documents with their own content.
 * 
 * Modified to make Doc ID a required parameter... now defaults to the current 
 * Page/Folder you call the snippet from.
 * 
 * &docid=`12` 
 * Use the docid parameter to have this snippet redirect to the
 * first child document of the specified document.
 */

$docid = (isset($docid))? $docid: $modx->documentIdentifier;

$children= $modx->getActiveChildren($docid, \'menuindex\', \'ASC\');
if (!$children === false) {
    $firstChild= $children[0];
    $firstChildUrl= $modx->makeUrl($firstChild[\'id\']);
} else {
    $firstChildUrl= $modx->makeUrl($modx->config[\'site_start\']);
}
// return $modx->sendRedirect($firstChildUrl);
return $modx->sendRedirect($firstChildUrl,0,\'REDIRECT_HEADER\',\'HTTP/1.1 301 Moved Permanently\');
';
$s['FirstChildRedirect'] = '/*
 * @name FirstChildRedirect
 * @author Jason Coward <jason@opengeek.com>
 * @modified-by Ryan Thrash <ryan@vertexworks.com>
 * @license Public Domain
 * @version 1.0
 * 
 * This snippet redirects to the first child document of a folder in which this
 * snippet is included within the content (e.g. [!FirstChildRedirect!]).  This
 * allows MODx folders to emulate the behavior of real folders since MODx
 * usually treats folders as actual documents with their own content.
 * 
 * Modified to make Doc ID a required parameter... now defaults to the current 
 * Page/Folder you call the snippet from.
 * 
 * &docid=`12` 
 * Use the docid parameter to have this snippet redirect to the
 * first child document of the specified document.
 */

$docid = (isset($docid))? $docid: $modx->documentIdentifier;

$children= $modx->getActiveChildren($docid, \'menuindex\', \'ASC\');
if (!$children === false) {
    $firstChild= $children[0];
    $firstChildUrl= $modx->makeUrl($firstChild[\'id\']);
} else {
    $firstChildUrl= $modx->makeUrl($modx->config[\'site_start\']);
}
// return $modx->sendRedirect($firstChildUrl);
return $modx->sendRedirect($firstChildUrl,0,\'REDIRECT_HEADER\',\'HTTP/1.1 301 Moved Permanently\');
';
$s['FirstChildRedirect'] = '/*
 * @name FirstChildRedirect
 * @author Jason Coward <jason@opengeek.com>
 * @modified-by Ryan Thrash <ryan@vertexworks.com>
 * @license Public Domain
 * @version 1.0
 * 
 * This snippet redirects to the first child document of a folder in which this
 * snippet is included within the content (e.g. [!FirstChildRedirect!]).  This
 * allows MODx folders to emulate the behavior of real folders since MODx
 * usually treats folders as actual documents with their own content.
 * 
 * Modified to make Doc ID a required parameter... now defaults to the current 
 * Page/Folder you call the snippet from.
 * 
 * &docid=`12` 
 * Use the docid parameter to have this snippet redirect to the
 * first child document of the specified document.
 */

$docid = (isset($docid))? $docid: $modx->documentIdentifier;

$children= $modx->getActiveChildren($docid, \'menuindex\', \'ASC\');
if (!$children === false) {
    $firstChild= $children[0];
    $firstChildUrl= $modx->makeUrl($firstChild[\'id\']);
} else {
    $firstChildUrl= $modx->makeUrl($modx->config[\'site_start\']);
}
// return $modx->sendRedirect($firstChildUrl);
return $modx->sendRedirect($firstChildUrl,0,\'REDIRECT_HEADER\',\'HTTP/1.1 301 Moved Permanently\');
';
$s['FirstChildRedirectProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['FirstChildRedirect'] = '/*
 * @name FirstChildRedirect
 * @author Jason Coward <jason@opengeek.com>
 * @modified-by Ryan Thrash <ryan@vertexworks.com>
 * @license Public Domain
 * @version 1.0
 * 
 * This snippet redirects to the first child document of a folder in which this
 * snippet is included within the content (e.g. [!FirstChildRedirect!]).  This
 * allows MODx folders to emulate the behavior of real folders since MODx
 * usually treats folders as actual documents with their own content.
 * 
 * Modified to make Doc ID a required parameter... now defaults to the current 
 * Page/Folder you call the snippet from.
 * 
 * &docid=`12` 
 * Use the docid parameter to have this snippet redirect to the
 * first child document of the specified document.
 */

$docid = (isset($docid))? $docid: $modx->documentIdentifier;

$children= $modx->getActiveChildren($docid, \'menuindex\', \'ASC\');
if (!$children === false) {
    $firstChild= $children[0];
    $firstChildUrl= $modx->makeUrl($firstChild[\'id\']);
} else {
    $firstChildUrl= $modx->makeUrl($modx->config[\'site_start\']);
}
// return $modx->sendRedirect($firstChildUrl);
return $modx->sendRedirect($firstChildUrl,0,\'REDIRECT_HEADER\',\'HTTP/1.1 301 Moved Permanently\');
';
$s['WebSignup'] = '# Created By Raymond Irving April, 2005
#::::::::::::::::::::::::::::::::::::::::
# Usage:     
#    Allows a web user to signup for a new web account from the website
#    This snippet provides a basic set of form fields for the signup form
#    You can customize this snippet to create your own signup form
#
# Params:    
#
#    &tpl        - (Optional) Chunk name or document id to use as a template
#    &groups     - Web users groups to be assigned to users
#    &useCaptcha - (Optional) Determine to use (1) or not to use (0) captcha
#                  on signup form - if not defined, will default to system
#                  setting. GD is required for this feature. If GD is not 
#                  available, useCaptcha will automatically be set to false;
#                  
#    Note: Templats design:
#        section 1: signup template
#        section 2: notification template 
#
# Examples:
#
#    [[WebSignup? &tpl=`SignupForm` &groups=`NewsReaders,WebUsers`]] 

# Set Snippet Paths 
$snipPath = $modx->config[\'base_path\'] . "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
    return \'\'; # don\'t go any further when inside manager
}


# Snippet customize settings
$tpl = isset($tpl)? $tpl:"";
$useCaptcha = isset($useCaptcha)? $useCaptcha : $modx->config[\'use_captcha\'] ;
// Override captcha if no GD
if ($useCaptcha && !gd_info()) $useCaptcha = 0;

if(!isset($alerttpl)) $alerttpl = \'\';

# setup web groups
$groups = isset($groups) ? explode(\',\',$groups):array();
for($i=0;$i<count($groups);$i++) $groups[$i] = trim($groups[$i]);

# System settings
$isPostBack        = count($_POST) && isset($_POST[\'cmdwebsignup\']);

$output = \'\';

# Start processing
require $snipPath."weblogin/lang/russian-UTF-8.php";
require_once $snipPath."weblogin/weblogin.common.inc.php";
require_once $snipPath."weblogin/websignup.inc.php";

# Return
return $output;';
$s['WebSignupProps'] = '&tpl=Template;string; ';
$s['WebSignup'] = '# Created By Raymond Irving April, 2005
#::::::::::::::::::::::::::::::::::::::::
# Usage:     
#    Allows a web user to signup for a new web account from the website
#    This snippet provides a basic set of form fields for the signup form
#    You can customize this snippet to create your own signup form
#
# Params:    
#
#    &tpl        - (Optional) Chunk name or document id to use as a template
#    &groups     - Web users groups to be assigned to users
#    &useCaptcha - (Optional) Determine to use (1) or not to use (0) captcha
#                  on signup form - if not defined, will default to system
#                  setting. GD is required for this feature. If GD is not 
#                  available, useCaptcha will automatically be set to false;
#                  
#    Note: Templats design:
#        section 1: signup template
#        section 2: notification template 
#
# Examples:
#
#    [[WebSignup? &tpl=`SignupForm` &groups=`NewsReaders,WebUsers`]] 

# Set Snippet Paths 
$snipPath = $modx->config[\'base_path\'] . "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
    return \'\'; # don\'t go any further when inside manager
}


# Snippet customize settings
$tpl = isset($tpl)? $tpl:"";
$useCaptcha = isset($useCaptcha)? $useCaptcha : $modx->config[\'use_captcha\'] ;
// Override captcha if no GD
if ($useCaptcha && !gd_info()) $useCaptcha = 0;

if(!isset($alerttpl)) $alerttpl = \'\';

# setup web groups
$groups = isset($groups) ? explode(\',\',$groups):array();
for($i=0;$i<count($groups);$i++) $groups[$i] = trim($groups[$i]);

# System settings
$isPostBack        = count($_POST) && isset($_POST[\'cmdwebsignup\']);

$output = \'\';

# Start processing
require $snipPath."weblogin/lang/russian-UTF-8.php";
require_once $snipPath."weblogin/weblogin.common.inc.php";
require_once $snipPath."weblogin/websignup.inc.php";

# Return
return $output;';
$s['WebSignupProps'] = '&tpl=Template;string; ';
$s['WebSignup'] = '# Created By Raymond Irving April, 2005
#::::::::::::::::::::::::::::::::::::::::
# Usage:     
#    Allows a web user to signup for a new web account from the website
#    This snippet provides a basic set of form fields for the signup form
#    You can customize this snippet to create your own signup form
#
# Params:    
#
#    &tpl        - (Optional) Chunk name or document id to use as a template
#    &groups     - Web users groups to be assigned to users
#    &useCaptcha - (Optional) Determine to use (1) or not to use (0) captcha
#                  on signup form - if not defined, will default to system
#                  setting. GD is required for this feature. If GD is not 
#                  available, useCaptcha will automatically be set to false;
#                  
#    Note: Templats design:
#        section 1: signup template
#        section 2: notification template 
#
# Examples:
#
#    [[WebSignup? &tpl=`SignupForm` &groups=`NewsReaders,WebUsers`]] 

# Set Snippet Paths 
$snipPath = $modx->config[\'base_path\'] . "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
    return \'\'; # don\'t go any further when inside manager
}


# Snippet customize settings
$tpl = isset($tpl)? $tpl:"";
$useCaptcha = isset($useCaptcha)? $useCaptcha : $modx->config[\'use_captcha\'] ;
// Override captcha if no GD
if ($useCaptcha && !gd_info()) $useCaptcha = 0;

if(!isset($alerttpl)) $alerttpl = \'\';

# setup web groups
$groups = isset($groups) ? explode(\',\',$groups):array();
for($i=0;$i<count($groups);$i++) $groups[$i] = trim($groups[$i]);

# System settings
$isPostBack        = count($_POST) && isset($_POST[\'cmdwebsignup\']);

$output = \'\';

# Start processing
require $snipPath."weblogin/lang/russian-UTF-8.php";
require_once $snipPath."weblogin/weblogin.common.inc.php";
require_once $snipPath."weblogin/websignup.inc.php";

# Return
return $output;';
$s['WebSignupProps'] = '&tpl=Template;string; &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['WebSignup'] = '# Created By Raymond Irving April, 2005
#::::::::::::::::::::::::::::::::::::::::
# Usage:     
#    Allows a web user to signup for a new web account from the website
#    This snippet provides a basic set of form fields for the signup form
#    You can customize this snippet to create your own signup form
#
# Params:    
#
#    &tpl        - (Optional) Chunk name or document id to use as a template
#    &groups     - Web users groups to be assigned to users
#    &useCaptcha - (Optional) Determine to use (1) or not to use (0) captcha
#                  on signup form - if not defined, will default to system
#                  setting. GD is required for this feature. If GD is not 
#                  available, useCaptcha will automatically be set to false;
#                  
#    Note: Templats design:
#        section 1: signup template
#        section 2: notification template 
#
# Examples:
#
#    [[WebSignup? &tpl=`SignupForm` &groups=`NewsReaders,WebUsers`]] 

# Set Snippet Paths 
$snipPath = $modx->config[\'base_path\'] . "assets/snippets/";

# check if inside manager
if ($m = $modx->insideManager()) {
    return \'\'; # don\'t go any further when inside manager
}


# Snippet customize settings
$tpl = isset($tpl)? $tpl:"";
$useCaptcha = isset($useCaptcha)? $useCaptcha : $modx->config[\'use_captcha\'] ;
// Override captcha if no GD
if ($useCaptcha && !gd_info()) $useCaptcha = 0;

if(!isset($alerttpl)) $alerttpl = \'\';

# setup web groups
$groups = isset($groups) ? explode(\',\',$groups):array();
for($i=0;$i<count($groups);$i++) $groups[$i] = trim($groups[$i]);

# System settings
$isPostBack        = count($_POST) && isset($_POST[\'cmdwebsignup\']);

$output = \'\';

# Start processing
require $snipPath."weblogin/lang/russian-UTF-8.php";
require_once $snipPath."weblogin/weblogin.common.inc.php";
require_once $snipPath."weblogin/websignup.inc.php";

# Return
return $output;';
$s['WebSignupProps'] = '&tpl=Template;string; ';
$s['ajaxSubmit'] = 'return require MODX_BASE_PATH.\'assets/plugins/ajax_submit/ajax_submit.inc.php\';
';
$s['ajaxSubmit'] = 'return require MODX_BASE_PATH.\'assets/plugins/ajax_submit/ajax_submit.inc.php\';
';
$s['ajaxSubmit'] = 'return require MODX_BASE_PATH.\'assets/plugins/ajax_submit/ajax_submit.inc.php\';
';
$s['ajaxSubmitProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['ajaxSubmit'] = 'return require MODX_BASE_PATH.\'assets/plugins/ajax_submit/ajax_submit.inc.php\';
';
$s['CacheAccelerator'] = '//Функция сравнения. Работает в соответствии с функцией сравнения Ditto
if(!function_exists(\'cacheFieldsCompare\')) {
    function cacheFieldsCompare ($param1, $param2, $param3){
/*
1 or != Не равно
2 or =  Равно
3 or <  Меньше чем 
4 or >  Больше чем
5 or <= Меньше чем или равно
6 or >= Больше чем или равно
7   Содержит
8   Не содержит
*/
        switch($param3){
           case 1:
              return $param1 != $param2;
              break;
           case 2:
              return $param1 == $param2;
              break; 
           case 3:
              return $param1 < $param2;
              break; 
           case 4:
              return $param1 > $param2;
              break; 
           case 5:
              return $param1 <= $param2;
              break;
           case 6:
              return $param1 >= $param2;
              break;
           case 7:
              return stristr($param1, $param2);
              break;
           case 8:
              return !stristr($param1, $param2);   
        }  
    }
}


if(!function_exists(\'isUserRole\')){
  function isUserRole($array){
      $output = false;
      if(!isset($_SESSION[\'mgrPermissions\'][\'name\'])) return $output;
      $userRole = $_SESSION[\'mgrPermissions\'][\'name\'];
      foreach($array as $val){
          if($userRole == $val){
            $output = true;
            break;
          }
      }
      return $output;
  }
}

$snippetToCache = isset($snippetToCache) ? $snippetToCache : null;
$noHead = isset($noHead) ? $noHead : 0;
$nocache = isset($nocache)? $nocache : 0; //флаг необходимости сброса кеша
$checkURL = isset($checkURL) ? $checkURL : true;
$logMessages = isset($logMessages) ? $logMessages : false;
$cacheId = isset($cacheId) ? $cacheId : \'myCache\';
$url = $_SERVER["REQUEST_URI"]; //текущий урл, включается в ключ для кеширования
$cacheKey = $checkURL ? $cacheId.$url : $cacheId;
$path_to_cacheengine=$modx->config[\'base_path\']."assets/plugins/cacheaccelerator/"; //путь к директории с CacheAccelerator
$path_to_cache=$modx->config[\'base_path\']."assets/plugins/cacheaccelerator/cache/"; //путь к директории для хранения кеша (может быть произвольым)
require_once ($path_to_cacheengine."fileCache.php"); //запрос класса fileCache
$cache = fileCache::GetInstance(84600*7,$path_to_cache);//создание инстанции класса fileCache
$cacheId = isset($cacheId) ? $cacheId : $modx->documentIdentifier; //проверка cacheId, если нет, то ID страницы
$tmp = explode(\':\', $cacheId); //извлечение группы из cacheId
if(isset($tmp[1])){
    $cacheId = trim($tmp[1]);
    $cacheGroup = trim($tmp[0]);
} else 
    $cacheGroup = \'default\';
if(isset($dropCacheGroups) && $dropCacheGroups != \'all\'){ //создание списка групп для сброса по условию
    $dropCacheGroups = trim(preg_replace(\'|\\\\s*(?:\'.preg_quote(\',\').\')\\\\s*|\', \',\', $dropCacheGroups));
    $dropCacheGroups = explode(",", $dropCacheGroups);
} else
    $dropCacheGroups = null;

//обработка флага принудительной очистки кеша
if((int)$clearCache){
    if($logMessages) echo("Clearing cache...");
    $cache->deleteCache(0, $dropCacheGroups);
    return;
}

//обработка групп пользователей и ролей менеджеров, для которых кеширование не производится (администраторы сайта, модераторы и тд)
$noCacheGroups = isset($noCacheGroups) ? $noCacheGroups : "";
$noCacheRoles = isset($noCacheRoles) ? $noCacheRoles : "";
if($noCacheGroups) $nocache = $modx->isMemberOfWebGroup(explode("||",$noCacheGroups)) ? 2 : $nocache;
if($noCacheRoles) 
    $nocache = isUserRole(explode("||",$noCacheRoles)) ? 2 : $nocache;
else
    $nocache = $modx->checkSession() ? 2 : $nocache;


if($nocache == 2){
       if($logMessages) echo("No caching for this web group.");
}

/* обработка стоп-полей, дающих сигнал на сброс кеша. в случае совпадения условий, кеш сбрасывается */
if(isset($dropCacheField)){
    $fieldsArray = explode("||", $dropCacheField);
    foreach ($fieldsArray as $field){
//        $field1a = explode(",", $field); //поддержка разделителя \',\'
        $field1 = explode(";", $field); 
//        if(count($field1a) > count($field1))
//            $field1 = $field1a;
        if($field1[1] && $field[2]){
          if(empty($field1[0])){
             foreach ($_POST as $key => $postField){ 
                  if(cacheFieldsCompare($postField, $field1[1], $field1[2])){
                     $nocache = 1;
                     continue; 
                  } 
             }
             foreach ($_GET as $key => $getField){
                  if(cacheFieldsCompare($getField, $field1[1], $field1[2])){
                     $nocache = 1;
                     continue;
                  }            
             }   
          } else {  
              if(!empty($_POST[$field1[0]])){
                  if(cacheFieldsCompare($_POST[$field1[0]], $field1[1], $field1[2])){
                     $nocache = 1;
                     continue; 
                  } 
              }
              if(!empty($_GET[$field1[0]])){
                  if(cacheFieldsCompare($_GET[$field1[0]], $field1[1], $field1[2])){
                     $nocache = 1;
                     continue;
                  } 
              } 
          }      
        } else {
           if(!empty($_POST[$field1[0]]) || !empty($_GET[$field1[0]]))
              $nocache = 1;
        }   
    }    

//непосредственно сброс кеша при совпадении условий
    if($nocache == 1){
        if($logMessages) echo("<b>Clearing cache...</b>");
        $cache->deleteCache(0, $dropCacheGroups);
    }  
}
if(is_null($snippetToCache)) //возвращаемся, если не указан snippetToCache
    return \'\';

//запрос результата работы сниппета из кеша
if($nocache == 0){
    $cached = $cache->cache($cacheId.$url, $cacheGroup);
    if(isset($cached)){
        if($logMessages) echo("<b>Cache hit!</b>");
        $this->placeholders = array_merge($this->placeholders, $cached[\'placeholders\']); //установка плейсхолдеров закешированного сниппета
//        $modx->placeholders = $cached[\'placeholders\']; 
        //регистрирование скриптов и css
        if($cached[\'head\']){
            end($cached[\'head\'][0]);
            end($cached[\'head\'][1]);
            do {
                $tmp = current($cached[\'head\'][0]);
                $modx->regClientScript(key($cached[\'head\'][0]), $tmp, $tmp[\'startup\'] == 1 ? true : false);
                end($modx->sjscripts);
                $modx->sjscripts[key($modx->sjscripts)] = current($cached[\'head\'][1]);
                prev($cached[\'head\'][1]);
            } while (prev($cached[\'head\'][0]) !== false);
        }
        return $cached[\'content\']; //возврат результата работы сниппета из кеша
    }
} 

//парсинг зарегистрированных скриптов и css
if(!empty($modx->loadedjscripts) && !$noHead){
    end($modx->loadedjscripts);
    $lastHeadKey = key($modx->loadedjscripts);
} else
    $lastHeadKey = \'\';
$output = $modx->runSnippet($snippetToCache, $modx->event->params); //непосредственное выолнение сниппета с передачей всех параметров
$head = array(array(), array());
if(!empty($modx->loadedjscripts) && !$noHead){
    if(end($modx->loadedjscripts) !== false){
        end($modx->sjscripts);
        do{
            $tmp = key($modx->loadedjscripts);
            if($tmp != $lastHeadKey){
                $head[0][$tmp] = current($modx->loadedjscripts);
                $head[1][key($modx->sjscripts)] = current($modx->sjscripts);
            } else
                break;
            prev($modx->sjscripts);
        } while (prev($modx->loadedjscripts) !== false);
    }
}
if(!count($head[0]))
    $head = null;

//помещение в кеш результата работы сниппета
if($nocache == 0){
    if($logMessages) echo("Storing to cache...");
    $cache->cache($cacheId.$url, $cacheGroup, array(\'placeholders\' => $modx->placeholders, \'head\' => $head, \'content\' => $output));
}
//возвращение результата работы сниппета в парсер MODx
return($output);';
$s['CacheAccelerator'] = '//Функция сравнения. Работает в соответствии с функцией сравнения Ditto
if(!function_exists(\'cacheFieldsCompare\')) {
    function cacheFieldsCompare ($param1, $param2, $param3){
/*
1 or != Не равно
2 or =  Равно
3 or <  Меньше чем 
4 or >  Больше чем
5 or <= Меньше чем или равно
6 or >= Больше чем или равно
7   Содержит
8   Не содержит
*/
        switch($param3){
           case 1:
              return $param1 != $param2;
              break;
           case 2:
              return $param1 == $param2;
              break; 
           case 3:
              return $param1 < $param2;
              break; 
           case 4:
              return $param1 > $param2;
              break; 
           case 5:
              return $param1 <= $param2;
              break;
           case 6:
              return $param1 >= $param2;
              break;
           case 7:
              return stristr($param1, $param2);
              break;
           case 8:
              return !stristr($param1, $param2);   
        }  
    }
}


if(!function_exists(\'isUserRole\')){
  function isUserRole($array){
      $output = false;
      if(!isset($_SESSION[\'mgrPermissions\'][\'name\'])) return $output;
      $userRole = $_SESSION[\'mgrPermissions\'][\'name\'];
      foreach($array as $val){
          if($userRole == $val){
            $output = true;
            break;
          }
      }
      return $output;
  }
}

$snippetToCache = isset($snippetToCache) ? $snippetToCache : null;
$noHead = isset($noHead) ? $noHead : 0;
$nocache = isset($nocache)? $nocache : 0; //флаг необходимости сброса кеша
$checkURL = isset($checkURL) ? $checkURL : true;
$logMessages = isset($logMessages) ? $logMessages : false;
$cacheId = isset($cacheId) ? $cacheId : \'myCache\';
$url = $_SERVER["REQUEST_URI"]; //текущий урл, включается в ключ для кеширования
$cacheKey = $checkURL ? $cacheId.$url : $cacheId;
$path_to_cacheengine=$modx->config[\'base_path\']."assets/plugins/cacheaccelerator/"; //путь к директории с CacheAccelerator
$path_to_cache=$modx->config[\'base_path\']."assets/plugins/cacheaccelerator/cache/"; //путь к директории для хранения кеша (может быть произвольым)
require_once ($path_to_cacheengine."fileCache.php"); //запрос класса fileCache
$cache = fileCache::GetInstance(84600*7,$path_to_cache);//создание инстанции класса fileCache
$cacheId = isset($cacheId) ? $cacheId : $modx->documentIdentifier; //проверка cacheId, если нет, то ID страницы
$tmp = explode(\':\', $cacheId); //извлечение группы из cacheId
if(isset($tmp[1])){
    $cacheId = trim($tmp[1]);
    $cacheGroup = trim($tmp[0]);
} else 
    $cacheGroup = \'default\';
if(isset($dropCacheGroups) && $dropCacheGroups != \'all\'){ //создание списка групп для сброса по условию
    $dropCacheGroups = trim(preg_replace(\'|\\\\s*(?:\'.preg_quote(\',\').\')\\\\s*|\', \',\', $dropCacheGroups));
    $dropCacheGroups = explode(",", $dropCacheGroups);
} else
    $dropCacheGroups = null;

//обработка флага принудительной очистки кеша
if((int)$clearCache){
    if($logMessages) echo("Clearing cache...");
    $cache->deleteCache(0, $dropCacheGroups);
    return;
}

//обработка групп пользователей и ролей менеджеров, для которых кеширование не производится (администраторы сайта, модераторы и тд)
$noCacheGroups = isset($noCacheGroups) ? $noCacheGroups : "";
$noCacheRoles = isset($noCacheRoles) ? $noCacheRoles : "";
if($noCacheGroups) $nocache = $modx->isMemberOfWebGroup(explode("||",$noCacheGroups)) ? 2 : $nocache;
if($noCacheRoles) 
    $nocache = isUserRole(explode("||",$noCacheRoles)) ? 2 : $nocache;
else
    $nocache = $modx->checkSession() ? 2 : $nocache;


if($nocache == 2){
       if($logMessages) echo("No caching for this web group.");
}

/* обработка стоп-полей, дающих сигнал на сброс кеша. в случае совпадения условий, кеш сбрасывается */
if(isset($dropCacheField)){
    $fieldsArray = explode("||", $dropCacheField);
    foreach ($fieldsArray as $field){
//        $field1a = explode(",", $field); //поддержка разделителя \',\'
        $field1 = explode(";", $field); 
//        if(count($field1a) > count($field1))
//            $field1 = $field1a;
        if($field1[1] && $field[2]){
          if(empty($field1[0])){
             foreach ($_POST as $key => $postField){ 
                  if(cacheFieldsCompare($postField, $field1[1], $field1[2])){
                     $nocache = 1;
                     continue; 
                  } 
             }
             foreach ($_GET as $key => $getField){
                  if(cacheFieldsCompare($getField, $field1[1], $field1[2])){
                     $nocache = 1;
                     continue;
                  }            
             }   
          } else {  
              if(!empty($_POST[$field1[0]])){
                  if(cacheFieldsCompare($_POST[$field1[0]], $field1[1], $field1[2])){
                     $nocache = 1;
                     continue; 
                  } 
              }
              if(!empty($_GET[$field1[0]])){
                  if(cacheFieldsCompare($_GET[$field1[0]], $field1[1], $field1[2])){
                     $nocache = 1;
                     continue;
                  } 
              } 
          }      
        } else {
           if(!empty($_POST[$field1[0]]) || !empty($_GET[$field1[0]]))
              $nocache = 1;
        }   
    }    

//непосредственно сброс кеша при совпадении условий
    if($nocache == 1){
        if($logMessages) echo("<b>Clearing cache...</b>");
        $cache->deleteCache(0, $dropCacheGroups);
    }  
}
if(is_null($snippetToCache)) //возвращаемся, если не указан snippetToCache
    return \'\';

//запрос результата работы сниппета из кеша
if($nocache == 0){
    $cached = $cache->cache($cacheId.$url, $cacheGroup);
    if(isset($cached)){
        if($logMessages) echo("<b>Cache hit!</b>");
        $this->placeholders = array_merge($this->placeholders, $cached[\'placeholders\']); //установка плейсхолдеров закешированного сниппета
//        $modx->placeholders = $cached[\'placeholders\']; 
        //регистрирование скриптов и css
        if($cached[\'head\']){
            end($cached[\'head\'][0]);
            end($cached[\'head\'][1]);
            do {
                $tmp = current($cached[\'head\'][0]);
                $modx->regClientScript(key($cached[\'head\'][0]), $tmp, $tmp[\'startup\'] == 1 ? true : false);
                end($modx->sjscripts);
                $modx->sjscripts[key($modx->sjscripts)] = current($cached[\'head\'][1]);
                prev($cached[\'head\'][1]);
            } while (prev($cached[\'head\'][0]) !== false);
        }
        return $cached[\'content\']; //возврат результата работы сниппета из кеша
    }
} 

//парсинг зарегистрированных скриптов и css
if(!empty($modx->loadedjscripts) && !$noHead){
    end($modx->loadedjscripts);
    $lastHeadKey = key($modx->loadedjscripts);
} else
    $lastHeadKey = \'\';
$output = $modx->runSnippet($snippetToCache, $modx->event->params); //непосредственное выолнение сниппета с передачей всех параметров
$head = array(array(), array());
if(!empty($modx->loadedjscripts) && !$noHead){
    if(end($modx->loadedjscripts) !== false){
        end($modx->sjscripts);
        do{
            $tmp = key($modx->loadedjscripts);
            if($tmp != $lastHeadKey){
                $head[0][$tmp] = current($modx->loadedjscripts);
                $head[1][key($modx->sjscripts)] = current($modx->sjscripts);
            } else
                break;
            prev($modx->sjscripts);
        } while (prev($modx->loadedjscripts) !== false);
    }
}
if(!count($head[0]))
    $head = null;

//помещение в кеш результата работы сниппета
if($nocache == 0){
    if($logMessages) echo("Storing to cache...");
    $cache->cache($cacheId.$url, $cacheGroup, array(\'placeholders\' => $modx->placeholders, \'head\' => $head, \'content\' => $output));
}
//возвращение результата работы сниппета в парсер MODx
return($output);';
$s['CacheAccelerator'] = '//Функция сравнения. Работает в соответствии с функцией сравнения Ditto
if(!function_exists(\'cacheFieldsCompare\')) {
    function cacheFieldsCompare ($param1, $param2, $param3){
/*
1 or != Не равно
2 or =  Равно
3 or <  Меньше чем 
4 or >  Больше чем
5 or <= Меньше чем или равно
6 or >= Больше чем или равно
7   Содержит
8   Не содержит
*/
        switch($param3){
           case 1:
              return $param1 != $param2;
              break;
           case 2:
              return $param1 == $param2;
              break; 
           case 3:
              return $param1 < $param2;
              break; 
           case 4:
              return $param1 > $param2;
              break; 
           case 5:
              return $param1 <= $param2;
              break;
           case 6:
              return $param1 >= $param2;
              break;
           case 7:
              return stristr($param1, $param2);
              break;
           case 8:
              return !stristr($param1, $param2);   
        }  
    }
}


if(!function_exists(\'isUserRole\')){
  function isUserRole($array){
      $output = false;
      if(!isset($_SESSION[\'mgrPermissions\'][\'name\'])) return $output;
      $userRole = $_SESSION[\'mgrPermissions\'][\'name\'];
      foreach($array as $val){
          if($userRole == $val){
            $output = true;
            break;
          }
      }
      return $output;
  }
}

$snippetToCache = isset($snippetToCache) ? $snippetToCache : null;
$noHead = isset($noHead) ? $noHead : 0;
$nocache = isset($nocache)? $nocache : 0; //флаг необходимости сброса кеша
$checkURL = isset($checkURL) ? $checkURL : true;
$logMessages = isset($logMessages) ? $logMessages : false;
$cacheId = isset($cacheId) ? $cacheId : \'myCache\';
$url = $_SERVER["REQUEST_URI"]; //текущий урл, включается в ключ для кеширования
$cacheKey = $checkURL ? $cacheId.$url : $cacheId;
$path_to_cacheengine=$modx->config[\'base_path\']."assets/plugins/cacheaccelerator/"; //путь к директории с CacheAccelerator
$path_to_cache=$modx->config[\'base_path\']."assets/plugins/cacheaccelerator/cache/"; //путь к директории для хранения кеша (может быть произвольым)
require_once ($path_to_cacheengine."fileCache.php"); //запрос класса fileCache
$cache = fileCache::GetInstance(84600*7,$path_to_cache);//создание инстанции класса fileCache
$cacheId = isset($cacheId) ? $cacheId : $modx->documentIdentifier; //проверка cacheId, если нет, то ID страницы
$tmp = explode(\':\', $cacheId); //извлечение группы из cacheId
if(isset($tmp[1])){
    $cacheId = trim($tmp[1]);
    $cacheGroup = trim($tmp[0]);
} else 
    $cacheGroup = \'default\';
if(isset($dropCacheGroups) && $dropCacheGroups != \'all\'){ //создание списка групп для сброса по условию
    $dropCacheGroups = trim(preg_replace(\'|\\\\s*(?:\'.preg_quote(\',\').\')\\\\s*|\', \',\', $dropCacheGroups));
    $dropCacheGroups = explode(",", $dropCacheGroups);
} else
    $dropCacheGroups = null;

//обработка флага принудительной очистки кеша
if((int)$clearCache){
    if($logMessages) echo("Clearing cache...");
    $cache->deleteCache(0, $dropCacheGroups);
    return;
}

//обработка групп пользователей и ролей менеджеров, для которых кеширование не производится (администраторы сайта, модераторы и тд)
$noCacheGroups = isset($noCacheGroups) ? $noCacheGroups : "";
$noCacheRoles = isset($noCacheRoles) ? $noCacheRoles : "";
if($noCacheGroups) $nocache = $modx->isMemberOfWebGroup(explode("||",$noCacheGroups)) ? 2 : $nocache;
if($noCacheRoles) 
    $nocache = isUserRole(explode("||",$noCacheRoles)) ? 2 : $nocache;
else
    $nocache = $modx->checkSession() ? 2 : $nocache;


if($nocache == 2){
       if($logMessages) echo("No caching for this web group.");
}

/* обработка стоп-полей, дающих сигнал на сброс кеша. в случае совпадения условий, кеш сбрасывается */
if(isset($dropCacheField)){
    $fieldsArray = explode("||", $dropCacheField);
    foreach ($fieldsArray as $field){
//        $field1a = explode(",", $field); //поддержка разделителя \',\'
        $field1 = explode(";", $field); 
//        if(count($field1a) > count($field1))
//            $field1 = $field1a;
        if($field1[1] && $field[2]){
          if(empty($field1[0])){
             foreach ($_POST as $key => $postField){ 
                  if(cacheFieldsCompare($postField, $field1[1], $field1[2])){
                     $nocache = 1;
                     continue; 
                  } 
             }
             foreach ($_GET as $key => $getField){
                  if(cacheFieldsCompare($getField, $field1[1], $field1[2])){
                     $nocache = 1;
                     continue;
                  }            
             }   
          } else {  
              if(!empty($_POST[$field1[0]])){
                  if(cacheFieldsCompare($_POST[$field1[0]], $field1[1], $field1[2])){
                     $nocache = 1;
                     continue; 
                  } 
              }
              if(!empty($_GET[$field1[0]])){
                  if(cacheFieldsCompare($_GET[$field1[0]], $field1[1], $field1[2])){
                     $nocache = 1;
                     continue;
                  } 
              } 
          }      
        } else {
           if(!empty($_POST[$field1[0]]) || !empty($_GET[$field1[0]]))
              $nocache = 1;
        }   
    }    

//непосредственно сброс кеша при совпадении условий
    if($nocache == 1){
        if($logMessages) echo("<b>Clearing cache...</b>");
        $cache->deleteCache(0, $dropCacheGroups);
    }  
}
if(is_null($snippetToCache)) //возвращаемся, если не указан snippetToCache
    return \'\';

//запрос результата работы сниппета из кеша
if($nocache == 0){
    $cached = $cache->cache($cacheId.$url, $cacheGroup);
    if(isset($cached)){
        if($logMessages) echo("<b>Cache hit!</b>");
        $this->placeholders = array_merge($this->placeholders, $cached[\'placeholders\']); //установка плейсхолдеров закешированного сниппета
//        $modx->placeholders = $cached[\'placeholders\']; 
        //регистрирование скриптов и css
        if($cached[\'head\']){
            end($cached[\'head\'][0]);
            end($cached[\'head\'][1]);
            do {
                $tmp = current($cached[\'head\'][0]);
                $modx->regClientScript(key($cached[\'head\'][0]), $tmp, $tmp[\'startup\'] == 1 ? true : false);
                end($modx->sjscripts);
                $modx->sjscripts[key($modx->sjscripts)] = current($cached[\'head\'][1]);
                prev($cached[\'head\'][1]);
            } while (prev($cached[\'head\'][0]) !== false);
        }
        return $cached[\'content\']; //возврат результата работы сниппета из кеша
    }
} 

//парсинг зарегистрированных скриптов и css
if(!empty($modx->loadedjscripts) && !$noHead){
    end($modx->loadedjscripts);
    $lastHeadKey = key($modx->loadedjscripts);
} else
    $lastHeadKey = \'\';
$output = $modx->runSnippet($snippetToCache, $modx->event->params); //непосредственное выолнение сниппета с передачей всех параметров
$head = array(array(), array());
if(!empty($modx->loadedjscripts) && !$noHead){
    if(end($modx->loadedjscripts) !== false){
        end($modx->sjscripts);
        do{
            $tmp = key($modx->loadedjscripts);
            if($tmp != $lastHeadKey){
                $head[0][$tmp] = current($modx->loadedjscripts);
                $head[1][key($modx->sjscripts)] = current($modx->sjscripts);
            } else
                break;
            prev($modx->sjscripts);
        } while (prev($modx->loadedjscripts) !== false);
    }
}
if(!count($head[0]))
    $head = null;

//помещение в кеш результата работы сниппета
if($nocache == 0){
    if($logMessages) echo("Storing to cache...");
    $cache->cache($cacheId.$url, $cacheGroup, array(\'placeholders\' => $modx->placeholders, \'head\' => $head, \'content\' => $output));
}
//возвращение результата работы сниппета в парсер MODx
return($output);';
$s['CacheAcceleratorProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['CacheAccelerator'] = '//Функция сравнения. Работает в соответствии с функцией сравнения Ditto
if(!function_exists(\'cacheFieldsCompare\')) {
    function cacheFieldsCompare ($param1, $param2, $param3){
/*
1 or != Не равно
2 or =  Равно
3 or <  Меньше чем 
4 or >  Больше чем
5 or <= Меньше чем или равно
6 or >= Больше чем или равно
7   Содержит
8   Не содержит
*/
        switch($param3){
           case 1:
              return $param1 != $param2;
              break;
           case 2:
              return $param1 == $param2;
              break; 
           case 3:
              return $param1 < $param2;
              break; 
           case 4:
              return $param1 > $param2;
              break; 
           case 5:
              return $param1 <= $param2;
              break;
           case 6:
              return $param1 >= $param2;
              break;
           case 7:
              return stristr($param1, $param2);
              break;
           case 8:
              return !stristr($param1, $param2);   
        }  
    }
}


if(!function_exists(\'isUserRole\')){
  function isUserRole($array){
      $output = false;
      if(!isset($_SESSION[\'mgrPermissions\'][\'name\'])) return $output;
      $userRole = $_SESSION[\'mgrPermissions\'][\'name\'];
      foreach($array as $val){
          if($userRole == $val){
            $output = true;
            break;
          }
      }
      return $output;
  }
}

$snippetToCache = isset($snippetToCache) ? $snippetToCache : null;
$noHead = isset($noHead) ? $noHead : 0;
$nocache = isset($nocache)? $nocache : 0; //флаг необходимости сброса кеша
$checkURL = isset($checkURL) ? $checkURL : true;
$logMessages = isset($logMessages) ? $logMessages : false;
$cacheId = isset($cacheId) ? $cacheId : \'myCache\';
$url = $_SERVER["REQUEST_URI"]; //текущий урл, включается в ключ для кеширования
$cacheKey = $checkURL ? $cacheId.$url : $cacheId;
$path_to_cacheengine=$modx->config[\'base_path\']."assets/plugins/cacheaccelerator/"; //путь к директории с CacheAccelerator
$path_to_cache=$modx->config[\'base_path\']."assets/plugins/cacheaccelerator/cache/"; //путь к директории для хранения кеша (может быть произвольым)
require_once ($path_to_cacheengine."fileCache.php"); //запрос класса fileCache
$cache = fileCache::GetInstance(84600*7,$path_to_cache);//создание инстанции класса fileCache
$cacheId = isset($cacheId) ? $cacheId : $modx->documentIdentifier; //проверка cacheId, если нет, то ID страницы
$tmp = explode(\':\', $cacheId); //извлечение группы из cacheId
if(isset($tmp[1])){
    $cacheId = trim($tmp[1]);
    $cacheGroup = trim($tmp[0]);
} else 
    $cacheGroup = \'default\';
if(isset($dropCacheGroups) && $dropCacheGroups != \'all\'){ //создание списка групп для сброса по условию
    $dropCacheGroups = trim(preg_replace(\'|\\\\s*(?:\'.preg_quote(\',\').\')\\\\s*|\', \',\', $dropCacheGroups));
    $dropCacheGroups = explode(",", $dropCacheGroups);
} else
    $dropCacheGroups = null;

//обработка флага принудительной очистки кеша
if((int)$clearCache){
    if($logMessages) echo("Clearing cache...");
    $cache->deleteCache(0, $dropCacheGroups);
    return;
}

//обработка групп пользователей и ролей менеджеров, для которых кеширование не производится (администраторы сайта, модераторы и тд)
$noCacheGroups = isset($noCacheGroups) ? $noCacheGroups : "";
$noCacheRoles = isset($noCacheRoles) ? $noCacheRoles : "";
if($noCacheGroups) $nocache = $modx->isMemberOfWebGroup(explode("||",$noCacheGroups)) ? 2 : $nocache;
if($noCacheRoles) 
    $nocache = isUserRole(explode("||",$noCacheRoles)) ? 2 : $nocache;
else
    $nocache = $modx->checkSession() ? 2 : $nocache;


if($nocache == 2){
       if($logMessages) echo("No caching for this web group.");
}

/* обработка стоп-полей, дающих сигнал на сброс кеша. в случае совпадения условий, кеш сбрасывается */
if(isset($dropCacheField)){
    $fieldsArray = explode("||", $dropCacheField);
    foreach ($fieldsArray as $field){
//        $field1a = explode(",", $field); //поддержка разделителя \',\'
        $field1 = explode(";", $field); 
//        if(count($field1a) > count($field1))
//            $field1 = $field1a;
        if($field1[1] && $field[2]){
          if(empty($field1[0])){
             foreach ($_POST as $key => $postField){ 
                  if(cacheFieldsCompare($postField, $field1[1], $field1[2])){
                     $nocache = 1;
                     continue; 
                  } 
             }
             foreach ($_GET as $key => $getField){
                  if(cacheFieldsCompare($getField, $field1[1], $field1[2])){
                     $nocache = 1;
                     continue;
                  }            
             }   
          } else {  
              if(!empty($_POST[$field1[0]])){
                  if(cacheFieldsCompare($_POST[$field1[0]], $field1[1], $field1[2])){
                     $nocache = 1;
                     continue; 
                  } 
              }
              if(!empty($_GET[$field1[0]])){
                  if(cacheFieldsCompare($_GET[$field1[0]], $field1[1], $field1[2])){
                     $nocache = 1;
                     continue;
                  } 
              } 
          }      
        } else {
           if(!empty($_POST[$field1[0]]) || !empty($_GET[$field1[0]]))
              $nocache = 1;
        }   
    }    

//непосредственно сброс кеша при совпадении условий
    if($nocache == 1){
        if($logMessages) echo("<b>Clearing cache...</b>");
        $cache->deleteCache(0, $dropCacheGroups);
    }  
}
if(is_null($snippetToCache)) //возвращаемся, если не указан snippetToCache
    return \'\';

//запрос результата работы сниппета из кеша
if($nocache == 0){
    $cached = $cache->cache($cacheId.$url, $cacheGroup);
    if(isset($cached)){
        if($logMessages) echo("<b>Cache hit!</b>");
        $this->placeholders = array_merge($this->placeholders, $cached[\'placeholders\']); //установка плейсхолдеров закешированного сниппета
//        $modx->placeholders = $cached[\'placeholders\']; 
        //регистрирование скриптов и css
        if($cached[\'head\']){
            end($cached[\'head\'][0]);
            end($cached[\'head\'][1]);
            do {
                $tmp = current($cached[\'head\'][0]);
                $modx->regClientScript(key($cached[\'head\'][0]), $tmp, $tmp[\'startup\'] == 1 ? true : false);
                end($modx->sjscripts);
                $modx->sjscripts[key($modx->sjscripts)] = current($cached[\'head\'][1]);
                prev($cached[\'head\'][1]);
            } while (prev($cached[\'head\'][0]) !== false);
        }
        return $cached[\'content\']; //возврат результата работы сниппета из кеша
    }
} 

//парсинг зарегистрированных скриптов и css
if(!empty($modx->loadedjscripts) && !$noHead){
    end($modx->loadedjscripts);
    $lastHeadKey = key($modx->loadedjscripts);
} else
    $lastHeadKey = \'\';
$output = $modx->runSnippet($snippetToCache, $modx->event->params); //непосредственное выолнение сниппета с передачей всех параметров
$head = array(array(), array());
if(!empty($modx->loadedjscripts) && !$noHead){
    if(end($modx->loadedjscripts) !== false){
        end($modx->sjscripts);
        do{
            $tmp = key($modx->loadedjscripts);
            if($tmp != $lastHeadKey){
                $head[0][$tmp] = current($modx->loadedjscripts);
                $head[1][key($modx->sjscripts)] = current($modx->sjscripts);
            } else
                break;
            prev($modx->sjscripts);
        } while (prev($modx->loadedjscripts) !== false);
    }
}
if(!count($head[0]))
    $head = null;

//помещение в кеш результата работы сниппета
if($nocache == 0){
    if($logMessages) echo("Storing to cache...");
    $cache->cache($cacheId.$url, $cacheGroup, array(\'placeholders\' => $modx->placeholders, \'head\' => $head, \'content\' => $output));
}
//возвращение результата работы сниппета в парсер MODx
return($output);';
$s['JotX'] = 'if(!defined(\'MODX_BASE_PATH\')) die();
$jotPath = MODX_BASE_PATH . \'assets/snippets/jot/\';
$config = (isset($config)) ? $jotPath.\'configs/\'.$config.\'.config.php\' : $jotPath.\'configs/default.config.php\';
if (is_file($config)) include $config;
include_once($jotPath.\'jot.class.inc.php\');
if (!isset($action)) $action=\'default\';

$Jot = new CJot;
$Jot->Set("path",$jotPath);
$Jot->Set("action", $action);
$Jot->Set("postdelay", $postdelay);
$Jot->Set("docid", $docid);
$Jot->Set("tagid", $tagid);
$Jot->Set("docids", $docids);
$Jot->Set("tagids", $tagids);
$Jot->Set("userids", $userids);
$Jot->Set("subscribe", $subscribe);
$Jot->Set("subscriber", $subscriber);
$Jot->Set("moderated", $moderated);
$Jot->Set("captcha", $captcha);
$Jot->Set("badwords", $badwords);
$Jot->Set("bw", $bw);
$Jot->Set("sortby", $sortby);
$Jot->Set("numdir", $numdir);
$Jot->Set("customfields", $customfields);
$Jot->Set("guestname", $guestname);
$Jot->Set("canpost", $canpost);
$Jot->Set("canview", $canview);
$Jot->Set("canedit", $canedit);
$Jot->Set("canmoderate", $canmoderate);
$Jot->Set("trusted", $trusted);
$Jot->Set("pagination", $pagination);
$Jot->Set("placeholders", $placeholders);
$Jot->Set("subjectSubscribe", $subjectSubscribe);
$Jot->Set("subjectModerate", $subjectModerate);
$Jot->Set("subjectAuthor", $subjectAuthor);
$Jot->Set("subjectEmails", $subjectEmails);
$Jot->Set("notify", $notify);
$Jot->Set("notifyAuthor", $notifyAuthor);
$Jot->Set("notifyEmails", $notifyEmails);
$Jot->Set("validate", $validate);
$Jot->Set("title", $title);
$Jot->Set("authorid", $authorid);
$Jot->Set("css", $css);
$Jot->Set("cssFile", $cssFile);
$Jot->Set("cssRowAlt", $cssRowAlt);
$Jot->Set("cssRowMe", $cssRowMe);
$Jot->Set("cssRowAuthor", $cssRowAuthor);
$Jot->Set("js", $js);
$Jot->Set("jsFile", $jsFile);
$Jot->Set("tplForm", $tplForm);
$Jot->Set("tplComments", $tplComments);
$Jot->Set("tplModerate", $tplModerate);
$Jot->Set("tplNav", $tplNav);
$Jot->Set("tplNavPage", $tplNavPage);
$Jot->Set("tplNavPageCur", $tplNavPageCur);
$Jot->Set("tplNavPageSpl", $tplNavPageSpl);
$Jot->Set("tplNotify", $tplNotify);
$Jot->Set("tplNotifyModerator", $tplNotifyModerator);
$Jot->Set("tplNotifyAuthor", $tplNotifyAuthor);
$Jot->Set("tplNotifyEmails", $tplNotifyEmails);
$Jot->Set("tplSubscribe", $tplSubscribe);
$Jot->Set("debug", $debug);
$Jot->Set("output", $output);
$Jot->Set("upc", $upc);
$Jot->Set("limit", $limit);
$Jot->Set("depth", $depth);

//events
$Jot->Set("onBeforeConfiguration", $onBeforeConfiguration);
$Jot->Set("onBeforeRunActions", $onBeforeRunActions);
$Jot->Set("onRunActions", $onRunActions);
$Jot->Set("onConfiguration", $onConfiguration);
$Jot->Set("onBeforeFirstRun", $onBeforeFirstRun);
$Jot->Set("onFirstRun", $onFirstRun);
$Jot->Set("onSubscriptionCheck", $onSubscriptionCheck);
$Jot->Set("onDeleteComment", $onDeleteComment);
$Jot->Set("onGetCommentFields", $onGetCommentFields);
$Jot->Set("onBeforeSaveComment", $onBeforeSaveComment);
$Jot->Set("onSaveComment", $onSaveComment);
$Jot->Set("onGetSubscriptions", $onGetSubscriptions);
$Jot->Set("onBeforeGetSubscriptions", $onBeforeGetSubscriptions);
$Jot->Set("onBeforeGetUserInfo", $onBeforeGetUserInfo);
$Jot->Set("onBeforeNotify", $onBeforeNotify);
$Jot->Set("onBeforeSubscribe", $onBeforeSubscribe);
$Jot->Set("onBeforeUnsubscribe", $onBeforeUnsubscribe);
$Jot->Set("onBeforeValidateFormField", $onBeforeValidateFormField);
$Jot->Set("onValidateFormFieldFail", $onValidateFormFieldFail);
$Jot->Set("onBeforePOSTProcess", $onBeforePOSTProcess);
$Jot->Set("onProcessForm", $onProcessForm);
$Jot->Set("onBeforeProcessPassiveActions", $onBeforeProcessPassiveActions);
$Jot->Set("onProcessPassiveActions", $onProcessPassiveActions);
$Jot->Set("onBeforeGetUserPostCount", $onBeforeGetUserPostCount);
$Jot->Set("onBeforeGetCommentCount", $onBeforeGetCommentCount);
$Jot->Set("onBeforeGetComments", $onBeforeGetComments);
$Jot->Set("onGetComments", $onGetComments);
$Jot->Set("onReturnOutput", $onReturnOutput);
$Jot->Set("onSetDefaultOutput", $onSetDefaultOutput);
$Jot->Set("onSetFormOutput", $onSetFormOutput);
$Jot->Set("onSetCommentsOutput", $onSetCommentsOutput);

return $Jot->Run();
';
$s['JotX'] = 'if(!defined(\'MODX_BASE_PATH\')) die();
$jotPath = MODX_BASE_PATH . \'assets/snippets/jot/\';
$config = (isset($config)) ? $jotPath.\'configs/\'.$config.\'.config.php\' : $jotPath.\'configs/default.config.php\';
if (is_file($config)) include $config;
include_once($jotPath.\'jot.class.inc.php\');
if (!isset($action)) $action=\'default\';

$Jot = new CJot;
$Jot->Set("path",$jotPath);
$Jot->Set("action", $action);
$Jot->Set("postdelay", $postdelay);
$Jot->Set("docid", $docid);
$Jot->Set("tagid", $tagid);
$Jot->Set("docids", $docids);
$Jot->Set("tagids", $tagids);
$Jot->Set("userids", $userids);
$Jot->Set("subscribe", $subscribe);
$Jot->Set("subscriber", $subscriber);
$Jot->Set("moderated", $moderated);
$Jot->Set("captcha", $captcha);
$Jot->Set("badwords", $badwords);
$Jot->Set("bw", $bw);
$Jot->Set("sortby", $sortby);
$Jot->Set("numdir", $numdir);
$Jot->Set("customfields", $customfields);
$Jot->Set("guestname", $guestname);
$Jot->Set("canpost", $canpost);
$Jot->Set("canview", $canview);
$Jot->Set("canedit", $canedit);
$Jot->Set("canmoderate", $canmoderate);
$Jot->Set("trusted", $trusted);
$Jot->Set("pagination", $pagination);
$Jot->Set("placeholders", $placeholders);
$Jot->Set("subjectSubscribe", $subjectSubscribe);
$Jot->Set("subjectModerate", $subjectModerate);
$Jot->Set("subjectAuthor", $subjectAuthor);
$Jot->Set("subjectEmails", $subjectEmails);
$Jot->Set("notify", $notify);
$Jot->Set("notifyAuthor", $notifyAuthor);
$Jot->Set("notifyEmails", $notifyEmails);
$Jot->Set("validate", $validate);
$Jot->Set("title", $title);
$Jot->Set("authorid", $authorid);
$Jot->Set("css", $css);
$Jot->Set("cssFile", $cssFile);
$Jot->Set("cssRowAlt", $cssRowAlt);
$Jot->Set("cssRowMe", $cssRowMe);
$Jot->Set("cssRowAuthor", $cssRowAuthor);
$Jot->Set("js", $js);
$Jot->Set("jsFile", $jsFile);
$Jot->Set("tplForm", $tplForm);
$Jot->Set("tplComments", $tplComments);
$Jot->Set("tplModerate", $tplModerate);
$Jot->Set("tplNav", $tplNav);
$Jot->Set("tplNavPage", $tplNavPage);
$Jot->Set("tplNavPageCur", $tplNavPageCur);
$Jot->Set("tplNavPageSpl", $tplNavPageSpl);
$Jot->Set("tplNotify", $tplNotify);
$Jot->Set("tplNotifyModerator", $tplNotifyModerator);
$Jot->Set("tplNotifyAuthor", $tplNotifyAuthor);
$Jot->Set("tplNotifyEmails", $tplNotifyEmails);
$Jot->Set("tplSubscribe", $tplSubscribe);
$Jot->Set("debug", $debug);
$Jot->Set("output", $output);
$Jot->Set("upc", $upc);
$Jot->Set("limit", $limit);
$Jot->Set("depth", $depth);

//events
$Jot->Set("onBeforeConfiguration", $onBeforeConfiguration);
$Jot->Set("onBeforeRunActions", $onBeforeRunActions);
$Jot->Set("onRunActions", $onRunActions);
$Jot->Set("onConfiguration", $onConfiguration);
$Jot->Set("onBeforeFirstRun", $onBeforeFirstRun);
$Jot->Set("onFirstRun", $onFirstRun);
$Jot->Set("onSubscriptionCheck", $onSubscriptionCheck);
$Jot->Set("onDeleteComment", $onDeleteComment);
$Jot->Set("onGetCommentFields", $onGetCommentFields);
$Jot->Set("onBeforeSaveComment", $onBeforeSaveComment);
$Jot->Set("onSaveComment", $onSaveComment);
$Jot->Set("onGetSubscriptions", $onGetSubscriptions);
$Jot->Set("onBeforeGetSubscriptions", $onBeforeGetSubscriptions);
$Jot->Set("onBeforeGetUserInfo", $onBeforeGetUserInfo);
$Jot->Set("onBeforeNotify", $onBeforeNotify);
$Jot->Set("onBeforeSubscribe", $onBeforeSubscribe);
$Jot->Set("onBeforeUnsubscribe", $onBeforeUnsubscribe);
$Jot->Set("onBeforeValidateFormField", $onBeforeValidateFormField);
$Jot->Set("onValidateFormFieldFail", $onValidateFormFieldFail);
$Jot->Set("onBeforePOSTProcess", $onBeforePOSTProcess);
$Jot->Set("onProcessForm", $onProcessForm);
$Jot->Set("onBeforeProcessPassiveActions", $onBeforeProcessPassiveActions);
$Jot->Set("onProcessPassiveActions", $onProcessPassiveActions);
$Jot->Set("onBeforeGetUserPostCount", $onBeforeGetUserPostCount);
$Jot->Set("onBeforeGetCommentCount", $onBeforeGetCommentCount);
$Jot->Set("onBeforeGetComments", $onBeforeGetComments);
$Jot->Set("onGetComments", $onGetComments);
$Jot->Set("onReturnOutput", $onReturnOutput);
$Jot->Set("onSetDefaultOutput", $onSetDefaultOutput);
$Jot->Set("onSetFormOutput", $onSetFormOutput);
$Jot->Set("onSetCommentsOutput", $onSetCommentsOutput);

return $Jot->Run();
';
$s['JotX'] = 'if(!defined(\'MODX_BASE_PATH\')) die();
$jotPath = MODX_BASE_PATH . \'assets/snippets/jot/\';
$config = (isset($config)) ? $jotPath.\'configs/\'.$config.\'.config.php\' : $jotPath.\'configs/default.config.php\';
if (is_file($config)) include $config;
include_once($jotPath.\'jot.class.inc.php\');
if (!isset($action)) $action=\'default\';

$Jot = new CJot;
$Jot->Set("path",$jotPath);
$Jot->Set("action", $action);
$Jot->Set("postdelay", $postdelay);
$Jot->Set("docid", $docid);
$Jot->Set("tagid", $tagid);
$Jot->Set("docids", $docids);
$Jot->Set("tagids", $tagids);
$Jot->Set("userids", $userids);
$Jot->Set("subscribe", $subscribe);
$Jot->Set("subscriber", $subscriber);
$Jot->Set("moderated", $moderated);
$Jot->Set("captcha", $captcha);
$Jot->Set("badwords", $badwords);
$Jot->Set("bw", $bw);
$Jot->Set("sortby", $sortby);
$Jot->Set("numdir", $numdir);
$Jot->Set("customfields", $customfields);
$Jot->Set("guestname", $guestname);
$Jot->Set("canpost", $canpost);
$Jot->Set("canview", $canview);
$Jot->Set("canedit", $canedit);
$Jot->Set("canmoderate", $canmoderate);
$Jot->Set("trusted", $trusted);
$Jot->Set("pagination", $pagination);
$Jot->Set("placeholders", $placeholders);
$Jot->Set("subjectSubscribe", $subjectSubscribe);
$Jot->Set("subjectModerate", $subjectModerate);
$Jot->Set("subjectAuthor", $subjectAuthor);
$Jot->Set("subjectEmails", $subjectEmails);
$Jot->Set("notify", $notify);
$Jot->Set("notifyAuthor", $notifyAuthor);
$Jot->Set("notifyEmails", $notifyEmails);
$Jot->Set("validate", $validate);
$Jot->Set("title", $title);
$Jot->Set("authorid", $authorid);
$Jot->Set("css", $css);
$Jot->Set("cssFile", $cssFile);
$Jot->Set("cssRowAlt", $cssRowAlt);
$Jot->Set("cssRowMe", $cssRowMe);
$Jot->Set("cssRowAuthor", $cssRowAuthor);
$Jot->Set("js", $js);
$Jot->Set("jsFile", $jsFile);
$Jot->Set("tplForm", $tplForm);
$Jot->Set("tplComments", $tplComments);
$Jot->Set("tplModerate", $tplModerate);
$Jot->Set("tplNav", $tplNav);
$Jot->Set("tplNavPage", $tplNavPage);
$Jot->Set("tplNavPageCur", $tplNavPageCur);
$Jot->Set("tplNavPageSpl", $tplNavPageSpl);
$Jot->Set("tplNotify", $tplNotify);
$Jot->Set("tplNotifyModerator", $tplNotifyModerator);
$Jot->Set("tplNotifyAuthor", $tplNotifyAuthor);
$Jot->Set("tplNotifyEmails", $tplNotifyEmails);
$Jot->Set("tplSubscribe", $tplSubscribe);
$Jot->Set("debug", $debug);
$Jot->Set("output", $output);
$Jot->Set("upc", $upc);
$Jot->Set("limit", $limit);
$Jot->Set("depth", $depth);

//events
$Jot->Set("onBeforeConfiguration", $onBeforeConfiguration);
$Jot->Set("onBeforeRunActions", $onBeforeRunActions);
$Jot->Set("onRunActions", $onRunActions);
$Jot->Set("onConfiguration", $onConfiguration);
$Jot->Set("onBeforeFirstRun", $onBeforeFirstRun);
$Jot->Set("onFirstRun", $onFirstRun);
$Jot->Set("onSubscriptionCheck", $onSubscriptionCheck);
$Jot->Set("onDeleteComment", $onDeleteComment);
$Jot->Set("onGetCommentFields", $onGetCommentFields);
$Jot->Set("onBeforeSaveComment", $onBeforeSaveComment);
$Jot->Set("onSaveComment", $onSaveComment);
$Jot->Set("onGetSubscriptions", $onGetSubscriptions);
$Jot->Set("onBeforeGetSubscriptions", $onBeforeGetSubscriptions);
$Jot->Set("onBeforeGetUserInfo", $onBeforeGetUserInfo);
$Jot->Set("onBeforeNotify", $onBeforeNotify);
$Jot->Set("onBeforeSubscribe", $onBeforeSubscribe);
$Jot->Set("onBeforeUnsubscribe", $onBeforeUnsubscribe);
$Jot->Set("onBeforeValidateFormField", $onBeforeValidateFormField);
$Jot->Set("onValidateFormFieldFail", $onValidateFormFieldFail);
$Jot->Set("onBeforePOSTProcess", $onBeforePOSTProcess);
$Jot->Set("onProcessForm", $onProcessForm);
$Jot->Set("onBeforeProcessPassiveActions", $onBeforeProcessPassiveActions);
$Jot->Set("onProcessPassiveActions", $onProcessPassiveActions);
$Jot->Set("onBeforeGetUserPostCount", $onBeforeGetUserPostCount);
$Jot->Set("onBeforeGetCommentCount", $onBeforeGetCommentCount);
$Jot->Set("onBeforeGetComments", $onBeforeGetComments);
$Jot->Set("onGetComments", $onGetComments);
$Jot->Set("onReturnOutput", $onReturnOutput);
$Jot->Set("onSetDefaultOutput", $onSetDefaultOutput);
$Jot->Set("onSetFormOutput", $onSetFormOutput);
$Jot->Set("onSetCommentsOutput", $onSetCommentsOutput);

return $Jot->Run();
';
$s['JotXProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['JotX'] = 'if(!defined(\'MODX_BASE_PATH\')) die();
$jotPath = MODX_BASE_PATH . \'assets/snippets/jot/\';
$config = (isset($config)) ? $jotPath.\'configs/\'.$config.\'.config.php\' : $jotPath.\'configs/default.config.php\';
if (is_file($config)) include $config;
include_once($jotPath.\'jot.class.inc.php\');
if (!isset($action)) $action=\'default\';

$Jot = new CJot;
$Jot->Set("path",$jotPath);
$Jot->Set("action", $action);
$Jot->Set("postdelay", $postdelay);
$Jot->Set("docid", $docid);
$Jot->Set("tagid", $tagid);
$Jot->Set("docids", $docids);
$Jot->Set("tagids", $tagids);
$Jot->Set("userids", $userids);
$Jot->Set("subscribe", $subscribe);
$Jot->Set("subscriber", $subscriber);
$Jot->Set("moderated", $moderated);
$Jot->Set("captcha", $captcha);
$Jot->Set("badwords", $badwords);
$Jot->Set("bw", $bw);
$Jot->Set("sortby", $sortby);
$Jot->Set("numdir", $numdir);
$Jot->Set("customfields", $customfields);
$Jot->Set("guestname", $guestname);
$Jot->Set("canpost", $canpost);
$Jot->Set("canview", $canview);
$Jot->Set("canedit", $canedit);
$Jot->Set("canmoderate", $canmoderate);
$Jot->Set("trusted", $trusted);
$Jot->Set("pagination", $pagination);
$Jot->Set("placeholders", $placeholders);
$Jot->Set("subjectSubscribe", $subjectSubscribe);
$Jot->Set("subjectModerate", $subjectModerate);
$Jot->Set("subjectAuthor", $subjectAuthor);
$Jot->Set("subjectEmails", $subjectEmails);
$Jot->Set("notify", $notify);
$Jot->Set("notifyAuthor", $notifyAuthor);
$Jot->Set("notifyEmails", $notifyEmails);
$Jot->Set("validate", $validate);
$Jot->Set("title", $title);
$Jot->Set("authorid", $authorid);
$Jot->Set("css", $css);
$Jot->Set("cssFile", $cssFile);
$Jot->Set("cssRowAlt", $cssRowAlt);
$Jot->Set("cssRowMe", $cssRowMe);
$Jot->Set("cssRowAuthor", $cssRowAuthor);
$Jot->Set("js", $js);
$Jot->Set("jsFile", $jsFile);
$Jot->Set("tplForm", $tplForm);
$Jot->Set("tplComments", $tplComments);
$Jot->Set("tplModerate", $tplModerate);
$Jot->Set("tplNav", $tplNav);
$Jot->Set("tplNavPage", $tplNavPage);
$Jot->Set("tplNavPageCur", $tplNavPageCur);
$Jot->Set("tplNavPageSpl", $tplNavPageSpl);
$Jot->Set("tplNotify", $tplNotify);
$Jot->Set("tplNotifyModerator", $tplNotifyModerator);
$Jot->Set("tplNotifyAuthor", $tplNotifyAuthor);
$Jot->Set("tplNotifyEmails", $tplNotifyEmails);
$Jot->Set("tplSubscribe", $tplSubscribe);
$Jot->Set("debug", $debug);
$Jot->Set("output", $output);
$Jot->Set("upc", $upc);
$Jot->Set("limit", $limit);
$Jot->Set("depth", $depth);

//events
$Jot->Set("onBeforeConfiguration", $onBeforeConfiguration);
$Jot->Set("onBeforeRunActions", $onBeforeRunActions);
$Jot->Set("onRunActions", $onRunActions);
$Jot->Set("onConfiguration", $onConfiguration);
$Jot->Set("onBeforeFirstRun", $onBeforeFirstRun);
$Jot->Set("onFirstRun", $onFirstRun);
$Jot->Set("onSubscriptionCheck", $onSubscriptionCheck);
$Jot->Set("onDeleteComment", $onDeleteComment);
$Jot->Set("onGetCommentFields", $onGetCommentFields);
$Jot->Set("onBeforeSaveComment", $onBeforeSaveComment);
$Jot->Set("onSaveComment", $onSaveComment);
$Jot->Set("onGetSubscriptions", $onGetSubscriptions);
$Jot->Set("onBeforeGetSubscriptions", $onBeforeGetSubscriptions);
$Jot->Set("onBeforeGetUserInfo", $onBeforeGetUserInfo);
$Jot->Set("onBeforeNotify", $onBeforeNotify);
$Jot->Set("onBeforeSubscribe", $onBeforeSubscribe);
$Jot->Set("onBeforeUnsubscribe", $onBeforeUnsubscribe);
$Jot->Set("onBeforeValidateFormField", $onBeforeValidateFormField);
$Jot->Set("onValidateFormFieldFail", $onValidateFormFieldFail);
$Jot->Set("onBeforePOSTProcess", $onBeforePOSTProcess);
$Jot->Set("onProcessForm", $onProcessForm);
$Jot->Set("onBeforeProcessPassiveActions", $onBeforeProcessPassiveActions);
$Jot->Set("onProcessPassiveActions", $onProcessPassiveActions);
$Jot->Set("onBeforeGetUserPostCount", $onBeforeGetUserPostCount);
$Jot->Set("onBeforeGetCommentCount", $onBeforeGetCommentCount);
$Jot->Set("onBeforeGetComments", $onBeforeGetComments);
$Jot->Set("onGetComments", $onGetComments);
$Jot->Set("onReturnOutput", $onReturnOutput);
$Jot->Set("onSetDefaultOutput", $onSetDefaultOutput);
$Jot->Set("onSetFormOutput", $onSetFormOutput);
$Jot->Set("onSetCommentsOutput", $onSetCommentsOutput);

return $Jot->Run();
';
$s['aDate'] = '//пример: [[aDate? &date=`[*createdon*]` &date2=`[*pub_date*]`]]

$output = "";
$format = "%d.%m.%Y";
if (isset($date2) && $date2>0 ) {
    $output = strftime($format,$date2);
}
else{
    $output = strftime($format,$date);
}

$date=explode(".", $output);
switch ($date[1]){
case 1: $m=\'января\'; break;
case 2: $m=\'февраля\'; break;
case 3: $m=\'марта\'; break;
case 4: $m=\'апреля\'; break;
case 5: $m=\'мая\'; break;
case 6: $m=\'июня\'; break;
case 7: $m=\'июля\'; break;
case 8: $m=\'августа\'; break;
case 9: $m=\'сентября\'; break;
case 10: $m=\'октября\'; break;
case 11: $m=\'ноября\'; break;
case 12: $m=\'декабря\'; break;
}
echo $date[0].\'&nbsp;\'.$m.\'&nbsp;\'.$date[2];
';
$s['aDate'] = '//пример: [[aDate? &date=`[*createdon*]` &date2=`[*pub_date*]`]]

$output = "";
$format = "%d.%m.%Y";
if (isset($date2) && $date2>0 ) {
    $output = strftime($format,$date2);
}
else{
    $output = strftime($format,$date);
}

$date=explode(".", $output);
switch ($date[1]){
case 1: $m=\'января\'; break;
case 2: $m=\'февраля\'; break;
case 3: $m=\'марта\'; break;
case 4: $m=\'апреля\'; break;
case 5: $m=\'мая\'; break;
case 6: $m=\'июня\'; break;
case 7: $m=\'июля\'; break;
case 8: $m=\'августа\'; break;
case 9: $m=\'сентября\'; break;
case 10: $m=\'октября\'; break;
case 11: $m=\'ноября\'; break;
case 12: $m=\'декабря\'; break;
}
echo $date[0].\'&nbsp;\'.$m.\'&nbsp;\'.$date[2];
';
$s['aDate'] = '//пример: [[aDate? &date=`[*createdon*]` &date2=`[*pub_date*]`]]

$output = "";
$format = "%d.%m.%Y";
if (isset($date2) && $date2>0 ) {
    $output = strftime($format,$date2);
}
else{
    $output = strftime($format,$date);
}

$date=explode(".", $output);
switch ($date[1]){
case 1: $m=\'января\'; break;
case 2: $m=\'февраля\'; break;
case 3: $m=\'марта\'; break;
case 4: $m=\'апреля\'; break;
case 5: $m=\'мая\'; break;
case 6: $m=\'июня\'; break;
case 7: $m=\'июля\'; break;
case 8: $m=\'августа\'; break;
case 9: $m=\'сентября\'; break;
case 10: $m=\'октября\'; break;
case 11: $m=\'ноября\'; break;
case 12: $m=\'декабря\'; break;
}
echo $date[0].\'&nbsp;\'.$m.\'&nbsp;\'.$date[2];
';
$s['aDateProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['aDate'] = '//пример: [[aDate? &date=`[*createdon*]` &date2=`[*pub_date*]`]]

$output = "";
$format = "%d.%m.%Y";
if (isset($date2) && $date2>0 ) {
    $output = strftime($format,$date2);
}
else{
    $output = strftime($format,$date);
}

$date=explode(".", $output);
switch ($date[1]){
case 1: $m=\'января\'; break;
case 2: $m=\'февраля\'; break;
case 3: $m=\'марта\'; break;
case 4: $m=\'апреля\'; break;
case 5: $m=\'мая\'; break;
case 6: $m=\'июня\'; break;
case 7: $m=\'июля\'; break;
case 8: $m=\'августа\'; break;
case 9: $m=\'сентября\'; break;
case 10: $m=\'октября\'; break;
case 11: $m=\'ноября\'; break;
case 12: $m=\'декабря\'; break;
}
echo $date[0].\'&nbsp;\'.$m.\'&nbsp;\'.$date[2];
';
$s['alterTitle'] = '/*
[[alterTitle? &id = `[+id+]`]] к примеру для вывода в Ditto
*/
$id = isset($id) ? $id : $modx->documentIdentifier;  
$arr = $modx->getPageInfo($id,1,\'pagetitle,longtitle\');
$title = (strlen($arr["longtitle"])>0) ? $arr["longtitle"] : $arr["pagetitle"]; 
return $title;';
$s['alterTitle'] = '/*
[[alterTitle? &id = `[+id+]`]] к примеру для вывода в Ditto
*/
$id = isset($id) ? $id : $modx->documentIdentifier;  
$arr = $modx->getPageInfo($id,1,\'pagetitle,longtitle\');
$title = (strlen($arr["longtitle"])>0) ? $arr["longtitle"] : $arr["pagetitle"]; 
return $title;';
$s['alterTitle'] = '/*
[[alterTitle? &id = `[+id+]`]] к примеру для вывода в Ditto
*/
$id = isset($id) ? $id : $modx->documentIdentifier;  
$arr = $modx->getPageInfo($id,1,\'pagetitle,longtitle\');
$title = (strlen($arr["longtitle"])>0) ? $arr["longtitle"] : $arr["pagetitle"]; 
return $title;';
$s['alterTitleProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['alterTitle'] = '/*
[[alterTitle? &id = `[+id+]`]] к примеру для вывода в Ditto
*/
$id = isset($id) ? $id : $modx->documentIdentifier;  
$arr = $modx->getPageInfo($id,1,\'pagetitle,longtitle\');
$title = (strlen($arr["longtitle"])>0) ? $arr["longtitle"] : $arr["pagetitle"]; 
return $title;';
$s['Breadcrumbs'] = '/*
 * This snippet shows the path through the various levels of site structure. It
 * is NOT necessarily the path the user took to arrive at a given page.
 */

/* -----------------------------------------------------------------------------
 * CONFIGURATION
 * -----------------------------------------------------------------------------
 * This section contains brief explanations of the available parameters.
 */

/* General setup
 * -----------------------------------------------------------------------------
 */

/* $maxCrumbs [ integer ]
 * Max number of elemetns to have in a breadcrumb path. The default 100 is an
 * arbitrarily high number that will essentially include everything. If you were
 * to set it to 2, and you were 5 levels deep, it would appear like:
 * HOME > ... > Level 3 > Level 4 > CURRENT PAGE
 * It should be noted that the "home" link, and the current page do not count as
 * they are managed by their own configuration settings.
 */
( isset($maxCrumbs) ) ? $maxCrumbs : $maxCrumbs = 100;

/* $pathThruUnPub [ 1 | 0 ]
 * When your path includes an unpublished folder, setting this to 1 (true) will
 * show all documents in path EXCEPT the unpublished. When set to 0 (false), the
 * path will not go "through" that unpublished folder and will stop there.
 */
( isset($pathThruUnPub) ) ? $pathThruUnPub : $pathThruUnPub = 1;

/* $respectHidemenu [ 0 | 1 ]
 * Setting this to 1 (true) will respect the hidemenu setting of the document
 * and not include it in trail.
 */
( isset($respectHidemenu) ) ? (int)$respectHidemenu : $respectHidemenu = 1;

/* $showCurrentCrumb [ 1 | 0 ]
 * Include the current page at the end of the trail. On by default.
 */
( isset($showCurrentCrumb) ) ? $showCurrentCrumb : $showCurrentCrumb = 1;

/* $currentAsLink [ 1 | 0 ]
 * If the current page is included, this parameter will show it as a link (1) or
 * just plain text (0).
 */
( $currentAsLink ) ? $currentAsLink : $currentAsLink = 0;

/* $linkTextField [ string ]
 * Prioritized list of fields to use as link text. Options are: pagetitle,
 * longtitle, description, menutitle. The first of these fields that has a value
 * will be the title.
 */
( isset($linkTextField) ) ? $linkTextField : $linkTextField = \'menutitle,pagetitle,longtitle\';

/* $linkDescField [ string ]
 * Prioritized list of fields to use as link title text. Options are: pagetitle,
 * longtitle, description, menutitle. The first of these fields that has a value
 * will be the title.
 */
( isset($linkDescField) ) ? $linkDescField : $linkDescField = \'description,longtitle,pagetitle,menutitle\';

/* $showCrumbsAsLinks [ 1 | 0 ]
 * If for some reason you want breadcrumbs to be text and not links, set to 0
 * (false).
 */
( isset($showCrumbsAsLinks) ) ? $showCrumbsAsLinks : $showCrumbsAsLinks = 1;

/* $templateSet [ string ]
 * The set of templates you\'d like to use. (Templates are defined below.) It
 * will default to defaultString which replicates the output of previous
 * versions.
 */
( isset($templateSet) ) ? $templateSet : $templateSet = \'defaultString\';

/* $crumbGap [ string ]
 * String to be shown to represent gap if there are more crumbs in trail than
 * can be shown. Note: if you would like to use an image, the entire image tag
 * must be provided. When making a snippet call, you cannot use "=", so use "||"
 * instead and it will be converted for you.
 */
( isset($crumbGap) ) ? $crumbGap : $crumbGap = \'...\';

/* $stylePrefix [ string ]
 * Breadcrumbs will add style classes to various parts of the trail. To avoid
 * class name conflicts, you can determine your own prefix. The following
 * classes will be attached:
 * crumbBox: Span that surrounds all crumb output
 * hideCrumb: Span that surrounds the "..." if there are more crumbs than will
 * be shown
 * currentCrumb: Span or A tag surrounding the current crumb
 * firstCrumb: Span that will be applied to first crumb, whether it is "home" or
 * not
 * lastCrumb: Span surrounding last crumb, whether it is the current page or
 * not
 * crumb: Class given to each A tag surrounding the intermediate crumbs (not
 * "home", "current", or "hide")
 * homeCrumb: Class given to the home crumb
 */
( isset($stylePrefix) ) ? $stylePrefix : $stylePrefix = \'B_\';



/* Home link parameters
 * -----------------------------------------------------------------------------
 * The home link is unique. It is a link that can be placed at the head of the
 * breadcrumb trail, even if it is not truly in the hierarchy.
 */

/* $showHomeCrumb [ 1 | 0 ]
 * This toggles the "home" crumb to be added to the beginning of your trail.
 */
( isset($showHomeCrumb) ) ? $showHomeCrumb : $showHomeCrumb = 1;

/* $homeId [ integer ]
 * Usually the page designated as "site start" in MODx configuration is
 * considered the home page. But if you would like to use some other document,
 * you may explicitly define it.
 */
( isset($homeId) ) ? (int)$homeId : $homeId = $modx->config[\'site_start\'];

/* $homeCrumbTitle [ string ]
 * If you\'d like to use something other than the menutitle (or pagetitle) for
 * the home link.
 */
( isset($homeCrumbTitle) ) ? $homeCrumbTitle : $homeCrumbTitle = \'\';

/* $homeCrumbDescription [ string ]
 * If you\'d like to use a custom description (link title) on the home link. If
 * left blank, the title will follow the title order set in $titleField.
 */
( isset($homeCrumbDescription) ) ? $homeCrumbDescription : $homeCrumbDescription = \'\';


/* Custom behaviors
 * -----------------------------------------------------------------------------
 * The following parameters will alter the behavior of the Breadcrumbs based on
 * the page it is on.
 */

/* $showCrumbsAtHome [ 1 | 0 ]
 * You can turn off Breadcrumbs all together on the home page by setting this to
 * 1 (true);
 */
( isset($showCrumbsAtHome) ) ? $showCrumbsAtHome : $showCrumbsAtHome = 0;

/* $hideOn [ string ]
 * Comma separated list of documents you don\'t want Breadcrumbs on at all. If
 * you have a LOT of pages like this, you might try $hideUnder or use another
 * template. This parameter is best for those rare odd balls - otherwise it will
 * become a pain to manage.
 */
( isset($hideOn) ) ? $hideOn : $hideOn = \'\';

/* $hideUnder [ string ]
 * Comma separated list of parent documents, whose CHILDREN you don\'t want
 * Breadcrumbs to appear on at all. This enables you to hide Breadcrumbs on a
 * whole folders worth of documents by specifying the parent only. The PARENT
 * will not have Breadcrumbs hidden however. If you wanted to hide the parent
 * and the children, put the parent ID in hideUnder AND hideOn.
 */
( isset($hideUnder) ) ? $hideUnder : $hideUnder = \'\';

/* $stopIds [ string ]
 * Comma separated list of document IDs that when reached, stops Breadcrumbs
 * from going any further. This is useful in situations like where you have
 * language branches, and you don\'t want the Breadcrumbs going past the "home"
 * of the language you\'re in.
 */
( isset($stopIds) ) ? $stopIds : $stopIds = \'\';

/* $ignoreIds [ string ]
 * Comma separated list of document IDs to explicitly ignore.
 */
( isset($ignoreIds) ) ? $ignoreids : $ignoreids = \'\';

/* Templates
 * -----------------------------------------------------------------------------
 * In an effort to keep the MODx chunks manager from getting mired down in lots
 * of templates, Breadcrumbs templates are included here. Two sets are provided
 * prefixed with defaultString, and defaultList. You can create as many more as
 * you like, each set with it\'s own prefix
 */
$templates = array(
    \'defaultString\' => array(
        \'crumb\' => \'[+crumb+]\',
        \'separator\' => \' &raquo; \',
        \'crumbContainer\' => \'<span class="[+crumbBoxClass+]">[+crumbs+]</span>\',
        \'lastCrumbWrapper\' => \'<span class="[+lastCrumbClass+]">[+lastCrumbSpanA+]</span>\',
        \'firstCrumbWrapper\' => \'<span class="[+firstCrumbClass+]">[+firstCrumbSpanA+]</span>\'
    ),
    \'defaultList\' => array(
        \'crumb\' => \'<li>[+crumb+]</li>\',
        \'separator\' => \'\',
        \'crumbContainer\' => \'<ul class="[+crumbBoxClass+]">[+crumbs+]</ul>\',
        \'lastCrumbWrapper\' => \'<span class="[+lastCrumbClass+]">[+lastCrumbSpanA+]</span>\',
        \'firstCrumbWrapper\' => \'<span class="[+firstCrumbClass+]">[+firstCrumbSpanA+]</span>\'
    ),
);


/* -----------------------------------------------------------------------------
 * END CONFIGURATION
 * -----------------------------------------------------------------------------
 */

// Return blank if necessary: on home page
if ( !$showCrumbsAtHome && $homeId == $modx->documentObject[\'id\'] )
{
    return \'\';
}
// Return blank if necessary: specified pages
if ( $hideOn || $hideUnder )
{
    // Create array of hide pages
    $hideOn = str_replace(\' \',\'\',$hideOn);
    $hideOn = explode(\',\',$hideOn);

    // Get more hide pages based on parents if needed
    if ( $hideUnder )
    {
        $hiddenKids = array();
        // Get child pages to hide
        $hideKidsQuery = $modx->db->select(\'id\',$modx->getFullTableName("site_content"),"parent IN ($hideUnder)");
        while ( $hideKid = $modx->db->getRow($hideKidsQuery) )
        {
            $hiddenKids[] = $hideKid[\'id\'];
        }
        // Merge with hideOn pages
        $hideOn = array_merge($hideOn,$hiddenKids);
    }

    if ( in_array($modx->documentObject[\'id\'],$hideOn) )
    {
        return \'\';
    }

}


// Initialize ------------------------------------------------------------------

// Put certain parameters in arrays
$stopIds = str_replace(\' \',\'\',$stopIds);
$stopIds = explode(\',\',$stopIds);
$linkTextField = str_replace(\' \',\'\',$linkTextField);
$linkTextField = explode(\',\',$linkTextField);
$linkDescField = str_replace(\' \',\'\',$linkDescField);
$linkDescField = explode(\',\',$linkDescField);
$ignoreIds = str_replace(\' \',\'\',$ignoreIds);
$ignoreIds = explode(\',\',$ignoreIds);

/* $crumbs
 * Crumb elements are: id, parent, pagetitle, longtitle, menutitle, description,
 * published, hidemenu
 */
$crumbs = array();
$parent = $modx->documentObject[\'parent\'];
$output = \'\';
$maxCrumbs += ($showCurrentCrumb) ? 1 : 0;

// Replace || in snippet parameters that accept them with =
$crumbGap = str_replace(\'||\',\'=\',$crumbGap);

// Curent crumb ----------------------------------------------------------------

// Decide if current page is to be a crumb
if ( $showCurrentCrumb )
{
    $crumbs[] = array(
        \'id\' => $modx->documentObject[\'id\'],
        \'parent\' => $modx->documentObject[\'parent\'],
        \'pagetitle\' => $modx->documentObject[\'pagetitle\'],
        \'longtitle\' => $modx->documentObject[\'longtitle\'],
        \'menutitle\' => $modx->documentObject[\'menutitle\'],
        \'description\' => $modx->documentObject[\'description\']);
}

// Intermediate crumbs ---------------------------------------------------------


// Iterate through parents till we hit root or a reason to stop
$loopSafety = 0;
while ( $parent && $parent!=$modx->config[\'site_start\'] && $loopSafety < 1000 )
{
    // Get next crumb
    $tempCrumb = $modx->getPageInfo($parent,0,"id,parent,pagetitle,longtitle,menutitle,description,published,hidemenu");

    // Check for include conditions & add to crumbs
    if (
        $tempCrumb[\'published\'] &&
        ( !$tempCrumb[\'hidemenu\'] || !$respectHidemenu ) &&
        !in_array($tempCrumb[\'id\'],$ignoreIds)
    )
    {
        // Add crumb
        $crumbs[] = array(
        \'id\' => $tempCrumb[\'id\'],
        \'parent\' => $tempCrumb[\'parent\'],
        \'pagetitle\' => $tempCrumb[\'pagetitle\'],
        \'longtitle\' => $tempCrumb[\'longtitle\'],
        \'menutitle\' => $tempCrumb[\'menutitle\'],
        \'description\' => $tempCrumb[\'description\']);
    }

    // Check stop conditions
    if (
        in_array($tempCrumb[\'id\'],$stopIds) ||  // Is one of the stop IDs
        !$tempCrumb[\'parent\'] || // At root
        ( !$tempCrumb[\'published\'] && !$pathThruUnPub ) // Unpublished
    )
    {
        // Halt making crumbs
        break;
    }

    // Reset parent
    $parent = $tempCrumb[\'parent\'];

    // Increment loop safety
    $loopSafety++;
}

// Home crumb ------------------------------------------------------------------

if ( $showHomeCrumb && $homeId != $modx->documentObject[\'id\'] && $homeCrumb = $modx->getPageInfo($homeId,0,"id,parent,pagetitle,longtitle,menutitle,description,published,hidemenu") )
{
    $crumbs[] = array(
    \'id\' => $homeCrumb[\'id\'],
    \'parent\' => $homeCrumb[\'parent\'],
    \'pagetitle\' => $homeCrumb[\'pagetitle\'],
    \'longtitle\' => $homeCrumb[\'longtitle\'],
    \'menutitle\' => $homeCrumb[\'menutitle\'],
    \'description\' => $homeCrumb[\'description\']);
}


// Process each crumb ----------------------------------------------------------
$pretemplateCrumbs = array();

foreach ( $crumbs as $c )
{

    // Skip if we\'ve exceeded our crumb limit but we\'re waiting to get to home
    if ( count($pretemplateCrumbs) > $maxCrumbs && $c[\'id\'] != $homeId )
    {
        continue;
    }

    $text = \'\';
    $title = \'\';
    $pretemplateCrumb = \'\';

    // Determine appropriate span/link text: home link specified
    if ( $c[\'id\'] == $homeId && $homeCrumbTitle )
    {
        $text = $homeCrumbTitle;
    }
    else
    // Determine appropriate span/link text: home link not specified
    {
        for ($i = 0; !$text && $i < count($linkTextField); $i++)
        {
            if ( $c[$linkTextField[$i]] )
            {
                $text = $c[$linkTextField[$i]];
            }
        }
    }

    // Determine link/span class(es)
    if ( $c[\'id\'] == $homeId )
    {
        $crumbClass = $stylePrefix.\'homeCrumb\';
    }
    else if ( $modx->documentObject[\'id\'] == $c[\'id\'] )
    {
        $crumbClass = $stylePrefix.\'currentCrumb\';
    }
    else
    {
        $crumbClass = $stylePrefix.\'crumb\';
    }

    // Make link
    if (
        ( $c[\'id\'] != $modx->documentObject[\'id\'] && $showCrumbsAsLinks ) ||
        ( $c[\'id\'] == $modx->documentObject[\'id\'] && $currentAsLink )
    )
    {
        // Determine appropriate title for link: home link specified
        if ( $c[\'id\'] == $homeId && $homeCrumbDescription )
        {
            $title = htmlspecialchars($homeCrumbDescription);
        }
        else
        // Determine appropriate title for link: home link not specified
        {
            for ($i = 0; !$title && $i < count($linkDescField); $i++)
            {
                if ( $c[$linkDescField[$i]] )
                {
                    $title = htmlspecialchars($c[$linkDescField[$i]]);
                }
            }
        }


        $pretemplateCrumb .= \'<a class="\'.$crumbClass.\'" href="\'.($c[\'id\'] == $modx->config[\'site_start\'] ? $modx->config[\'base_url\'] : $modx->makeUrl($c[\'id\'])).\'" title="\'.$title.\'">\'.$text.\'</a>\';
    }
    else
    // Make a span instead of a link
    {
       $pretemplateCrumb .= \'<span class="\'.$crumbClass.\'">\'.$text.\'</span>\';
    }

    // Add crumb to pretemplate crumb array
    $pretemplateCrumbs[] = $pretemplateCrumb;

    // If we have hit the crumb limit
    if ( count($pretemplateCrumbs) == $maxCrumbs )
    {
        if ( count($crumbs) > ($maxCrumbs + (($showHomeCrumb) ? 1 : 0)) )
        {
            // Add gap
            $pretemplateCrumbs[] = \'<span class="\'.$stylePrefix.\'hideCrumb\'.\'">\'.$crumbGap.\'</span>\';
        }

        // Stop here if we\'re not looking for the home crumb
        if ( !$showHomeCrumb )
        {
            break;
        }
    }
}

// Put in correct order for output
$pretemplateCrumbs = array_reverse($pretemplateCrumbs);

// Wrap first/last spans
$pretemplateCrumbs[0] = str_replace(
    array(\'[+firstCrumbClass+]\',\'[+firstCrumbSpanA+]\'),
    array($stylePrefix.\'firstCrumb\',$pretemplateCrumbs[0]),
    $templates[$templateSet][\'firstCrumbWrapper\']
);
$pretemplateCrumbs[(count($pretemplateCrumbs)-1)] = str_replace(
    array(\'[+lastCrumbClass+]\',\'[+lastCrumbSpanA+]\'),
    array($stylePrefix.\'lastCrumb\',$pretemplateCrumbs[(count($pretemplateCrumbs)-1)]),
    $templates[$templateSet][\'lastCrumbWrapper\']
);

// Insert crumbs into crumb template
$processedCrumbs = array();
foreach ( $pretemplateCrumbs as $pc )
{
    $processedCrumbs[] = str_replace(\'[+crumb+]\',$pc,$templates[$templateSet][\'crumb\']);
}

// Combine crumbs together into one string with separator
$processedCrumbs = implode($templates[$templateSet][\'separator\'],$processedCrumbs);

// Put crumbs into crumb container template
$container = str_replace(
    array(\'[+crumbBoxClass+]\',\'[+crumbs+]\'),
    array($stylePrefix.\'crumbBox\',$processedCrumbs),
    $templates[$templateSet][\'crumbContainer\']
    );

// Return crumbs
return $container;';
$s['Breadcrumbs'] = '/*
 * This snippet shows the path through the various levels of site structure. It
 * is NOT necessarily the path the user took to arrive at a given page.
 */

/* -----------------------------------------------------------------------------
 * CONFIGURATION
 * -----------------------------------------------------------------------------
 * This section contains brief explanations of the available parameters.
 */

/* General setup
 * -----------------------------------------------------------------------------
 */

/* $maxCrumbs [ integer ]
 * Max number of elemetns to have in a breadcrumb path. The default 100 is an
 * arbitrarily high number that will essentially include everything. If you were
 * to set it to 2, and you were 5 levels deep, it would appear like:
 * HOME > ... > Level 3 > Level 4 > CURRENT PAGE
 * It should be noted that the "home" link, and the current page do not count as
 * they are managed by their own configuration settings.
 */
( isset($maxCrumbs) ) ? $maxCrumbs : $maxCrumbs = 100;

/* $pathThruUnPub [ 1 | 0 ]
 * When your path includes an unpublished folder, setting this to 1 (true) will
 * show all documents in path EXCEPT the unpublished. When set to 0 (false), the
 * path will not go "through" that unpublished folder and will stop there.
 */
( isset($pathThruUnPub) ) ? $pathThruUnPub : $pathThruUnPub = 1;

/* $respectHidemenu [ 0 | 1 ]
 * Setting this to 1 (true) will respect the hidemenu setting of the document
 * and not include it in trail.
 */
( isset($respectHidemenu) ) ? (int)$respectHidemenu : $respectHidemenu = 1;

/* $showCurrentCrumb [ 1 | 0 ]
 * Include the current page at the end of the trail. On by default.
 */
( isset($showCurrentCrumb) ) ? $showCurrentCrumb : $showCurrentCrumb = 1;

/* $currentAsLink [ 1 | 0 ]
 * If the current page is included, this parameter will show it as a link (1) or
 * just plain text (0).
 */
( $currentAsLink ) ? $currentAsLink : $currentAsLink = 0;

/* $linkTextField [ string ]
 * Prioritized list of fields to use as link text. Options are: pagetitle,
 * longtitle, description, menutitle. The first of these fields that has a value
 * will be the title.
 */
( isset($linkTextField) ) ? $linkTextField : $linkTextField = \'menutitle,pagetitle,longtitle\';

/* $linkDescField [ string ]
 * Prioritized list of fields to use as link title text. Options are: pagetitle,
 * longtitle, description, menutitle. The first of these fields that has a value
 * will be the title.
 */
( isset($linkDescField) ) ? $linkDescField : $linkDescField = \'description,longtitle,pagetitle,menutitle\';

/* $showCrumbsAsLinks [ 1 | 0 ]
 * If for some reason you want breadcrumbs to be text and not links, set to 0
 * (false).
 */
( isset($showCrumbsAsLinks) ) ? $showCrumbsAsLinks : $showCrumbsAsLinks = 1;

/* $templateSet [ string ]
 * The set of templates you\'d like to use. (Templates are defined below.) It
 * will default to defaultString which replicates the output of previous
 * versions.
 */
( isset($templateSet) ) ? $templateSet : $templateSet = \'defaultString\';

/* $crumbGap [ string ]
 * String to be shown to represent gap if there are more crumbs in trail than
 * can be shown. Note: if you would like to use an image, the entire image tag
 * must be provided. When making a snippet call, you cannot use "=", so use "||"
 * instead and it will be converted for you.
 */
( isset($crumbGap) ) ? $crumbGap : $crumbGap = \'...\';

/* $stylePrefix [ string ]
 * Breadcrumbs will add style classes to various parts of the trail. To avoid
 * class name conflicts, you can determine your own prefix. The following
 * classes will be attached:
 * crumbBox: Span that surrounds all crumb output
 * hideCrumb: Span that surrounds the "..." if there are more crumbs than will
 * be shown
 * currentCrumb: Span or A tag surrounding the current crumb
 * firstCrumb: Span that will be applied to first crumb, whether it is "home" or
 * not
 * lastCrumb: Span surrounding last crumb, whether it is the current page or
 * not
 * crumb: Class given to each A tag surrounding the intermediate crumbs (not
 * "home", "current", or "hide")
 * homeCrumb: Class given to the home crumb
 */
( isset($stylePrefix) ) ? $stylePrefix : $stylePrefix = \'B_\';



/* Home link parameters
 * -----------------------------------------------------------------------------
 * The home link is unique. It is a link that can be placed at the head of the
 * breadcrumb trail, even if it is not truly in the hierarchy.
 */

/* $showHomeCrumb [ 1 | 0 ]
 * This toggles the "home" crumb to be added to the beginning of your trail.
 */
( isset($showHomeCrumb) ) ? $showHomeCrumb : $showHomeCrumb = 1;

/* $homeId [ integer ]
 * Usually the page designated as "site start" in MODx configuration is
 * considered the home page. But if you would like to use some other document,
 * you may explicitly define it.
 */
( isset($homeId) ) ? (int)$homeId : $homeId = $modx->config[\'site_start\'];

/* $homeCrumbTitle [ string ]
 * If you\'d like to use something other than the menutitle (or pagetitle) for
 * the home link.
 */
( isset($homeCrumbTitle) ) ? $homeCrumbTitle : $homeCrumbTitle = \'\';

/* $homeCrumbDescription [ string ]
 * If you\'d like to use a custom description (link title) on the home link. If
 * left blank, the title will follow the title order set in $titleField.
 */
( isset($homeCrumbDescription) ) ? $homeCrumbDescription : $homeCrumbDescription = \'\';


/* Custom behaviors
 * -----------------------------------------------------------------------------
 * The following parameters will alter the behavior of the Breadcrumbs based on
 * the page it is on.
 */

/* $showCrumbsAtHome [ 1 | 0 ]
 * You can turn off Breadcrumbs all together on the home page by setting this to
 * 1 (true);
 */
( isset($showCrumbsAtHome) ) ? $showCrumbsAtHome : $showCrumbsAtHome = 0;

/* $hideOn [ string ]
 * Comma separated list of documents you don\'t want Breadcrumbs on at all. If
 * you have a LOT of pages like this, you might try $hideUnder or use another
 * template. This parameter is best for those rare odd balls - otherwise it will
 * become a pain to manage.
 */
( isset($hideOn) ) ? $hideOn : $hideOn = \'\';

/* $hideUnder [ string ]
 * Comma separated list of parent documents, whose CHILDREN you don\'t want
 * Breadcrumbs to appear on at all. This enables you to hide Breadcrumbs on a
 * whole folders worth of documents by specifying the parent only. The PARENT
 * will not have Breadcrumbs hidden however. If you wanted to hide the parent
 * and the children, put the parent ID in hideUnder AND hideOn.
 */
( isset($hideUnder) ) ? $hideUnder : $hideUnder = \'\';

/* $stopIds [ string ]
 * Comma separated list of document IDs that when reached, stops Breadcrumbs
 * from going any further. This is useful in situations like where you have
 * language branches, and you don\'t want the Breadcrumbs going past the "home"
 * of the language you\'re in.
 */
( isset($stopIds) ) ? $stopIds : $stopIds = \'\';

/* $ignoreIds [ string ]
 * Comma separated list of document IDs to explicitly ignore.
 */
( isset($ignoreIds) ) ? $ignoreids : $ignoreids = \'\';

/* Templates
 * -----------------------------------------------------------------------------
 * In an effort to keep the MODx chunks manager from getting mired down in lots
 * of templates, Breadcrumbs templates are included here. Two sets are provided
 * prefixed with defaultString, and defaultList. You can create as many more as
 * you like, each set with it\'s own prefix
 */
$templates = array(
    \'defaultString\' => array(
        \'crumb\' => \'[+crumb+]\',
        \'separator\' => \' &raquo; \',
        \'crumbContainer\' => \'<span class="[+crumbBoxClass+]">[+crumbs+]</span>\',
        \'lastCrumbWrapper\' => \'<span class="[+lastCrumbClass+]">[+lastCrumbSpanA+]</span>\',
        \'firstCrumbWrapper\' => \'<span class="[+firstCrumbClass+]">[+firstCrumbSpanA+]</span>\'
    ),
    \'defaultList\' => array(
        \'crumb\' => \'<li>[+crumb+]</li>\',
        \'separator\' => \'\',
        \'crumbContainer\' => \'<ul class="[+crumbBoxClass+]">[+crumbs+]</ul>\',
        \'lastCrumbWrapper\' => \'<span class="[+lastCrumbClass+]">[+lastCrumbSpanA+]</span>\',
        \'firstCrumbWrapper\' => \'<span class="[+firstCrumbClass+]">[+firstCrumbSpanA+]</span>\'
    ),
);


/* -----------------------------------------------------------------------------
 * END CONFIGURATION
 * -----------------------------------------------------------------------------
 */

// Return blank if necessary: on home page
if ( !$showCrumbsAtHome && $homeId == $modx->documentObject[\'id\'] )
{
    return \'\';
}
// Return blank if necessary: specified pages
if ( $hideOn || $hideUnder )
{
    // Create array of hide pages
    $hideOn = str_replace(\' \',\'\',$hideOn);
    $hideOn = explode(\',\',$hideOn);

    // Get more hide pages based on parents if needed
    if ( $hideUnder )
    {
        $hiddenKids = array();
        // Get child pages to hide
        $hideKidsQuery = $modx->db->select(\'id\',$modx->getFullTableName("site_content"),"parent IN ($hideUnder)");
        while ( $hideKid = $modx->db->getRow($hideKidsQuery) )
        {
            $hiddenKids[] = $hideKid[\'id\'];
        }
        // Merge with hideOn pages
        $hideOn = array_merge($hideOn,$hiddenKids);
    }

    if ( in_array($modx->documentObject[\'id\'],$hideOn) )
    {
        return \'\';
    }

}


// Initialize ------------------------------------------------------------------

// Put certain parameters in arrays
$stopIds = str_replace(\' \',\'\',$stopIds);
$stopIds = explode(\',\',$stopIds);
$linkTextField = str_replace(\' \',\'\',$linkTextField);
$linkTextField = explode(\',\',$linkTextField);
$linkDescField = str_replace(\' \',\'\',$linkDescField);
$linkDescField = explode(\',\',$linkDescField);
$ignoreIds = str_replace(\' \',\'\',$ignoreIds);
$ignoreIds = explode(\',\',$ignoreIds);

/* $crumbs
 * Crumb elements are: id, parent, pagetitle, longtitle, menutitle, description,
 * published, hidemenu
 */
$crumbs = array();
$parent = $modx->documentObject[\'parent\'];
$output = \'\';
$maxCrumbs += ($showCurrentCrumb) ? 1 : 0;

// Replace || in snippet parameters that accept them with =
$crumbGap = str_replace(\'||\',\'=\',$crumbGap);

// Curent crumb ----------------------------------------------------------------

// Decide if current page is to be a crumb
if ( $showCurrentCrumb )
{
    $crumbs[] = array(
        \'id\' => $modx->documentObject[\'id\'],
        \'parent\' => $modx->documentObject[\'parent\'],
        \'pagetitle\' => $modx->documentObject[\'pagetitle\'],
        \'longtitle\' => $modx->documentObject[\'longtitle\'],
        \'menutitle\' => $modx->documentObject[\'menutitle\'],
        \'description\' => $modx->documentObject[\'description\']);
}

// Intermediate crumbs ---------------------------------------------------------


// Iterate through parents till we hit root or a reason to stop
$loopSafety = 0;
while ( $parent && $parent!=$modx->config[\'site_start\'] && $loopSafety < 1000 )
{
    // Get next crumb
    $tempCrumb = $modx->getPageInfo($parent,0,"id,parent,pagetitle,longtitle,menutitle,description,published,hidemenu");

    // Check for include conditions & add to crumbs
    if (
        $tempCrumb[\'published\'] &&
        ( !$tempCrumb[\'hidemenu\'] || !$respectHidemenu ) &&
        !in_array($tempCrumb[\'id\'],$ignoreIds)
    )
    {
        // Add crumb
        $crumbs[] = array(
        \'id\' => $tempCrumb[\'id\'],
        \'parent\' => $tempCrumb[\'parent\'],
        \'pagetitle\' => $tempCrumb[\'pagetitle\'],
        \'longtitle\' => $tempCrumb[\'longtitle\'],
        \'menutitle\' => $tempCrumb[\'menutitle\'],
        \'description\' => $tempCrumb[\'description\']);
    }

    // Check stop conditions
    if (
        in_array($tempCrumb[\'id\'],$stopIds) ||  // Is one of the stop IDs
        !$tempCrumb[\'parent\'] || // At root
        ( !$tempCrumb[\'published\'] && !$pathThruUnPub ) // Unpublished
    )
    {
        // Halt making crumbs
        break;
    }

    // Reset parent
    $parent = $tempCrumb[\'parent\'];

    // Increment loop safety
    $loopSafety++;
}

// Home crumb ------------------------------------------------------------------

if ( $showHomeCrumb && $homeId != $modx->documentObject[\'id\'] && $homeCrumb = $modx->getPageInfo($homeId,0,"id,parent,pagetitle,longtitle,menutitle,description,published,hidemenu") )
{
    $crumbs[] = array(
    \'id\' => $homeCrumb[\'id\'],
    \'parent\' => $homeCrumb[\'parent\'],
    \'pagetitle\' => $homeCrumb[\'pagetitle\'],
    \'longtitle\' => $homeCrumb[\'longtitle\'],
    \'menutitle\' => $homeCrumb[\'menutitle\'],
    \'description\' => $homeCrumb[\'description\']);
}


// Process each crumb ----------------------------------------------------------
$pretemplateCrumbs = array();

foreach ( $crumbs as $c )
{

    // Skip if we\'ve exceeded our crumb limit but we\'re waiting to get to home
    if ( count($pretemplateCrumbs) > $maxCrumbs && $c[\'id\'] != $homeId )
    {
        continue;
    }

    $text = \'\';
    $title = \'\';
    $pretemplateCrumb = \'\';

    // Determine appropriate span/link text: home link specified
    if ( $c[\'id\'] == $homeId && $homeCrumbTitle )
    {
        $text = $homeCrumbTitle;
    }
    else
    // Determine appropriate span/link text: home link not specified
    {
        for ($i = 0; !$text && $i < count($linkTextField); $i++)
        {
            if ( $c[$linkTextField[$i]] )
            {
                $text = $c[$linkTextField[$i]];
            }
        }
    }

    // Determine link/span class(es)
    if ( $c[\'id\'] == $homeId )
    {
        $crumbClass = $stylePrefix.\'homeCrumb\';
    }
    else if ( $modx->documentObject[\'id\'] == $c[\'id\'] )
    {
        $crumbClass = $stylePrefix.\'currentCrumb\';
    }
    else
    {
        $crumbClass = $stylePrefix.\'crumb\';
    }

    // Make link
    if (
        ( $c[\'id\'] != $modx->documentObject[\'id\'] && $showCrumbsAsLinks ) ||
        ( $c[\'id\'] == $modx->documentObject[\'id\'] && $currentAsLink )
    )
    {
        // Determine appropriate title for link: home link specified
        if ( $c[\'id\'] == $homeId && $homeCrumbDescription )
        {
            $title = htmlspecialchars($homeCrumbDescription);
        }
        else
        // Determine appropriate title for link: home link not specified
        {
            for ($i = 0; !$title && $i < count($linkDescField); $i++)
            {
                if ( $c[$linkDescField[$i]] )
                {
                    $title = htmlspecialchars($c[$linkDescField[$i]]);
                }
            }
        }


        $pretemplateCrumb .= \'<a class="\'.$crumbClass.\'" href="\'.($c[\'id\'] == $modx->config[\'site_start\'] ? $modx->config[\'base_url\'] : $modx->makeUrl($c[\'id\'])).\'" title="\'.$title.\'">\'.$text.\'</a>\';
    }
    else
    // Make a span instead of a link
    {
       $pretemplateCrumb .= \'<span class="\'.$crumbClass.\'">\'.$text.\'</span>\';
    }

    // Add crumb to pretemplate crumb array
    $pretemplateCrumbs[] = $pretemplateCrumb;

    // If we have hit the crumb limit
    if ( count($pretemplateCrumbs) == $maxCrumbs )
    {
        if ( count($crumbs) > ($maxCrumbs + (($showHomeCrumb) ? 1 : 0)) )
        {
            // Add gap
            $pretemplateCrumbs[] = \'<span class="\'.$stylePrefix.\'hideCrumb\'.\'">\'.$crumbGap.\'</span>\';
        }

        // Stop here if we\'re not looking for the home crumb
        if ( !$showHomeCrumb )
        {
            break;
        }
    }
}

// Put in correct order for output
$pretemplateCrumbs = array_reverse($pretemplateCrumbs);

// Wrap first/last spans
$pretemplateCrumbs[0] = str_replace(
    array(\'[+firstCrumbClass+]\',\'[+firstCrumbSpanA+]\'),
    array($stylePrefix.\'firstCrumb\',$pretemplateCrumbs[0]),
    $templates[$templateSet][\'firstCrumbWrapper\']
);
$pretemplateCrumbs[(count($pretemplateCrumbs)-1)] = str_replace(
    array(\'[+lastCrumbClass+]\',\'[+lastCrumbSpanA+]\'),
    array($stylePrefix.\'lastCrumb\',$pretemplateCrumbs[(count($pretemplateCrumbs)-1)]),
    $templates[$templateSet][\'lastCrumbWrapper\']
);

// Insert crumbs into crumb template
$processedCrumbs = array();
foreach ( $pretemplateCrumbs as $pc )
{
    $processedCrumbs[] = str_replace(\'[+crumb+]\',$pc,$templates[$templateSet][\'crumb\']);
}

// Combine crumbs together into one string with separator
$processedCrumbs = implode($templates[$templateSet][\'separator\'],$processedCrumbs);

// Put crumbs into crumb container template
$container = str_replace(
    array(\'[+crumbBoxClass+]\',\'[+crumbs+]\'),
    array($stylePrefix.\'crumbBox\',$processedCrumbs),
    $templates[$templateSet][\'crumbContainer\']
    );

// Return crumbs
return $container;';
$s['Breadcrumbs'] = '/*
 * This snippet shows the path through the various levels of site structure. It
 * is NOT necessarily the path the user took to arrive at a given page.
 */

/* -----------------------------------------------------------------------------
 * CONFIGURATION
 * -----------------------------------------------------------------------------
 * This section contains brief explanations of the available parameters.
 */

/* General setup
 * -----------------------------------------------------------------------------
 */

/* $maxCrumbs [ integer ]
 * Max number of elemetns to have in a breadcrumb path. The default 100 is an
 * arbitrarily high number that will essentially include everything. If you were
 * to set it to 2, and you were 5 levels deep, it would appear like:
 * HOME > ... > Level 3 > Level 4 > CURRENT PAGE
 * It should be noted that the "home" link, and the current page do not count as
 * they are managed by their own configuration settings.
 */
( isset($maxCrumbs) ) ? $maxCrumbs : $maxCrumbs = 100;

/* $pathThruUnPub [ 1 | 0 ]
 * When your path includes an unpublished folder, setting this to 1 (true) will
 * show all documents in path EXCEPT the unpublished. When set to 0 (false), the
 * path will not go "through" that unpublished folder and will stop there.
 */
( isset($pathThruUnPub) ) ? $pathThruUnPub : $pathThruUnPub = 1;

/* $respectHidemenu [ 0 | 1 ]
 * Setting this to 1 (true) will respect the hidemenu setting of the document
 * and not include it in trail.
 */
( isset($respectHidemenu) ) ? (int)$respectHidemenu : $respectHidemenu = 1;

/* $showCurrentCrumb [ 1 | 0 ]
 * Include the current page at the end of the trail. On by default.
 */
( isset($showCurrentCrumb) ) ? $showCurrentCrumb : $showCurrentCrumb = 1;

/* $currentAsLink [ 1 | 0 ]
 * If the current page is included, this parameter will show it as a link (1) or
 * just plain text (0).
 */
( $currentAsLink ) ? $currentAsLink : $currentAsLink = 0;

/* $linkTextField [ string ]
 * Prioritized list of fields to use as link text. Options are: pagetitle,
 * longtitle, description, menutitle. The first of these fields that has a value
 * will be the title.
 */
( isset($linkTextField) ) ? $linkTextField : $linkTextField = \'menutitle,pagetitle,longtitle\';

/* $linkDescField [ string ]
 * Prioritized list of fields to use as link title text. Options are: pagetitle,
 * longtitle, description, menutitle. The first of these fields that has a value
 * will be the title.
 */
( isset($linkDescField) ) ? $linkDescField : $linkDescField = \'description,longtitle,pagetitle,menutitle\';

/* $showCrumbsAsLinks [ 1 | 0 ]
 * If for some reason you want breadcrumbs to be text and not links, set to 0
 * (false).
 */
( isset($showCrumbsAsLinks) ) ? $showCrumbsAsLinks : $showCrumbsAsLinks = 1;

/* $templateSet [ string ]
 * The set of templates you\'d like to use. (Templates are defined below.) It
 * will default to defaultString which replicates the output of previous
 * versions.
 */
( isset($templateSet) ) ? $templateSet : $templateSet = \'defaultString\';

/* $crumbGap [ string ]
 * String to be shown to represent gap if there are more crumbs in trail than
 * can be shown. Note: if you would like to use an image, the entire image tag
 * must be provided. When making a snippet call, you cannot use "=", so use "||"
 * instead and it will be converted for you.
 */
( isset($crumbGap) ) ? $crumbGap : $crumbGap = \'...\';

/* $stylePrefix [ string ]
 * Breadcrumbs will add style classes to various parts of the trail. To avoid
 * class name conflicts, you can determine your own prefix. The following
 * classes will be attached:
 * crumbBox: Span that surrounds all crumb output
 * hideCrumb: Span that surrounds the "..." if there are more crumbs than will
 * be shown
 * currentCrumb: Span or A tag surrounding the current crumb
 * firstCrumb: Span that will be applied to first crumb, whether it is "home" or
 * not
 * lastCrumb: Span surrounding last crumb, whether it is the current page or
 * not
 * crumb: Class given to each A tag surrounding the intermediate crumbs (not
 * "home", "current", or "hide")
 * homeCrumb: Class given to the home crumb
 */
( isset($stylePrefix) ) ? $stylePrefix : $stylePrefix = \'B_\';



/* Home link parameters
 * -----------------------------------------------------------------------------
 * The home link is unique. It is a link that can be placed at the head of the
 * breadcrumb trail, even if it is not truly in the hierarchy.
 */

/* $showHomeCrumb [ 1 | 0 ]
 * This toggles the "home" crumb to be added to the beginning of your trail.
 */
( isset($showHomeCrumb) ) ? $showHomeCrumb : $showHomeCrumb = 1;

/* $homeId [ integer ]
 * Usually the page designated as "site start" in MODx configuration is
 * considered the home page. But if you would like to use some other document,
 * you may explicitly define it.
 */
( isset($homeId) ) ? (int)$homeId : $homeId = $modx->config[\'site_start\'];

/* $homeCrumbTitle [ string ]
 * If you\'d like to use something other than the menutitle (or pagetitle) for
 * the home link.
 */
( isset($homeCrumbTitle) ) ? $homeCrumbTitle : $homeCrumbTitle = \'\';

/* $homeCrumbDescription [ string ]
 * If you\'d like to use a custom description (link title) on the home link. If
 * left blank, the title will follow the title order set in $titleField.
 */
( isset($homeCrumbDescription) ) ? $homeCrumbDescription : $homeCrumbDescription = \'\';


/* Custom behaviors
 * -----------------------------------------------------------------------------
 * The following parameters will alter the behavior of the Breadcrumbs based on
 * the page it is on.
 */

/* $showCrumbsAtHome [ 1 | 0 ]
 * You can turn off Breadcrumbs all together on the home page by setting this to
 * 1 (true);
 */
( isset($showCrumbsAtHome) ) ? $showCrumbsAtHome : $showCrumbsAtHome = 0;

/* $hideOn [ string ]
 * Comma separated list of documents you don\'t want Breadcrumbs on at all. If
 * you have a LOT of pages like this, you might try $hideUnder or use another
 * template. This parameter is best for those rare odd balls - otherwise it will
 * become a pain to manage.
 */
( isset($hideOn) ) ? $hideOn : $hideOn = \'\';

/* $hideUnder [ string ]
 * Comma separated list of parent documents, whose CHILDREN you don\'t want
 * Breadcrumbs to appear on at all. This enables you to hide Breadcrumbs on a
 * whole folders worth of documents by specifying the parent only. The PARENT
 * will not have Breadcrumbs hidden however. If you wanted to hide the parent
 * and the children, put the parent ID in hideUnder AND hideOn.
 */
( isset($hideUnder) ) ? $hideUnder : $hideUnder = \'\';

/* $stopIds [ string ]
 * Comma separated list of document IDs that when reached, stops Breadcrumbs
 * from going any further. This is useful in situations like where you have
 * language branches, and you don\'t want the Breadcrumbs going past the "home"
 * of the language you\'re in.
 */
( isset($stopIds) ) ? $stopIds : $stopIds = \'\';

/* $ignoreIds [ string ]
 * Comma separated list of document IDs to explicitly ignore.
 */
( isset($ignoreIds) ) ? $ignoreids : $ignoreids = \'\';

/* Templates
 * -----------------------------------------------------------------------------
 * In an effort to keep the MODx chunks manager from getting mired down in lots
 * of templates, Breadcrumbs templates are included here. Two sets are provided
 * prefixed with defaultString, and defaultList. You can create as many more as
 * you like, each set with it\'s own prefix
 */
$templates = array(
    \'defaultString\' => array(
        \'crumb\' => \'[+crumb+]\',
        \'separator\' => \' &raquo; \',
        \'crumbContainer\' => \'<span class="[+crumbBoxClass+]">[+crumbs+]</span>\',
        \'lastCrumbWrapper\' => \'<span class="[+lastCrumbClass+]">[+lastCrumbSpanA+]</span>\',
        \'firstCrumbWrapper\' => \'<span class="[+firstCrumbClass+]">[+firstCrumbSpanA+]</span>\'
    ),
    \'defaultList\' => array(
        \'crumb\' => \'<li>[+crumb+]</li>\',
        \'separator\' => \'\',
        \'crumbContainer\' => \'<ul class="[+crumbBoxClass+]">[+crumbs+]</ul>\',
        \'lastCrumbWrapper\' => \'<span class="[+lastCrumbClass+]">[+lastCrumbSpanA+]</span>\',
        \'firstCrumbWrapper\' => \'<span class="[+firstCrumbClass+]">[+firstCrumbSpanA+]</span>\'
    ),
);


/* -----------------------------------------------------------------------------
 * END CONFIGURATION
 * -----------------------------------------------------------------------------
 */

// Return blank if necessary: on home page
if ( !$showCrumbsAtHome && $homeId == $modx->documentObject[\'id\'] )
{
    return \'\';
}
// Return blank if necessary: specified pages
if ( $hideOn || $hideUnder )
{
    // Create array of hide pages
    $hideOn = str_replace(\' \',\'\',$hideOn);
    $hideOn = explode(\',\',$hideOn);

    // Get more hide pages based on parents if needed
    if ( $hideUnder )
    {
        $hiddenKids = array();
        // Get child pages to hide
        $hideKidsQuery = $modx->db->select(\'id\',$modx->getFullTableName("site_content"),"parent IN ($hideUnder)");
        while ( $hideKid = $modx->db->getRow($hideKidsQuery) )
        {
            $hiddenKids[] = $hideKid[\'id\'];
        }
        // Merge with hideOn pages
        $hideOn = array_merge($hideOn,$hiddenKids);
    }

    if ( in_array($modx->documentObject[\'id\'],$hideOn) )
    {
        return \'\';
    }

}


// Initialize ------------------------------------------------------------------

// Put certain parameters in arrays
$stopIds = str_replace(\' \',\'\',$stopIds);
$stopIds = explode(\',\',$stopIds);
$linkTextField = str_replace(\' \',\'\',$linkTextField);
$linkTextField = explode(\',\',$linkTextField);
$linkDescField = str_replace(\' \',\'\',$linkDescField);
$linkDescField = explode(\',\',$linkDescField);
$ignoreIds = str_replace(\' \',\'\',$ignoreIds);
$ignoreIds = explode(\',\',$ignoreIds);

/* $crumbs
 * Crumb elements are: id, parent, pagetitle, longtitle, menutitle, description,
 * published, hidemenu
 */
$crumbs = array();
$parent = $modx->documentObject[\'parent\'];
$output = \'\';
$maxCrumbs += ($showCurrentCrumb) ? 1 : 0;

// Replace || in snippet parameters that accept them with =
$crumbGap = str_replace(\'||\',\'=\',$crumbGap);

// Curent crumb ----------------------------------------------------------------

// Decide if current page is to be a crumb
if ( $showCurrentCrumb )
{
    $crumbs[] = array(
        \'id\' => $modx->documentObject[\'id\'],
        \'parent\' => $modx->documentObject[\'parent\'],
        \'pagetitle\' => $modx->documentObject[\'pagetitle\'],
        \'longtitle\' => $modx->documentObject[\'longtitle\'],
        \'menutitle\' => $modx->documentObject[\'menutitle\'],
        \'description\' => $modx->documentObject[\'description\']);
}

// Intermediate crumbs ---------------------------------------------------------


// Iterate through parents till we hit root or a reason to stop
$loopSafety = 0;
while ( $parent && $parent!=$modx->config[\'site_start\'] && $loopSafety < 1000 )
{
    // Get next crumb
    $tempCrumb = $modx->getPageInfo($parent,0,"id,parent,pagetitle,longtitle,menutitle,description,published,hidemenu");

    // Check for include conditions & add to crumbs
    if (
        $tempCrumb[\'published\'] &&
        ( !$tempCrumb[\'hidemenu\'] || !$respectHidemenu ) &&
        !in_array($tempCrumb[\'id\'],$ignoreIds)
    )
    {
        // Add crumb
        $crumbs[] = array(
        \'id\' => $tempCrumb[\'id\'],
        \'parent\' => $tempCrumb[\'parent\'],
        \'pagetitle\' => $tempCrumb[\'pagetitle\'],
        \'longtitle\' => $tempCrumb[\'longtitle\'],
        \'menutitle\' => $tempCrumb[\'menutitle\'],
        \'description\' => $tempCrumb[\'description\']);
    }

    // Check stop conditions
    if (
        in_array($tempCrumb[\'id\'],$stopIds) ||  // Is one of the stop IDs
        !$tempCrumb[\'parent\'] || // At root
        ( !$tempCrumb[\'published\'] && !$pathThruUnPub ) // Unpublished
    )
    {
        // Halt making crumbs
        break;
    }

    // Reset parent
    $parent = $tempCrumb[\'parent\'];

    // Increment loop safety
    $loopSafety++;
}

// Home crumb ------------------------------------------------------------------

if ( $showHomeCrumb && $homeId != $modx->documentObject[\'id\'] && $homeCrumb = $modx->getPageInfo($homeId,0,"id,parent,pagetitle,longtitle,menutitle,description,published,hidemenu") )
{
    $crumbs[] = array(
    \'id\' => $homeCrumb[\'id\'],
    \'parent\' => $homeCrumb[\'parent\'],
    \'pagetitle\' => $homeCrumb[\'pagetitle\'],
    \'longtitle\' => $homeCrumb[\'longtitle\'],
    \'menutitle\' => $homeCrumb[\'menutitle\'],
    \'description\' => $homeCrumb[\'description\']);
}


// Process each crumb ----------------------------------------------------------
$pretemplateCrumbs = array();

foreach ( $crumbs as $c )
{

    // Skip if we\'ve exceeded our crumb limit but we\'re waiting to get to home
    if ( count($pretemplateCrumbs) > $maxCrumbs && $c[\'id\'] != $homeId )
    {
        continue;
    }

    $text = \'\';
    $title = \'\';
    $pretemplateCrumb = \'\';

    // Determine appropriate span/link text: home link specified
    if ( $c[\'id\'] == $homeId && $homeCrumbTitle )
    {
        $text = $homeCrumbTitle;
    }
    else
    // Determine appropriate span/link text: home link not specified
    {
        for ($i = 0; !$text && $i < count($linkTextField); $i++)
        {
            if ( $c[$linkTextField[$i]] )
            {
                $text = $c[$linkTextField[$i]];
            }
        }
    }

    // Determine link/span class(es)
    if ( $c[\'id\'] == $homeId )
    {
        $crumbClass = $stylePrefix.\'homeCrumb\';
    }
    else if ( $modx->documentObject[\'id\'] == $c[\'id\'] )
    {
        $crumbClass = $stylePrefix.\'currentCrumb\';
    }
    else
    {
        $crumbClass = $stylePrefix.\'crumb\';
    }

    // Make link
    if (
        ( $c[\'id\'] != $modx->documentObject[\'id\'] && $showCrumbsAsLinks ) ||
        ( $c[\'id\'] == $modx->documentObject[\'id\'] && $currentAsLink )
    )
    {
        // Determine appropriate title for link: home link specified
        if ( $c[\'id\'] == $homeId && $homeCrumbDescription )
        {
            $title = htmlspecialchars($homeCrumbDescription);
        }
        else
        // Determine appropriate title for link: home link not specified
        {
            for ($i = 0; !$title && $i < count($linkDescField); $i++)
            {
                if ( $c[$linkDescField[$i]] )
                {
                    $title = htmlspecialchars($c[$linkDescField[$i]]);
                }
            }
        }


        $pretemplateCrumb .= \'<a class="\'.$crumbClass.\'" href="\'.($c[\'id\'] == $modx->config[\'site_start\'] ? $modx->config[\'base_url\'] : $modx->makeUrl($c[\'id\'])).\'" title="\'.$title.\'">\'.$text.\'</a>\';
    }
    else
    // Make a span instead of a link
    {
       $pretemplateCrumb .= \'<span class="\'.$crumbClass.\'">\'.$text.\'</span>\';
    }

    // Add crumb to pretemplate crumb array
    $pretemplateCrumbs[] = $pretemplateCrumb;

    // If we have hit the crumb limit
    if ( count($pretemplateCrumbs) == $maxCrumbs )
    {
        if ( count($crumbs) > ($maxCrumbs + (($showHomeCrumb) ? 1 : 0)) )
        {
            // Add gap
            $pretemplateCrumbs[] = \'<span class="\'.$stylePrefix.\'hideCrumb\'.\'">\'.$crumbGap.\'</span>\';
        }

        // Stop here if we\'re not looking for the home crumb
        if ( !$showHomeCrumb )
        {
            break;
        }
    }
}

// Put in correct order for output
$pretemplateCrumbs = array_reverse($pretemplateCrumbs);

// Wrap first/last spans
$pretemplateCrumbs[0] = str_replace(
    array(\'[+firstCrumbClass+]\',\'[+firstCrumbSpanA+]\'),
    array($stylePrefix.\'firstCrumb\',$pretemplateCrumbs[0]),
    $templates[$templateSet][\'firstCrumbWrapper\']
);
$pretemplateCrumbs[(count($pretemplateCrumbs)-1)] = str_replace(
    array(\'[+lastCrumbClass+]\',\'[+lastCrumbSpanA+]\'),
    array($stylePrefix.\'lastCrumb\',$pretemplateCrumbs[(count($pretemplateCrumbs)-1)]),
    $templates[$templateSet][\'lastCrumbWrapper\']
);

// Insert crumbs into crumb template
$processedCrumbs = array();
foreach ( $pretemplateCrumbs as $pc )
{
    $processedCrumbs[] = str_replace(\'[+crumb+]\',$pc,$templates[$templateSet][\'crumb\']);
}

// Combine crumbs together into one string with separator
$processedCrumbs = implode($templates[$templateSet][\'separator\'],$processedCrumbs);

// Put crumbs into crumb container template
$container = str_replace(
    array(\'[+crumbBoxClass+]\',\'[+crumbs+]\'),
    array($stylePrefix.\'crumbBox\',$processedCrumbs),
    $templates[$templateSet][\'crumbContainer\']
    );

// Return crumbs
return $container;';
$s['BreadcrumbsProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['Breadcrumbs'] = '/*
 * This snippet shows the path through the various levels of site structure. It
 * is NOT necessarily the path the user took to arrive at a given page.
 */

/* -----------------------------------------------------------------------------
 * CONFIGURATION
 * -----------------------------------------------------------------------------
 * This section contains brief explanations of the available parameters.
 */

/* General setup
 * -----------------------------------------------------------------------------
 */

/* $maxCrumbs [ integer ]
 * Max number of elemetns to have in a breadcrumb path. The default 100 is an
 * arbitrarily high number that will essentially include everything. If you were
 * to set it to 2, and you were 5 levels deep, it would appear like:
 * HOME > ... > Level 3 > Level 4 > CURRENT PAGE
 * It should be noted that the "home" link, and the current page do not count as
 * they are managed by their own configuration settings.
 */
( isset($maxCrumbs) ) ? $maxCrumbs : $maxCrumbs = 100;

/* $pathThruUnPub [ 1 | 0 ]
 * When your path includes an unpublished folder, setting this to 1 (true) will
 * show all documents in path EXCEPT the unpublished. When set to 0 (false), the
 * path will not go "through" that unpublished folder and will stop there.
 */
( isset($pathThruUnPub) ) ? $pathThruUnPub : $pathThruUnPub = 1;

/* $respectHidemenu [ 0 | 1 ]
 * Setting this to 1 (true) will respect the hidemenu setting of the document
 * and not include it in trail.
 */
( isset($respectHidemenu) ) ? (int)$respectHidemenu : $respectHidemenu = 1;

/* $showCurrentCrumb [ 1 | 0 ]
 * Include the current page at the end of the trail. On by default.
 */
( isset($showCurrentCrumb) ) ? $showCurrentCrumb : $showCurrentCrumb = 1;

/* $currentAsLink [ 1 | 0 ]
 * If the current page is included, this parameter will show it as a link (1) or
 * just plain text (0).
 */
( $currentAsLink ) ? $currentAsLink : $currentAsLink = 0;

/* $linkTextField [ string ]
 * Prioritized list of fields to use as link text. Options are: pagetitle,
 * longtitle, description, menutitle. The first of these fields that has a value
 * will be the title.
 */
( isset($linkTextField) ) ? $linkTextField : $linkTextField = \'menutitle,pagetitle,longtitle\';

/* $linkDescField [ string ]
 * Prioritized list of fields to use as link title text. Options are: pagetitle,
 * longtitle, description, menutitle. The first of these fields that has a value
 * will be the title.
 */
( isset($linkDescField) ) ? $linkDescField : $linkDescField = \'description,longtitle,pagetitle,menutitle\';

/* $showCrumbsAsLinks [ 1 | 0 ]
 * If for some reason you want breadcrumbs to be text and not links, set to 0
 * (false).
 */
( isset($showCrumbsAsLinks) ) ? $showCrumbsAsLinks : $showCrumbsAsLinks = 1;

/* $templateSet [ string ]
 * The set of templates you\'d like to use. (Templates are defined below.) It
 * will default to defaultString which replicates the output of previous
 * versions.
 */
( isset($templateSet) ) ? $templateSet : $templateSet = \'defaultString\';

/* $crumbGap [ string ]
 * String to be shown to represent gap if there are more crumbs in trail than
 * can be shown. Note: if you would like to use an image, the entire image tag
 * must be provided. When making a snippet call, you cannot use "=", so use "||"
 * instead and it will be converted for you.
 */
( isset($crumbGap) ) ? $crumbGap : $crumbGap = \'...\';

/* $stylePrefix [ string ]
 * Breadcrumbs will add style classes to various parts of the trail. To avoid
 * class name conflicts, you can determine your own prefix. The following
 * classes will be attached:
 * crumbBox: Span that surrounds all crumb output
 * hideCrumb: Span that surrounds the "..." if there are more crumbs than will
 * be shown
 * currentCrumb: Span or A tag surrounding the current crumb
 * firstCrumb: Span that will be applied to first crumb, whether it is "home" or
 * not
 * lastCrumb: Span surrounding last crumb, whether it is the current page or
 * not
 * crumb: Class given to each A tag surrounding the intermediate crumbs (not
 * "home", "current", or "hide")
 * homeCrumb: Class given to the home crumb
 */
( isset($stylePrefix) ) ? $stylePrefix : $stylePrefix = \'B_\';



/* Home link parameters
 * -----------------------------------------------------------------------------
 * The home link is unique. It is a link that can be placed at the head of the
 * breadcrumb trail, even if it is not truly in the hierarchy.
 */

/* $showHomeCrumb [ 1 | 0 ]
 * This toggles the "home" crumb to be added to the beginning of your trail.
 */
( isset($showHomeCrumb) ) ? $showHomeCrumb : $showHomeCrumb = 1;

/* $homeId [ integer ]
 * Usually the page designated as "site start" in MODx configuration is
 * considered the home page. But if you would like to use some other document,
 * you may explicitly define it.
 */
( isset($homeId) ) ? (int)$homeId : $homeId = $modx->config[\'site_start\'];

/* $homeCrumbTitle [ string ]
 * If you\'d like to use something other than the menutitle (or pagetitle) for
 * the home link.
 */
( isset($homeCrumbTitle) ) ? $homeCrumbTitle : $homeCrumbTitle = \'\';

/* $homeCrumbDescription [ string ]
 * If you\'d like to use a custom description (link title) on the home link. If
 * left blank, the title will follow the title order set in $titleField.
 */
( isset($homeCrumbDescription) ) ? $homeCrumbDescription : $homeCrumbDescription = \'\';


/* Custom behaviors
 * -----------------------------------------------------------------------------
 * The following parameters will alter the behavior of the Breadcrumbs based on
 * the page it is on.
 */

/* $showCrumbsAtHome [ 1 | 0 ]
 * You can turn off Breadcrumbs all together on the home page by setting this to
 * 1 (true);
 */
( isset($showCrumbsAtHome) ) ? $showCrumbsAtHome : $showCrumbsAtHome = 0;

/* $hideOn [ string ]
 * Comma separated list of documents you don\'t want Breadcrumbs on at all. If
 * you have a LOT of pages like this, you might try $hideUnder or use another
 * template. This parameter is best for those rare odd balls - otherwise it will
 * become a pain to manage.
 */
( isset($hideOn) ) ? $hideOn : $hideOn = \'\';

/* $hideUnder [ string ]
 * Comma separated list of parent documents, whose CHILDREN you don\'t want
 * Breadcrumbs to appear on at all. This enables you to hide Breadcrumbs on a
 * whole folders worth of documents by specifying the parent only. The PARENT
 * will not have Breadcrumbs hidden however. If you wanted to hide the parent
 * and the children, put the parent ID in hideUnder AND hideOn.
 */
( isset($hideUnder) ) ? $hideUnder : $hideUnder = \'\';

/* $stopIds [ string ]
 * Comma separated list of document IDs that when reached, stops Breadcrumbs
 * from going any further. This is useful in situations like where you have
 * language branches, and you don\'t want the Breadcrumbs going past the "home"
 * of the language you\'re in.
 */
( isset($stopIds) ) ? $stopIds : $stopIds = \'\';

/* $ignoreIds [ string ]
 * Comma separated list of document IDs to explicitly ignore.
 */
( isset($ignoreIds) ) ? $ignoreids : $ignoreids = \'\';

/* Templates
 * -----------------------------------------------------------------------------
 * In an effort to keep the MODx chunks manager from getting mired down in lots
 * of templates, Breadcrumbs templates are included here. Two sets are provided
 * prefixed with defaultString, and defaultList. You can create as many more as
 * you like, each set with it\'s own prefix
 */
$templates = array(
    \'defaultString\' => array(
        \'crumb\' => \'[+crumb+]\',
        \'separator\' => \' &raquo; \',
        \'crumbContainer\' => \'<span class="[+crumbBoxClass+]">[+crumbs+]</span>\',
        \'lastCrumbWrapper\' => \'<span class="[+lastCrumbClass+]">[+lastCrumbSpanA+]</span>\',
        \'firstCrumbWrapper\' => \'<span class="[+firstCrumbClass+]">[+firstCrumbSpanA+]</span>\'
    ),
    \'defaultList\' => array(
        \'crumb\' => \'<li>[+crumb+]</li>\',
        \'separator\' => \'\',
        \'crumbContainer\' => \'<ul class="[+crumbBoxClass+]">[+crumbs+]</ul>\',
        \'lastCrumbWrapper\' => \'<span class="[+lastCrumbClass+]">[+lastCrumbSpanA+]</span>\',
        \'firstCrumbWrapper\' => \'<span class="[+firstCrumbClass+]">[+firstCrumbSpanA+]</span>\'
    ),
);


/* -----------------------------------------------------------------------------
 * END CONFIGURATION
 * -----------------------------------------------------------------------------
 */

// Return blank if necessary: on home page
if ( !$showCrumbsAtHome && $homeId == $modx->documentObject[\'id\'] )
{
    return \'\';
}
// Return blank if necessary: specified pages
if ( $hideOn || $hideUnder )
{
    // Create array of hide pages
    $hideOn = str_replace(\' \',\'\',$hideOn);
    $hideOn = explode(\',\',$hideOn);

    // Get more hide pages based on parents if needed
    if ( $hideUnder )
    {
        $hiddenKids = array();
        // Get child pages to hide
        $hideKidsQuery = $modx->db->select(\'id\',$modx->getFullTableName("site_content"),"parent IN ($hideUnder)");
        while ( $hideKid = $modx->db->getRow($hideKidsQuery) )
        {
            $hiddenKids[] = $hideKid[\'id\'];
        }
        // Merge with hideOn pages
        $hideOn = array_merge($hideOn,$hiddenKids);
    }

    if ( in_array($modx->documentObject[\'id\'],$hideOn) )
    {
        return \'\';
    }

}


// Initialize ------------------------------------------------------------------

// Put certain parameters in arrays
$stopIds = str_replace(\' \',\'\',$stopIds);
$stopIds = explode(\',\',$stopIds);
$linkTextField = str_replace(\' \',\'\',$linkTextField);
$linkTextField = explode(\',\',$linkTextField);
$linkDescField = str_replace(\' \',\'\',$linkDescField);
$linkDescField = explode(\',\',$linkDescField);
$ignoreIds = str_replace(\' \',\'\',$ignoreIds);
$ignoreIds = explode(\',\',$ignoreIds);

/* $crumbs
 * Crumb elements are: id, parent, pagetitle, longtitle, menutitle, description,
 * published, hidemenu
 */
$crumbs = array();
$parent = $modx->documentObject[\'parent\'];
$output = \'\';
$maxCrumbs += ($showCurrentCrumb) ? 1 : 0;

// Replace || in snippet parameters that accept them with =
$crumbGap = str_replace(\'||\',\'=\',$crumbGap);

// Curent crumb ----------------------------------------------------------------

// Decide if current page is to be a crumb
if ( $showCurrentCrumb )
{
    $crumbs[] = array(
        \'id\' => $modx->documentObject[\'id\'],
        \'parent\' => $modx->documentObject[\'parent\'],
        \'pagetitle\' => $modx->documentObject[\'pagetitle\'],
        \'longtitle\' => $modx->documentObject[\'longtitle\'],
        \'menutitle\' => $modx->documentObject[\'menutitle\'],
        \'description\' => $modx->documentObject[\'description\']);
}

// Intermediate crumbs ---------------------------------------------------------


// Iterate through parents till we hit root or a reason to stop
$loopSafety = 0;
while ( $parent && $parent!=$modx->config[\'site_start\'] && $loopSafety < 1000 )
{
    // Get next crumb
    $tempCrumb = $modx->getPageInfo($parent,0,"id,parent,pagetitle,longtitle,menutitle,description,published,hidemenu");

    // Check for include conditions & add to crumbs
    if (
        $tempCrumb[\'published\'] &&
        ( !$tempCrumb[\'hidemenu\'] || !$respectHidemenu ) &&
        !in_array($tempCrumb[\'id\'],$ignoreIds)
    )
    {
        // Add crumb
        $crumbs[] = array(
        \'id\' => $tempCrumb[\'id\'],
        \'parent\' => $tempCrumb[\'parent\'],
        \'pagetitle\' => $tempCrumb[\'pagetitle\'],
        \'longtitle\' => $tempCrumb[\'longtitle\'],
        \'menutitle\' => $tempCrumb[\'menutitle\'],
        \'description\' => $tempCrumb[\'description\']);
    }

    // Check stop conditions
    if (
        in_array($tempCrumb[\'id\'],$stopIds) ||  // Is one of the stop IDs
        !$tempCrumb[\'parent\'] || // At root
        ( !$tempCrumb[\'published\'] && !$pathThruUnPub ) // Unpublished
    )
    {
        // Halt making crumbs
        break;
    }

    // Reset parent
    $parent = $tempCrumb[\'parent\'];

    // Increment loop safety
    $loopSafety++;
}

// Home crumb ------------------------------------------------------------------

if ( $showHomeCrumb && $homeId != $modx->documentObject[\'id\'] && $homeCrumb = $modx->getPageInfo($homeId,0,"id,parent,pagetitle,longtitle,menutitle,description,published,hidemenu") )
{
    $crumbs[] = array(
    \'id\' => $homeCrumb[\'id\'],
    \'parent\' => $homeCrumb[\'parent\'],
    \'pagetitle\' => $homeCrumb[\'pagetitle\'],
    \'longtitle\' => $homeCrumb[\'longtitle\'],
    \'menutitle\' => $homeCrumb[\'menutitle\'],
    \'description\' => $homeCrumb[\'description\']);
}


// Process each crumb ----------------------------------------------------------
$pretemplateCrumbs = array();

foreach ( $crumbs as $c )
{

    // Skip if we\'ve exceeded our crumb limit but we\'re waiting to get to home
    if ( count($pretemplateCrumbs) > $maxCrumbs && $c[\'id\'] != $homeId )
    {
        continue;
    }

    $text = \'\';
    $title = \'\';
    $pretemplateCrumb = \'\';

    // Determine appropriate span/link text: home link specified
    if ( $c[\'id\'] == $homeId && $homeCrumbTitle )
    {
        $text = $homeCrumbTitle;
    }
    else
    // Determine appropriate span/link text: home link not specified
    {
        for ($i = 0; !$text && $i < count($linkTextField); $i++)
        {
            if ( $c[$linkTextField[$i]] )
            {
                $text = $c[$linkTextField[$i]];
            }
        }
    }

    // Determine link/span class(es)
    if ( $c[\'id\'] == $homeId )
    {
        $crumbClass = $stylePrefix.\'homeCrumb\';
    }
    else if ( $modx->documentObject[\'id\'] == $c[\'id\'] )
    {
        $crumbClass = $stylePrefix.\'currentCrumb\';
    }
    else
    {
        $crumbClass = $stylePrefix.\'crumb\';
    }

    // Make link
    if (
        ( $c[\'id\'] != $modx->documentObject[\'id\'] && $showCrumbsAsLinks ) ||
        ( $c[\'id\'] == $modx->documentObject[\'id\'] && $currentAsLink )
    )
    {
        // Determine appropriate title for link: home link specified
        if ( $c[\'id\'] == $homeId && $homeCrumbDescription )
        {
            $title = htmlspecialchars($homeCrumbDescription);
        }
        else
        // Determine appropriate title for link: home link not specified
        {
            for ($i = 0; !$title && $i < count($linkDescField); $i++)
            {
                if ( $c[$linkDescField[$i]] )
                {
                    $title = htmlspecialchars($c[$linkDescField[$i]]);
                }
            }
        }


        $pretemplateCrumb .= \'<a class="\'.$crumbClass.\'" href="\'.($c[\'id\'] == $modx->config[\'site_start\'] ? $modx->config[\'base_url\'] : $modx->makeUrl($c[\'id\'])).\'" title="\'.$title.\'">\'.$text.\'</a>\';
    }
    else
    // Make a span instead of a link
    {
       $pretemplateCrumb .= \'<span class="\'.$crumbClass.\'">\'.$text.\'</span>\';
    }

    // Add crumb to pretemplate crumb array
    $pretemplateCrumbs[] = $pretemplateCrumb;

    // If we have hit the crumb limit
    if ( count($pretemplateCrumbs) == $maxCrumbs )
    {
        if ( count($crumbs) > ($maxCrumbs + (($showHomeCrumb) ? 1 : 0)) )
        {
            // Add gap
            $pretemplateCrumbs[] = \'<span class="\'.$stylePrefix.\'hideCrumb\'.\'">\'.$crumbGap.\'</span>\';
        }

        // Stop here if we\'re not looking for the home crumb
        if ( !$showHomeCrumb )
        {
            break;
        }
    }
}

// Put in correct order for output
$pretemplateCrumbs = array_reverse($pretemplateCrumbs);

// Wrap first/last spans
$pretemplateCrumbs[0] = str_replace(
    array(\'[+firstCrumbClass+]\',\'[+firstCrumbSpanA+]\'),
    array($stylePrefix.\'firstCrumb\',$pretemplateCrumbs[0]),
    $templates[$templateSet][\'firstCrumbWrapper\']
);
$pretemplateCrumbs[(count($pretemplateCrumbs)-1)] = str_replace(
    array(\'[+lastCrumbClass+]\',\'[+lastCrumbSpanA+]\'),
    array($stylePrefix.\'lastCrumb\',$pretemplateCrumbs[(count($pretemplateCrumbs)-1)]),
    $templates[$templateSet][\'lastCrumbWrapper\']
);

// Insert crumbs into crumb template
$processedCrumbs = array();
foreach ( $pretemplateCrumbs as $pc )
{
    $processedCrumbs[] = str_replace(\'[+crumb+]\',$pc,$templates[$templateSet][\'crumb\']);
}

// Combine crumbs together into one string with separator
$processedCrumbs = implode($templates[$templateSet][\'separator\'],$processedCrumbs);

// Put crumbs into crumb container template
$container = str_replace(
    array(\'[+crumbBoxClass+]\',\'[+crumbs+]\'),
    array($stylePrefix.\'crumbBox\',$processedCrumbs),
    $templates[$templateSet][\'crumbContainer\']
    );

// Return crumbs
return $container;';
$s['YouTube'] = '//SETTINGS
$width = isset($width)?$width:425;
$height = isset($height)?$height:350;

// YouTube API settings
$related = isset($related)?$related:true;
$autoplay = isset($autoplay)?$autoplay:false;
$loop = isset($loop)?$loop:false;
$disablekb = isset($disablekb)?$disablekb:false;
$egm = isset($egm)?$egm:false;
$border = isset($border)?$border:false;
$color1 = isset($color1)?$color1:\'\';
$color2 = isset($color2)?$color2:\'\';

// Javascript
$js = isset($js)?$js:true;
$swfobject_url = isset($swfobject_url)?$swfobject_url:\'/assets/js/swfobject/swfobject.js\';
$swfobject_express_url = isset($swfobject_url)?$swfobject_url:\'/assets/js/swfobject/expressInstall.swf\';
$missing = isset($missing)?$missing:\'<p>This video requires the free Flash plugin.</p>\';

// If a URL is supplied, work out the ID part of it
if (isset($url) && $ytid = (getIdFromUrl(urldecode($url))) ) {
   // $ytid is already set
} else if (isset($id)) {
   $ytid =  $id;
} else {   // No URL or ID supplied
   return;   
}

// Ensure the "related" value is appropriate for the YouTube URL
$related_val = ($related)?\'&rel=1\':\'&rel=0\';
$autoplay_val = ($autoplay)?\'&autoplay=1\':\'&autoplay=0\';
$loop_val = ($loop)?\'&loop=1\':\'&loop=0\';
$disablekb_val = ($disablekb)?\'&disablekb=1\':\'&disablekb=0\';
$egm_val = ($egm)?\'&egm=1\':\'&egm=0\';
$border_val = ($border)?\'&border=1\':\'&border=0\';
$color1_val = (!empty($color1))?\'&color1=\'.$color1:\'\';
$color2_val = (!empty($color2))?\'&color2=\'.$color2:\'\';

// Construct the YouTube URL
$yturl =\' http://www.youtube.com/v/\'.$ytid.$related_val.$autoplay_val.$loop_val.$disablekb_val.$egm_val.$border_val.$color1_val.$color2_val.\'&hl=en\';

// HTML template, based on cross-browser recommendation from SWFobject project
$html = \'
   <object id="\'.$ytid.\'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="\'.$width.\'" height="\'.$height.\'">
        <param name="movie" value="\'.$yturl.\'" />
        <!--[if !IE]>-->
        <object type="application/x-shockwave-flash" data="\'.$yturl.\'" width="\'.$width.\'" height="\'.$height.\'">
        <!--<![endif]-->
          \'.$missing.\'
        <!--[if !IE]>-->
        </object>
        <!--<![endif]-->
      </object>
\';


// If we want to use javascript to check Flash version, etc.
if ($js) {
   // Register the SWFObject script
   $modx->regClientStartupScript($swfobject_url);
   
   // Activate the content with JS
   $script = \'
   <script type="text/javascript">
    swfobject.registerObject("\'.$ytid.\'", "8.0.0", "\'.$swfobject_express_url.\'");
   </script>
   \';
   $modx->regClientStartupScript($script);
}

return $html;

if(!function_exists(\'getIdFromUrl\')) {
  function getIdFromUrl($url) {
    $url_parts = parse_url($url);
    parse_str($url_parts[\'query\']);
    if(isset($v)) {
      return $v;    
    } else {
      return false;   
    }
  }
}';
$s['YouTube'] = '//SETTINGS
$width = isset($width)?$width:425;
$height = isset($height)?$height:350;

// YouTube API settings
$related = isset($related)?$related:true;
$autoplay = isset($autoplay)?$autoplay:false;
$loop = isset($loop)?$loop:false;
$disablekb = isset($disablekb)?$disablekb:false;
$egm = isset($egm)?$egm:false;
$border = isset($border)?$border:false;
$color1 = isset($color1)?$color1:\'\';
$color2 = isset($color2)?$color2:\'\';

// Javascript
$js = isset($js)?$js:true;
$swfobject_url = isset($swfobject_url)?$swfobject_url:\'/assets/js/swfobject/swfobject.js\';
$swfobject_express_url = isset($swfobject_url)?$swfobject_url:\'/assets/js/swfobject/expressInstall.swf\';
$missing = isset($missing)?$missing:\'<p>This video requires the free Flash plugin.</p>\';

// If a URL is supplied, work out the ID part of it
if (isset($url) && $ytid = (getIdFromUrl(urldecode($url))) ) {
   // $ytid is already set
} else if (isset($id)) {
   $ytid =  $id;
} else {   // No URL or ID supplied
   return;   
}

// Ensure the "related" value is appropriate for the YouTube URL
$related_val = ($related)?\'&rel=1\':\'&rel=0\';
$autoplay_val = ($autoplay)?\'&autoplay=1\':\'&autoplay=0\';
$loop_val = ($loop)?\'&loop=1\':\'&loop=0\';
$disablekb_val = ($disablekb)?\'&disablekb=1\':\'&disablekb=0\';
$egm_val = ($egm)?\'&egm=1\':\'&egm=0\';
$border_val = ($border)?\'&border=1\':\'&border=0\';
$color1_val = (!empty($color1))?\'&color1=\'.$color1:\'\';
$color2_val = (!empty($color2))?\'&color2=\'.$color2:\'\';

// Construct the YouTube URL
$yturl =\' http://www.youtube.com/v/\'.$ytid.$related_val.$autoplay_val.$loop_val.$disablekb_val.$egm_val.$border_val.$color1_val.$color2_val.\'&hl=en\';

// HTML template, based on cross-browser recommendation from SWFobject project
$html = \'
   <object id="\'.$ytid.\'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="\'.$width.\'" height="\'.$height.\'">
        <param name="movie" value="\'.$yturl.\'" />
        <!--[if !IE]>-->
        <object type="application/x-shockwave-flash" data="\'.$yturl.\'" width="\'.$width.\'" height="\'.$height.\'">
        <!--<![endif]-->
          \'.$missing.\'
        <!--[if !IE]>-->
        </object>
        <!--<![endif]-->
      </object>
\';


// If we want to use javascript to check Flash version, etc.
if ($js) {
   // Register the SWFObject script
   $modx->regClientStartupScript($swfobject_url);
   
   // Activate the content with JS
   $script = \'
   <script type="text/javascript">
    swfobject.registerObject("\'.$ytid.\'", "8.0.0", "\'.$swfobject_express_url.\'");
   </script>
   \';
   $modx->regClientStartupScript($script);
}

return $html;

if(!function_exists(\'getIdFromUrl\')) {
  function getIdFromUrl($url) {
    $url_parts = parse_url($url);
    parse_str($url_parts[\'query\']);
    if(isset($v)) {
      return $v;    
    } else {
      return false;   
    }
  }
}';
$s['YouTube'] = '//SETTINGS
$width = isset($width)?$width:425;
$height = isset($height)?$height:350;

// YouTube API settings
$related = isset($related)?$related:true;
$autoplay = isset($autoplay)?$autoplay:false;
$loop = isset($loop)?$loop:false;
$disablekb = isset($disablekb)?$disablekb:false;
$egm = isset($egm)?$egm:false;
$border = isset($border)?$border:false;
$color1 = isset($color1)?$color1:\'\';
$color2 = isset($color2)?$color2:\'\';

// Javascript
$js = isset($js)?$js:true;
$swfobject_url = isset($swfobject_url)?$swfobject_url:\'/assets/js/swfobject/swfobject.js\';
$swfobject_express_url = isset($swfobject_url)?$swfobject_url:\'/assets/js/swfobject/expressInstall.swf\';
$missing = isset($missing)?$missing:\'<p>This video requires the free Flash plugin.</p>\';

// If a URL is supplied, work out the ID part of it
if (isset($url) && $ytid = (getIdFromUrl(urldecode($url))) ) {
   // $ytid is already set
} else if (isset($id)) {
   $ytid =  $id;
} else {   // No URL or ID supplied
   return;   
}

// Ensure the "related" value is appropriate for the YouTube URL
$related_val = ($related)?\'&rel=1\':\'&rel=0\';
$autoplay_val = ($autoplay)?\'&autoplay=1\':\'&autoplay=0\';
$loop_val = ($loop)?\'&loop=1\':\'&loop=0\';
$disablekb_val = ($disablekb)?\'&disablekb=1\':\'&disablekb=0\';
$egm_val = ($egm)?\'&egm=1\':\'&egm=0\';
$border_val = ($border)?\'&border=1\':\'&border=0\';
$color1_val = (!empty($color1))?\'&color1=\'.$color1:\'\';
$color2_val = (!empty($color2))?\'&color2=\'.$color2:\'\';

// Construct the YouTube URL
$yturl =\' http://www.youtube.com/v/\'.$ytid.$related_val.$autoplay_val.$loop_val.$disablekb_val.$egm_val.$border_val.$color1_val.$color2_val.\'&hl=en\';

// HTML template, based on cross-browser recommendation from SWFobject project
$html = \'
   <object id="\'.$ytid.\'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="\'.$width.\'" height="\'.$height.\'">
        <param name="movie" value="\'.$yturl.\'" />
        <!--[if !IE]>-->
        <object type="application/x-shockwave-flash" data="\'.$yturl.\'" width="\'.$width.\'" height="\'.$height.\'">
        <!--<![endif]-->
          \'.$missing.\'
        <!--[if !IE]>-->
        </object>
        <!--<![endif]-->
      </object>
\';


// If we want to use javascript to check Flash version, etc.
if ($js) {
   // Register the SWFObject script
   $modx->regClientStartupScript($swfobject_url);
   
   // Activate the content with JS
   $script = \'
   <script type="text/javascript">
    swfobject.registerObject("\'.$ytid.\'", "8.0.0", "\'.$swfobject_express_url.\'");
   </script>
   \';
   $modx->regClientStartupScript($script);
}

return $html;

if(!function_exists(\'getIdFromUrl\')) {
  function getIdFromUrl($url) {
    $url_parts = parse_url($url);
    parse_str($url_parts[\'query\']);
    if(isset($v)) {
      return $v;    
    } else {
      return false;   
    }
  }
}';
$s['YouTubeProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['YouTube'] = '//SETTINGS
$width = isset($width)?$width:425;
$height = isset($height)?$height:350;

// YouTube API settings
$related = isset($related)?$related:true;
$autoplay = isset($autoplay)?$autoplay:false;
$loop = isset($loop)?$loop:false;
$disablekb = isset($disablekb)?$disablekb:false;
$egm = isset($egm)?$egm:false;
$border = isset($border)?$border:false;
$color1 = isset($color1)?$color1:\'\';
$color2 = isset($color2)?$color2:\'\';

// Javascript
$js = isset($js)?$js:true;
$swfobject_url = isset($swfobject_url)?$swfobject_url:\'/assets/js/swfobject/swfobject.js\';
$swfobject_express_url = isset($swfobject_url)?$swfobject_url:\'/assets/js/swfobject/expressInstall.swf\';
$missing = isset($missing)?$missing:\'<p>This video requires the free Flash plugin.</p>\';

// If a URL is supplied, work out the ID part of it
if (isset($url) && $ytid = (getIdFromUrl(urldecode($url))) ) {
   // $ytid is already set
} else if (isset($id)) {
   $ytid =  $id;
} else {   // No URL or ID supplied
   return;   
}

// Ensure the "related" value is appropriate for the YouTube URL
$related_val = ($related)?\'&rel=1\':\'&rel=0\';
$autoplay_val = ($autoplay)?\'&autoplay=1\':\'&autoplay=0\';
$loop_val = ($loop)?\'&loop=1\':\'&loop=0\';
$disablekb_val = ($disablekb)?\'&disablekb=1\':\'&disablekb=0\';
$egm_val = ($egm)?\'&egm=1\':\'&egm=0\';
$border_val = ($border)?\'&border=1\':\'&border=0\';
$color1_val = (!empty($color1))?\'&color1=\'.$color1:\'\';
$color2_val = (!empty($color2))?\'&color2=\'.$color2:\'\';

// Construct the YouTube URL
$yturl =\' http://www.youtube.com/v/\'.$ytid.$related_val.$autoplay_val.$loop_val.$disablekb_val.$egm_val.$border_val.$color1_val.$color2_val.\'&hl=en\';

// HTML template, based on cross-browser recommendation from SWFobject project
$html = \'
   <object id="\'.$ytid.\'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="\'.$width.\'" height="\'.$height.\'">
        <param name="movie" value="\'.$yturl.\'" />
        <!--[if !IE]>-->
        <object type="application/x-shockwave-flash" data="\'.$yturl.\'" width="\'.$width.\'" height="\'.$height.\'">
        <!--<![endif]-->
          \'.$missing.\'
        <!--[if !IE]>-->
        </object>
        <!--<![endif]-->
      </object>
\';


// If we want to use javascript to check Flash version, etc.
if ($js) {
   // Register the SWFObject script
   $modx->regClientStartupScript($swfobject_url);
   
   // Activate the content with JS
   $script = \'
   <script type="text/javascript">
    swfobject.registerObject("\'.$ytid.\'", "8.0.0", "\'.$swfobject_express_url.\'");
   </script>
   \';
   $modx->regClientStartupScript($script);
}

return $html;

if(!function_exists(\'getIdFromUrl\')) {
  function getIdFromUrl($url) {
    $url_parts = parse_url($url);
    parse_str($url_parts[\'query\']);
    if(isset($v)) {
      return $v;    
    } else {
      return false;   
    }
  }
}';
$s['MultiPhotos'] = '$tvname = isset($tvname) ? $tvname : \'photos\';
$outerTpl = isset($outerTpl) ? $modx->getChunk($outerTpl) : \'<div class="thumbs">[+photos+]</div>\';
$rowTpl = isset($rowTpl) ? $modx->getChunk($rowTpl) : \'<a href="[+link+]" id="thumb_[+num+]"><img src="[+url+]" alt="" title="[+title+]" /></a>\';
$fid = isset($fid) ? $fid : false;

if (isset($id)) {
	$tvf = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvf[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvf = $modx->documentObject[$tvname];
	$tvv = $tvf[1];
}
if (!$tvv || $tvv==\'[]\') return;
$fotoArr=json_decode($tvv);
$fotoRes=array();
$num=1;
if (!class_exists(\'PHxParser\'))include_once(MODX_BASE_PATH.\'assets/snippets/ditto/classes/phx.parser.class.inc.php\');
foreach ($fotoArr as $v) {
	$phx = new PHxParser();
	$phx->setPHxVariable(\'url\',$v[0]);
	$phx->setPHxVariable(\'link\',$v[1]);
	$phx->setPHxVariable(\'title\',$v[2]);
	$phx->setPHxVariable(\'num\',$num);
	$fotoRes[$num] = $phx->Parse($rowTpl);
	$num++;
}
#################### PAGINATION ####################
$count_per_page = isset($display) ? $display : 10;
$tplLinkNext = \'<a href="[+link+]">>></a>\';
$tplLinkPrev = \'<a href="[+link+]"><<</a>\';
$tplLinkNav = \'<div class="mp_pages">[+linkprev+] [+pages+] [+linknext+]</div>\';
$mp_pagecount=ceil(count($fotoRes)/$count_per_page);
if (!empty($pagination) && $mp_pagecount > 1){
	$mp_currentpage = isset($_GET["page"]) ? intval($_GET["page"]): 1;
	if ($mp_currentpage > $mp_pagecount || $mp_currentpage < 1) { $mp_currentpage = 1; }
	$char = ($modx->config[\'friendly_urls\'] == 0) ? "&" : "?";
	$url = $modx->makeurl($modx->documentObject["id"],\'\',$char.\'page=\');
	$prevpage = $mp_currentpage-1;	$nextpage = $mp_currentpage+1;
	$linkprev = ($prevpage>0) ? str_replace("[+link+]",$url.$prevpage,$tplLinkPrev) : \'\';
	$linknext = ($nextpage>$mp_pagecount) ? \'\' : str_replace("[+link+]",$url.$nextpage,$tplLinkNext);
	$tplPages = str_replace("[+linkprev+]",$linkprev,$tplLinkNav);
	$tplPages = str_replace("[+linknext+]",$linknext,$tplPages);
	$pages=\'\';
	for ($i=1;$i<=$mp_pagecount;$i++){
		$pages .= ($i==$mp_currentpage) ? \'<span class="mp_currentpage">\'.$i.\'</span>\' : \'<a class="mp_page" href="\'.$url.$i.\'">\'.$i.\'</a>\';
		$pages .= ($i==$mp_pagecount) ? \'\' : \' | \';
	}
	$tplPages=str_replace("[+pages+]",$pages,$tplPages);
	$fotoRes=array_slice($fotoRes,$count_per_page*$mp_currentpage-$count_per_page,$count_per_page);
	$outerTpl .= $tplPages;
}
#####################################################
$output = $fid ? $fotoRes[$fid] : implode(\'\',$fotoRes);
if (isset($random)) $output = $fotoRes[array_rand($fotoRes)];
if ($output) return str_replace(\'[+photos+]\',$output,$outerTpl);
?>';
$s['MultiPhotos'] = '$tvname = isset($tvname) ? $tvname : \'photos\';
$outerTpl = isset($outerTpl) ? $modx->getChunk($outerTpl) : \'<div class="thumbs">[+photos+]</div>\';
$rowTpl = isset($rowTpl) ? $modx->getChunk($rowTpl) : \'<a href="[+link+]" id="thumb_[+num+]"><img src="[+url+]" alt="" title="[+title+]" /></a>\';
$fid = isset($fid) ? $fid : false;

if (isset($id)) {
	$tvf = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvf[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvf = $modx->documentObject[$tvname];
	$tvv = $tvf[1];
}
if (!$tvv || $tvv==\'[]\') return;
$fotoArr=json_decode($tvv);
$fotoRes=array();
$num=1;
if (!class_exists(\'PHxParser\'))include_once(MODX_BASE_PATH.\'assets/snippets/ditto/classes/phx.parser.class.inc.php\');
foreach ($fotoArr as $v) {
	$phx = new PHxParser();
	$phx->setPHxVariable(\'url\',$v[0]);
	$phx->setPHxVariable(\'link\',$v[1]);
	$phx->setPHxVariable(\'title\',$v[2]);
	$phx->setPHxVariable(\'num\',$num);
	$fotoRes[$num] = $phx->Parse($rowTpl);
	$num++;
}
#################### PAGINATION ####################
$count_per_page = isset($display) ? $display : 10;
$tplLinkNext = \'<a href="[+link+]">>></a>\';
$tplLinkPrev = \'<a href="[+link+]"><<</a>\';
$tplLinkNav = \'<div class="mp_pages">[+linkprev+] [+pages+] [+linknext+]</div>\';
$mp_pagecount=ceil(count($fotoRes)/$count_per_page);
if (!empty($pagination) && $mp_pagecount > 1){
	$mp_currentpage = isset($_GET["page"]) ? intval($_GET["page"]): 1;
	if ($mp_currentpage > $mp_pagecount || $mp_currentpage < 1) { $mp_currentpage = 1; }
	$char = ($modx->config[\'friendly_urls\'] == 0) ? "&" : "?";
	$url = $modx->makeurl($modx->documentObject["id"],\'\',$char.\'page=\');
	$prevpage = $mp_currentpage-1;	$nextpage = $mp_currentpage+1;
	$linkprev = ($prevpage>0) ? str_replace("[+link+]",$url.$prevpage,$tplLinkPrev) : \'\';
	$linknext = ($nextpage>$mp_pagecount) ? \'\' : str_replace("[+link+]",$url.$nextpage,$tplLinkNext);
	$tplPages = str_replace("[+linkprev+]",$linkprev,$tplLinkNav);
	$tplPages = str_replace("[+linknext+]",$linknext,$tplPages);
	$pages=\'\';
	for ($i=1;$i<=$mp_pagecount;$i++){
		$pages .= ($i==$mp_currentpage) ? \'<span class="mp_currentpage">\'.$i.\'</span>\' : \'<a class="mp_page" href="\'.$url.$i.\'">\'.$i.\'</a>\';
		$pages .= ($i==$mp_pagecount) ? \'\' : \' | \';
	}
	$tplPages=str_replace("[+pages+]",$pages,$tplPages);
	$fotoRes=array_slice($fotoRes,$count_per_page*$mp_currentpage-$count_per_page,$count_per_page);
	$outerTpl .= $tplPages;
}
#####################################################
$output = $fid ? $fotoRes[$fid] : implode(\'\',$fotoRes);
if (isset($random)) $output = $fotoRes[array_rand($fotoRes)];
if ($output) return str_replace(\'[+photos+]\',$output,$outerTpl);
?>';
$s['MultiPhotos'] = '$tvname = isset($tvname) ? $tvname : \'photos\';
$outerTpl = isset($outerTpl) ? $modx->getChunk($outerTpl) : \'<div class="thumbs">[+photos+]</div>\';
$rowTpl = isset($rowTpl) ? $modx->getChunk($rowTpl) : \'<a href="[+link+]" id="thumb_[+num+]"><img src="[+url+]" alt="" title="[+title+]" /></a>\';
$fid = isset($fid) ? $fid : false;

if (isset($id)) {
	$tvf = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvf[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvf = $modx->documentObject[$tvname];
	$tvv = $tvf[1];
}
if (!$tvv || $tvv==\'[]\') return;
$fotoArr=json_decode($tvv);
$fotoRes=array();
$num=1;
if (!class_exists(\'PHxParser\'))include_once(MODX_BASE_PATH.\'assets/snippets/ditto/classes/phx.parser.class.inc.php\');
foreach ($fotoArr as $v) {
	$phx = new PHxParser();
	$phx->setPHxVariable(\'url\',$v[0]);
	$phx->setPHxVariable(\'link\',$v[1]);
	$phx->setPHxVariable(\'title\',$v[2]);
	$phx->setPHxVariable(\'num\',$num);
	$fotoRes[$num] = $phx->Parse($rowTpl);
	$num++;
}
#################### PAGINATION ####################
$count_per_page = isset($display) ? $display : 10;
$tplLinkNext = \'<a href="[+link+]">>></a>\';
$tplLinkPrev = \'<a href="[+link+]"><<</a>\';
$tplLinkNav = \'<div class="mp_pages">[+linkprev+] [+pages+] [+linknext+]</div>\';
$mp_pagecount=ceil(count($fotoRes)/$count_per_page);
if (!empty($pagination) && $mp_pagecount > 1){
	$mp_currentpage = isset($_GET["page"]) ? intval($_GET["page"]): 1;
	if ($mp_currentpage > $mp_pagecount || $mp_currentpage < 1) { $mp_currentpage = 1; }
	$char = ($modx->config[\'friendly_urls\'] == 0) ? "&" : "?";
	$url = $modx->makeurl($modx->documentObject["id"],\'\',$char.\'page=\');
	$prevpage = $mp_currentpage-1;	$nextpage = $mp_currentpage+1;
	$linkprev = ($prevpage>0) ? str_replace("[+link+]",$url.$prevpage,$tplLinkPrev) : \'\';
	$linknext = ($nextpage>$mp_pagecount) ? \'\' : str_replace("[+link+]",$url.$nextpage,$tplLinkNext);
	$tplPages = str_replace("[+linkprev+]",$linkprev,$tplLinkNav);
	$tplPages = str_replace("[+linknext+]",$linknext,$tplPages);
	$pages=\'\';
	for ($i=1;$i<=$mp_pagecount;$i++){
		$pages .= ($i==$mp_currentpage) ? \'<span class="mp_currentpage">\'.$i.\'</span>\' : \'<a class="mp_page" href="\'.$url.$i.\'">\'.$i.\'</a>\';
		$pages .= ($i==$mp_pagecount) ? \'\' : \' | \';
	}
	$tplPages=str_replace("[+pages+]",$pages,$tplPages);
	$fotoRes=array_slice($fotoRes,$count_per_page*$mp_currentpage-$count_per_page,$count_per_page);
	$outerTpl .= $tplPages;
}
#####################################################
$output = $fid ? $fotoRes[$fid] : implode(\'\',$fotoRes);
if (isset($random)) $output = $fotoRes[array_rand($fotoRes)];
if ($output) return str_replace(\'[+photos+]\',$output,$outerTpl);
?>';
$s['MultiPhotosProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$s['MultiPhotos'] = '$tvname = isset($tvname) ? $tvname : \'photos\';
$outerTpl = isset($outerTpl) ? $modx->getChunk($outerTpl) : \'<div class="thumbs">[+photos+]</div>\';
$rowTpl = isset($rowTpl) ? $modx->getChunk($rowTpl) : \'<a href="[+link+]" id="thumb_[+num+]"><img src="[+url+]" alt="" title="[+title+]" /></a>\';
$fid = isset($fid) ? $fid : false;

if (isset($id)) {
	$tvf = $modx->getTemplateVar($tvname,\'*\',$id);
	$tvv = $tvf[\'value\'];
} else {
	$id = $modx->documentObject[\'id\']; 
	$tvf = $modx->documentObject[$tvname];
	$tvv = $tvf[1];
}
if (!$tvv || $tvv==\'[]\') return;
$fotoArr=json_decode($tvv);
$fotoRes=array();
$num=1;
if (!class_exists(\'PHxParser\'))include_once(MODX_BASE_PATH.\'assets/snippets/ditto/classes/phx.parser.class.inc.php\');
foreach ($fotoArr as $v) {
	$phx = new PHxParser();
	$phx->setPHxVariable(\'url\',$v[0]);
	$phx->setPHxVariable(\'link\',$v[1]);
	$phx->setPHxVariable(\'title\',$v[2]);
	$phx->setPHxVariable(\'num\',$num);
	$fotoRes[$num] = $phx->Parse($rowTpl);
	$num++;
}
#################### PAGINATION ####################
$count_per_page = isset($display) ? $display : 10;
$tplLinkNext = \'<a href="[+link+]">>></a>\';
$tplLinkPrev = \'<a href="[+link+]"><<</a>\';
$tplLinkNav = \'<div class="mp_pages">[+linkprev+] [+pages+] [+linknext+]</div>\';
$mp_pagecount=ceil(count($fotoRes)/$count_per_page);
if (!empty($pagination) && $mp_pagecount > 1){
	$mp_currentpage = isset($_GET["page"]) ? intval($_GET["page"]): 1;
	if ($mp_currentpage > $mp_pagecount || $mp_currentpage < 1) { $mp_currentpage = 1; }
	$char = ($modx->config[\'friendly_urls\'] == 0) ? "&" : "?";
	$url = $modx->makeurl($modx->documentObject["id"],\'\',$char.\'page=\');
	$prevpage = $mp_currentpage-1;	$nextpage = $mp_currentpage+1;
	$linkprev = ($prevpage>0) ? str_replace("[+link+]",$url.$prevpage,$tplLinkPrev) : \'\';
	$linknext = ($nextpage>$mp_pagecount) ? \'\' : str_replace("[+link+]",$url.$nextpage,$tplLinkNext);
	$tplPages = str_replace("[+linkprev+]",$linkprev,$tplLinkNav);
	$tplPages = str_replace("[+linknext+]",$linknext,$tplPages);
	$pages=\'\';
	for ($i=1;$i<=$mp_pagecount;$i++){
		$pages .= ($i==$mp_currentpage) ? \'<span class="mp_currentpage">\'.$i.\'</span>\' : \'<a class="mp_page" href="\'.$url.$i.\'">\'.$i.\'</a>\';
		$pages .= ($i==$mp_pagecount) ? \'\' : \' | \';
	}
	$tplPages=str_replace("[+pages+]",$pages,$tplPages);
	$fotoRes=array_slice($fotoRes,$count_per_page*$mp_currentpage-$count_per_page,$count_per_page);
	$outerTpl .= $tplPages;
}
#####################################################
$output = $fid ? $fotoRes[$fid] : implode(\'\',$fotoRes);
if (isset($random)) $output = $fotoRes[array_rand($fotoRes)];
if ($output) return str_replace(\'[+photos+]\',$output,$outerTpl);
?>';
$s['number'] = '

$sename = $_POST[\'senamead\'];  
$namename = $_POST[\'namenamead\'];   
$secname = $_POST[\'secnamead\'];
$email = $_POST[\'emailad\']; 
$phone = "+7".$_POST[\'phone1ad\'].$_POST[\'phone2ad\'];
  
if(isset($sename)){
$res = $modx->db->select("id", "user",  "sename=\'" . $sename ."\' AND namename=\'".$namename."\'"); 
if($modx->db->getRecordCount($res)) {  
$id = $modx->db->getValue($res);
  echo "0";
  exit();
} 
else {
  
$table_name = \'user\';  
$fields = array(
  \'sename\'	=> $sename,  
  \'namename\'	=> $namename,  
  \'secname\'	=> $secname,  
  \'email\'	=> $secname,  
  \'phone1\'	=> $phone
); 
  
  
if( $modx->db->insert( $fields, $table_name) ) { 
 
$id =  $modx->db->getInsertId(); 
$id_len = strlen($id);
  
switch ($id_len) {
case 1:
    $id = "00".$id;
    break;
case 2:
    $id = "0".$id;
    break;
case 3:
    $id = $id;
    break;
}  
  
echo $id; 
exit();}  
}
}
';
$p = &$this->pluginCache;
$p['CodeMirror'] = '/**
 * @name: CodeMirror
 * @description: <b>2.23 b</b> JavaScript library that can be used to create a relatively pleasant editor interface
 *
 * @events:
 * - OnDocFormRender
 * - OnChunkFormRender
 * - OnModFormRender
 * - OnPluginFormRender
 * - OnSnipFormRender
 * - OnTempFormRender
 *
 */

$_CM_BASE = \'assets/plugins/codemirror/\';

$_CM_URL = $modx->config[\'site_url\'] . $_CM_BASE;

require(MODX_BASE_PATH. $_CM_BASE .\'codemirror.plugin.php\');

';
$p['CodeMirrorProps'] = '&theme=Theme;list;,cobalt,ecllipse,elegant,monokai,neat,night,rubyblue; &indentUnit=Indent unit;int;2 &tabSize=The width of a tab character;int;2 &lineWrapping=lineWrapping;list;true,false;true ';
$p['CodeMirror'] = '/**
 * @name: CodeMirror
 * @description: <b>2.23 b</b> JavaScript library that can be used to create a relatively pleasant editor interface
 *
 * @events:
 * - OnDocFormRender
 * - OnChunkFormRender
 * - OnModFormRender
 * - OnPluginFormRender
 * - OnSnipFormRender
 * - OnTempFormRender
 *
 */

$_CM_BASE = \'assets/plugins/codemirror/\';

$_CM_URL = $modx->config[\'site_url\'] . $_CM_BASE;

require(MODX_BASE_PATH. $_CM_BASE .\'codemirror.plugin.php\');

';
$p['CodeMirrorProps'] = '&theme=Theme;list;,cobalt,ecllipse,elegant,monokai,neat,night,rubyblue; &indentUnit=Indent unit;int;2 &tabSize=The width of a tab character;int;2 &lineWrapping=lineWrapping;list;true,false;true ';
$p['CodeMirror'] = '/**
 * @name: CodeMirror
 * @description: <b>2.23 b</b> JavaScript library that can be used to create a relatively pleasant editor interface
 *
 * @events:
 * - OnDocFormRender
 * - OnChunkFormRender
 * - OnModFormRender
 * - OnPluginFormRender
 * - OnSnipFormRender
 * - OnTempFormRender
 *
 */

$_CM_BASE = \'assets/plugins/codemirror/\';

$_CM_URL = $modx->config[\'site_url\'] . $_CM_BASE;

require(MODX_BASE_PATH. $_CM_BASE .\'codemirror.plugin.php\');

';
$p['CodeMirrorProps'] = '&theme=Theme;list;,cobalt,ecllipse,elegant,monokai,neat,night,rubyblue; &indentUnit=Indent unit;int;2 &tabSize=The width of a tab character;int;2 &lineWrapping=lineWrapping;list;true,false;true &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$p['CodeMirror'] = '/**
 * @name: CodeMirror
 * @description: <b>2.23 b</b> JavaScript library that can be used to create a relatively pleasant editor interface
 *
 * @events:
 * - OnDocFormRender
 * - OnChunkFormRender
 * - OnModFormRender
 * - OnPluginFormRender
 * - OnSnipFormRender
 * - OnTempFormRender
 *
 */

$_CM_BASE = \'assets/plugins/codemirror/\';

$_CM_URL = $modx->config[\'site_url\'] . $_CM_BASE;

require(MODX_BASE_PATH. $_CM_BASE .\'codemirror.plugin.php\');

';
$p['CodeMirrorProps'] = '&theme=Theme;list;,cobalt,ecllipse,elegant,monokai,neat,night,rubyblue; &indentUnit=Indent unit;int;2 &tabSize=The width of a tab character;int;2 &lineWrapping=lineWrapping;list;true,false;true ';
$p['Forgot Manager Login'] = 'if(!class_exists(\'ForgotManagerPassword\')) {
    class ForgotManagerPassword{
        function ForgotManagerPassword(){
            $this->errors = array();
            $this->checkLang();
        }

        function getLink() {
            global $_lang;
  
            $link = <<<EOD
<a id="ForgotManagerPassword-show_form" href="index.php?action=show_form">{$_lang[\'forgot_your_password\']}</a>
EOD;

            return $link;
        }

        function getForm() {
            global $_lang;

            $form = <<<EOD
<label id="FMP-email_label" for="FMP_email">{$_lang[\'account_email\']}:</label>
<input id="FMP-email" type="text" />
<button id="FMP-email_button" type="button" onclick="window.location = \'index.php?action=send_email&email=\'+document.getElementById(\'FMP-email\').value;">{$_lang[\'send\']}</button>
EOD;

            return $form;
        }

        /* Get user info including a hash unique to this user, password, and day */
        function getUser($user_id=false, $username=\'\', $email=\'\', $hash=\'\') {
            global $modx, $_lang;

            $user_id = $user_id == false ? false : $modx->db->escape($user_id);
            $username = $modx->db->escape($username);
            $email = $modx->db->escape($email);
            $emaail = $modx->db->escape($hash);

			$pre = $modx->db->config[\'table_prefix\'];
			$site_id = $modx->config[\'site_id\'];
			$today = date(\'Yz\'); // Year and day of the year
			$wheres = array();
			$where = \'\';
			$user = null;
  
            if($user_id !== false) { $wheres[] = "usr.id = \'{$user_id}\'"; }
            if(!empty($username)) { $wheres[] = "usr.username = \'{$username}\'"; }
            if(!empty($email)) { $wheres[] = "attr.email = \'{$email}\'"; }
            if(!empty($hash)) { $wheres[] = "MD5(CONCAT(usr.username,usr.password,\'{$site_id}\',\'{$today}\')) = \'{$hash}\'"; } 

            if($wheres) {
                $where = \' WHERE \'.implode(\' AND \',$wheres);
                $sql = "SELECT usr.id, usr.username, attr.email, MD5(CONCAT(usr.username,usr.password,\'{$site_id}\',\'{$today}\')) AS hash
                    FROM `{$pre}manager_users` usr
                    INNER JOIN `{$pre}user_attributes` attr ON usr.id = attr.internalKey
                    {$where}      
                    LIMIT 1;"; 

                if($result = $modx->db->query($sql)){
                    if($modx->db->getRecordCount($result)==1) {
                        $user = $modx->db->getRow($result);
                    }
                }
            }

            if($user == null) { $this->errors[] = $_lang[\'could_not_find_user\']; }

            return $user;
        }



        /* Send an email with a link to login */
        function sendEmail($to) {
            global $modx, $_lang;

            $subject = $_lang[\'password_change_request\'];
            $headers  = "MIME-Version: 1.0\\r\\n".
                "Content-type: text/html; charset=\\"{$modx->config[\'modx_charset\']}\\"\\r\\n".
		"From: MODx <{$modx->config[\'emailsender\']}>\\r\\n".
                "Reply-To: no-reply@{$_SERVER[\'HTTP_HOST\']}\\r\\n".
                "X-Mailer: PHP/".phpversion();

            $user = $this->getUser(0, \'\', $to);
  
            if($user[\'username\']) {
                $body = <<<EOD
<p>{$_lang[\'forgot_password_email_intro\']} <a href="{$modx->config[\'site_url\']}manager/processors/login.processor.php?username={$user[\'username\']}&hash={$user[\'hash\']}">{$_lang[\'forgot_password_email_link\']}</a></p>
<p>{$_lang[\'forgot_password_email_instructions\']}</p>
<p><small>{$_lang[\'forgot_password_email_fine_print\']}</small></p>
EOD;

                $mail = mail($to, $subject, $body, $headers);
                if(!$mail) { $this->errors[] = $_lang[\'error_sending_email\']; }
   
                return $mail;  
            }
        }

        function unblockUser($user_id) {
            global $modx, $_lang;

            $pre = $modx->db->config[\'table_prefix\'];
            $modx->db->update(array(\'blocked\' => 0, \'blockeduntil\' => 0, \'failedlogincount\' => 0), "`{$pre}user_attributes`", "internalKey = \'{$user_id}\'");

            if(!$modx->db->getAffectedRows()) { $this->errors[] = $_lang[\'user_doesnt_exist\']; return; }

            return true;
        }

        function checkLang() {
            global $_lang;

            $eng = array();
            $eng[\'forgot_your_password\'] = \'Forgot your password?\';
            $eng[\'account_email\'] = \'Account email\';
            $eng[\'send\'] = \'Send\';
            $eng[\'password_change_request\'] = \'Password change request\';
            $eng[\'forgot_password_email_intro\'] = \'A request has been made to change the password on your account.\';
            $eng[\'forgot_password_email_link\'] = \'Click here to complete the process.\';
            $eng[\'forgot_password_email_instructions\'] = \'From there you will be able to change your password from the My Account menu.\';
            $eng[\'forgot_password_email_fine_print\'] = \'* The URL above will expire once you change your password or after today.\';
            $eng[\'error_sending_email\'] = \'Error sending email\';
            $eng[\'could_not_find_user\'] = \'Could not find user\';
            $eng[\'user_doesnt_exist\'] = \'User does not exist\';
            $eng[\'email_sent\'] = \'Email sent\';

            foreach($eng as $key=>$value) {
                if(empty($_lang[$key])) { $_lang[$key] = $value; }
            }  
        }

        function getErrorOutput() {
            $output = \'\';

            if($this->errors) {
                $output = \'<span class="error">\'.implode(\'</span><span class="errors">\', $this->errors).\'</span>\';
            }
  
            return $output;
        }
    }
}

global $_lang;

$output = \'\';
$event_name = $modx->Event->name;
$action = (empty($_GET[\'action\']) ? \'\' : $_GET[\'action\']);
$username = (empty($_GET[\'username\']) ? false : $_GET[\'username\']);
$to = (empty($_GET[\'email\']) ? \'\' : $_GET[\'email\']);
$hash = (empty($_GET[\'hash\']) ? false : $_GET[\'hash\']);
$forgot = new ForgotManagerPassword();

if($event_name == \'OnManagerLoginFormRender\') {
    switch($action) {
        case \'show_form\':
            $output = $forgot->getForm();
            break;
        case \'send_email\':
            if($forgot->sendEmail($to)) { $output = $_lang[\'email_sent\']; }
            break;
        default:
            $output = $forgot->getLink();
            break;
    }

    if($forgot->errors) { $output = $forgot->getErrorOutput() . $forgot->getLink(); }
}

if($event_name == \'OnBeforeManagerLogin\') {
    $user = $forgot->getUser(false, $username, \'\', $hash);
    if($user && is_array($user) && !$forgot->errors) {
        $forgot->unblockUser($user[\'id\']);
    }
}

if($event_name == \'OnManagerAuthentication\' && $hash && $username) {
    $user = $forgot->getUser(false, $username, \'\', $hash);
    $output = ($user !== null && count($forgot->errors) == 0) ? true : false;
}

$modx->Event->output($output);';
$p['Forgot Manager Login'] = 'if(!class_exists(\'ForgotManagerPassword\')) {
    class ForgotManagerPassword{
        function ForgotManagerPassword(){
            $this->errors = array();
            $this->checkLang();
        }

        function getLink() {
            global $_lang;
  
            $link = <<<EOD
<a id="ForgotManagerPassword-show_form" href="index.php?action=show_form">{$_lang[\'forgot_your_password\']}</a>
EOD;

            return $link;
        }

        function getForm() {
            global $_lang;

            $form = <<<EOD
<label id="FMP-email_label" for="FMP_email">{$_lang[\'account_email\']}:</label>
<input id="FMP-email" type="text" />
<button id="FMP-email_button" type="button" onclick="window.location = \'index.php?action=send_email&email=\'+document.getElementById(\'FMP-email\').value;">{$_lang[\'send\']}</button>
EOD;

            return $form;
        }

        /* Get user info including a hash unique to this user, password, and day */
        function getUser($user_id=false, $username=\'\', $email=\'\', $hash=\'\') {
            global $modx, $_lang;

            $user_id = $user_id == false ? false : $modx->db->escape($user_id);
            $username = $modx->db->escape($username);
            $email = $modx->db->escape($email);
            $emaail = $modx->db->escape($hash);

			$pre = $modx->db->config[\'table_prefix\'];
			$site_id = $modx->config[\'site_id\'];
			$today = date(\'Yz\'); // Year and day of the year
			$wheres = array();
			$where = \'\';
			$user = null;
  
            if($user_id !== false) { $wheres[] = "usr.id = \'{$user_id}\'"; }
            if(!empty($username)) { $wheres[] = "usr.username = \'{$username}\'"; }
            if(!empty($email)) { $wheres[] = "attr.email = \'{$email}\'"; }
            if(!empty($hash)) { $wheres[] = "MD5(CONCAT(usr.username,usr.password,\'{$site_id}\',\'{$today}\')) = \'{$hash}\'"; } 

            if($wheres) {
                $where = \' WHERE \'.implode(\' AND \',$wheres);
                $sql = "SELECT usr.id, usr.username, attr.email, MD5(CONCAT(usr.username,usr.password,\'{$site_id}\',\'{$today}\')) AS hash
                    FROM `{$pre}manager_users` usr
                    INNER JOIN `{$pre}user_attributes` attr ON usr.id = attr.internalKey
                    {$where}      
                    LIMIT 1;"; 

                if($result = $modx->db->query($sql)){
                    if($modx->db->getRecordCount($result)==1) {
                        $user = $modx->db->getRow($result);
                    }
                }
            }

            if($user == null) { $this->errors[] = $_lang[\'could_not_find_user\']; }

            return $user;
        }



        /* Send an email with a link to login */
        function sendEmail($to) {
            global $modx, $_lang;

            $subject = $_lang[\'password_change_request\'];
            $headers  = "MIME-Version: 1.0\\r\\n".
                "Content-type: text/html; charset=\\"{$modx->config[\'modx_charset\']}\\"\\r\\n".
		"From: MODx <{$modx->config[\'emailsender\']}>\\r\\n".
                "Reply-To: no-reply@{$_SERVER[\'HTTP_HOST\']}\\r\\n".
                "X-Mailer: PHP/".phpversion();

            $user = $this->getUser(0, \'\', $to);
  
            if($user[\'username\']) {
                $body = <<<EOD
<p>{$_lang[\'forgot_password_email_intro\']} <a href="{$modx->config[\'site_url\']}manager/processors/login.processor.php?username={$user[\'username\']}&hash={$user[\'hash\']}">{$_lang[\'forgot_password_email_link\']}</a></p>
<p>{$_lang[\'forgot_password_email_instructions\']}</p>
<p><small>{$_lang[\'forgot_password_email_fine_print\']}</small></p>
EOD;

                $mail = mail($to, $subject, $body, $headers);
                if(!$mail) { $this->errors[] = $_lang[\'error_sending_email\']; }
   
                return $mail;  
            }
        }

        function unblockUser($user_id) {
            global $modx, $_lang;

            $pre = $modx->db->config[\'table_prefix\'];
            $modx->db->update(array(\'blocked\' => 0, \'blockeduntil\' => 0, \'failedlogincount\' => 0), "`{$pre}user_attributes`", "internalKey = \'{$user_id}\'");

            if(!$modx->db->getAffectedRows()) { $this->errors[] = $_lang[\'user_doesnt_exist\']; return; }

            return true;
        }

        function checkLang() {
            global $_lang;

            $eng = array();
            $eng[\'forgot_your_password\'] = \'Forgot your password?\';
            $eng[\'account_email\'] = \'Account email\';
            $eng[\'send\'] = \'Send\';
            $eng[\'password_change_request\'] = \'Password change request\';
            $eng[\'forgot_password_email_intro\'] = \'A request has been made to change the password on your account.\';
            $eng[\'forgot_password_email_link\'] = \'Click here to complete the process.\';
            $eng[\'forgot_password_email_instructions\'] = \'From there you will be able to change your password from the My Account menu.\';
            $eng[\'forgot_password_email_fine_print\'] = \'* The URL above will expire once you change your password or after today.\';
            $eng[\'error_sending_email\'] = \'Error sending email\';
            $eng[\'could_not_find_user\'] = \'Could not find user\';
            $eng[\'user_doesnt_exist\'] = \'User does not exist\';
            $eng[\'email_sent\'] = \'Email sent\';

            foreach($eng as $key=>$value) {
                if(empty($_lang[$key])) { $_lang[$key] = $value; }
            }  
        }

        function getErrorOutput() {
            $output = \'\';

            if($this->errors) {
                $output = \'<span class="error">\'.implode(\'</span><span class="errors">\', $this->errors).\'</span>\';
            }
  
            return $output;
        }
    }
}

global $_lang;

$output = \'\';
$event_name = $modx->Event->name;
$action = (empty($_GET[\'action\']) ? \'\' : $_GET[\'action\']);
$username = (empty($_GET[\'username\']) ? false : $_GET[\'username\']);
$to = (empty($_GET[\'email\']) ? \'\' : $_GET[\'email\']);
$hash = (empty($_GET[\'hash\']) ? false : $_GET[\'hash\']);
$forgot = new ForgotManagerPassword();

if($event_name == \'OnManagerLoginFormRender\') {
    switch($action) {
        case \'show_form\':
            $output = $forgot->getForm();
            break;
        case \'send_email\':
            if($forgot->sendEmail($to)) { $output = $_lang[\'email_sent\']; }
            break;
        default:
            $output = $forgot->getLink();
            break;
    }

    if($forgot->errors) { $output = $forgot->getErrorOutput() . $forgot->getLink(); }
}

if($event_name == \'OnBeforeManagerLogin\') {
    $user = $forgot->getUser(false, $username, \'\', $hash);
    if($user && is_array($user) && !$forgot->errors) {
        $forgot->unblockUser($user[\'id\']);
    }
}

if($event_name == \'OnManagerAuthentication\' && $hash && $username) {
    $user = $forgot->getUser(false, $username, \'\', $hash);
    $output = ($user !== null && count($forgot->errors) == 0) ? true : false;
}

$modx->Event->output($output);';
$p['Forgot Manager Login'] = 'if(!class_exists(\'ForgotManagerPassword\')) {
    class ForgotManagerPassword{
        function ForgotManagerPassword(){
            $this->errors = array();
            $this->checkLang();
        }

        function getLink() {
            global $_lang;
  
            $link = <<<EOD
<a id="ForgotManagerPassword-show_form" href="index.php?action=show_form">{$_lang[\'forgot_your_password\']}</a>
EOD;

            return $link;
        }

        function getForm() {
            global $_lang;

            $form = <<<EOD
<label id="FMP-email_label" for="FMP_email">{$_lang[\'account_email\']}:</label>
<input id="FMP-email" type="text" />
<button id="FMP-email_button" type="button" onclick="window.location = \'index.php?action=send_email&email=\'+document.getElementById(\'FMP-email\').value;">{$_lang[\'send\']}</button>
EOD;

            return $form;
        }

        /* Get user info including a hash unique to this user, password, and day */
        function getUser($user_id=false, $username=\'\', $email=\'\', $hash=\'\') {
            global $modx, $_lang;

            $user_id = $user_id == false ? false : $modx->db->escape($user_id);
            $username = $modx->db->escape($username);
            $email = $modx->db->escape($email);
            $emaail = $modx->db->escape($hash);

			$pre = $modx->db->config[\'table_prefix\'];
			$site_id = $modx->config[\'site_id\'];
			$today = date(\'Yz\'); // Year and day of the year
			$wheres = array();
			$where = \'\';
			$user = null;
  
            if($user_id !== false) { $wheres[] = "usr.id = \'{$user_id}\'"; }
            if(!empty($username)) { $wheres[] = "usr.username = \'{$username}\'"; }
            if(!empty($email)) { $wheres[] = "attr.email = \'{$email}\'"; }
            if(!empty($hash)) { $wheres[] = "MD5(CONCAT(usr.username,usr.password,\'{$site_id}\',\'{$today}\')) = \'{$hash}\'"; } 

            if($wheres) {
                $where = \' WHERE \'.implode(\' AND \',$wheres);
                $sql = "SELECT usr.id, usr.username, attr.email, MD5(CONCAT(usr.username,usr.password,\'{$site_id}\',\'{$today}\')) AS hash
                    FROM `{$pre}manager_users` usr
                    INNER JOIN `{$pre}user_attributes` attr ON usr.id = attr.internalKey
                    {$where}      
                    LIMIT 1;"; 

                if($result = $modx->db->query($sql)){
                    if($modx->db->getRecordCount($result)==1) {
                        $user = $modx->db->getRow($result);
                    }
                }
            }

            if($user == null) { $this->errors[] = $_lang[\'could_not_find_user\']; }

            return $user;
        }



        /* Send an email with a link to login */
        function sendEmail($to) {
            global $modx, $_lang;

            $subject = $_lang[\'password_change_request\'];
            $headers  = "MIME-Version: 1.0\\r\\n".
                "Content-type: text/html; charset=\\"{$modx->config[\'modx_charset\']}\\"\\r\\n".
		"From: MODx <{$modx->config[\'emailsender\']}>\\r\\n".
                "Reply-To: no-reply@{$_SERVER[\'HTTP_HOST\']}\\r\\n".
                "X-Mailer: PHP/".phpversion();

            $user = $this->getUser(0, \'\', $to);
  
            if($user[\'username\']) {
                $body = <<<EOD
<p>{$_lang[\'forgot_password_email_intro\']} <a href="{$modx->config[\'site_url\']}manager/processors/login.processor.php?username={$user[\'username\']}&hash={$user[\'hash\']}">{$_lang[\'forgot_password_email_link\']}</a></p>
<p>{$_lang[\'forgot_password_email_instructions\']}</p>
<p><small>{$_lang[\'forgot_password_email_fine_print\']}</small></p>
EOD;

                $mail = mail($to, $subject, $body, $headers);
                if(!$mail) { $this->errors[] = $_lang[\'error_sending_email\']; }
   
                return $mail;  
            }
        }

        function unblockUser($user_id) {
            global $modx, $_lang;

            $pre = $modx->db->config[\'table_prefix\'];
            $modx->db->update(array(\'blocked\' => 0, \'blockeduntil\' => 0, \'failedlogincount\' => 0), "`{$pre}user_attributes`", "internalKey = \'{$user_id}\'");

            if(!$modx->db->getAffectedRows()) { $this->errors[] = $_lang[\'user_doesnt_exist\']; return; }

            return true;
        }

        function checkLang() {
            global $_lang;

            $eng = array();
            $eng[\'forgot_your_password\'] = \'Forgot your password?\';
            $eng[\'account_email\'] = \'Account email\';
            $eng[\'send\'] = \'Send\';
            $eng[\'password_change_request\'] = \'Password change request\';
            $eng[\'forgot_password_email_intro\'] = \'A request has been made to change the password on your account.\';
            $eng[\'forgot_password_email_link\'] = \'Click here to complete the process.\';
            $eng[\'forgot_password_email_instructions\'] = \'From there you will be able to change your password from the My Account menu.\';
            $eng[\'forgot_password_email_fine_print\'] = \'* The URL above will expire once you change your password or after today.\';
            $eng[\'error_sending_email\'] = \'Error sending email\';
            $eng[\'could_not_find_user\'] = \'Could not find user\';
            $eng[\'user_doesnt_exist\'] = \'User does not exist\';
            $eng[\'email_sent\'] = \'Email sent\';

            foreach($eng as $key=>$value) {
                if(empty($_lang[$key])) { $_lang[$key] = $value; }
            }  
        }

        function getErrorOutput() {
            $output = \'\';

            if($this->errors) {
                $output = \'<span class="error">\'.implode(\'</span><span class="errors">\', $this->errors).\'</span>\';
            }
  
            return $output;
        }
    }
}

global $_lang;

$output = \'\';
$event_name = $modx->Event->name;
$action = (empty($_GET[\'action\']) ? \'\' : $_GET[\'action\']);
$username = (empty($_GET[\'username\']) ? false : $_GET[\'username\']);
$to = (empty($_GET[\'email\']) ? \'\' : $_GET[\'email\']);
$hash = (empty($_GET[\'hash\']) ? false : $_GET[\'hash\']);
$forgot = new ForgotManagerPassword();

if($event_name == \'OnManagerLoginFormRender\') {
    switch($action) {
        case \'show_form\':
            $output = $forgot->getForm();
            break;
        case \'send_email\':
            if($forgot->sendEmail($to)) { $output = $_lang[\'email_sent\']; }
            break;
        default:
            $output = $forgot->getLink();
            break;
    }

    if($forgot->errors) { $output = $forgot->getErrorOutput() . $forgot->getLink(); }
}

if($event_name == \'OnBeforeManagerLogin\') {
    $user = $forgot->getUser(false, $username, \'\', $hash);
    if($user && is_array($user) && !$forgot->errors) {
        $forgot->unblockUser($user[\'id\']);
    }
}

if($event_name == \'OnManagerAuthentication\' && $hash && $username) {
    $user = $forgot->getUser(false, $username, \'\', $hash);
    $output = ($user !== null && count($forgot->errors) == 0) ? true : false;
}

$modx->Event->output($output);';
$p['Forgot Manager LoginProps'] = ' &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$p['Forgot Manager Login'] = 'if(!class_exists(\'ForgotManagerPassword\')) {
    class ForgotManagerPassword{
        function ForgotManagerPassword(){
            $this->errors = array();
            $this->checkLang();
        }

        function getLink() {
            global $_lang;
  
            $link = <<<EOD
<a id="ForgotManagerPassword-show_form" href="index.php?action=show_form">{$_lang[\'forgot_your_password\']}</a>
EOD;

            return $link;
        }

        function getForm() {
            global $_lang;

            $form = <<<EOD
<label id="FMP-email_label" for="FMP_email">{$_lang[\'account_email\']}:</label>
<input id="FMP-email" type="text" />
<button id="FMP-email_button" type="button" onclick="window.location = \'index.php?action=send_email&email=\'+document.getElementById(\'FMP-email\').value;">{$_lang[\'send\']}</button>
EOD;

            return $form;
        }

        /* Get user info including a hash unique to this user, password, and day */
        function getUser($user_id=false, $username=\'\', $email=\'\', $hash=\'\') {
            global $modx, $_lang;

            $user_id = $user_id == false ? false : $modx->db->escape($user_id);
            $username = $modx->db->escape($username);
            $email = $modx->db->escape($email);
            $emaail = $modx->db->escape($hash);

			$pre = $modx->db->config[\'table_prefix\'];
			$site_id = $modx->config[\'site_id\'];
			$today = date(\'Yz\'); // Year and day of the year
			$wheres = array();
			$where = \'\';
			$user = null;
  
            if($user_id !== false) { $wheres[] = "usr.id = \'{$user_id}\'"; }
            if(!empty($username)) { $wheres[] = "usr.username = \'{$username}\'"; }
            if(!empty($email)) { $wheres[] = "attr.email = \'{$email}\'"; }
            if(!empty($hash)) { $wheres[] = "MD5(CONCAT(usr.username,usr.password,\'{$site_id}\',\'{$today}\')) = \'{$hash}\'"; } 

            if($wheres) {
                $where = \' WHERE \'.implode(\' AND \',$wheres);
                $sql = "SELECT usr.id, usr.username, attr.email, MD5(CONCAT(usr.username,usr.password,\'{$site_id}\',\'{$today}\')) AS hash
                    FROM `{$pre}manager_users` usr
                    INNER JOIN `{$pre}user_attributes` attr ON usr.id = attr.internalKey
                    {$where}      
                    LIMIT 1;"; 

                if($result = $modx->db->query($sql)){
                    if($modx->db->getRecordCount($result)==1) {
                        $user = $modx->db->getRow($result);
                    }
                }
            }

            if($user == null) { $this->errors[] = $_lang[\'could_not_find_user\']; }

            return $user;
        }



        /* Send an email with a link to login */
        function sendEmail($to) {
            global $modx, $_lang;

            $subject = $_lang[\'password_change_request\'];
            $headers  = "MIME-Version: 1.0\\r\\n".
                "Content-type: text/html; charset=\\"{$modx->config[\'modx_charset\']}\\"\\r\\n".
		"From: MODx <{$modx->config[\'emailsender\']}>\\r\\n".
                "Reply-To: no-reply@{$_SERVER[\'HTTP_HOST\']}\\r\\n".
                "X-Mailer: PHP/".phpversion();

            $user = $this->getUser(0, \'\', $to);
  
            if($user[\'username\']) {
                $body = <<<EOD
<p>{$_lang[\'forgot_password_email_intro\']} <a href="{$modx->config[\'site_url\']}manager/processors/login.processor.php?username={$user[\'username\']}&hash={$user[\'hash\']}">{$_lang[\'forgot_password_email_link\']}</a></p>
<p>{$_lang[\'forgot_password_email_instructions\']}</p>
<p><small>{$_lang[\'forgot_password_email_fine_print\']}</small></p>
EOD;

                $mail = mail($to, $subject, $body, $headers);
                if(!$mail) { $this->errors[] = $_lang[\'error_sending_email\']; }
   
                return $mail;  
            }
        }

        function unblockUser($user_id) {
            global $modx, $_lang;

            $pre = $modx->db->config[\'table_prefix\'];
            $modx->db->update(array(\'blocked\' => 0, \'blockeduntil\' => 0, \'failedlogincount\' => 0), "`{$pre}user_attributes`", "internalKey = \'{$user_id}\'");

            if(!$modx->db->getAffectedRows()) { $this->errors[] = $_lang[\'user_doesnt_exist\']; return; }

            return true;
        }

        function checkLang() {
            global $_lang;

            $eng = array();
            $eng[\'forgot_your_password\'] = \'Forgot your password?\';
            $eng[\'account_email\'] = \'Account email\';
            $eng[\'send\'] = \'Send\';
            $eng[\'password_change_request\'] = \'Password change request\';
            $eng[\'forgot_password_email_intro\'] = \'A request has been made to change the password on your account.\';
            $eng[\'forgot_password_email_link\'] = \'Click here to complete the process.\';
            $eng[\'forgot_password_email_instructions\'] = \'From there you will be able to change your password from the My Account menu.\';
            $eng[\'forgot_password_email_fine_print\'] = \'* The URL above will expire once you change your password or after today.\';
            $eng[\'error_sending_email\'] = \'Error sending email\';
            $eng[\'could_not_find_user\'] = \'Could not find user\';
            $eng[\'user_doesnt_exist\'] = \'User does not exist\';
            $eng[\'email_sent\'] = \'Email sent\';

            foreach($eng as $key=>$value) {
                if(empty($_lang[$key])) { $_lang[$key] = $value; }
            }  
        }

        function getErrorOutput() {
            $output = \'\';

            if($this->errors) {
                $output = \'<span class="error">\'.implode(\'</span><span class="errors">\', $this->errors).\'</span>\';
            }
  
            return $output;
        }
    }
}

global $_lang;

$output = \'\';
$event_name = $modx->Event->name;
$action = (empty($_GET[\'action\']) ? \'\' : $_GET[\'action\']);
$username = (empty($_GET[\'username\']) ? false : $_GET[\'username\']);
$to = (empty($_GET[\'email\']) ? \'\' : $_GET[\'email\']);
$hash = (empty($_GET[\'hash\']) ? false : $_GET[\'hash\']);
$forgot = new ForgotManagerPassword();

if($event_name == \'OnManagerLoginFormRender\') {
    switch($action) {
        case \'show_form\':
            $output = $forgot->getForm();
            break;
        case \'send_email\':
            if($forgot->sendEmail($to)) { $output = $_lang[\'email_sent\']; }
            break;
        default:
            $output = $forgot->getLink();
            break;
    }

    if($forgot->errors) { $output = $forgot->getErrorOutput() . $forgot->getLink(); }
}

if($event_name == \'OnBeforeManagerLogin\') {
    $user = $forgot->getUser(false, $username, \'\', $hash);
    if($user && is_array($user) && !$forgot->errors) {
        $forgot->unblockUser($user[\'id\']);
    }
}

if($event_name == \'OnManagerAuthentication\' && $hash && $username) {
    $user = $forgot->getUser(false, $username, \'\', $hash);
    $output = ($user !== null && count($forgot->errors) == 0) ? true : false;
}

$modx->Event->output($output);';
$p['TinyMCE Rich Text Editor'] = '// Set the name of the plugin folder
$plugin_dir = "tinymce";

// Set path and base setting variables
if(!isset($mce_path))
{ 
	$mce_path = MODX_BASE_PATH . \'assets/plugins/\'.$plugin_dir . \'/\'; 
	$mce_url  = MODX_BASE_URL  . \'assets/plugins/\'.$plugin_dir . \'/\'; 
}

$params[\'customparams\']    = $customparams;
$params[\'blockFormats\']    = $mce_formats;
$params[\'entity_encoding\'] = $entity_encoding;
$params[\'entities\']        = $entities;
$params[\'pathoptions\']     = $mce_path_options;
$params[\'resizing\']        = $mce_resizing;
$params[\'disabledButtons\'] = $disabledButtons;
$params[\'link_list\']       = $link_list;
$params[\'theme\']           = $webtheme;
$params[\'custom_plugins\']  = $webPlugins;
$params[\'custom_buttons1\'] = $webButtons1;
$params[\'custom_buttons2\'] = $webButtons2;
$params[\'custom_buttons3\'] = $webButtons3;
$params[\'custom_buttons4\'] = $webButtons4;
$params[\'toolbar_align\']   = $webAlign;
$params[\'width\']           = $width;
$params[\'height\']          = $height;

$params[\'mce_path\']        = $mce_path;
$params[\'mce_url\']         = $mce_url;

include_once $mce_path . \'lang/tinymce.lang.php\';
include_once $mce_path . \'tinymce.functions.php\';

$mce = new TinyMCE($params);

// Handle event
$e = &$modx->Event; 
switch ($e->name)
{
	case "OnRichTextEditorRegister": // register only for backend
		$e->output("TinyMCE");
		break;

	case "OnRichTextEditorInit": 
		if($editor!=="TinyMCE") return;
		
		$params[\'elements\']        = $elements;
		$params[\'css_selectors\']   = $modx->config[\'tinymce_css_selectors\'];
		$params[\'use_browser\']     = $modx->config[\'use_browser\'];
		$params[\'editor_css_path\'] = $modx->config[\'editor_css_path\'];
		
		if($modx->isBackend() || (intval($_GET[\'quickmanagertv\']) == 1 && isset($_SESSION[\'mgrValidated\'])))
		{
			$params[\'theme\']           = $modx->config[\'tinymce_editor_theme\'];
			$params[\'language\']        = getTinyMCELang($modx->config[\'manager_language\']);
			$params[\'frontend\']        = false;
			$params[\'custom_plugins\']  = $modx->config[\'tinymce_custom_plugins\'];
			$params[\'custom_buttons1\'] = $modx->config[\'tinymce_custom_buttons1\'];
			$params[\'custom_buttons2\'] = $modx->config[\'tinymce_custom_buttons2\'];
			$params[\'custom_buttons3\'] = $modx->config[\'tinymce_custom_buttons3\'];
			$params[\'custom_buttons4\'] = $modx->config[\'tinymce_custom_buttons4\'];
			$params[\'toolbar_align\']   = $modx->config[\'manager_direction\'];
			$params[\'webuser\']         = null;
			
			$html = $mce->get_mce_script($params);
		}
		else
		{
			$frontend_language = isset($modx->config[\'fe_editor_lang\']) ? $modx->config[\'fe_editor_lang\']:\'\';
			$webuser = (isset($modx->config[\'rb_webuser\']) ? $modx->config[\'rb_webuser\'] : null);
			
			$params[\'webuser\']         = $webuser;
			$params[\'language\']        = getTinyMCELang($frontend_language);
			$params[\'frontend\']        = true;
			
			$html = $mce->get_mce_script($params);
		}
		$e->output($html);
		break;

	case "OnInterfaceSettingsRender":
		global $usersettings,$settings;
		$action = $modx->manager->action;
		switch ($action)
		{
			case 11:
				$mce_settings = \'\';
				break;
			case 12:
				$mce_settings = $usersettings;
				break;
			case 17:
				$mce_settings = $settings;
				break;
			default:
				$mce_settings = $settings;
				break;
		}
		
		$params[\'use_editor\']       = $modx->config[\'base_url\'].$modx->config[\'use_editor\'];
        $params[\'editor_css_path\']  = $modx->config[\'editor_css_path\'];
		$params[\'theme\']            = $mce_settings[\'tinymce_editor_theme\'];
		$params[\'css_selectors\']    = $mce_settings[\'tinymce_css_selectors\'];
		$params[\'custom_plugins\']   = $mce_settings[\'tinymce_custom_plugins\'];
		$params[\'custom_buttons1\']  = $mce_settings[\'tinymce_custom_buttons1\'];
		$params[\'custom_buttons2\']  = $mce_settings[\'tinymce_custom_buttons2\'];
		$params[\'custom_buttons3\']  = $mce_settings[\'tinymce_custom_buttons3\'];
		$params[\'custom_buttons4\']  = $mce_settings[\'tinymce_custom_buttons4\'];
		
		$html = $mce->get_mce_settings($params);
		$e->output($html);
		break;
		
	default :
		return; // stop here - this is very important. 
		break; 
}
';
$p['TinyMCE Rich Text EditorProps'] = '&customparams=Custom Parameters;textarea; &mce_formats=Block Formats;text;p,h1,h2,h3,h4,h5,h6,div,blockquote,code,pre &entity_encoding=Entity Encoding;list;named,numeric,raw;named &entities=Entities;text; &mce_path_options=Path Options;list;rootrelative,docrelative,fullpathurl;docrelative &mce_resizing=Advanced Resizing;list;true,false;true &disabledButtons=Disabled Buttons;text; &link_list=Link List;list;enabled,disabled;enabled &webtheme=Web Theme;list;simple,editor,creative,custom;simple &webPlugins=Web Plugins;text;style,advimage,advlink,searchreplace,contextmenu,paste,fullscreen,nonbreaking,xhtmlxtras,visualchars,media &webButtons1=Web Buttons 1;text;undo,redo,selectall,|,pastetext,pasteword,|,search,replace,|,nonbreaking,hr,charmap,|,image,link,unlink,anchor,media,|,cleanup,removeformat,|,fullscreen,code,help &webButtons2=Web Buttons 2;text;bold,italic,underline,strikethrough,sub,sup,|,|,blockquote,bullist,numlist,outdent,indent,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,|,styleprops &webButtons3=Web Buttons 3;text; &webButtons4=Web Buttons 4;text; &webAlign=Web Toolbar Alignment;list;ltr,rtl;ltr &width=Width;text;100% &height=Height;text;400 ';
$p['TinyMCE Rich Text Editor'] = '// Set the name of the plugin folder
$plugin_dir = "tinymce";

// Set path and base setting variables
if(!isset($mce_path))
{ 
	$mce_path = MODX_BASE_PATH . \'assets/plugins/\'.$plugin_dir . \'/\'; 
	$mce_url  = MODX_BASE_URL  . \'assets/plugins/\'.$plugin_dir . \'/\'; 
}

$params[\'customparams\']    = $customparams;
$params[\'blockFormats\']    = $mce_formats;
$params[\'entity_encoding\'] = $entity_encoding;
$params[\'entities\']        = $entities;
$params[\'pathoptions\']     = $mce_path_options;
$params[\'resizing\']        = $mce_resizing;
$params[\'disabledButtons\'] = $disabledButtons;
$params[\'link_list\']       = $link_list;
$params[\'theme\']           = $webtheme;
$params[\'custom_plugins\']  = $webPlugins;
$params[\'custom_buttons1\'] = $webButtons1;
$params[\'custom_buttons2\'] = $webButtons2;
$params[\'custom_buttons3\'] = $webButtons3;
$params[\'custom_buttons4\'] = $webButtons4;
$params[\'toolbar_align\']   = $webAlign;
$params[\'width\']           = $width;
$params[\'height\']          = $height;

$params[\'mce_path\']        = $mce_path;
$params[\'mce_url\']         = $mce_url;

include_once $mce_path . \'lang/tinymce.lang.php\';
include_once $mce_path . \'tinymce.functions.php\';

$mce = new TinyMCE($params);

// Handle event
$e = &$modx->Event; 
switch ($e->name)
{
	case "OnRichTextEditorRegister": // register only for backend
		$e->output("TinyMCE");
		break;

	case "OnRichTextEditorInit": 
		if($editor!=="TinyMCE") return;
		
		$params[\'elements\']        = $elements;
		$params[\'css_selectors\']   = $modx->config[\'tinymce_css_selectors\'];
		$params[\'use_browser\']     = $modx->config[\'use_browser\'];
		$params[\'editor_css_path\'] = $modx->config[\'editor_css_path\'];
		
		if($modx->isBackend() || (intval($_GET[\'quickmanagertv\']) == 1 && isset($_SESSION[\'mgrValidated\'])))
		{
			$params[\'theme\']           = $modx->config[\'tinymce_editor_theme\'];
			$params[\'language\']        = getTinyMCELang($modx->config[\'manager_language\']);
			$params[\'frontend\']        = false;
			$params[\'custom_plugins\']  = $modx->config[\'tinymce_custom_plugins\'];
			$params[\'custom_buttons1\'] = $modx->config[\'tinymce_custom_buttons1\'];
			$params[\'custom_buttons2\'] = $modx->config[\'tinymce_custom_buttons2\'];
			$params[\'custom_buttons3\'] = $modx->config[\'tinymce_custom_buttons3\'];
			$params[\'custom_buttons4\'] = $modx->config[\'tinymce_custom_buttons4\'];
			$params[\'toolbar_align\']   = $modx->config[\'manager_direction\'];
			$params[\'webuser\']         = null;
			
			$html = $mce->get_mce_script($params);
		}
		else
		{
			$frontend_language = isset($modx->config[\'fe_editor_lang\']) ? $modx->config[\'fe_editor_lang\']:\'\';
			$webuser = (isset($modx->config[\'rb_webuser\']) ? $modx->config[\'rb_webuser\'] : null);
			
			$params[\'webuser\']         = $webuser;
			$params[\'language\']        = getTinyMCELang($frontend_language);
			$params[\'frontend\']        = true;
			
			$html = $mce->get_mce_script($params);
		}
		$e->output($html);
		break;

	case "OnInterfaceSettingsRender":
		global $usersettings,$settings;
		$action = $modx->manager->action;
		switch ($action)
		{
			case 11:
				$mce_settings = \'\';
				break;
			case 12:
				$mce_settings = $usersettings;
				break;
			case 17:
				$mce_settings = $settings;
				break;
			default:
				$mce_settings = $settings;
				break;
		}
		
		$params[\'use_editor\']       = $modx->config[\'base_url\'].$modx->config[\'use_editor\'];
        $params[\'editor_css_path\']  = $modx->config[\'editor_css_path\'];
		$params[\'theme\']            = $mce_settings[\'tinymce_editor_theme\'];
		$params[\'css_selectors\']    = $mce_settings[\'tinymce_css_selectors\'];
		$params[\'custom_plugins\']   = $mce_settings[\'tinymce_custom_plugins\'];
		$params[\'custom_buttons1\']  = $mce_settings[\'tinymce_custom_buttons1\'];
		$params[\'custom_buttons2\']  = $mce_settings[\'tinymce_custom_buttons2\'];
		$params[\'custom_buttons3\']  = $mce_settings[\'tinymce_custom_buttons3\'];
		$params[\'custom_buttons4\']  = $mce_settings[\'tinymce_custom_buttons4\'];
		
		$html = $mce->get_mce_settings($params);
		$e->output($html);
		break;
		
	default :
		return; // stop here - this is very important. 
		break; 
}
';
$p['TinyMCE Rich Text EditorProps'] = '&customparams=Custom Parameters;textarea; &mce_formats=Block Formats;text;p,h1,h2,h3,h4,h5,h6,div,blockquote,code,pre &entity_encoding=Entity Encoding;list;named,numeric,raw;named &entities=Entities;text; &mce_path_options=Path Options;list;rootrelative,docrelative,fullpathurl;docrelative &mce_resizing=Advanced Resizing;list;true,false;true &disabledButtons=Disabled Buttons;text; &link_list=Link List;list;enabled,disabled;enabled &webtheme=Web Theme;list;simple,editor,creative,custom;simple &webPlugins=Web Plugins;text;style,advimage,advlink,searchreplace,contextmenu,paste,fullscreen,nonbreaking,xhtmlxtras,visualchars,media &webButtons1=Web Buttons 1;text;undo,redo,selectall,|,pastetext,pasteword,|,search,replace,|,nonbreaking,hr,charmap,|,image,link,unlink,anchor,media,|,cleanup,removeformat,|,fullscreen,code,help &webButtons2=Web Buttons 2;text;bold,italic,underline,strikethrough,sub,sup,|,|,blockquote,bullist,numlist,outdent,indent,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,|,styleprops &webButtons3=Web Buttons 3;text; &webButtons4=Web Buttons 4;text; &webAlign=Web Toolbar Alignment;list;ltr,rtl;ltr &width=Width;text;100% &height=Height;text;400 ';
$p['TinyMCE Rich Text Editor'] = '// Set the name of the plugin folder
$plugin_dir = "tinymce";

// Set path and base setting variables
if(!isset($mce_path))
{ 
	$mce_path = MODX_BASE_PATH . \'assets/plugins/\'.$plugin_dir . \'/\'; 
	$mce_url  = MODX_BASE_URL  . \'assets/plugins/\'.$plugin_dir . \'/\'; 
}

$params[\'customparams\']    = $customparams;
$params[\'blockFormats\']    = $mce_formats;
$params[\'entity_encoding\'] = $entity_encoding;
$params[\'entities\']        = $entities;
$params[\'pathoptions\']     = $mce_path_options;
$params[\'resizing\']        = $mce_resizing;
$params[\'disabledButtons\'] = $disabledButtons;
$params[\'link_list\']       = $link_list;
$params[\'theme\']           = $webtheme;
$params[\'custom_plugins\']  = $webPlugins;
$params[\'custom_buttons1\'] = $webButtons1;
$params[\'custom_buttons2\'] = $webButtons2;
$params[\'custom_buttons3\'] = $webButtons3;
$params[\'custom_buttons4\'] = $webButtons4;
$params[\'toolbar_align\']   = $webAlign;
$params[\'width\']           = $width;
$params[\'height\']          = $height;

$params[\'mce_path\']        = $mce_path;
$params[\'mce_url\']         = $mce_url;

include_once $mce_path . \'lang/tinymce.lang.php\';
include_once $mce_path . \'tinymce.functions.php\';

$mce = new TinyMCE($params);

// Handle event
$e = &$modx->Event; 
switch ($e->name)
{
	case "OnRichTextEditorRegister": // register only for backend
		$e->output("TinyMCE");
		break;

	case "OnRichTextEditorInit": 
		if($editor!=="TinyMCE") return;
		
		$params[\'elements\']        = $elements;
		$params[\'css_selectors\']   = $modx->config[\'tinymce_css_selectors\'];
		$params[\'use_browser\']     = $modx->config[\'use_browser\'];
		$params[\'editor_css_path\'] = $modx->config[\'editor_css_path\'];
		
		if($modx->isBackend() || (intval($_GET[\'quickmanagertv\']) == 1 && isset($_SESSION[\'mgrValidated\'])))
		{
			$params[\'theme\']           = $modx->config[\'tinymce_editor_theme\'];
			$params[\'language\']        = getTinyMCELang($modx->config[\'manager_language\']);
			$params[\'frontend\']        = false;
			$params[\'custom_plugins\']  = $modx->config[\'tinymce_custom_plugins\'];
			$params[\'custom_buttons1\'] = $modx->config[\'tinymce_custom_buttons1\'];
			$params[\'custom_buttons2\'] = $modx->config[\'tinymce_custom_buttons2\'];
			$params[\'custom_buttons3\'] = $modx->config[\'tinymce_custom_buttons3\'];
			$params[\'custom_buttons4\'] = $modx->config[\'tinymce_custom_buttons4\'];
			$params[\'toolbar_align\']   = $modx->config[\'manager_direction\'];
			$params[\'webuser\']         = null;
			
			$html = $mce->get_mce_script($params);
		}
		else
		{
			$frontend_language = isset($modx->config[\'fe_editor_lang\']) ? $modx->config[\'fe_editor_lang\']:\'\';
			$webuser = (isset($modx->config[\'rb_webuser\']) ? $modx->config[\'rb_webuser\'] : null);
			
			$params[\'webuser\']         = $webuser;
			$params[\'language\']        = getTinyMCELang($frontend_language);
			$params[\'frontend\']        = true;
			
			$html = $mce->get_mce_script($params);
		}
		$e->output($html);
		break;

	case "OnInterfaceSettingsRender":
		global $usersettings,$settings;
		$action = $modx->manager->action;
		switch ($action)
		{
			case 11:
				$mce_settings = \'\';
				break;
			case 12:
				$mce_settings = $usersettings;
				break;
			case 17:
				$mce_settings = $settings;
				break;
			default:
				$mce_settings = $settings;
				break;
		}
		
		$params[\'use_editor\']       = $modx->config[\'base_url\'].$modx->config[\'use_editor\'];
        $params[\'editor_css_path\']  = $modx->config[\'editor_css_path\'];
		$params[\'theme\']            = $mce_settings[\'tinymce_editor_theme\'];
		$params[\'css_selectors\']    = $mce_settings[\'tinymce_css_selectors\'];
		$params[\'custom_plugins\']   = $mce_settings[\'tinymce_custom_plugins\'];
		$params[\'custom_buttons1\']  = $mce_settings[\'tinymce_custom_buttons1\'];
		$params[\'custom_buttons2\']  = $mce_settings[\'tinymce_custom_buttons2\'];
		$params[\'custom_buttons3\']  = $mce_settings[\'tinymce_custom_buttons3\'];
		$params[\'custom_buttons4\']  = $mce_settings[\'tinymce_custom_buttons4\'];
		
		$html = $mce->get_mce_settings($params);
		$e->output($html);
		break;
		
	default :
		return; // stop here - this is very important. 
		break; 
}
';
$p['TinyMCE Rich Text EditorProps'] = '&customparams=Custom Parameters;textarea; &mce_formats=Block Formats;text;p,h1,h2,h3,h4,h5,h6,div,blockquote,code,pre &entity_encoding=Entity Encoding;list;named,numeric,raw;named &entities=Entities;text; &mce_path_options=Path Options;list;rootrelative,docrelative,fullpathurl;docrelative &mce_resizing=Advanced Resizing;list;true,false;true &disabledButtons=Disabled Buttons;text; &link_list=Link List;list;enabled,disabled;enabled &webtheme=Web Theme;list;simple,editor,creative,custom;simple &webPlugins=Web Plugins;text;style,advimage,advlink,searchreplace,contextmenu,paste,fullscreen,nonbreaking,xhtmlxtras,visualchars,media &webButtons1=Web Buttons 1;text;undo,redo,selectall,|,pastetext,pasteword,|,search,replace,|,nonbreaking,hr,charmap,|,image,link,unlink,anchor,media,|,cleanup,removeformat,|,fullscreen,code,help &webButtons2=Web Buttons 2;text;bold,italic,underline,strikethrough,sub,sup,|,|,blockquote,bullist,numlist,outdent,indent,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,|,styleprops &webButtons3=Web Buttons 3;text; &webButtons4=Web Buttons 4;text; &webAlign=Web Toolbar Alignment;list;ltr,rtl;ltr &width=Width;text;100% &height=Height;text;400 &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$p['TinyMCE Rich Text Editor'] = '// Set the name of the plugin folder
$plugin_dir = "tinymce";

// Set path and base setting variables
if(!isset($mce_path))
{ 
	$mce_path = MODX_BASE_PATH . \'assets/plugins/\'.$plugin_dir . \'/\'; 
	$mce_url  = MODX_BASE_URL  . \'assets/plugins/\'.$plugin_dir . \'/\'; 
}

$params[\'customparams\']    = $customparams;
$params[\'blockFormats\']    = $mce_formats;
$params[\'entity_encoding\'] = $entity_encoding;
$params[\'entities\']        = $entities;
$params[\'pathoptions\']     = $mce_path_options;
$params[\'resizing\']        = $mce_resizing;
$params[\'disabledButtons\'] = $disabledButtons;
$params[\'link_list\']       = $link_list;
$params[\'theme\']           = $webtheme;
$params[\'custom_plugins\']  = $webPlugins;
$params[\'custom_buttons1\'] = $webButtons1;
$params[\'custom_buttons2\'] = $webButtons2;
$params[\'custom_buttons3\'] = $webButtons3;
$params[\'custom_buttons4\'] = $webButtons4;
$params[\'toolbar_align\']   = $webAlign;
$params[\'width\']           = $width;
$params[\'height\']          = $height;

$params[\'mce_path\']        = $mce_path;
$params[\'mce_url\']         = $mce_url;

include_once $mce_path . \'lang/tinymce.lang.php\';
include_once $mce_path . \'tinymce.functions.php\';

$mce = new TinyMCE($params);

// Handle event
$e = &$modx->Event; 
switch ($e->name)
{
	case "OnRichTextEditorRegister": // register only for backend
		$e->output("TinyMCE");
		break;

	case "OnRichTextEditorInit": 
		if($editor!=="TinyMCE") return;
		
		$params[\'elements\']        = $elements;
		$params[\'css_selectors\']   = $modx->config[\'tinymce_css_selectors\'];
		$params[\'use_browser\']     = $modx->config[\'use_browser\'];
		$params[\'editor_css_path\'] = $modx->config[\'editor_css_path\'];
		
		if($modx->isBackend() || (intval($_GET[\'quickmanagertv\']) == 1 && isset($_SESSION[\'mgrValidated\'])))
		{
			$params[\'theme\']           = $modx->config[\'tinymce_editor_theme\'];
			$params[\'language\']        = getTinyMCELang($modx->config[\'manager_language\']);
			$params[\'frontend\']        = false;
			$params[\'custom_plugins\']  = $modx->config[\'tinymce_custom_plugins\'];
			$params[\'custom_buttons1\'] = $modx->config[\'tinymce_custom_buttons1\'];
			$params[\'custom_buttons2\'] = $modx->config[\'tinymce_custom_buttons2\'];
			$params[\'custom_buttons3\'] = $modx->config[\'tinymce_custom_buttons3\'];
			$params[\'custom_buttons4\'] = $modx->config[\'tinymce_custom_buttons4\'];
			$params[\'toolbar_align\']   = $modx->config[\'manager_direction\'];
			$params[\'webuser\']         = null;
			
			$html = $mce->get_mce_script($params);
		}
		else
		{
			$frontend_language = isset($modx->config[\'fe_editor_lang\']) ? $modx->config[\'fe_editor_lang\']:\'\';
			$webuser = (isset($modx->config[\'rb_webuser\']) ? $modx->config[\'rb_webuser\'] : null);
			
			$params[\'webuser\']         = $webuser;
			$params[\'language\']        = getTinyMCELang($frontend_language);
			$params[\'frontend\']        = true;
			
			$html = $mce->get_mce_script($params);
		}
		$e->output($html);
		break;

	case "OnInterfaceSettingsRender":
		global $usersettings,$settings;
		$action = $modx->manager->action;
		switch ($action)
		{
			case 11:
				$mce_settings = \'\';
				break;
			case 12:
				$mce_settings = $usersettings;
				break;
			case 17:
				$mce_settings = $settings;
				break;
			default:
				$mce_settings = $settings;
				break;
		}
		
		$params[\'use_editor\']       = $modx->config[\'base_url\'].$modx->config[\'use_editor\'];
        $params[\'editor_css_path\']  = $modx->config[\'editor_css_path\'];
		$params[\'theme\']            = $mce_settings[\'tinymce_editor_theme\'];
		$params[\'css_selectors\']    = $mce_settings[\'tinymce_css_selectors\'];
		$params[\'custom_plugins\']   = $mce_settings[\'tinymce_custom_plugins\'];
		$params[\'custom_buttons1\']  = $mce_settings[\'tinymce_custom_buttons1\'];
		$params[\'custom_buttons2\']  = $mce_settings[\'tinymce_custom_buttons2\'];
		$params[\'custom_buttons3\']  = $mce_settings[\'tinymce_custom_buttons3\'];
		$params[\'custom_buttons4\']  = $mce_settings[\'tinymce_custom_buttons4\'];
		
		$html = $mce->get_mce_settings($params);
		$e->output($html);
		break;
		
	default :
		return; // stop here - this is very important. 
		break; 
}
';
$p['TinyMCE Rich Text EditorProps'] = '&customparams=Custom Parameters;textarea; &mce_formats=Block Formats;text;p,h1,h2,h3,h4,h5,h6,div,blockquote,code,pre &entity_encoding=Entity Encoding;list;named,numeric,raw;named &entities=Entities;text; &mce_path_options=Path Options;list;rootrelative,docrelative,fullpathurl;docrelative &mce_resizing=Advanced Resizing;list;true,false;true &disabledButtons=Disabled Buttons;text; &link_list=Link List;list;enabled,disabled;enabled &webtheme=Web Theme;list;simple,editor,creative,custom;simple &webPlugins=Web Plugins;text;style,advimage,advlink,searchreplace,contextmenu,paste,fullscreen,nonbreaking,xhtmlxtras,visualchars,media &webButtons1=Web Buttons 1;text;undo,redo,selectall,|,pastetext,pasteword,|,search,replace,|,nonbreaking,hr,charmap,|,image,link,unlink,anchor,media,|,cleanup,removeformat,|,fullscreen,code,help &webButtons2=Web Buttons 2;text;bold,italic,underline,strikethrough,sub,sup,|,|,blockquote,bullist,numlist,outdent,indent,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,|,styleprops &webButtons3=Web Buttons 3;text; &webButtons4=Web Buttons 4;text; &webAlign=Web Toolbar Alignment;list;ltr,rtl;ltr &width=Width;text;100% &height=Height;text;400 ';
$p['ManagerManager'] = '// You can put your ManagerManager rules EITHER in a chunk OR in an external file - whichever suits your development style the best

// To use an external file, put your rules in /assets/plugins/managermanager/mm_rules.inc.php 
// (you can rename default.mm_rules.inc.php and use it as an example)
// The chunk SHOULD have php opening tags at the beginning and end

// If you want to put your rules in a chunk (so you can edit them through the Manager),
// create the chunk, and enter its name in the configuration tab.
// The chunk should NOT have php tags at the beginning or end

// ManagerManager requires jQuery 1.3+
// The URL to the jQuery library. Choose from the configuration tab whether you want to use 
// a local copy (which defaults to the jQuery library distributed with ModX 1.0.1)
// a remote copy (which defaults to the Google Code hosted version)
// or specify a URL to a custom location.
// Here we set some default values, because this is a convenient place to change them if we need to,
// but you should configure your preference via the Configuration tab.
$js_default_url_local = $modx->config[\'site_url\']. \'/assets/js/jquery-1.7.1.min.js\';
$js_default_url_remote = \'http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js\';

// You don\'t need to change anything else from here onwards
//-------------------------------------------------------

// Run the main code
$asset_path = $modx->config[\'base_path\'] . \'assets/plugins/managermanager/mm.inc.php\';
include($asset_path);
';
$p['ManagerManagerProps'] = '&config_chunk=Configuration Chunk;text;mm_rules; &remove_deprecated_tv_types_pref=Remove deprecated TV types;list;yes,no;yes &which_jquery=jQuery source;list;local (assets/js),remote (google code),manual url (specify below);local (assets/js) &js_src_type=jQuery URL override;text; ';
$p['ManagerManager'] = '// You can put your ManagerManager rules EITHER in a chunk OR in an external file - whichever suits your development style the best

// To use an external file, put your rules in /assets/plugins/managermanager/mm_rules.inc.php 
// (you can rename default.mm_rules.inc.php and use it as an example)
// The chunk SHOULD have php opening tags at the beginning and end

// If you want to put your rules in a chunk (so you can edit them through the Manager),
// create the chunk, and enter its name in the configuration tab.
// The chunk should NOT have php tags at the beginning or end

// ManagerManager requires jQuery 1.3+
// The URL to the jQuery library. Choose from the configuration tab whether you want to use 
// a local copy (which defaults to the jQuery library distributed with ModX 1.0.1)
// a remote copy (which defaults to the Google Code hosted version)
// or specify a URL to a custom location.
// Here we set some default values, because this is a convenient place to change them if we need to,
// but you should configure your preference via the Configuration tab.
$js_default_url_local = $modx->config[\'site_url\']. \'/assets/js/jquery-1.7.1.min.js\';
$js_default_url_remote = \'http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js\';

// You don\'t need to change anything else from here onwards
//-------------------------------------------------------

// Run the main code
$asset_path = $modx->config[\'base_path\'] . \'assets/plugins/managermanager/mm.inc.php\';
include($asset_path);
';
$p['ManagerManagerProps'] = '&config_chunk=Configuration Chunk;text;mm_rules; &remove_deprecated_tv_types_pref=Remove deprecated TV types;list;yes,no;yes &which_jquery=jQuery source;list;local (assets/js),remote (google code),manual url (specify below);local (assets/js) &js_src_type=jQuery URL override;text; ';
$p['ManagerManager'] = '// You can put your ManagerManager rules EITHER in a chunk OR in an external file - whichever suits your development style the best

// To use an external file, put your rules in /assets/plugins/managermanager/mm_rules.inc.php 
// (you can rename default.mm_rules.inc.php and use it as an example)
// The chunk SHOULD have php opening tags at the beginning and end

// If you want to put your rules in a chunk (so you can edit them through the Manager),
// create the chunk, and enter its name in the configuration tab.
// The chunk should NOT have php tags at the beginning or end

// ManagerManager requires jQuery 1.3+
// The URL to the jQuery library. Choose from the configuration tab whether you want to use 
// a local copy (which defaults to the jQuery library distributed with ModX 1.0.1)
// a remote copy (which defaults to the Google Code hosted version)
// or specify a URL to a custom location.
// Here we set some default values, because this is a convenient place to change them if we need to,
// but you should configure your preference via the Configuration tab.
$js_default_url_local = $modx->config[\'site_url\']. \'/assets/js/jquery-1.7.1.min.js\';
$js_default_url_remote = \'http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js\';

// You don\'t need to change anything else from here onwards
//-------------------------------------------------------

// Run the main code
$asset_path = $modx->config[\'base_path\'] . \'assets/plugins/managermanager/mm.inc.php\';
include($asset_path);
';
$p['ManagerManagerProps'] = '&config_chunk=Configuration Chunk;text;mm_rules; &remove_deprecated_tv_types_pref=Remove deprecated TV types;list;yes,no;yes &which_jquery=jQuery source;list;local (assets/js),remote (google code),manual url (specify below);local (assets/js) &js_src_type=jQuery URL override;text; &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$p['ManagerManager'] = '// You can put your ManagerManager rules EITHER in a chunk OR in an external file - whichever suits your development style the best

// To use an external file, put your rules in /assets/plugins/managermanager/mm_rules.inc.php 
// (you can rename default.mm_rules.inc.php and use it as an example)
// The chunk SHOULD have php opening tags at the beginning and end

// If you want to put your rules in a chunk (so you can edit them through the Manager),
// create the chunk, and enter its name in the configuration tab.
// The chunk should NOT have php tags at the beginning or end

// ManagerManager requires jQuery 1.3+
// The URL to the jQuery library. Choose from the configuration tab whether you want to use 
// a local copy (which defaults to the jQuery library distributed with ModX 1.0.1)
// a remote copy (which defaults to the Google Code hosted version)
// or specify a URL to a custom location.
// Here we set some default values, because this is a convenient place to change them if we need to,
// but you should configure your preference via the Configuration tab.
$js_default_url_local = $modx->config[\'site_url\']. \'/assets/js/jquery-1.7.1.min.js\';
$js_default_url_remote = \'http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js\';

// You don\'t need to change anything else from here onwards
//-------------------------------------------------------

// Run the main code
$asset_path = $modx->config[\'base_path\'] . \'assets/plugins/managermanager/mm.inc.php\';
include($asset_path);
';
$p['ManagerManagerProps'] = '&config_chunk=Configuration Chunk;text;mm_rules; &remove_deprecated_tv_types_pref=Remove deprecated TV types;list;yes,no;yes &which_jquery=jQuery source;list;local (assets/js),remote (google code),manual url (specify below);local (assets/js) &js_src_type=jQuery URL override;text; ';
$p['Strict URLs'] = '// For overriding documents, create a new template variabe (TV) named seoOverride with the following options:
//    Input Type: DropDown List Menu
//    Input Option Values: Disabled==-1||Base Name==0||Append Extension==1||Folder==2
//    Default Value: -1

//  # Include the following in your .htaccess file
//  # Replace "example.com" &  "example\\.com" with your domain info
//  RewriteCond %{HTTP_HOST} .
//  RewriteCond %{HTTP_HOST} !^www\\.example\\.com [NC]
//  RewriteRule (.*) http://www.example.com/$1 [R=301,L] 

// Begin plugin code
$e = &$modx->event;

if ($e->name == \'OnWebPageInit\') 
{
   $documentIdentifier = $modx->documentIdentifier;

   if ($documentIdentifier)  // Check for 404 error
   {
      $myProtocol = ($_SERVER[\'HTTPS\'] == \'on\') ? \'https\' : \'http\';
      $s = $_SERVER[\'REQUEST_URI\'];
      $parts = explode("?", $s);  

      $alias = $modx->aliasListing[$documentIdentifier][\'alias\'];
      if ($makeFolders)
      {
         if ($emptyFolders)
         {
            $result = $modx->db->select(\'isfolder\', $modx->getFullTableName(\'site_content\'), \'id = \' . $documentIdentifier);
            $isfolder = $modx->db->getValue($result);
         }
         else
         {
            $isfolder = (count($modx->getChildIds($documentIdentifier, 1)) > 0) ? 1 : 0;
         }
      }

      if ($override && $overrideOption = $modx->getTemplateVarOutput($overrideTV, $documentIdentifier))
      {
         switch ($overrideOption[$overrideTV])
         {
            case 0:
               $isoverride = 1;
               break;
            case 1:
               $isfolder = 0;
               break;
            case 2:
               $makeFolders = 1;
               $isfolder = 1;
         }
      }

      if ($isoverride)
      {
         $strictURL = preg_replace(\'/[^\\/]+$/\', $alias, $modx->makeUrl($documentIdentifier));
      }
      elseif ($isfolder && $makeFolders)
      {
         $strictURL = preg_replace(\'/[^\\/]+$/\', $alias, $modx->makeUrl($documentIdentifier)) . "/";
      }
      else
      {
         $strictURL = $modx->makeUrl($documentIdentifier);
      }

      $myDomain = $myProtocol . "://" . $_SERVER[\'HTTP_HOST\'];
      $newURL = $myDomain . $strictURL;
      $requestedURL = $myDomain . $parts[0];

      if ($documentIdentifier == $modx->config[\'site_start\'])
      {
         if ($requestedURL != $modx->config[\'site_url\'])
         {
            // Force redirect of site start
            header("HTTP/1.1 301 Moved Permanently");
            $qstring = preg_replace("#(^|&)(q|id)=[^&]+#", \'\', $parts[1]);  // Strip conflicting id/q from query string
            if ($qstring) header(\'Location: \' . $modx->config[\'site_url\'] . \'?\' . $qstring);
            else header(\'Location: \' . $modx->config[\'site_url\']);
            exit(0);
         }
      }
      elseif ($parts[0] != $strictURL)
      {
         // Force page redirect
         header("HTTP/1.1 301 Moved Permanently");
         $qstring = preg_replace("#(^|&)(q|id)=[^&]+#", \'\', $parts[1]);  // Strip conflicting id/q from query string
         if ($qstring) header(\'Location: \' . $strictURL . \'?\' . $qstring);
         else header(\'Location: \' . $strictURL);
         exit(0);
      }
   }
}
elseif ($e->name == \'OnWebPagePrerender\')
{
   if ($editDocLinks)
   {
      $myDomain = $_SERVER[\'HTTP_HOST\'];
      $furlSuffix = $modx->config[\'friendly_url_suffix\'];
      $baseUrl = $modx->config[\'base_url\'];
      $o = &$modx->documentOutput; // get a reference of the output

      // Reduce site start to base url
      $overrideAlias = $modx->aliasListing[$modx->config[\'site_start\']][\'alias\'];
      $overridePath = $modx->aliasListing[$modx->config[\'site_start\']][\'path\'];
      $o = preg_replace("#((href|action)=\\"|$myDomain)($baseUrl)?($overridePath/)?$overrideAlias$furlSuffix#", \'${1}\' . $baseUrl, $o);

      if ($override)
      {
         // Replace manual override links
         $sql = "SELECT tvc.contentid as id, tvc.value as value FROM " . $modx->getFullTableName(\'site_tmplvars\') . " tv ";
         $sql .= "INNER JOIN " . $modx->getFullTableName(\'site_tmplvar_templates\') . " tvtpl ON tvtpl.tmplvarid = tv.id ";
         $sql .= "LEFT JOIN " . $modx->getFullTableName(\'site_tmplvar_contentvalues\') . " tvc ON tvc.tmplvarid = tv.id ";
         $sql .= "LEFT JOIN " . $modx->getFullTableName(\'site_content\') . " sc ON sc.id = tvc.contentid ";
         $sql .= "WHERE sc.published = 1 AND tvtpl.templateid = sc.template AND tv.name = \'$overrideTV\'";
         $results = $modx->dbQuery($sql);
         while ($row = $modx->fetchRow($results))
         {
            $overrideAlias = $modx->aliasListing[$row[\'id\']][\'alias\'];
            $overridePath = $modx->aliasListing[$row[\'id\']][\'path\'];
            switch ($row[\'value\'])
            {
               case 0:
                  $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix#", \'${1}\' . $overrideAlias, $o);
                  break;
               case 2:
                  $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix/?#", \'${1}\' . rtrim($overrideAlias, \'/\') . \'/\', $o);
                  break;
            }
         }
      }

      if ($makeFolders)
      {
         if ($emptyFolders)
         {
            // Populate isfolder array
            $isfolder_arr = array();
            $result = $modx->db->select(\'id\', $modx->getFullTableName(\'site_content\'), \'published > 0 AND isfolder > 0\');
            while ($row = $modx->db->getRow($result))
               $isfolder_arr[$row[\'id\']] = true;
         }

         // Replace container links
         foreach ($modx->documentListing as $id)
         {
            if ((is_array($isfolder_arr) && isset($isfolder_arr[$id])) || count($modx->getChildIds($id, 1)))
            {
               $overrideAlias = $modx->aliasListing[$id][\'alias\'];
               $overridePath = $modx->aliasListing[$id][\'path\'];
               $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix/?#", \'${1}\' . rtrim($overrideAlias, \'/\') . \'/\', $o);
            }
         }
      }
   }
}';
$p['Strict URLsProps'] = '&editDocLinks=Edit document links;int;1 &makeFolders=Rewrite containers as folders;int;1 &emptyFolders=Check for empty container when rewriting;int;0 &override=Enable manual overrides;int;1 &overrideTV=Override TV name;string;seoOverride ';
$p['Strict URLs'] = '// For overriding documents, create a new template variabe (TV) named seoOverride with the following options:
//    Input Type: DropDown List Menu
//    Input Option Values: Disabled==-1||Base Name==0||Append Extension==1||Folder==2
//    Default Value: -1

//  # Include the following in your .htaccess file
//  # Replace "example.com" &  "example\\.com" with your domain info
//  RewriteCond %{HTTP_HOST} .
//  RewriteCond %{HTTP_HOST} !^www\\.example\\.com [NC]
//  RewriteRule (.*) http://www.example.com/$1 [R=301,L] 

// Begin plugin code
$e = &$modx->event;

if ($e->name == \'OnWebPageInit\') 
{
   $documentIdentifier = $modx->documentIdentifier;

   if ($documentIdentifier)  // Check for 404 error
   {
      $myProtocol = ($_SERVER[\'HTTPS\'] == \'on\') ? \'https\' : \'http\';
      $s = $_SERVER[\'REQUEST_URI\'];
      $parts = explode("?", $s);  

      $alias = $modx->aliasListing[$documentIdentifier][\'alias\'];
      if ($makeFolders)
      {
         if ($emptyFolders)
         {
            $result = $modx->db->select(\'isfolder\', $modx->getFullTableName(\'site_content\'), \'id = \' . $documentIdentifier);
            $isfolder = $modx->db->getValue($result);
         }
         else
         {
            $isfolder = (count($modx->getChildIds($documentIdentifier, 1)) > 0) ? 1 : 0;
         }
      }

      if ($override && $overrideOption = $modx->getTemplateVarOutput($overrideTV, $documentIdentifier))
      {
         switch ($overrideOption[$overrideTV])
         {
            case 0:
               $isoverride = 1;
               break;
            case 1:
               $isfolder = 0;
               break;
            case 2:
               $makeFolders = 1;
               $isfolder = 1;
         }
      }

      if ($isoverride)
      {
         $strictURL = preg_replace(\'/[^\\/]+$/\', $alias, $modx->makeUrl($documentIdentifier));
      }
      elseif ($isfolder && $makeFolders)
      {
         $strictURL = preg_replace(\'/[^\\/]+$/\', $alias, $modx->makeUrl($documentIdentifier)) . "/";
      }
      else
      {
         $strictURL = $modx->makeUrl($documentIdentifier);
      }

      $myDomain = $myProtocol . "://" . $_SERVER[\'HTTP_HOST\'];
      $newURL = $myDomain . $strictURL;
      $requestedURL = $myDomain . $parts[0];

      if ($documentIdentifier == $modx->config[\'site_start\'])
      {
         if ($requestedURL != $modx->config[\'site_url\'])
         {
            // Force redirect of site start
            header("HTTP/1.1 301 Moved Permanently");
            $qstring = preg_replace("#(^|&)(q|id)=[^&]+#", \'\', $parts[1]);  // Strip conflicting id/q from query string
            if ($qstring) header(\'Location: \' . $modx->config[\'site_url\'] . \'?\' . $qstring);
            else header(\'Location: \' . $modx->config[\'site_url\']);
            exit(0);
         }
      }
      elseif ($parts[0] != $strictURL)
      {
         // Force page redirect
         header("HTTP/1.1 301 Moved Permanently");
         $qstring = preg_replace("#(^|&)(q|id)=[^&]+#", \'\', $parts[1]);  // Strip conflicting id/q from query string
         if ($qstring) header(\'Location: \' . $strictURL . \'?\' . $qstring);
         else header(\'Location: \' . $strictURL);
         exit(0);
      }
   }
}
elseif ($e->name == \'OnWebPagePrerender\')
{
   if ($editDocLinks)
   {
      $myDomain = $_SERVER[\'HTTP_HOST\'];
      $furlSuffix = $modx->config[\'friendly_url_suffix\'];
      $baseUrl = $modx->config[\'base_url\'];
      $o = &$modx->documentOutput; // get a reference of the output

      // Reduce site start to base url
      $overrideAlias = $modx->aliasListing[$modx->config[\'site_start\']][\'alias\'];
      $overridePath = $modx->aliasListing[$modx->config[\'site_start\']][\'path\'];
      $o = preg_replace("#((href|action)=\\"|$myDomain)($baseUrl)?($overridePath/)?$overrideAlias$furlSuffix#", \'${1}\' . $baseUrl, $o);

      if ($override)
      {
         // Replace manual override links
         $sql = "SELECT tvc.contentid as id, tvc.value as value FROM " . $modx->getFullTableName(\'site_tmplvars\') . " tv ";
         $sql .= "INNER JOIN " . $modx->getFullTableName(\'site_tmplvar_templates\') . " tvtpl ON tvtpl.tmplvarid = tv.id ";
         $sql .= "LEFT JOIN " . $modx->getFullTableName(\'site_tmplvar_contentvalues\') . " tvc ON tvc.tmplvarid = tv.id ";
         $sql .= "LEFT JOIN " . $modx->getFullTableName(\'site_content\') . " sc ON sc.id = tvc.contentid ";
         $sql .= "WHERE sc.published = 1 AND tvtpl.templateid = sc.template AND tv.name = \'$overrideTV\'";
         $results = $modx->dbQuery($sql);
         while ($row = $modx->fetchRow($results))
         {
            $overrideAlias = $modx->aliasListing[$row[\'id\']][\'alias\'];
            $overridePath = $modx->aliasListing[$row[\'id\']][\'path\'];
            switch ($row[\'value\'])
            {
               case 0:
                  $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix#", \'${1}\' . $overrideAlias, $o);
                  break;
               case 2:
                  $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix/?#", \'${1}\' . rtrim($overrideAlias, \'/\') . \'/\', $o);
                  break;
            }
         }
      }

      if ($makeFolders)
      {
         if ($emptyFolders)
         {
            // Populate isfolder array
            $isfolder_arr = array();
            $result = $modx->db->select(\'id\', $modx->getFullTableName(\'site_content\'), \'published > 0 AND isfolder > 0\');
            while ($row = $modx->db->getRow($result))
               $isfolder_arr[$row[\'id\']] = true;
         }

         // Replace container links
         foreach ($modx->documentListing as $id)
         {
            if ((is_array($isfolder_arr) && isset($isfolder_arr[$id])) || count($modx->getChildIds($id, 1)))
            {
               $overrideAlias = $modx->aliasListing[$id][\'alias\'];
               $overridePath = $modx->aliasListing[$id][\'path\'];
               $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix/?#", \'${1}\' . rtrim($overrideAlias, \'/\') . \'/\', $o);
            }
         }
      }
   }
}';
$p['Strict URLsProps'] = '&editDocLinks=Edit document links;int;1 &makeFolders=Rewrite containers as folders;int;1 &emptyFolders=Check for empty container when rewriting;int;0 &override=Enable manual overrides;int;1 &overrideTV=Override TV name;string;seoOverride ';
$p['Strict URLs'] = '// For overriding documents, create a new template variabe (TV) named seoOverride with the following options:
//    Input Type: DropDown List Menu
//    Input Option Values: Disabled==-1||Base Name==0||Append Extension==1||Folder==2
//    Default Value: -1

//  # Include the following in your .htaccess file
//  # Replace "example.com" &  "example\\.com" with your domain info
//  RewriteCond %{HTTP_HOST} .
//  RewriteCond %{HTTP_HOST} !^www\\.example\\.com [NC]
//  RewriteRule (.*) http://www.example.com/$1 [R=301,L] 

// Begin plugin code
$e = &$modx->event;

if ($e->name == \'OnWebPageInit\') 
{
   $documentIdentifier = $modx->documentIdentifier;

   if ($documentIdentifier)  // Check for 404 error
   {
      $myProtocol = ($_SERVER[\'HTTPS\'] == \'on\') ? \'https\' : \'http\';
      $s = $_SERVER[\'REQUEST_URI\'];
      $parts = explode("?", $s);  

      $alias = $modx->aliasListing[$documentIdentifier][\'alias\'];
      if ($makeFolders)
      {
         if ($emptyFolders)
         {
            $result = $modx->db->select(\'isfolder\', $modx->getFullTableName(\'site_content\'), \'id = \' . $documentIdentifier);
            $isfolder = $modx->db->getValue($result);
         }
         else
         {
            $isfolder = (count($modx->getChildIds($documentIdentifier, 1)) > 0) ? 1 : 0;
         }
      }

      if ($override && $overrideOption = $modx->getTemplateVarOutput($overrideTV, $documentIdentifier))
      {
         switch ($overrideOption[$overrideTV])
         {
            case 0:
               $isoverride = 1;
               break;
            case 1:
               $isfolder = 0;
               break;
            case 2:
               $makeFolders = 1;
               $isfolder = 1;
         }
      }

      if ($isoverride)
      {
         $strictURL = preg_replace(\'/[^\\/]+$/\', $alias, $modx->makeUrl($documentIdentifier));
      }
      elseif ($isfolder && $makeFolders)
      {
         $strictURL = preg_replace(\'/[^\\/]+$/\', $alias, $modx->makeUrl($documentIdentifier)) . "/";
      }
      else
      {
         $strictURL = $modx->makeUrl($documentIdentifier);
      }

      $myDomain = $myProtocol . "://" . $_SERVER[\'HTTP_HOST\'];
      $newURL = $myDomain . $strictURL;
      $requestedURL = $myDomain . $parts[0];

      if ($documentIdentifier == $modx->config[\'site_start\'])
      {
         if ($requestedURL != $modx->config[\'site_url\'])
         {
            // Force redirect of site start
            header("HTTP/1.1 301 Moved Permanently");
            $qstring = preg_replace("#(^|&)(q|id)=[^&]+#", \'\', $parts[1]);  // Strip conflicting id/q from query string
            if ($qstring) header(\'Location: \' . $modx->config[\'site_url\'] . \'?\' . $qstring);
            else header(\'Location: \' . $modx->config[\'site_url\']);
            exit(0);
         }
      }
      elseif ($parts[0] != $strictURL)
      {
         // Force page redirect
         header("HTTP/1.1 301 Moved Permanently");
         $qstring = preg_replace("#(^|&)(q|id)=[^&]+#", \'\', $parts[1]);  // Strip conflicting id/q from query string
         if ($qstring) header(\'Location: \' . $strictURL . \'?\' . $qstring);
         else header(\'Location: \' . $strictURL);
         exit(0);
      }
   }
}
elseif ($e->name == \'OnWebPagePrerender\')
{
   if ($editDocLinks)
   {
      $myDomain = $_SERVER[\'HTTP_HOST\'];
      $furlSuffix = $modx->config[\'friendly_url_suffix\'];
      $baseUrl = $modx->config[\'base_url\'];
      $o = &$modx->documentOutput; // get a reference of the output

      // Reduce site start to base url
      $overrideAlias = $modx->aliasListing[$modx->config[\'site_start\']][\'alias\'];
      $overridePath = $modx->aliasListing[$modx->config[\'site_start\']][\'path\'];
      $o = preg_replace("#((href|action)=\\"|$myDomain)($baseUrl)?($overridePath/)?$overrideAlias$furlSuffix#", \'${1}\' . $baseUrl, $o);

      if ($override)
      {
         // Replace manual override links
         $sql = "SELECT tvc.contentid as id, tvc.value as value FROM " . $modx->getFullTableName(\'site_tmplvars\') . " tv ";
         $sql .= "INNER JOIN " . $modx->getFullTableName(\'site_tmplvar_templates\') . " tvtpl ON tvtpl.tmplvarid = tv.id ";
         $sql .= "LEFT JOIN " . $modx->getFullTableName(\'site_tmplvar_contentvalues\') . " tvc ON tvc.tmplvarid = tv.id ";
         $sql .= "LEFT JOIN " . $modx->getFullTableName(\'site_content\') . " sc ON sc.id = tvc.contentid ";
         $sql .= "WHERE sc.published = 1 AND tvtpl.templateid = sc.template AND tv.name = \'$overrideTV\'";
         $results = $modx->dbQuery($sql);
         while ($row = $modx->fetchRow($results))
         {
            $overrideAlias = $modx->aliasListing[$row[\'id\']][\'alias\'];
            $overridePath = $modx->aliasListing[$row[\'id\']][\'path\'];
            switch ($row[\'value\'])
            {
               case 0:
                  $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix#", \'${1}\' . $overrideAlias, $o);
                  break;
               case 2:
                  $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix/?#", \'${1}\' . rtrim($overrideAlias, \'/\') . \'/\', $o);
                  break;
            }
         }
      }

      if ($makeFolders)
      {
         if ($emptyFolders)
         {
            // Populate isfolder array
            $isfolder_arr = array();
            $result = $modx->db->select(\'id\', $modx->getFullTableName(\'site_content\'), \'published > 0 AND isfolder > 0\');
            while ($row = $modx->db->getRow($result))
               $isfolder_arr[$row[\'id\']] = true;
         }

         // Replace container links
         foreach ($modx->documentListing as $id)
         {
            if ((is_array($isfolder_arr) && isset($isfolder_arr[$id])) || count($modx->getChildIds($id, 1)))
            {
               $overrideAlias = $modx->aliasListing[$id][\'alias\'];
               $overridePath = $modx->aliasListing[$id][\'path\'];
               $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix/?#", \'${1}\' . rtrim($overrideAlias, \'/\') . \'/\', $o);
            }
         }
      }
   }
}';
$p['Strict URLsProps'] = '&editDocLinks=Edit document links;int;1 &makeFolders=Rewrite containers as folders;int;1 &emptyFolders=Check for empty container when rewriting;int;0 &override=Enable manual overrides;int;1 &overrideTV=Override TV name;string;seoOverride &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$p['Strict URLs'] = '// For overriding documents, create a new template variabe (TV) named seoOverride with the following options:
//    Input Type: DropDown List Menu
//    Input Option Values: Disabled==-1||Base Name==0||Append Extension==1||Folder==2
//    Default Value: -1

//  # Include the following in your .htaccess file
//  # Replace "example.com" &  "example\\.com" with your domain info
//  RewriteCond %{HTTP_HOST} .
//  RewriteCond %{HTTP_HOST} !^www\\.example\\.com [NC]
//  RewriteRule (.*) http://www.example.com/$1 [R=301,L] 

// Begin plugin code
$e = &$modx->event;

if ($e->name == \'OnWebPageInit\') 
{
   $documentIdentifier = $modx->documentIdentifier;

   if ($documentIdentifier)  // Check for 404 error
   {
      $myProtocol = ($_SERVER[\'HTTPS\'] == \'on\') ? \'https\' : \'http\';
      $s = $_SERVER[\'REQUEST_URI\'];
      $parts = explode("?", $s);  

      $alias = $modx->aliasListing[$documentIdentifier][\'alias\'];
      if ($makeFolders)
      {
         if ($emptyFolders)
         {
            $result = $modx->db->select(\'isfolder\', $modx->getFullTableName(\'site_content\'), \'id = \' . $documentIdentifier);
            $isfolder = $modx->db->getValue($result);
         }
         else
         {
            $isfolder = (count($modx->getChildIds($documentIdentifier, 1)) > 0) ? 1 : 0;
         }
      }

      if ($override && $overrideOption = $modx->getTemplateVarOutput($overrideTV, $documentIdentifier))
      {
         switch ($overrideOption[$overrideTV])
         {
            case 0:
               $isoverride = 1;
               break;
            case 1:
               $isfolder = 0;
               break;
            case 2:
               $makeFolders = 1;
               $isfolder = 1;
         }
      }

      if ($isoverride)
      {
         $strictURL = preg_replace(\'/[^\\/]+$/\', $alias, $modx->makeUrl($documentIdentifier));
      }
      elseif ($isfolder && $makeFolders)
      {
         $strictURL = preg_replace(\'/[^\\/]+$/\', $alias, $modx->makeUrl($documentIdentifier)) . "/";
      }
      else
      {
         $strictURL = $modx->makeUrl($documentIdentifier);
      }

      $myDomain = $myProtocol . "://" . $_SERVER[\'HTTP_HOST\'];
      $newURL = $myDomain . $strictURL;
      $requestedURL = $myDomain . $parts[0];

      if ($documentIdentifier == $modx->config[\'site_start\'])
      {
         if ($requestedURL != $modx->config[\'site_url\'])
         {
            // Force redirect of site start
            header("HTTP/1.1 301 Moved Permanently");
            $qstring = preg_replace("#(^|&)(q|id)=[^&]+#", \'\', $parts[1]);  // Strip conflicting id/q from query string
            if ($qstring) header(\'Location: \' . $modx->config[\'site_url\'] . \'?\' . $qstring);
            else header(\'Location: \' . $modx->config[\'site_url\']);
            exit(0);
         }
      }
      elseif ($parts[0] != $strictURL)
      {
         // Force page redirect
         header("HTTP/1.1 301 Moved Permanently");
         $qstring = preg_replace("#(^|&)(q|id)=[^&]+#", \'\', $parts[1]);  // Strip conflicting id/q from query string
         if ($qstring) header(\'Location: \' . $strictURL . \'?\' . $qstring);
         else header(\'Location: \' . $strictURL);
         exit(0);
      }
   }
}
elseif ($e->name == \'OnWebPagePrerender\')
{
   if ($editDocLinks)
   {
      $myDomain = $_SERVER[\'HTTP_HOST\'];
      $furlSuffix = $modx->config[\'friendly_url_suffix\'];
      $baseUrl = $modx->config[\'base_url\'];
      $o = &$modx->documentOutput; // get a reference of the output

      // Reduce site start to base url
      $overrideAlias = $modx->aliasListing[$modx->config[\'site_start\']][\'alias\'];
      $overridePath = $modx->aliasListing[$modx->config[\'site_start\']][\'path\'];
      $o = preg_replace("#((href|action)=\\"|$myDomain)($baseUrl)?($overridePath/)?$overrideAlias$furlSuffix#", \'${1}\' . $baseUrl, $o);

      if ($override)
      {
         // Replace manual override links
         $sql = "SELECT tvc.contentid as id, tvc.value as value FROM " . $modx->getFullTableName(\'site_tmplvars\') . " tv ";
         $sql .= "INNER JOIN " . $modx->getFullTableName(\'site_tmplvar_templates\') . " tvtpl ON tvtpl.tmplvarid = tv.id ";
         $sql .= "LEFT JOIN " . $modx->getFullTableName(\'site_tmplvar_contentvalues\') . " tvc ON tvc.tmplvarid = tv.id ";
         $sql .= "LEFT JOIN " . $modx->getFullTableName(\'site_content\') . " sc ON sc.id = tvc.contentid ";
         $sql .= "WHERE sc.published = 1 AND tvtpl.templateid = sc.template AND tv.name = \'$overrideTV\'";
         $results = $modx->dbQuery($sql);
         while ($row = $modx->fetchRow($results))
         {
            $overrideAlias = $modx->aliasListing[$row[\'id\']][\'alias\'];
            $overridePath = $modx->aliasListing[$row[\'id\']][\'path\'];
            switch ($row[\'value\'])
            {
               case 0:
                  $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix#", \'${1}\' . $overrideAlias, $o);
                  break;
               case 2:
                  $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix/?#", \'${1}\' . rtrim($overrideAlias, \'/\') . \'/\', $o);
                  break;
            }
         }
      }

      if ($makeFolders)
      {
         if ($emptyFolders)
         {
            // Populate isfolder array
            $isfolder_arr = array();
            $result = $modx->db->select(\'id\', $modx->getFullTableName(\'site_content\'), \'published > 0 AND isfolder > 0\');
            while ($row = $modx->db->getRow($result))
               $isfolder_arr[$row[\'id\']] = true;
         }

         // Replace container links
         foreach ($modx->documentListing as $id)
         {
            if ((is_array($isfolder_arr) && isset($isfolder_arr[$id])) || count($modx->getChildIds($id, 1)))
            {
               $overrideAlias = $modx->aliasListing[$id][\'alias\'];
               $overridePath = $modx->aliasListing[$id][\'path\'];
               $o = preg_replace("#((href|action)=\\"($baseUrl)?($overridePath/)?|$myDomain$baseUrl$overridePath/?)$overrideAlias$furlSuffix/?#", \'${1}\' . rtrim($overrideAlias, \'/\') . \'/\', $o);
            }
         }
      }
   }
}';
$p['Strict URLsProps'] = '&editDocLinks=Edit document links;int;1 &makeFolders=Rewrite containers as folders;int;1 &emptyFolders=Check for empty container when rewriting;int;0 &override=Enable manual overrides;int;1 &overrideTV=Override TV name;string;seoOverride ';
$p['TransAlias'] = '/*
 * Initialize parameters
 */
if (!isset ($alias)) { return ; }
if (!isset ($plugin_dir) ) { $plugin_dir = \'transalias\'; }
if (!isset ($plugin_path) ) { $plugin_path = $modx->config[\'base_path\'].\'assets/plugins/\'.$plugin_dir; }
if (!isset ($table_name)) { $table_name = \'common\'; }
if (!isset ($char_restrict)) { $char_restrict = \'lowercase alphanumeric\'; }
if (!isset ($remove_periods)) { $remove_periods = \'No\'; }
if (!isset ($word_separator)) { $word_separator = \'dash\'; }
if (!isset ($override_tv)) { $override_tv = \'\'; }

if (!class_exists(\'TransAlias\')) {
    require_once $plugin_path.\'/transalias.class.php\';
}
$trans = new TransAlias($modx);

/*
 * see if TV overrides the table name
 */
if(!empty($override_tv)) {
    $tvval = $trans->getTVValue($override_tv);
    if(!empty($tvval)) {
        $table_name = $tvval;
    }
}

/*
 * Handle events
 */
$e =& $modx->event;
switch ($e->name ) {
    case \'OnStripAlias\':
        if ($trans->loadTable($table_name, $remove_periods)) {
            $output = $trans->stripAlias($alias,$char_restrict,$word_separator);
            $e->output($output);
            $e->stopPropagation();
        }
        break ;
    default:
        return ;
}';
$p['TransAliasProps'] = '&table_name=Trans table;list;common,russian,utf8,utf8lowercase;russian &char_restrict=Restrict alias to;list;lowercase alphanumeric,alphanumeric,legal characters;lowercase alphanumeric &remove_periods=Remove Periods;list;Yes,No;No &word_separator=Word Separator;list;dash,underscore,none;dash &override_tv=Override TV name;string; ';
$p['TransAlias'] = '/*
 * Initialize parameters
 */
if (!isset ($alias)) { return ; }
if (!isset ($plugin_dir) ) { $plugin_dir = \'transalias\'; }
if (!isset ($plugin_path) ) { $plugin_path = $modx->config[\'base_path\'].\'assets/plugins/\'.$plugin_dir; }
if (!isset ($table_name)) { $table_name = \'common\'; }
if (!isset ($char_restrict)) { $char_restrict = \'lowercase alphanumeric\'; }
if (!isset ($remove_periods)) { $remove_periods = \'No\'; }
if (!isset ($word_separator)) { $word_separator = \'dash\'; }
if (!isset ($override_tv)) { $override_tv = \'\'; }

if (!class_exists(\'TransAlias\')) {
    require_once $plugin_path.\'/transalias.class.php\';
}
$trans = new TransAlias($modx);

/*
 * see if TV overrides the table name
 */
if(!empty($override_tv)) {
    $tvval = $trans->getTVValue($override_tv);
    if(!empty($tvval)) {
        $table_name = $tvval;
    }
}

/*
 * Handle events
 */
$e =& $modx->event;
switch ($e->name ) {
    case \'OnStripAlias\':
        if ($trans->loadTable($table_name, $remove_periods)) {
            $output = $trans->stripAlias($alias,$char_restrict,$word_separator);
            $e->output($output);
            $e->stopPropagation();
        }
        break ;
    default:
        return ;
}';
$p['TransAliasProps'] = '&table_name=Trans table;list;common,russian,utf8,utf8lowercase;russian &char_restrict=Restrict alias to;list;lowercase alphanumeric,alphanumeric,legal characters;lowercase alphanumeric &remove_periods=Remove Periods;list;Yes,No;No &word_separator=Word Separator;list;dash,underscore,none;dash &override_tv=Override TV name;string; ';
$p['TransAlias'] = '/*
 * Initialize parameters
 */
if (!isset ($alias)) { return ; }
if (!isset ($plugin_dir) ) { $plugin_dir = \'transalias\'; }
if (!isset ($plugin_path) ) { $plugin_path = $modx->config[\'base_path\'].\'assets/plugins/\'.$plugin_dir; }
if (!isset ($table_name)) { $table_name = \'common\'; }
if (!isset ($char_restrict)) { $char_restrict = \'lowercase alphanumeric\'; }
if (!isset ($remove_periods)) { $remove_periods = \'No\'; }
if (!isset ($word_separator)) { $word_separator = \'dash\'; }
if (!isset ($override_tv)) { $override_tv = \'\'; }

if (!class_exists(\'TransAlias\')) {
    require_once $plugin_path.\'/transalias.class.php\';
}
$trans = new TransAlias($modx);

/*
 * see if TV overrides the table name
 */
if(!empty($override_tv)) {
    $tvval = $trans->getTVValue($override_tv);
    if(!empty($tvval)) {
        $table_name = $tvval;
    }
}

/*
 * Handle events
 */
$e =& $modx->event;
switch ($e->name ) {
    case \'OnStripAlias\':
        if ($trans->loadTable($table_name, $remove_periods)) {
            $output = $trans->stripAlias($alias,$char_restrict,$word_separator);
            $e->output($output);
            $e->stopPropagation();
        }
        break ;
    default:
        return ;
}';
$p['TransAliasProps'] = '&table_name=Trans table;list;common,russian,utf8,utf8lowercase;russian &char_restrict=Restrict alias to;list;lowercase alphanumeric,alphanumeric,legal characters;lowercase alphanumeric &remove_periods=Remove Periods;list;Yes,No;No &word_separator=Word Separator;list;dash,underscore,none;dash &override_tv=Override TV name;string; &cols=Ширина колонок через запятую;string;40,40,150,60,100,100,100,45,50,50,55 &height=Высота таблицы;string;500 &ui_theme=Тема jquery-ui(путь к папке с темой внутри папки css);string;smoothness';
$p['TransAlias'] = '/*
 * Initialize parameters
 */
if (!isset ($alias)) { return ; }
if (!isset ($plugin_dir) ) { $plugin_dir = \'transalias\'; }
if (!isset ($plugin_path) ) { $plugin_path = $modx->config[\'base_path\'].\'assets/plugins/\'.$plugin_dir; }
if (!isset ($table_name)) { $table_name = \'common\'; }
if (!isset ($char_restrict)) { $char_restrict = \'lowercase alphanumeric\'; }
if (!isset ($remove_periods)) { $remove_periods = \'No\'; }
if (!isset ($word_separator)) { $word_separator = \'dash\'; }
if (!isset ($override_tv)) { $override_tv = \'\'; }

if (!class_exists(\'TransAlias\')) {
    require_once $plugin_path.\'/transalias.class.php\';
}
$trans = new TransAlias($modx);

/*
 * see if TV overrides the table name
 */
if(!empty($override_tv)) {
    $tvval = $trans->getTVValue($override_tv);
    if(!empty($tvval)) {
        $table_name = $tvval;
    }
}

/*
 * Handle events
 */
$e =& $modx->event;
switch ($e->name ) {
    case \'OnStripAlias\':
        if ($trans->loadTable($table_name, $remove_periods)) {
            $output = $trans->stripAlias($alias,$char_restrict,$word_separator);
            $e->output($output);
            $e->stopPropagation();
        }
        break ;
    default:
        return ;
}';
$p['TransAliasProps'] = '&table_name=Trans table;list;common,russian,utf8,utf8lowercase;russian &char_restrict=Restrict alias to;list;lowercase alphanumeric,alphanumeric,legal characters;lowercase alphanumeric &remove_periods=Remove Periods;list;Yes,No;No &word_separator=Word Separator;list;dash,underscore,none;dash &override_tv=Override TV name;string; ';
$e = &$this->pluginEvent;
$e['OnBeforeManagerLogin'] = array('Forgot Manager Login');
$e['OnChunkFormRender'] = array('CodeMirror');
$e['OnDocFormPrerender'] = array('ManagerManager');
$e['OnDocFormRender'] = array('CodeMirror','ManagerManager');
$e['OnInterfaceSettingsRender'] = array('TinyMCE Rich Text Editor');
$e['OnManagerAuthentication'] = array('Forgot Manager Login');
$e['OnManagerLoginFormRender'] = array('Forgot Manager Login');
$e['OnModFormRender'] = array('CodeMirror');
$e['OnPluginFormRender'] = array('CodeMirror');
$e['OnRichTextEditorInit'] = array('TinyMCE Rich Text Editor');
$e['OnRichTextEditorRegister'] = array('TinyMCE Rich Text Editor');
$e['OnSnipFormRender'] = array('CodeMirror');
$e['OnStripAlias'] = array('TransAlias');
$e['OnTempFormRender'] = array('CodeMirror');
$e['OnTVFormRender'] = array('ManagerManager');
$e['OnWebPageInit'] = array('Strict URLs');
$e['OnWebPagePrerender'] = array('Strict URLs');

